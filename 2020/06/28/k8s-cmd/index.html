<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon/favicon-16x16.png">
  <meta name="google-site-verification" content="xitt2fbphh1nTeWLiTWc0lCggHuxJ5heMcAzkHW2vno">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Microsoft+YaHei+UI:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"cyun.tech","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.11.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"utterances","storage":true,"lazyload":false,"nav":null,"activeClass":"utterances"},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":10,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="K8s commandsKubernetes resources are usually created&#x2F;edited by posting a JSON or YAML manifest to the Kubernetes REST API endpoint, as with this manifest, you have more control of the resource, a">
<meta property="og:type" content="article">
<meta property="og:title" content="k8s_cmd">
<meta property="og:url" content="http://cyun.tech/2020/06/28/k8s-cmd/index.html">
<meta property="og:site_name" content="CYun">
<meta property="og:description" content="K8s commandsKubernetes resources are usually created&#x2F;edited by posting a JSON or YAML manifest to the Kubernetes REST API endpoint, as with this manifest, you have more control of the resource, a">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://cyun.tech/images/k8s/k8s_cheat_sheet.png">
<meta property="og:image" content="https://cyun.tech/images/k8s/k8s_modify_resource.png">
<meta property="article:published_time" content="2020-06-28T00:35:45.000Z">
<meta property="article:modified_time" content="2023-08-16T15:02:01.153Z">
<meta property="article:author" content="Jason">
<meta property="article:tag" content="k8s">
<meta property="article:tag" content="k8s_command">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cyun.tech/images/k8s/k8s_cheat_sheet.png">


<link rel="canonical" href="http://cyun.tech/2020/06/28/k8s-cmd/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://cyun.tech/2020/06/28/k8s-cmd/","path":"2020/06/28/k8s-cmd/","title":"k8s_cmd"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>k8s_cmd | CYun</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-148730544-1"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-148730544-1","only_pageview":false}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>

  <script src="/js/third-party/analytics/baidu-analytics.js"></script>
  <script async src="https://hm.baidu.com/hm.js?a510d1f580c8231f8f867d14f42bb8ea"></script>




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">CYun</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#K8s-commands"><span class="nav-number">1.</span> <span class="nav-text">K8s commands</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#K8s-mostly-used-resources"><span class="nav-number">1.1.</span> <span class="nav-text">K8s mostly used resources</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#cluster"><span class="nav-number">1.2.</span> <span class="nav-text">cluster</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Namespace"><span class="nav-number">1.3.</span> <span class="nav-text">Namespace</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#POD"><span class="nav-number">1.4.</span> <span class="nav-text">POD</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Replica"><span class="nav-number">1.5.</span> <span class="nav-text">Replica</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DaemonSet"><span class="nav-number">1.6.</span> <span class="nav-text">DaemonSet</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Job-CronJob"><span class="nav-number">1.7.</span> <span class="nav-text">Job, CronJob</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Service"><span class="nav-number">1.8.</span> <span class="nav-text">Service</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Ingress"><span class="nav-number">1.9.</span> <span class="nav-text">Ingress</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Deployment"><span class="nav-number">1.10.</span> <span class="nav-text">Deployment</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#configMap-downwardAPI-secret"><span class="nav-number">1.11.</span> <span class="nav-text">configMap, downwardAPI, secret</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#secrets"><span class="nav-number">1.11.1.</span> <span class="nav-text">secrets</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Volumes"><span class="nav-number">1.12.</span> <span class="nav-text">Volumes</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Ref"><span class="nav-number">1.13.</span> <span class="nav-text">Ref</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Jason"
      src="/uploads/avatar.gif">
  <p class="site-author-name" itemprop="name">Jason</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">149</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">141</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">148</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/jason-cyun" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;jason-cyun" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:jason_lkm@163.com" title="E-Mail → mailto:jason_lkm@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://cyun.tech/2020/06/28/k8s-cmd/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.gif">
      <meta itemprop="name" content="Jason">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CYun">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="k8s_cmd | CYun">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          k8s_cmd
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-06-28 08:35:45" itemprop="dateCreated datePublished" datetime="2020-06-28T08:35:45+08:00">2020-06-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-08-16 23:02:01" itemprop="dateModified" datetime="2023-08-16T23:02:01+08:00">2023-08-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/k8s/" itemprop="url" rel="index"><span itemprop="name">k8s</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/k8s/overview/" itemprop="url" rel="index"><span itemprop="name">overview</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="K8s-commands"><a href="#K8s-commands" class="headerlink" title="K8s commands"></a>K8s commands</h1><p>Kubernetes resources are usually created&#x2F;edited by <code>posting a JSON or YAML manifest</code> to the Kubernetes REST API endpoint, as with this manifest, you have <code>more control of the resource</code>, also it is a bit complex, hence K8S provides specific commands to create&#x2F;edit limited properties of resources.<br><img src="https://cyun.tech/images/k8s/k8s_cheat_sheet.png" alt="k8s_cheat_sheet"></p>
<span id="more"></span>

<p><strong>create&#x2F;delete resource</strong><br>you can create resource by generic API with yaml file or you can create it by specific command for specific resource</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl create configmap| deployment| namespace| secret| job <span class="variable">$options</span></span><br><span class="line">$ kubectl create -f xxx.yaml</span><br></pre></td></tr></table></figure>

<p><strong>modify resource</strong><br><img src="https://cyun.tech/images/k8s/k8s_modify_resource.png" alt="k8s_modify_resource"></p>
<p><strong>NOTE</strong></p>
<ul>
<li><p><code>apply</code> manages applications through files defining Kubernetes resources. It creates and updates resources in a cluster through running kubectl apply. <strong>This is the recommended way of managing Kubernetes applications on production</strong>.</p>
</li>
<li><p><code>apply</code> behaves like <code>create</code> if resource does not exist, otherwise, modify it, but the yaml must be full definition of a resource, so modification always needs <code>kubectl get deploy kubia -o yaml</code>, then modify the field, then apply it back.</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl apply -f ./my-manifest.yaml            <span class="comment"># create resource(s)</span></span><br><span class="line">$ kubectl apply -f ./my1.yaml -f ./my2.yaml      <span class="comment"># create from multiple files</span></span><br><span class="line">$ kubectl apply -f ./dir                         <span class="comment"># create resource(s) in all manifest files in dir</span></span><br><span class="line">$ kubectl apply -f https://git.io/vPieo          <span class="comment"># create resource(s) from url</span></span><br></pre></td></tr></table></figure>

<p><strong>creating from json&#x2F;yaml file</strong><br><code>More control of resources</code>, it’s a bit complex, but for each resource type, only a few properties are a must ,you only need to set that part, please refer to each resource type to see how to create each type from json&#x2F;yaml.</p>
<p><strong>get help for each resource, properties</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl explain pods</span><br><span class="line">KIND:     Pod</span><br><span class="line">VERSION:  v1</span><br><span class="line"></span><br><span class="line">DESCRIPTION:</span><br><span class="line">     Pod is a collection of containers that can run on a host. This resource is</span><br><span class="line">     created by clients and scheduled onto hosts.</span><br><span class="line"></span><br><span class="line">FIELDS:</span><br><span class="line">   apiVersion	&lt;string&gt;</span><br><span class="line">     APIVersion defines the versioned schema of this representation of an</span><br><span class="line">     object. Servers should convert recognized schemas to the latest internal</span><br><span class="line">     value, and may reject unrecognized values. More info:</span><br><span class="line">     https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md<span class="comment">#resources</span></span><br><span class="line"></span><br><span class="line">   kind	&lt;string&gt;</span><br><span class="line">     Kind is a string value representing the REST resource this object</span><br><span class="line">     represents. Servers may infer this from the endpoint the client submits</span><br><span class="line">     requests to. Cannot be updated. In CamelCase. More info:</span><br><span class="line">     https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md<span class="comment">#types-kinds</span></span><br><span class="line">...</span><br><span class="line">$ kubectl explain pod.metadata</span><br><span class="line">...</span><br><span class="line">$ kubectl explain pod.metadata.labels</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h2 id="K8s-mostly-used-resources"><a href="#K8s-mostly-used-resources" class="headerlink" title="K8s mostly used resources"></a>K8s mostly used resources</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">NAME                              SHORTNAMES      NAMESPACED   KIND</span><br><span class="line"> componentstatuses                 cs              false        ComponentStatus</span><br><span class="line"> configmaps                        cm              true         ConfigMap</span><br><span class="line"> namespaces                        ns              false        Namespace</span><br><span class="line"></span><br><span class="line"> nodes                             no              false        Node</span><br><span class="line"></span><br><span class="line"> persistentvolumeclaims            pvc             true         PersistentVolumeClaim</span><br><span class="line"></span><br><span class="line"> persistentvolumes                 pv              false        PersistentVolume</span><br><span class="line"></span><br><span class="line"> pods                              po              true         Pod</span><br><span class="line"> replicationcontrollers            rc              true         ReplicationController</span><br><span class="line"> resourcequotas                    quota           true         ResourceQuota</span><br><span class="line"> secrets                                           true         Secret</span><br><span class="line"> services                          svc             true         Service</span><br><span class="line"> daemonsets                        ds              true         DaemonSet</span><br><span class="line"> deployments                       deploy          true         Deployment</span><br><span class="line"> replicasets                       rs              true         ReplicaSet</span><br><span class="line"> cronjobs                          cj              true         CronJob</span><br><span class="line"> jobs                                              true         Job</span><br><span class="line"> events                            ev              true         Event</span><br><span class="line"> ingresses                         ing             true         Ingress</span><br><span class="line"> ...</span><br></pre></td></tr></table></figure>

<p><strong>generic options for all resources</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">--all-namespaces</span><br><span class="line">-n=kube-system</span><br><span class="line">-n kube-system</span><br><span class="line">-o wide</span><br><span class="line">-o json</span><br></pre></td></tr></table></figure>
<h2 id="cluster"><a href="#cluster" class="headerlink" title="cluster"></a>cluster</h2><ul>
<li><p>context related</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># context is groups of running info, higher than ns</span></span><br><span class="line"><span class="comment"># context has cluster and default ns for it</span></span><br><span class="line">$ sudo kubectl config current-context</span><br><span class="line">$ sudo kubectl config get-contexts</span><br><span class="line">CURRENT   NAME       CLUSTER    AUTHINFO   NAMESPACE</span><br><span class="line">*         minikube   minikube   minikube   default</span><br><span class="line"></span><br><span class="line"><span class="comment"># create a new context and switch to it, must create test-ns before it</span></span><br><span class="line">$ sudo kubectl config set-context test-ctx --namespace=test-ns --user=minikube --cluster=minikube</span><br><span class="line">$ sudo kubectl config get-contexts</span><br><span class="line">CURRENT   NAME       CLUSTER    AUTHINFO   NAMESPACE</span><br><span class="line">*         minikube   minikube   minikube   default</span><br><span class="line">          test-ctx   minikube   minikube   test-ns</span><br><span class="line"></span><br><span class="line">$ sudo kubectl config use-context test-ctx</span><br></pre></td></tr></table></figure>
</li>
<li><p>nodes related</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># show all nodes(master and worker)</span></span><br><span class="line">$ sudo kubectl get no -o wide</span><br><span class="line">NAME   STATUS   ROLES                  AGE   VERSION   INTERNAL-IP   EXTERNAL-IP   OS-IMAGE             KERNEL-VERSION       CONTAINER-RUNTIME</span><br><span class="line">dev    Ready    control-plane,master   17h   v1.20.2   10.116.5.201   &lt;none&gt;        Ubuntu 18.04.5 LTS   4.15.0-139-generic   docker://20.10.5</span><br><span class="line"></span><br><span class="line"><span class="comment"># get details about node</span></span><br><span class="line">$ kubectl describe nodes</span><br><span class="line"></span><br><span class="line">$ kubectl describe node dev</span><br><span class="line">Name:               dev</span><br><span class="line">Roles:              master</span><br><span class="line">Labels:             beta.kubernetes.io/arch=amd64</span><br><span class="line">                    beta.kubernetes.io/os=linux</span><br><span class="line">                    kubernetes.io/arch=amd64</span><br><span class="line">...</span><br><span class="line">CPU INO /OS INFO/ Pod Running</span><br><span class="line"></span><br><span class="line"><span class="comment"># label related</span></span><br><span class="line"><span class="comment"># set and filter with label</span></span><br><span class="line">$ kubectl label node dev disk=ssd</span><br><span class="line">$ kubectl get node -l disk=ssd</span><br></pre></td></tr></table></figure>
</li>
<li><p>cluster info</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl cluster-info</span><br><span class="line">Kubernetes master is running at https://192.168.1.1:8443</span><br><span class="line">KubeDNS is running at https://192.168.1.1:8443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy</span><br></pre></td></tr></table></figure></li>
<li><p>addon related</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">$ minikube addons list</span><br><span class="line">|-----------------------------|----------|--------------|</span><br><span class="line">|         ADDON NAME          | PROFILE  |    STATUS    |</span><br><span class="line">|-----------------------------|----------|--------------|</span><br><span class="line">| ambassador                  | minikube | disabled     |</span><br><span class="line">| dashboard                   | minikube | enabled ✅   |</span><br><span class="line">| default-storageclass        | minikube | enabled ✅   |</span><br><span class="line">| efk                         | minikube | disabled     |</span><br><span class="line">| freshpod                    | minikube | disabled     |</span><br><span class="line">| gvisor                      | minikube | disabled     |</span><br><span class="line">| helm-tiller                 | minikube | disabled     |</span><br><span class="line">| ingress                     | minikube | disabled     |</span><br><span class="line">| ingress-dns                 | minikube | disabled     |</span><br><span class="line">| istio                       | minikube | disabled     |</span><br><span class="line"></span><br><span class="line"><span class="comment"># enable ingress plugin</span></span><br><span class="line">$ minikube addons <span class="built_in">enable</span> ingress</span><br><span class="line">The <span class="string">&#x27;ingress&#x27;</span> addon is enabled.</span><br><span class="line"></span><br><span class="line"><span class="comment"># after ingress is enabled, a ingress pod is running listen on 80/443 by nginx</span></span><br><span class="line"><span class="comment"># and meanwhile docker-proxy starts as well on the node which ingress pod runs.</span></span><br><span class="line"><span class="comment"># so that if you access that node on port 80, it will proxy the traffic to ingress container</span></span><br><span class="line"><span class="comment"># which performs ingress rules and selects the proper endpoint depends on rule</span></span><br><span class="line"></span><br><span class="line">$ sudo kubectl get po -n kube-system -o wide -l app.kubernetes.io/name=ingress-nginx</span><br><span class="line">NAME                                        READY   STATUS      RESTARTS   AGE   IP           NODE   NOMINATED NODE   READINESS GATES</span><br><span class="line">ingress-nginx-controller-797b4b5ff7-jk8wp   1/1     Running     0          10h   172.17.0.6   dev    &lt;none&gt;           &lt;none&gt;</span><br><span class="line"></span><br><span class="line">$ ps -ef | grep docker-proxy</span><br><span class="line">ubuntu   19579  1156  0 01:44 pts/1    00:00:00 grep -i -n --color docker-proxy</span><br><span class="line">root     26472  6646  0 Mar25 ?        00:00:00 /usr/bin/docker-proxy -proto tcp -host-ip 0.0.0.0 -host-port 443 -container-ip 172.17.0.6 -container-port 443</span><br><span class="line">root     26485  6646  0 Mar25 ?        00:00:00 /usr/bin/docker-proxy -proto tcp -host-ip 0.0.0.0 -host-port 80 -container-ip 172.17.0.6 -container-port 80</span><br><span class="line"></span><br><span class="line"><span class="comment"># docker-proxy just adds iptable rules based on parameters for ingress pod.</span></span><br></pre></td></tr></table></figure>
<h2 id="Namespace"><a href="#Namespace" class="headerlink" title="Namespace"></a>Namespace</h2><p><strong>create ns from yaml</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersioin:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Namespace</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">test-ns</span></span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl create -f ns.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># create a namespace from command line</span></span><br><span class="line">$ kubectl create namespace test-ns</span><br><span class="line"><span class="comment"># show all namespaces</span></span><br><span class="line">$ kubectl get ns</span><br><span class="line"></span><br><span class="line"><span class="comment"># delete ns will delete resource in that namespace as well!! like Pod, replicaSet, deployment etc</span></span><br><span class="line">$ kubectl delete test-ns</span><br><span class="line"></span><br><span class="line"><span class="comment"># delete all pods in default ns</span></span><br><span class="line">$ kubectl delete pods --all</span><br><span class="line"><span class="comment"># delete all resource in default ns, after the delete, the ns is still there!!!</span></span><br><span class="line">$ kubectl delete all --all</span><br></pre></td></tr></table></figure>
<h2 id="POD"><a href="#POD" class="headerlink" title="POD"></a>POD</h2><p><strong>create standalone pod(no replicaset, no deployment involved) from yaml</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">kubia-mannual</span></span><br><span class="line">    <span class="comment"># speicify namespace of this pod</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">kubia</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">    <span class="comment"># without nodeSelector, pod can be scheduled to any node</span></span><br><span class="line">    <span class="attr">nodeSelector:</span></span><br><span class="line">      <span class="comment"># select scheduled node(s) with such label</span></span><br><span class="line">      <span class="comment"># which has highest priority, select pod then create deployment(like Daemset on the selected node)</span></span><br><span class="line">      <span class="attr">disk:</span> <span class="string">&quot;ssd&quot;</span></span><br><span class="line">    <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">luksa/kubia</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">kubia-mannual</span></span><br><span class="line">      <span class="attr">ports:</span></span><br><span class="line">      <span class="comment"># it just says the container is listening on 8080</span></span><br><span class="line">      <span class="comment"># even without it, you still can access 8080 for this pod</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8080</span></span><br><span class="line">        <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># add liveness probe</span></span><br><span class="line">      <span class="attr">livenessProbe:</span></span><br><span class="line">        <span class="attr">httpGet:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">          <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">        <span class="attr">initialDelaySeconds:</span> <span class="number">10</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># this creates a standalone pod(no replicacontroller, no replicaset, no deployment)</span></span><br><span class="line"><span class="comment"># even for standalone pod, if it dies, will be restarted by k8s</span></span><br><span class="line">$ kubectl create -f pod.yaml</span><br></pre></td></tr></table></figure>
<p><strong>create standalone pod from cmd</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl run kubia-t --image=luksa/kubia --port=8080</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># get pods from default namespace</span></span><br><span class="line">$ kubectl get pods</span><br><span class="line"></span><br><span class="line"><span class="comment"># show ip of a given pod/all pods</span></span><br><span class="line">$ kubectl get pods -o wide</span><br><span class="line">$ kubectl get pods kubia -o wide</span><br><span class="line"></span><br><span class="line"><span class="comment"># more detail about pods</span></span><br><span class="line">$ kubectl describe pods</span><br><span class="line">$ kubectl describe pods kube-apiserver-dev-alokb</span><br><span class="line"></span><br><span class="line"><span class="comment"># output pod conf with yaml or json</span></span><br><span class="line">$ kubectl get pod kubia -o yaml</span><br><span class="line">$ kubectl get pod kubia -o json</span><br><span class="line"></span><br><span class="line"><span class="comment"># get logs of a given pod</span></span><br><span class="line">$ kubectl logs kubia-mannual</span><br><span class="line"><span class="comment"># get logs of a container(add container name) in a given pod(pod may have multiple containers)</span></span><br><span class="line">$ kubectl logs kubia-mannual -c kubia-mannual</span><br><span class="line"></span><br><span class="line"><span class="comment"># access service in pod(pod is listening on 8080) without service resource</span></span><br><span class="line"><span class="comment"># way 1:</span></span><br><span class="line">$ curl http://<span class="variable">$pod_ip</span>:8080</span><br><span class="line"></span><br><span class="line"><span class="comment"># way 2:</span></span><br><span class="line"><span class="comment"># forward host port to container port, after run it hangs(added iptable rule on host)</span></span><br><span class="line">$ kubectl port-forward kubia-mannual 8888:8080</span><br><span class="line"><span class="comment"># open another terminal</span></span><br><span class="line">$ curl localhost:8888</span><br><span class="line"></span><br><span class="line"><span class="comment"># delete pod/pods</span></span><br><span class="line">$ kubectl delete pods kubia</span><br><span class="line"><span class="comment"># delete all pods and service in current namespace</span></span><br><span class="line">$ kubectl delete pods,svc --all</span><br><span class="line"></span><br><span class="line"><span class="comment"># delete pod with label selector</span></span><br><span class="line">$ kubectl delete pods -l app=kubia</span><br><span class="line"></span><br><span class="line"><span class="comment"># run cmd in specific container of a pod</span></span><br><span class="line">$ kubectl <span class="built_in">exec</span> <span class="variable">$&#123;POD_NAME&#125;</span> -c <span class="variable">$&#123;CONTAINER_NAME&#125;</span> -- <span class="variable">$&#123;CMD&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># run bash of a pod (if only one container, container name can be omitted)</span></span><br><span class="line"><span class="comment"># same like $ docker exec -it $container -- bash</span></span><br><span class="line">$ kubectl <span class="built_in">exec</span> -it <span class="variable">$&#123;POD_NAME&#125;</span> -- bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># modify any field of POD</span></span><br><span class="line">$ kubectl edit po kubia</span><br></pre></td></tr></table></figure>

<p><strong>Label related</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get po --show-labels</span><br><span class="line"><span class="comment"># modify an existing label of a pod</span></span><br><span class="line">$ kubectl label po kubia-mannual run=jason --overwrite</span><br><span class="line"><span class="comment"># add a new label to a pod</span></span><br><span class="line">$ kubectl label po kubia-mannual release=v1</span><br><span class="line"></span><br><span class="line"><span class="comment"># show pod with specific labels(filter)</span></span><br><span class="line">$ kubectl get po -l run=jason</span><br><span class="line">$ kubectl get po -l run!=jason</span><br><span class="line">$ kubectl get po -l <span class="string">&#x27;run in (jason, test)&#x27;</span></span><br><span class="line">$ kubectl get po -l <span class="string">&#x27;run notin (jason, test)&#x27;</span></span><br><span class="line">$ kubectl get po -l run</span><br><span class="line"><span class="comment"># not have run label</span></span><br><span class="line">$ kubectl get po -l <span class="string">&#x27;!run&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># similar like label, but used only for description</span></span><br><span class="line">$ kubectl annotate pod kubia-manual author=<span class="string">&quot;jason&quot;</span></span><br></pre></td></tr></table></figure>
<h2 id="Replica"><a href="#Replica" class="headerlink" title="Replica"></a>Replica</h2><p><strong>create rc from yaml</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="comment"># Old type, deprecated!!!</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ReplicationController</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kubia</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="comment"># create pod with such label</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">kubia</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">kubia</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">luksa/kubia</span></span><br><span class="line">          <span class="attr">ports:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># only way to create rc is from yaml</span></span><br><span class="line">$ kubectl create -f rc.yaml</span><br><span class="line">$ kubectl get rc</span><br><span class="line">$ kubectl describe rc kubia</span><br><span class="line"><span class="comment"># scale a rc, run less or more pod of this rc</span></span><br><span class="line"></span><br><span class="line">$ kubectl scale rc kubia --replicas=3</span><br><span class="line"><span class="comment"># change the label of a pod can move it in or out of scope of replication controller</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># modify any field of rc</span></span><br><span class="line">$ kubectl edit rc kubia</span><br><span class="line"><span class="comment"># delete rc, pod controlled by it will be deleted as well</span></span><br><span class="line">$ kubectl delete rc kubia</span><br><span class="line"><span class="comment"># only delete rc, keep pod running</span></span><br><span class="line">$ kubectl delete rc kubia --cascade=<span class="literal">false</span></span><br></pre></td></tr></table></figure>

<p><strong>create rs from yaml</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ReplicaSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kubia</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="comment"># label selector</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">kubia</span></span><br><span class="line">    <span class="comment"># expression selector</span></span><br><span class="line">    <span class="comment"># matchExpressions:</span></span><br><span class="line">    <span class="comment">#   - key: app</span></span><br><span class="line">    <span class="comment">#     operator: In</span></span><br><span class="line">    <span class="comment">#     values:</span></span><br><span class="line">    <span class="comment">#       - kubia</span></span><br><span class="line">    <span class="comment"># In—Label’s value must match one of the specified values.</span></span><br><span class="line">    <span class="comment"># NotIn—Label’s value must not match any of the specified values.</span></span><br><span class="line">    <span class="comment"># Exists—Pod must include a label with the specified key (the value isn’t important). When using this operator, you shouldn’t specify the values field.</span></span><br><span class="line">    <span class="comment"># DoesNotExist—Pod must not include a label with the specified key. The values property must not be specified.</span></span><br><span class="line">    <span class="comment"># If you specify multiple expressions, all those expressions must evaluate to true for the selector to match a pod.</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="comment"># create pod with such label</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">kubia</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">kubia</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">luksa/kubia</span></span><br><span class="line">          <span class="attr">ports:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8080</span></span><br><span class="line">          <span class="comment"># optional, mount from html to /var/htdocs</span></span><br><span class="line">          <span class="attr">volumeMounts:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">html</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">/var/htdocs</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># optional part</span></span><br><span class="line">        <span class="attr">volumes:</span></span><br><span class="line">        <span class="comment"># emptyDir type, shared by containers in the same pod!!!</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">html</span></span><br><span class="line">          <span class="attr">emptyDir:</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl create -f rs.yaml</span><br><span class="line"><span class="comment"># expose from host, add iptable rules to rc</span></span><br><span class="line">$ kubectl expose rc kubia --port=80 --target-port=8000</span><br><span class="line">$ kubectl get rs</span><br><span class="line">$ kubectl describe rs kubia</span><br><span class="line"><span class="comment"># scale a rs, run less or more pod of this rs</span></span><br><span class="line">$ kubectl scale rc kubia --replicas=3</span><br><span class="line"><span class="comment"># change the label of a pod can move it in or out of scope of ReplicaSet</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># modify any field of rs</span></span><br><span class="line">$ kubectl edit rs kubia</span><br><span class="line"><span class="comment"># delete rs, pod controlled by it will be deleted as well</span></span><br><span class="line">$ kubectl delete rs kubia</span><br><span class="line"><span class="comment"># only delete rs, keep pod running</span></span><br><span class="line">$ kubectl delete rs kubia --cascade=<span class="literal">false</span></span><br></pre></td></tr></table></figure>
<h2 id="DaemonSet"><a href="#DaemonSet" class="headerlink" title="DaemonSet"></a>DaemonSet</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">DaemonSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="comment"># DaemonSet name is kubia</span></span><br><span class="line">  <span class="comment"># pod name is kubia-xxx</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kubia</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="comment"># no replica as only one such pod for each worker node</span></span><br><span class="line">  <span class="comment"># label selector</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">kubia</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="comment"># create pod with such label</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">kubia</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">kubia</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">luksa/kubia</span></span><br><span class="line">          <span class="attr">ports:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl create -f ds.yaml</span><br><span class="line">$ kubectl get ds</span><br><span class="line">$ sudo kubectl get ds</span><br><span class="line">NAME     DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR   AGE</span><br><span class="line">kubia    1         1         1       1            1           &lt;none&gt;          10s</span><br><span class="line"></span><br><span class="line">$ kubectl describe ds kubia</span><br><span class="line"><span class="comment"># change the label of a pod can move it in or out of scope of DaemonSet</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># modify any field of ds</span></span><br><span class="line">$ kubectl edit ds kubia</span><br><span class="line"><span class="comment"># delete ds, pod controlled by it will be deleted as well</span></span><br><span class="line">$ kubectl delete ds kubia</span><br><span class="line"><span class="comment"># only delete rs, keep pod running</span></span><br><span class="line">$ kubectl delete ds kubia --cascade=<span class="literal">false</span></span><br></pre></td></tr></table></figure>
<h2 id="Job-CronJob"><a href="#Job-CronJob" class="headerlink" title="Job, CronJob"></a>Job, CronJob</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">batch/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Job</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">batch-job</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="comment"># there two are optional, by default they are 1</span></span><br><span class="line">  <span class="comment"># by default, run once and one pod runs</span></span><br><span class="line">  <span class="attr">completions:</span> <span class="number">5</span></span><br><span class="line">  <span class="attr">parallelism:</span> <span class="number">2</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">batch-job</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">restartPolicy:</span> <span class="string">OnFailure</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">main</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">luksa/batch-job</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl create -f jb.yaml</span><br><span class="line"></span><br><span class="line">$ kubectl get <span class="built_in">jobs</span></span><br><span class="line">NAME        COMPLETIONS   DURATION   AGE</span><br><span class="line">batch-job   0/1           11s        11s</span><br><span class="line"></span><br><span class="line"><span class="comment"># After a while job is done</span></span><br><span class="line">$ kubectl get job</span><br><span class="line">NAME        COMPLETIONS   DURATION   AGE</span><br><span class="line">batch-job   1/1           2m11s      2m24s</span><br><span class="line"></span><br><span class="line">$ kubectl describe <span class="built_in">jobs</span> batch-job</span><br><span class="line"></span><br><span class="line"><span class="comment"># modify any field of job</span></span><br><span class="line">$ kubectl edit <span class="built_in">jobs</span> batch-job</span><br><span class="line"></span><br><span class="line"><span class="comment"># after the job run successfully, job and pod are not deleted but show status completed</span></span><br><span class="line">$ kubectl delete <span class="built_in">jobs</span> batch-job</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">batch/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CronJob</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">batch-job-every-15</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">schedule:</span> <span class="string">&quot;0,15,30,45 * * * *&quot;</span></span><br><span class="line">  <span class="attr">jobTemplate:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">template:</span></span><br><span class="line">        <span class="attr">metadata:</span></span><br><span class="line">          <span class="attr">labels:</span></span><br><span class="line">            <span class="attr">app:</span> <span class="string">batch-job</span></span><br><span class="line">        <span class="attr">spec:</span></span><br><span class="line">          <span class="attr">restartPolicy:</span> <span class="string">OnFailure</span></span><br><span class="line">          <span class="attr">containers:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">main</span></span><br><span class="line">              <span class="attr">image:</span> <span class="string">luksa/batch-job</span></span><br><span class="line"></span><br><span class="line"><span class="string">schedule</span> <span class="string">has</span> <span class="string">the</span> <span class="string">same</span> <span class="string">format</span> <span class="string">as</span> <span class="string">linux</span> <span class="string">cron</span> <span class="string">job</span></span><br><span class="line"></span><br><span class="line"><span class="string">┌─────────────</span> <span class="string">minute</span> <span class="string">(0</span> <span class="bullet">-</span> <span class="number">59</span><span class="string">)</span></span><br><span class="line"><span class="string">│</span> <span class="string">┌─────────────</span> <span class="string">hour</span> <span class="string">(0</span> <span class="bullet">-</span> <span class="number">23</span><span class="string">)</span></span><br><span class="line"><span class="string">│</span> <span class="string">│</span> <span class="string">┌─────────────</span> <span class="string">day</span> <span class="string">of</span> <span class="string">the</span> <span class="string">month</span> <span class="string">(1</span> <span class="bullet">-</span> <span class="number">31</span><span class="string">)</span></span><br><span class="line"><span class="string">│</span> <span class="string">│</span> <span class="string">│</span> <span class="string">┌─────────────</span> <span class="string">month</span> <span class="string">(1</span> <span class="bullet">-</span> <span class="number">12</span><span class="string">)</span></span><br><span class="line"><span class="string">│</span> <span class="string">│</span> <span class="string">│</span> <span class="string">│</span> <span class="string">┌─────────────</span> <span class="string">day</span> <span class="string">of</span> <span class="string">the</span> <span class="string">week</span> <span class="string">(0</span> <span class="bullet">-</span> <span class="number">6</span><span class="string">)</span> <span class="string">(Sunday</span> <span class="string">to</span> <span class="string">Saturday;</span></span><br><span class="line"><span class="string">│</span> <span class="string">│</span> <span class="string">│</span> <span class="string">│</span> <span class="string">│</span>                                   <span class="number">7</span> <span class="string">is</span> <span class="string">also</span> <span class="string">Sunday</span> <span class="string">on</span> <span class="string">some</span> <span class="string">systems)</span></span><br><span class="line"><span class="string">│</span> <span class="string">│</span> <span class="string">│</span> <span class="string">│</span> <span class="string">│</span></span><br><span class="line"><span class="string">│</span> <span class="string">│</span> <span class="string">│</span> <span class="string">│</span> <span class="string">│</span></span><br><span class="line"><span class="string">*</span> <span class="string">*</span> <span class="string">*</span> <span class="string">*</span> <span class="string">*</span></span><br><span class="line"></span><br><span class="line"><span class="string">*</span>	<span class="string">any</span> <span class="string">value</span></span><br><span class="line"><span class="string">,</span>	<span class="string">value</span> <span class="string">list</span> <span class="string">separator</span></span><br><span class="line"><span class="string">-</span>	<span class="string">range</span> <span class="string">of</span> <span class="string">values</span></span><br><span class="line"><span class="string">/</span>	<span class="string">step</span> <span class="string">values</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl create -f cjb.yaml</span><br><span class="line">$ kubectl get cj</span><br><span class="line">NAME                 SCHEDULE             SUSPEND   ACTIVE   LAST SCHEDULE   AGE</span><br><span class="line">batch-job-every-15   0,15,30,45 * * * *   False     0        &lt;none&gt;          11s</span><br><span class="line"></span><br><span class="line">$ kubectl describe cronjobs batch-job-every-15</span><br><span class="line"></span><br><span class="line"><span class="comment"># modify any field of cjob</span></span><br><span class="line">$ kubectl edit cronjobs batch-job-every-15</span><br><span class="line"></span><br><span class="line">$ kubectl delete cronjobs batch-job-every-15</span><br></pre></td></tr></table></figure>

<h2 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h2><p><strong>ClusterIP service</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kubia</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="comment"># optional, default select pod randomly</span></span><br><span class="line">  <span class="attr">sessionAffinity:</span> <span class="string">ClientIP</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># ClusterIP automatically assigned when created or set it manually like below!!!</span></span><br><span class="line">  <span class="comment"># clusterIP: 10.2.2.1</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="comment"># service port 80---&gt;container port 8080</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">8080</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># if multiple ports for a service, each port must have a name</span></span><br><span class="line">    <span class="comment"># - name: http</span></span><br><span class="line">    <span class="comment">#   port: 80</span></span><br><span class="line">    <span class="comment">#   targetPort: 8080</span></span><br><span class="line">    <span class="comment"># - name: https</span></span><br><span class="line">    <span class="comment">#   port: 443</span></span><br><span class="line">    <span class="comment">#   targetPort: 8443</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># pods(in the same namespace) behind the service</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">kubia</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ kubectl create -f service.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># default service only has cluster ip, no external-ip</span></span><br><span class="line">$ kubectl get svc</span><br><span class="line">NAME    TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)   AGE</span><br><span class="line">kubia   ClusterIP   10.102.75.1   &lt;none&gt;        80/TCP    9s</span><br><span class="line"></span><br><span class="line"><span class="comment"># show endpoint Object of all service</span></span><br><span class="line"><span class="comment"># endpoint Object is create automatically when service is creating.</span></span><br><span class="line">$ kubectl get ep</span><br><span class="line">NAME    ENDPOINTS                                           AGE</span><br><span class="line">kubia   172.17.0.11:8080,172.17.0.12:8080,172.17.0.7:8080   72s</span><br><span class="line"></span><br><span class="line">$ kubectl describe ep kubia</span><br><span class="line">$ kubectl edit ep kubia</span><br><span class="line"></span><br><span class="line">$ kubectl describe svc kubia</span><br><span class="line">$ kubectl delete svc kubia</span><br><span class="line">$ kubectl edit svc kubia</span><br><span class="line"></span><br><span class="line">$ kubectl get po -o wide</span><br><span class="line">kubia-6555dff44f-h8kfd                1/1     Running     0          4m49s   172.17.0.11   dev    &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kubia-6555dff44f-k55fd                1/1     Running     0          4m49s   172.17.0.7    dev    &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kubia-6555dff44f-mvsqj                1/1     Running     0          4m49s   172.17.0.12   dev    &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure>

<p><strong>let’s check the core (nat) rules generated on the node after a service is created</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># default/kubia is service name, 10.105.109.83 is service cluster ip</span></span><br><span class="line">Chain KUBE-SERVICES (2 references)</span><br><span class="line"> pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination</span><br><span class="line">   11   660 KUBE-SVC-L5EAUEZ74VZL5GSC  tcp  --  any    any     anywhere             10.105.109.83        /* default/kubia: cluster IP */ tcp dpt:http</span><br><span class="line"></span><br><span class="line"><span class="comment"># three pods target with random mode</span></span><br><span class="line">Chain KUBE-SVC-L5EAUEZ74VZL5GSC (1 references)</span><br><span class="line"> pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination</span><br><span class="line">    2   120 KUBE-SEP-PERL6L2Q363TRRKS  all  --  any    any     anywhere             anywhere             /* default/kubia: */ statistic mode random probability 0.33333333349</span><br><span class="line">    3   180 KUBE-SEP-5SWG4BFKF7ZYVF5R  all  --  any    any     anywhere             anywhere             /* default/kubia: */ statistic mode random probability 0.50000000000</span><br><span class="line">    6   360 KUBE-SEP-5ZBQGZX3PSGHKG5K  all  --  any    any     anywhere             anywhere             /* default/kubia: */</span><br><span class="line"></span><br><span class="line"><span class="comment"># on pod rule 172.17.0.6 pod ip with port 8080</span></span><br><span class="line">Chain KUBE-SEP-PERL6L2Q363TRRKS (1 references)</span><br><span class="line"> pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination</span><br><span class="line">    0     0 KUBE-MARK-MASQ  all  --  any    any     172.17.0.6           anywhere             /* default/kubia: */</span><br><span class="line">    2   120 DNAT       tcp  --  any    any     anywhere             anywhere             /* default/kubia: */ tcp to:172.17.0.6:8080</span><br></pre></td></tr></table></figure>

<p><strong>NodeType service</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kubia</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="comment"># service port 80---&gt;container port 8080</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">8080</span></span><br><span class="line">      <span class="attr">nodePort:</span> <span class="number">30000</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">kubia</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># create service from one command line</span></span><br><span class="line">$ kubectl expose deployment kubia --<span class="built_in">type</span>=NodePort --port=80 --target-port=8080</span><br><span class="line"></span><br><span class="line"><span class="comment"># when you create a nodePort service,</span></span><br><span class="line"><span class="comment"># it creates clusterIP service automatically</span></span><br><span class="line"><span class="comment"># (but this is not true for ingress, you have to create clusterIP service manually),</span></span><br><span class="line"><span class="comment"># then add extra iptables rules to clusterIp service</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># if nodePort service exists, no need to create ClusterIP service,otherwise error: services &quot;xxxx&quot; already exists</span></span><br><span class="line"><span class="comment"># clusterIp service is also some iptables rules.</span></span><br><span class="line">$ kubectl create -f nodeport.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># nodePort service</span></span><br><span class="line">$ kubectl get svc</span><br><span class="line">NAME    TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE</span><br><span class="line">kubia   NodePort   10.104.24.124   &lt;none&gt;        80:30000/TCP   8s</span><br><span class="line"><span class="comment"># curl node port, 80 is service port</span></span><br><span class="line">$ curl 10.109.176.199:80</span><br><span class="line">$ curl <span class="variable">$Node_IP</span>:30000</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NodePort service---&gt;ClusterIP service---&gt;Pod</span><br><span class="line">LoadBalancer service---&gt;NodePort service---&gt;ClusterIP service---&gt;Pod</span><br></pre></td></tr></table></figure>
<h2 id="Ingress"><a href="#Ingress" class="headerlink" title="Ingress"></a>Ingress</h2><p><strong>Must enable ingress controller firstly</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ minikube addons <span class="built_in">enable</span> ingress</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kubia</span></span><br><span class="line"><span class="comment"># no ingress port needed</span></span><br><span class="line"><span class="comment"># ingress listens on 80 for http</span></span><br><span class="line"><span class="comment"># ingress listens on 443 for https</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">kubia.example.com</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">        <span class="attr">pathType:</span> <span class="string">Exact</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">kubia</span> <span class="comment"># must create ClusterIP service manually!!!</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl create -f in.yaml</span><br><span class="line"></span><br><span class="line">$ kubectl get ingress</span><br><span class="line"></span><br><span class="line">Name:             kubia</span><br><span class="line">Namespace:        test-ns</span><br><span class="line"><span class="comment"># ingress IP, it&#x27;s public IP!!!(node IP)</span></span><br><span class="line">Address:          10.116.5.201</span><br><span class="line">Default backend:  default-http-backend:80 (&lt;error: endpoints <span class="string">&quot;default-http-backend&quot;</span> not found&gt;)</span><br><span class="line">Rules:</span><br><span class="line">  Host               Path  Backends</span><br><span class="line">  ----               ----  --------</span><br><span class="line">  kubia.example.com</span><br><span class="line">                     /   kubia:80 (172.17.0.11:8080,172.17.0.12:8080,172.17.0.7:8080)</span><br><span class="line">  <span class="comment"># kubia:80 is clusterIP service with three endpoints</span></span><br><span class="line">  <span class="comment"># Ingress depends on cluster service to get the endpoints and use it directly!!!</span></span><br><span class="line">Annotations:         &lt;none&gt;</span><br><span class="line">Events:</span><br><span class="line">  Type    Reason  Age   From                      Message</span><br><span class="line">  ----    ------  ----  ----                      -------</span><br><span class="line">  Normal  CREATE  81s   nginx-ingress-controller  Ingress test-ns/kubia</span><br><span class="line">  Normal  UPDATE  27s   nginx-ingress-controller  Ingress test-ns/kubia</span><br></pre></td></tr></table></figure>

<h2 id="Deployment"><a href="#Deployment" class="headerlink" title="Deployment"></a>Deployment</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kubia</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">kubia</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">kubia</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">kubia</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">luksa/kubia:v1</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nodejs</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># create deploy from one command line</span></span><br><span class="line">$ kubectl create deployment kubia --image=luksa/kubia:v1</span><br><span class="line"></span><br><span class="line"><span class="comment"># create dp with --record in version history</span></span><br><span class="line"><span class="comment"># have the change to rollback if upgrade fails.</span></span><br><span class="line">$ kubectl create -f dp.yaml --record</span><br><span class="line">$ sudo kubectl get deploy</span><br><span class="line">NAME    READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">kubia   3/3     3            3           21s</span><br><span class="line">$ kubectl get deploy kubia</span><br><span class="line"></span><br><span class="line">$ kubectl describe deploy kubia</span><br><span class="line">$ kubectl edit deploy kubia</span><br><span class="line"><span class="comment"># deployment will create ReplicaSet automatically</span></span><br><span class="line">$ sudo kubectl get rs</span><br><span class="line">NAME               DESIRED   CURRENT   READY   AGE</span><br><span class="line">kubia-6555dff44f   3         3         3       95s</span><br><span class="line"></span><br><span class="line"><span class="comment"># trigger upgrade by change image version</span></span><br><span class="line">$ kubectl <span class="built_in">set</span> image deploy kubia nodejs=luksa/kubia:v2</span><br><span class="line"><span class="comment"># OR</span></span><br><span class="line">$ kubectl edit deploy kubia</span><br><span class="line"><span class="comment"># scale a deploy</span></span><br><span class="line">$ kubectl scale deploy kubia --replicas=2</span><br><span class="line"></span><br><span class="line"><span class="comment"># check the status when rolling happens</span></span><br><span class="line">$ kubectl rollout status deployment kubia</span><br><span class="line"></span><br><span class="line"><span class="comment"># if the new version has issue, rollback to previous one</span></span><br><span class="line">$ kubectl rollout undo deployment kubia</span><br><span class="line">$ kubectl rollout undo deployment kubia --to-revision=1</span><br><span class="line"></span><br><span class="line"><span class="comment"># check the version history of a given deployment when several upgrade happened</span></span><br><span class="line">$ kubectl rollout <span class="built_in">history</span> deployment kubia</span><br><span class="line"></span><br><span class="line">$ kubectl rollout pause deployment kubia</span><br><span class="line">$ kubectl rollout resume deployment kubia</span><br></pre></td></tr></table></figure>

<h2 id="configMap-downwardAPI-secret"><a href="#configMap-downwardAPI-secret" class="headerlink" title="configMap, downwardAPI, secret"></a>configMap, downwardAPI, secret</h2><p><strong>create configMap from shell</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># create configMap from literal, file, dir</span></span><br><span class="line"><span class="comment"># --from-file without key will use file name as the key</span></span><br><span class="line"><span class="comment"># --from-file with dir will use all files</span></span><br><span class="line"><span class="comment"># kubectl create configmap my-cfg --from-file=test.json --from-file=key1=hi.txt --from-file=test_dir/ --from-literal=key2=hello</span></span><br><span class="line"></span><br><span class="line">$ kubectl create configmap my-cfg --from-file=conf.cfg --from-literal=<span class="built_in">id</span>=jason</span><br><span class="line">$ kubectl get cm</span><br><span class="line">NAME               DATA   AGE</span><br><span class="line">my-cfg             2      17s</span><br><span class="line"></span><br><span class="line">$ kubectl describe cm my-cfg</span><br><span class="line">Name:         my-cfg</span><br><span class="line">Namespace:    test-ns</span><br><span class="line">Labels:       &lt;none&gt;</span><br><span class="line">Annotations:  &lt;none&gt;</span><br><span class="line"></span><br><span class="line">Data</span><br><span class="line">====</span><br><span class="line"></span><br><span class="line"><span class="built_in">id</span>:</span><br><span class="line">----</span><br><span class="line">jason</span><br><span class="line"></span><br><span class="line">conf.cfg:</span><br><span class="line">----</span><br><span class="line">name = hello</span><br><span class="line"></span><br><span class="line">Events:  &lt;none&gt;</span><br><span class="line"><span class="comment"># never use yaml to create configMap as you have to copy file content in yaml file!!!</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>use configMap from env var in pod’s container</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pod definition with value from configMap</span></span><br><span class="line"><span class="attr">env:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">FIRST_VAR</span></span><br><span class="line">  <span class="attr">valueFrom:</span></span><br><span class="line">    <span class="attr">configMapKeyRef:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">my-cfg</span></span><br><span class="line">      <span class="attr">key:</span> <span class="string">foo</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># or all entries from configMap as env vars</span></span><br><span class="line"><span class="attr">envFrom:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">prefix:</span> <span class="string">CONFIG_</span></span><br><span class="line">  <span class="attr">configMapRef:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">my-cfg</span></span><br></pre></td></tr></table></figure>

<p><strong>mount configmap entry as a file keep existing if has same file</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mount configmap entries to a dir in the pod</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">kubia-hc</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">kubia</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">    <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">luksa/kubia</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">kubia</span></span><br><span class="line">      <span class="comment"># mount individual entries under a dir but keep existing file under that dir</span></span><br><span class="line">      <span class="comment"># say mount to /etc, but still keep existing file under etc</span></span><br><span class="line">      <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/etc/new.json</span></span><br><span class="line">          <span class="comment"># subPath says new.json is a file</span></span><br><span class="line">          <span class="comment"># without subPath, new.json is treated as a path!!!!</span></span><br><span class="line">          <span class="attr">subPath:</span> <span class="string">new.json</span></span><br><span class="line">          <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config</span></span><br><span class="line">      <span class="attr">configMap:</span></span><br><span class="line">        <span class="comment"># use configMap declared by configMap</span></span><br><span class="line">        <span class="comment"># if no item provided, it will use all entries!!!</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">my-cfg</span></span><br><span class="line">        <span class="attr">items:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">test.json</span></span><br><span class="line">          <span class="comment"># rename it</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">new.json</span></span><br></pre></td></tr></table></figure>


<p><strong>mount configmap entry as a file hide existing if has same file</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mount configmap entries to a dir in the pod</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">kubia-hc</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">kubia</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">    <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">luksa/kubia</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">kubia</span></span><br><span class="line">      <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config</span></span><br><span class="line">          <span class="comment"># if this path does not exist, create</span></span><br><span class="line">          <span class="comment"># if exists, hide all existing files with configMap entries</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/var/test</span></span><br><span class="line">          <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config</span></span><br><span class="line">      <span class="attr">configMap:</span></span><br><span class="line">        <span class="comment"># use configMap declared by configMap</span></span><br><span class="line">        <span class="comment"># if no items provided, it will use all entries!!!</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">my-cfg</span></span><br><span class="line">        <span class="attr">items:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">test.json</span></span><br><span class="line">          <span class="comment"># rename it</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">new.json</span></span><br></pre></td></tr></table></figure>

<h3 id="secrets"><a href="#secrets" class="headerlink" title="secrets"></a>secrets</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># create secrets</span></span><br><span class="line">$ kubectl create secret generic test_sc --from-file=key1=test.json</span><br><span class="line">$ kubectl get secrets</span><br><span class="line">$ kubectl describe secrets</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># secret is mounted in-memory files</span></span><br><span class="line">  <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/var/run/secrets/kubernetes.io/serviceaccount</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">default-token-l5wrk</span></span><br><span class="line">      <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">default-token-l5wrk</span></span><br><span class="line">    <span class="attr">secret:</span></span><br><span class="line">      <span class="attr">secretName:</span> <span class="string">default-token-l5wrk</span></span><br><span class="line">    <span class="comment"># no items lists, all entries in secret are mounted to mountPath!!!</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># use secret from env</span></span><br><span class="line"><span class="attr">env:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">FOO_SECRET</span></span><br><span class="line">  <span class="attr">valueFrom:</span></span><br><span class="line">    <span class="attr">secretKeyRef:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">fortune-https</span></span><br><span class="line">      <span class="attr">key:</span> <span class="string">foo</span></span><br></pre></td></tr></table></figure>

<p><strong>downwardAPI</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># check Pod manifest to get the field name</span></span><br><span class="line"><span class="comment"># use ENV in container</span></span><br><span class="line"><span class="attr">env:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">POD_IP</span></span><br><span class="line">  <span class="attr">valueFrom:</span></span><br><span class="line">    <span class="attr">fieldRef:</span></span><br><span class="line">      <span class="attr">fieldPath:</span> <span class="string">status.podIP</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">POD_NAME</span></span><br><span class="line">  <span class="attr">valueFrom:</span></span><br><span class="line">    <span class="attr">fieldRef:</span></span><br><span class="line">      <span class="attr">fieldPath:</span> <span class="string">metadata.name</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment"># under container with file</span></span><br><span class="line">  <span class="attr">volumeMounts:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">downward</span></span><br><span class="line">    <span class="attr">mountPath:</span> <span class="string">/etc/downward</span></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">downward</span></span><br><span class="line">    <span class="attr">downwardAPI:</span></span><br><span class="line">      <span class="attr">items:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">&quot;podName&quot;</span></span><br><span class="line">        <span class="attr">fieldRef:</span></span><br><span class="line">          <span class="attr">fieldPath:</span> <span class="string">metadata.name</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">&quot;podIP&quot;</span></span><br><span class="line">        <span class="attr">fieldRef:</span></span><br><span class="line">          <span class="attr">fieldPath:</span> <span class="string">status.podIP</span></span><br></pre></td></tr></table></figure>

<p><strong>talk to API server</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get svc</span><br><span class="line">NAMESPACE              NAME                                 TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)                  AGE</span><br><span class="line">default                kubernetes                           ClusterIP   10.96.0.1        &lt;none&gt;        443/TCP                  9d</span><br><span class="line"></span><br><span class="line"><span class="comment"># on the node</span></span><br><span class="line">$ kubectl proxy</span><br><span class="line">Starting to serve on 127.0.0.1:8001</span><br><span class="line"><span class="comment"># proxy will talk to API server(10.96.0.1) and do the authentication, cool</span></span><br><span class="line"></span><br><span class="line">$ curl localhost:8001</span><br><span class="line"></span><br><span class="line"><span class="comment"># talk to API server within a pod</span></span><br><span class="line"><span class="comment"># as for each pod, we mount</span></span><br><span class="line"><span class="comment"># 1. a token(from secret) that can be used to talk with API server</span></span><br><span class="line"><span class="comment"># 2. ca: used to verify server&#x27;s certificate.</span></span><br><span class="line"><span class="comment"># at /var/run/secrets/kubernetes.io/serviceaccount</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># inside a container, run below command</span></span><br><span class="line">$ <span class="built_in">export</span> TOKEN=$(<span class="built_in">cat</span> /var/run/secrets/kubernetes.io/serviceaccount/token)</span><br><span class="line">$ curl -H <span class="string">&quot;Authorization: Bearer <span class="variable">$TOKEN</span>&quot;</span> https://kubernetes</span><br><span class="line"></span><br><span class="line"><span class="comment"># another way, you can run another container within a pod, this container runs kubectl proxy</span></span><br><span class="line"><span class="comment"># so other container in the same pod, can access localhost:80001 as proxy to talk with API server.</span></span><br></pre></td></tr></table></figure>
<h2 id="Volumes"><a href="#Volumes" class="headerlink" title="Volumes"></a>Volumes</h2><p><strong>check default storageClass provided by minikube</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ sudo minikube addons <span class="built_in">enable</span> storage-provisioner</span><br><span class="line">$ sudo kubectl get pod -n kube-system</span><br><span class="line">NAME                                        READY   STATUS             RESTARTS   AGE</span><br><span class="line">storage-provisioner                         1/1     Running            0          20h</span><br><span class="line"></span><br><span class="line">$ sudo kubectl get storageClass</span><br><span class="line">NAME                 PROVISIONER                RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE</span><br><span class="line">standard (default)   k8s.io/minikube-hostpath   Delete          Immediate           <span class="literal">false</span>                  19h</span><br></pre></td></tr></table></figure>

<p><strong>declare pvc use storageClass</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">data-pvc</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="comment"># use standard storageClass which is created by minikube automatically</span></span><br><span class="line">  <span class="attr">storageClassName:</span> <span class="string">standard</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">requests:</span></span><br><span class="line">      <span class="attr">storage:</span> <span class="string">100Mi</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteOnce</span></span><br></pre></td></tr></table></figure>

<p><strong>use data-pvc from pod</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">  <span class="attr">volumeMounts:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">data</span></span><br><span class="line">    <span class="attr">mountPath:</span> <span class="string">/var/store</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">data</span></span><br><span class="line">  <span class="attr">persistentVolumeClaim:</span></span><br><span class="line">    <span class="attr">claimName:</span> <span class="string">data-pvc</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get sc</span><br><span class="line">$ kubectl describe sc</span><br><span class="line">$ kubectl edit sc</span><br><span class="line"></span><br><span class="line"><span class="comment"># create pvc use storageClass</span></span><br><span class="line">$ kubectl create -f pvc.yaml</span><br><span class="line">$ kubectl get pvc</span><br><span class="line">NAME       STATUS    VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   AGE</span><br><span class="line">data-pvc   Pending                                      standard       38s</span><br><span class="line"></span><br><span class="line"><span class="comment"># After a while</span></span><br><span class="line">$ kubectl get pvc</span><br><span class="line">NAME       STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE</span><br><span class="line">data-pvc   Bound    pvc-0289f274-ab70-4a0f-9a6d-8c7d10bac7fe   100Mi      RWO            standard       35m</span><br><span class="line"></span><br><span class="line"><span class="comment"># pv is created automatically for pvc when it uses storageClass</span></span><br><span class="line">$ kubectl get pv</span><br><span class="line">NAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM              STORAGECLASS   REASON   AGE</span><br><span class="line">pvc-a59a4fac-5b1e-44e1-a066-ff33cfc2b1bc   100Mi      RWO            Delete           Bound    default/data-pvc   standard                104s</span><br></pre></td></tr></table></figure>
<h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><ul>
<li><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/kubectl/cheatsheet/">kubectl cheatsheet</a></li>
<li><a target="_blank" rel="noopener" href="https://www.manning.com/books/kubernetes-in-action">kubernetes-in-action</a></li>
<li><a target="_blank" rel="noopener" href="https://alta3.com/posters/k8s.pdf">Alta3</a></li>
<li><a target="_blank" rel="noopener" href="https://crontab.guru/">cron example</a></li>
</ul>

    </div>

    
    
    
      


    <footer class="post-footer">
          <div class="reward-container">
  <div></div>
  <button>
    Donate
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechatpay.jpeg" alt="Jason WeChat Pay">
        <span>WeChat Pay</span>
      </div>

  </div>
</div>

          <div class="post-tags">
              <a href="/tags/k8s/" rel="tag"># k8s</a>
              <a href="/tags/k8s-command/" rel="tag"># k8s_command</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2020/06/28/k8s-faq/" rel="prev" title="k8s_faq">
                  <i class="fa fa-chevron-left"></i> k8s_faq
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2020/06/28/k8s-concept/" rel="next" title="k8s_concept">
                  k8s_concept <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments utterances-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2018 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Cyun All rights reserved</span>
</div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.0/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>



  <script src="/js/third-party/fancybox.js"></script>

  <script src="/js/third-party/pace.js"></script>

  




<script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"jason-bj/blog","issue_term":"pathname","theme":"github-light"}</script>
<script src="/js/third-party/comments/utterances.js"></script>

</body>
</html>
