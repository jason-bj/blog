<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon/favicon-16x16.png">
  <meta name="google-site-verification" content="xitt2fbphh1nTeWLiTWc0lCggHuxJ5heMcAzkHW2vno">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Microsoft+YaHei+UI:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"cyun.tech","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.11.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"utterances","storage":true,"lazyload":false,"nav":null,"activeClass":"utterances"},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":10,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Question and Answer about Kubernetes.">
<meta property="og:type" content="article">
<meta property="og:title" content="k8s_faq">
<meta property="og:url" content="http://cyun.tech/2020/06/28/k8s-faq/index.html">
<meta property="og:site_name" content="CYun">
<meta property="og:description" content="Question and Answer about Kubernetes.">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://cyun.tech/images/k8s/operator.png">
<meta property="og:image" content="https://cyun.tech/images/k8s/helm.jpeg">
<meta property="article:published_time" content="2020-06-28T00:35:17.000Z">
<meta property="article:modified_time" content="2024-07-28T15:18:23.429Z">
<meta property="article:author" content="Jason">
<meta property="article:tag" content="k8s">
<meta property="article:tag" content="k8s_faq">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cyun.tech/images/k8s/operator.png">


<link rel="canonical" href="http://cyun.tech/2020/06/28/k8s-faq/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://cyun.tech/2020/06/28/k8s-faq/","path":"2020/06/28/k8s-faq/","title":"k8s_faq"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>k8s_faq | CYun</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-148730544-1"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-148730544-1","only_pageview":false}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>

  <script src="/js/third-party/analytics/baidu-analytics.js"></script>
  <script async src="https://hm.baidu.com/hm.js?a510d1f580c8231f8f867d14f42bb8ea"></script>




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">CYun</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Pods"><span class="nav-number">1.</span> <span class="nav-text">Pods</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#why-pod-is-in-pending-status"><span class="nav-number">1.1.</span> <span class="nav-text">why pod is in pending status?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pod-is-restarted-how-can-I-see-previous-container-log"><span class="nav-number">1.2.</span> <span class="nav-text">pod is restarted, how can I see previous container log</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#how-can-I-check-why-pod-is-restart"><span class="nav-number">1.3.</span> <span class="nav-text">how can I check why pod is restart</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#how-can-I-check-liveness-setting-for-a-pod"><span class="nav-number">1.4.</span> <span class="nav-text">how can I check liveness setting for a pod</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#how-pod-the-service-internal-cluster-ip-after-it-knows-the-service-name"><span class="nav-number">1.5.</span> <span class="nav-text">how pod the service internal cluster ip after it knows the service name?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#how-to-support-tls-in-Ingress"><span class="nav-number">1.6.</span> <span class="nav-text">how to support tls in Ingress</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#why-needs-headless-service-no-ClusterIP"><span class="nav-number">1.7.</span> <span class="nav-text">why needs headless service(no ClusterIP)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#directly-talk-to-api-server-by-restful-API-skip-kubectl"><span class="nav-number">1.8.</span> <span class="nav-text">directly talk to api server by restful API, skip kubectl</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#how-to-use-host-network-directly-for-pod"><span class="nav-number">1.9.</span> <span class="nav-text">how to use host network directly for pod</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#how-to-limit-resource-used-by-container"><span class="nav-number">1.10.</span> <span class="nav-text">how to limit resource used by container</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Operator-vs-Helm"><span class="nav-number">1.11.</span> <span class="nav-text">Operator vs Helm</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Vanilla-Kubernetes-vs-Distribution-Kubernetes"><span class="nav-number">1.12.</span> <span class="nav-text">Vanilla Kubernetes vs Distribution Kubernetes</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Jason"
      src="/uploads/avatar.gif">
  <p class="site-author-name" itemprop="name">Jason</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">150</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">142</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">149</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/jason-cyun" title="GitHub ‚Üí https:&#x2F;&#x2F;github.com&#x2F;jason-cyun" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:jason_lkm@163.com" title="E-Mail ‚Üí mailto:jason_lkm@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://cyun.tech/2020/06/28/k8s-faq/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.gif">
      <meta itemprop="name" content="Jason">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CYun">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="k8s_faq | CYun">
      <meta itemprop="description" content="Question and Answer about Kubernetes.">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          k8s_faq
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-06-28 08:35:17" itemprop="dateCreated datePublished" datetime="2020-06-28T08:35:17+08:00">2020-06-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-07-28 23:18:23" itemprop="dateModified" datetime="2024-07-28T23:18:23+08:00">2024-07-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/k8s/" itemprop="url" rel="index"><span itemprop="name">k8s</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/k8s/FAQ/" itemprop="url" rel="index"><span itemprop="name">FAQ</span></a>
        </span>
    </span>

  
</div>

            <div class="post-description">Question and Answer about Kubernetes.</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="Pods"><a href="#Pods" class="headerlink" title="Pods"></a>Pods</h1><h2 id="why-pod-is-in-pending-status"><a href="#why-pod-is-in-pending-status" class="headerlink" title="why pod is in pending status?"></a>why pod is in pending status?</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pods === pod</span></span><br><span class="line">$ kubectl get pod</span><br><span class="line">$ kubectl get pods</span><br><span class="line"><span class="comment"># there are many reason for this check why, use describe which gives status and events</span></span><br><span class="line">$ kubectl describe pods kubia-mannual</span><br><span class="line">Name:         kubia-mannual</span><br><span class="line">Namespace:    default</span><br><span class="line">Priority:     0</span><br><span class="line">Node:         &lt;none&gt;</span><br><span class="line">Labels:       run=kubia</span><br><span class="line">Annotations:  &lt;none&gt;</span><br><span class="line">Status:       Pending</span><br><span class="line">IP:</span><br><span class="line">IPs:          &lt;none&gt;</span><br><span class="line">Containers:</span><br><span class="line">...</span><br><span class="line">Events:</span><br><span class="line">  Type     Reason            Age                 From               Message</span><br><span class="line">  ----     ------            ----                ----               -------</span><br><span class="line">  Warning  FailedScheduling  6s (x4 over 2m45s)  default-scheduler  0/1 nodes are available: 1 node(s) didn<span class="string">&#x27;t match node selector.</span></span><br></pre></td></tr></table></figure>

<h2 id="pod-is-restarted-how-can-I-see-previous-container-log"><a href="#pod-is-restarted-how-can-I-see-previous-container-log" class="headerlink" title="pod is restarted, how can I see previous container log"></a>pod is restarted, how can I see previous container log</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl logs mypod --previous</span><br></pre></td></tr></table></figure>
<h2 id="how-can-I-check-why-pod-is-restart"><a href="#how-can-I-check-why-pod-is-restart" class="headerlink" title="how can I check why pod is restart"></a>how can I check why pod is restart</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl describe po mypod</span><br><span class="line">...</span><br><span class="line">Events:</span><br><span class="line">  Normal   Scheduled  2m30s                default-scheduler        Successfully assigned default/kubia-hc to dev-alokb</span><br><span class="line">  Warning  Unhealthy  54s (x3 over 74s)    kubelet, dev-alokb       Liveness probe failed: HTTP probe failed with statuscode: 500</span><br><span class="line">  Normal   Killing    53s                  kubelet, dev-alokb       Container kubia-hc failed liveness probe, will be restarted</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure>

<h2 id="how-can-I-check-liveness-setting-for-a-pod"><a href="#how-can-I-check-liveness-setting-for-a-pod" class="headerlink" title="how can I check liveness setting for a pod"></a>how can I check liveness setting for a pod</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl describe po mypod</span><br><span class="line">...</span><br><span class="line">Liveness:       http-get http://:8080/ delay=10s <span class="built_in">timeout</span>=1s period=10s <span class="comment">#success=1 #failure=3</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h2 id="how-pod-the-service-internal-cluster-ip-after-it-knows-the-service-name"><a href="#how-pod-the-service-internal-cluster-ip-after-it-knows-the-service-name" class="headerlink" title="how pod the service internal cluster ip after it knows the service name?"></a>how pod the service internal cluster ip after it knows the service name?</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get svc</span><br><span class="line">NAME         TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE</span><br><span class="line">kubia        ClusterIP   10.108.36.232   &lt;none&gt;        80/TCP    10m</span><br></pre></td></tr></table></figure>
<p><strong>by environment</strong><br>if pod is created after service, several variables are passed to pod by env</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># check env on a pod which is backend of a service</span></span><br><span class="line">$ kubectl <span class="built_in">exec</span> kubia-vtzwq -- <span class="built_in">env</span> | grep KUBIA</span><br><span class="line">KUBIA_SERVICE_PORT=80</span><br><span class="line">KUBIA_PORT_80_TCP_PROTO=tcp</span><br><span class="line">KUBIA_PORT_80_TCP_ADDR=10.108.36.232</span><br><span class="line">KUBIA_PORT_80_TCP=tcp://10.108.36.232:80</span><br><span class="line">KUBIA_PORT=tcp://10.108.36.232:80</span><br><span class="line">KUBIA_SERVICE_HOST=10.108.36.232</span><br><span class="line">KUBIA_PORT_80_TCP_PORT=80</span><br></pre></td></tr></table></figure>
<p><strong>by DNS server</strong><br>Actually, each pod configure a internal DNS server(dns service at kube-system)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl <span class="built_in">exec</span> kubia-vtzwq -- <span class="built_in">cat</span> /etc/resolv.conf</span><br><span class="line">nameserver 10.96.0.10</span><br><span class="line">search default.svc.cluster.local svc.cluster.local cluster.local ...</span><br></pre></td></tr></table></figure>
<p>Here dns server is a service cluster ip of kube-system</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get svc -n=kube-system -o wide</span><br><span class="line">NAME       TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)                  AGE     SELECTOR</span><br><span class="line">kube-dns   ClusterIP   10.96.0.10   &lt;none&gt;        53/UDP,53/TCP,9153/TCP   7d14h   k8s-app=kube-dns</span><br><span class="line"></span><br><span class="line"><span class="comment"># show all pod with labels</span></span><br><span class="line">$ kubectl get po -n=kube-system --show-labels</span><br><span class="line"><span class="comment"># OR</span></span><br><span class="line"><span class="comment"># filter with selector two pods behind the dns service</span></span><br><span class="line">$ kubectl get po -l k8s-app=kube-dns -n=kube-system</span><br><span class="line">NAME                       READY   STATUS    RESTARTS   AGE</span><br><span class="line">coredns-66bff467f8-77978   1/1     Running   0          7d14h</span><br><span class="line">coredns-66bff467f8-mtqbt   1/1     Running   0          7d14h</span><br><span class="line"></span><br><span class="line">$ kubectl <span class="built_in">exec</span> kubia-vtzwq -- curl kubia:80</span><br></pre></td></tr></table></figure>

<h2 id="how-to-support-tls-in-Ingress"><a href="#how-to-support-tls-in-Ingress" class="headerlink" title="how to support tls in Ingress"></a>how to support tls in Ingress</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ openssl genrsa -out tls.key 2048</span><br><span class="line">$ openssl req -new -x509 -key tls.key -out tls.cert -days 360 -subj/CN=kubia.example.com</span><br><span class="line">$ kubectl create secret tls tls-secret --cert=tls.cert --key=tls.key</span><br><span class="line"><span class="comment"># later on use the secret in Ingress like this</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kubia</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">tls:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">hosts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">kubia.example.com</span></span><br><span class="line">    <span class="comment"># secrete resource that created before</span></span><br><span class="line">    <span class="comment"># only enable ssl when access ingress, but ingress controller to backend still use Http!!!</span></span><br><span class="line">    <span class="attr">secretame:</span> <span class="string">tls-secret</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">kubia.example.com</span></span><br><span class="line">      <span class="attr">http:</span></span><br><span class="line">        <span class="attr">paths:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">          <span class="attr">backend:</span></span><br><span class="line">            <span class="attr">serviceName:</span> <span class="string">kubia-nodeport</span></span><br><span class="line">            <span class="attr">servicePort:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>
<h2 id="why-needs-headless-service-no-ClusterIP"><a href="#why-needs-headless-service-no-ClusterIP" class="headerlink" title="why needs headless service(no ClusterIP)"></a>why needs headless service(no ClusterIP)</h2><p>In some case, you want to know all endpoints of a service by internal DNS lookup, if service has ClusterIP, so dns server only returns the ClusterIP of the service, but for headless service, it returns several,  each record each for a endpoint.</p>
<p>For headless Services, a cluster IP is not allocated, <strong>kube-proxy does not handle these Services, and there is no load balancing or proxying done by the platform for them</strong>.</p>
<p><strong>DNS server here provides service&lt;‚Äî‚Äì&gt;IP mapping</strong></p>
<ul>
<li>cluster service, return ClusterIP</li>
<li>headless service, return IP(s) of each endpoint(pod).</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kubia</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="comment"># headless service, no ClusterIP</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="string">None</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="comment"># service port 80---&gt;container port 8080</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">8080</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">kubia</span></span><br></pre></td></tr></table></figure>

<h2 id="directly-talk-to-api-server-by-restful-API-skip-kubectl"><a href="#directly-talk-to-api-server-by-restful-API-skip-kubectl" class="headerlink" title="directly talk to api server by restful API, skip kubectl"></a>directly talk to api server by restful API, skip kubectl</h2><p>In some cause, we may no kubectl installed or we want to use restful API directly talking with api server from source source code like js&#x2F;python, there are <a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20/">API reference with example</a>, but first you need to authenticate with server first, either by your self, or use kube-proxy which will do this for you.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># on one node</span></span><br><span class="line">$ sudo kubectl proxy --address=0.0.0.0 --disable-filter=<span class="literal">true</span></span><br><span class="line">Starting to serve on [0.0.0.0]:8001</span><br><span class="line"><span class="comment"># curl&lt;---kubectl proxy&lt;-----api server------&gt;</span></span><br><span class="line">$ curl http://localhost:8001/apis/apps/v1/namespaces/default/deployments</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;kind&quot;</span>: <span class="string">&quot;DeploymentList&quot;</span>,</span><br><span class="line">  <span class="string">&quot;apiVersion&quot;</span>: <span class="string">&quot;apps/v1&quot;</span>,</span><br><span class="line">  <span class="string">&quot;metadata&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;resourceVersion&quot;</span>: <span class="string">&quot;44164&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;items&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;metadata&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;kubia&quot;</span>,</span><br><span class="line">        <span class="string">&quot;namespace&quot;</span>: <span class="string">&quot;default&quot;</span>,</span><br><span class="line">        <span class="string">&quot;uid&quot;</span>: <span class="string">&quot;80400a5b-0db9-4997-b1a5-b097181b97af&quot;</span>,</span><br><span class="line">        <span class="string">&quot;resourceVersion&quot;</span>: <span class="string">&quot;42156&quot;</span>,</span><br><span class="line">        <span class="string">&quot;generation&quot;</span>: 2,</span><br><span class="line">        <span class="string">&quot;creationTimestamp&quot;</span>: <span class="string">&quot;2021-03-28T11:55:17Z&quot;</span>,</span><br><span class="line">        <span class="string">&quot;annotations&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;deployment.kubernetes.io/revision&quot;</span>: <span class="string">&quot;1&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h2 id="how-to-use-host-network-directly-for-pod"><a href="#how-to-use-host-network-directly-for-pod" class="headerlink" title="how to use host network directly for pod"></a>how to use host network directly for pod</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">DaemonSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">traefik-ingress-lb</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">k8s-app:</span> <span class="string">traefik-ingress-lb</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">k8s-app:</span> <span class="string">traefik-ingress-lb</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">k8s-app:</span> <span class="string">traefik-ingress-lb</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">traefik-ingress-lb</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">terminationGracePeriodSeconds:</span> <span class="number">60</span></span><br><span class="line">      <span class="comment"># use host network diretly</span></span><br><span class="line">      <span class="attr">hostNetwork:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">restartPolicy:</span> <span class="string">Always</span></span><br><span class="line">      <span class="attr">serviceAccountName:</span> <span class="string">ingress</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">traefik:v1.7.20</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">traefik-ingress-lb</span></span><br></pre></td></tr></table></figure>

<h2 id="how-to-limit-resource-used-by-container"><a href="#how-to-limit-resource-used-by-container" class="headerlink" title="how to limit resource used by container"></a>how to limit resource used by container</h2><p>There are two kinds resource check for K8S pod, but it‚Äôs <code>set at each containers of that pod separately</code>.</p>
<ul>
<li>request: schedule to node only if it can proivde these resource, used by scheduler</li>
<li>limits: how much cpu&#x2F;memory container can use</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">containers:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">nginx:1.13.12</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">requests:</span></span><br><span class="line">      <span class="attr">memory:</span> <span class="string">&quot;64Mi&quot;</span></span><br><span class="line">      <span class="attr">cpu:</span> <span class="string">&quot;250m&quot;</span></span><br><span class="line">    <span class="attr">limits:</span></span><br><span class="line">      <span class="attr">memory:</span> <span class="string">&quot;128Mi&quot;</span></span><br><span class="line">      <span class="attr">cpu:</span> <span class="string">&quot;500m&quot;</span></span><br></pre></td></tr></table></figure>
<h2 id="Operator-vs-Helm"><a href="#Operator-vs-Helm" class="headerlink" title="Operator vs Helm"></a>Operator vs Helm</h2><p>They both serve the same basic goal of helping to install and configure apps in Kubernetes. But they do so in different ways. Depending on factors like how much control you want and how important ongoing application lifecycle management is, an operator might be better than a Helm chart, or vice versa.</p>
<hr>
<p>A Kubernetes Operator is a method of <strong>packaging, deploying and managing</strong> a Kubernetes application. Essentially, an Operator is a custom controller that <strong>extends the functionality of the Kubernetes API</strong>. This is accomplished by introducing new custom resources or by modifying existing ones.</p>
<p>Kubernetes Operators let you handle complex applications more easily.<code>Operators are designed to handle tasks like upgrades, backups and failover in a more automated and reliable way</code>. They can even make complex decisions based on the state of your cluster.</p>
<p><img src="https://cyun.tech/images/k8s/operator.png"></p>
<hr>
<p>A Helm chart is a package that contains the resources necessary for deploying an application on Kubernetes using a packaging format called charts. You can install Helm charts with (you guessed it!) Helm, an application package manager and configuration management tool for Kubernetes.</p>
<p><img src="https://cyun.tech/images/k8s/helm.jpeg"></p>
<hr>
<p><strong>Which one to choose</strong><br>If you need to manage complex, stateful applications and require a high degree of automation, Kubernetes Operator may be the better choice. On the other hand, if you‚Äôre looking for a simpler tool to help with application deployment or if you‚Äôre new to Kubernetes, Helm may be a more suitable option.</p>
<h2 id="Vanilla-Kubernetes-vs-Distribution-Kubernetes"><a href="#Vanilla-Kubernetes-vs-Distribution-Kubernetes" class="headerlink" title="Vanilla Kubernetes vs Distribution Kubernetes"></a>Vanilla Kubernetes vs Distribution Kubernetes</h2><p><strong>Vanilla Kubernetes is the upstream version of Kubernetes that is maintained by the Kubernetes community</strong>. It is the most basic and pure form of Kubernetes, without any modifications or additions. Vanilla Kubernetes is also known as stock Kubernetes or plain Kubernetes.</p>
<p>üëçPros  </p>
<ul>
<li>Flexible: highly flexible and customizable, allowing users to create and deploy a wide range of applications and workloads</li>
<li>Cost-effective: free and open-source, which means that users do not have to pay for support or maintenance fees</li>
</ul>
<p>üëéCons  </p>
<ul>
<li>Steep learning curve: can be difficult to learn and use, especially for users who are new to container orchestration</li>
<li>Complex deployment and management: deploying and managing vanilla Kubernetes requires more technical expertise and manual configuration<br>Distribution Kubernetes</li>
</ul>
<p><strong>A Kubernetes distribution is a packaged version of Kubernetes that includes additional features, tools, integrations</strong>, and support. A Kubernetes distribution aims to simplify the installation, configuration, management, and operation of Kubernetes clusters.</p>
<p>üî¥Types of Kubernetes Distributions  </p>
<ul>
<li><p><code>Enterprise Kubernetes</code>: designed for large enterprises and offer additional features such as advanced security, scalability, and manageability. Examples of enterprise Kubernetes distributions include <strong>Red Hat OpenShift, IBM Cloud Kubernetes Service, and Google Kubernetes Engine (GKE)</strong></p>
</li>
<li><p><code>Community Kubernetes</code>: designed for the open-source community and offer a range of features and tools that are not available in Vanilla Kubernetes. Examples of community Kubernetes distributions include <strong>CoreOS, Fedora, and openSUSE</strong></p>
</li>
<li><p><code>Cloud-Native Kubernetes</code>: designed for cloud-native applications and offer additional features such as serverless computing, service mesh, and observability. Examples of cloud-native Kubernetes distributions include <strong>AWS Elastic Kubernetes Service (EKS), Azure Kubernetes Service (AKS), and Google Kubernetes Engine (GKE)</strong></p>
</li>
<li><p><code>Hybrid Kubernetes</code>: designed for organizations that need to run Kubernetes on-premises and in the cloud. Examples of hybrid Kubernetes distributions include <strong>VMware Tanzu, OpenStack, and Kubernetes on AWS</strong></p>
</li>
</ul>
<p>üëçPros  </p>
<ul>
<li>Easier to use: provide a more streamlined and simplified experience for users, with additional tools and features that make it easier to deploy and manage applications</li>
<li>Additional features: offer additional features and capabilities, such as advanced security, scalability, and manageability</li>
<li>Support and maintenance: typically supported and maintained by the vendor, which means that users can receive support and updates more quickly and easily</li>
<li>Integration with other tools: integrate with other tools and services, such as monitoring, logging, and security solutions, which can simplify the deployment and management of applications</li>
<li>Security and compliance: some distributions come with built-in security features and compliance controls, making it easier for organizations to meet industry regulations and protect their applications and data</li>
</ul>
<p>üëéCons  </p>
<ul>
<li>Less flexible: they are designed to meet specific needs and use cases. This can limit the range of applications and workloads that can be deployed</li>
<li>Vendor lock-in: can lead to vendor lock-in, as users may become dependent on the vendor‚Äôs tools and features<br>Additional cost: often come with additional costs, such as support and maintenance fees, which can add to the overall cost of using Kubernetes</li>
</ul>

    </div>

    
    
    
      


    <footer class="post-footer">
          <div class="reward-container">
  <div></div>
  <button>
    Donate
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechatpay.jpeg" alt="Jason WeChat Pay">
        <span>WeChat Pay</span>
      </div>

  </div>
</div>

          <div class="post-tags">
              <a href="/tags/k8s/" rel="tag"># k8s</a>
              <a href="/tags/k8s-faq/" rel="tag"># k8s_faq</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2020/04/14/nginx-thundering-herd-accept/" rel="prev" title="nginx_thundering_herd_accept">
                  <i class="fa fa-chevron-left"></i> nginx_thundering_herd_accept
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2020/06/28/k8s-cmd/" rel="next" title="k8s_cmd">
                  k8s_cmd <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments utterances-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2018 ‚Äì 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Cyun All rights reserved</span>
</div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.0/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>



  <script src="/js/third-party/fancybox.js"></script>

  <script src="/js/third-party/pace.js"></script>

  




<script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"jason-bj/blog","issue_term":"pathname","theme":"github-light"}</script>
<script src="/js/third-party/comments/utterances.js"></script>

</body>
</html>
