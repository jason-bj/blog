<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" style="background-color: rgb(255, 255, 255);" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="1622px" height="1515px" viewBox="-0.5 -0.5 1622 1515" content="&lt;mxfile modified=&quot;2019-01-28T07:31:58.634Z&quot; host=&quot;www.draw.io&quot; agent=&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:64.0) Gecko/20100101 Firefox/64.0&quot; etag=&quot;0VJCGoarDBnXjxsdEzF-&quot; version=&quot;10.1.4&quot; type=&quot;device&quot;&gt;&lt;diagram id=&quot;tKmzMiykMQS-XE1H6s9r&quot; name=&quot;Page-1&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;"><defs><clipPath id="mx-clip-55-123-152-26-0"><rect x="55" y="123" width="152" height="26"/></clipPath><clipPath id="mx-clip-55-149-152-26-0"><rect x="55" y="149" width="152" height="26"/></clipPath><clipPath id="mx-clip-285-31-422-24-0"><rect x="285" y="31" width="422" height="24"/></clipPath><clipPath id="mx-clip-285-273-272-44-0"><rect x="285" y="273" width="272" height="44"/></clipPath></defs><path d="M 51 118 L 51 92 L 211 92 L 211 118" fill="#e0e0e0" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 51 118 L 51 170 L 211 170 L 211 118" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 51 118 L 211 118" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" text-anchor="middle" font-size="14px"><text x="129.79" y="109.5">struct net</text></g><g fill="#000000" font-family="Helvetica" clip-path="url(#mx-clip-55-123-152-26-0)" font-size="12px"><text x="56.5" y="135.5">struct netns_nf  nf;</text></g><g fill="#000000" font-family="Helvetica" clip-path="url(#mx-clip-55-149-152-26-0)" font-size="12px"><text x="56.5" y="161.5">struct netns_xt  xt</text></g><path d="M 281.14 13 L 277.51 13" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 272.26 13 L 279.26 9.5 L 277.51 13 L 279.26 16.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 281 26 L 281 0 L 711 0 L 711 26" fill="#e0e0e0" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 281 26 L 281 50 L 711 50 L 711 26" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 281 26 L 711 26" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" text-anchor="middle" font-size="14px"><text x="494.79" y="17.5">struct netns_nf  nf</text></g><g fill="#000000" font-family="Helvetica" clip-path="url(#mx-clip-285-31-422-24-0)" font-size="12px"><text x="286.5" y="43.5">struct list_head hooks[NFPROTO_NUMPROTO][NF_MAX_HOOKS];</text></g><path d="M 281 268 L 281 242 L 561 242 L 561 268" fill="#e0e0e0" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 281 268 L 281 312 L 561 312 L 561 268" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 281 268 L 561 268" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" text-anchor="middle" font-size="14px"><text x="419.79" y="259.5">struct netns_xt  xt</text></g><g fill="#000000" font-family="Helvetica" clip-path="url(#mx-clip-285-273-272-44-0)" font-size="12px"><text x="286.5" y="285.5">struct list_head tables[NFPROTO_NUMPROTO]</text><text x="286.5" y="299.5">(store all tables of this proto)</text></g><path d="M 211.14 131.57 L 231.14 131.57 L 231.14 11.57 L 274.63 11.57" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 279.88 11.57 L 272.88 15.07 L 274.63 11.57 L 272.88 8.07 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 301 67 L 461 67 L 491 97 L 491 237 L 301 237 L 301 67 Z" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 461 67 L 461 97 L 491 97 Z" fill-opacity="0.05" fill="#000000" stroke="none" pointer-events="none"/><path d="M 461 67 L 461 97 L 491 97" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(302.5,70.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="157" height="156" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 158px; white-space: nowrap; overflow-wrap: normal;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">enum {<br />    NFPROTO_UNSPEC =  0,<br />    NFPROTO_INET   =  1,<br /> <font color="#EA6B66"><b>   NFPROTO_IPV4   =  2,</b></font><br />    NFPROTO_ARP    =  3,<br />    NFPROTO_NETDEV =  5,<br />    NFPROTO_BRIDGE =  7,<br />    NFPROTO_IPV6   = 10,<br />    NFPROTO_DECNET = 12,<br />    NFPROTO_NUMPROTO,<br />};</div></div></foreignObject><text x="79" y="84" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 211.14 157.29 L 245.43 157.29 L 245.43 277.29 L 274.77 277.29" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 280.02 277.29 L 273.02 280.79 L 274.77 277.29 L 273.02 273.79 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 511 87 L 691 87 L 711 107 L 711 227 L 511 227 L 511 87 Z" fill="#ffffff" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="none"/><path d="M 691 87 L 691 107 L 711 107" fill="none" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(513.5,88.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="192" height="132" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 193px; white-space: nowrap; overflow-wrap: normal;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">enum nf_inet_hooks {<br />    NF_INET_PRE_ROUTING,<br />    NF_INET_LOCAL_IN,<br />    NF_INET_FORWARD,<br />    NF_INET_LOCAL_OUT,<br />    NF_INET_POST_ROUTING,<br />    NF_INET_NUMHOOKS<br />};<br /></div></div></foreignObject><text x="96" y="73" fill="#000000" text-anchor="middle" font-size="14px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><g transform="translate(572.5,249.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="198" height="41" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 18px; font-family: Helvetica; color: rgb(255, 0, 128); line-height: 1.2; vertical-align: top; width: 198px; white-space: normal; overflow-wrap: normal; font-weight: bold;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">MAX_HOOKS here are hook point supported</div></div></foreignObject><text x="99" y="30" fill="#FF0080" text-anchor="middle" font-size="18px" font-family="Helvetica" font-weight="bold">MAX_HOOKS here are hook point supported</text></switch></g><g transform="translate(22.5,183.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="218" height="152" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 16px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 218px; white-space: normal; overflow-wrap: normal;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;background-color:#B9E0A5;">as you can see for each NFPROTO like ipv4 and ipv6 etc, there is an array with MAX hook point array!<br /><br />each entry in that array<br /><div>is a list which hold all register hooks order by priority<br /></div></div></div></foreignObject><text x="109" y="84" fill="#000000" text-anchor="middle" font-size="16px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><g transform="translate(372.5,370.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="219" height="65" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 28px; font-family: Helvetica; color: rgb(0, 0, 255); line-height: 1.2; vertical-align: top; width: 220px; white-space: nowrap; overflow-wrap: normal; font-weight: bold;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">IPV4 Filter Table<br />(iptable_filter.c)</div></div></foreignObject><text x="110" y="47" fill="#0000FF" text-anchor="middle" font-size="28px" font-family="Helvetica" font-weight="bold">IPV4 Filter Table&lt;br&gt;(iptable_filter.c)</text></switch></g><path d="M 281.14 541.57 L 324.77 541.57" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 330.02 541.57 L 323.02 545.07 L 324.77 541.57 L 323.02 538.07 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="1" y="522" width="280" height="40" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(2.5,522.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="256" height="32" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 28px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 257px; white-space: nowrap; overflow-wrap: normal;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">iptable_filter_net_init</div></div></foreignObject><text x="128" y="30" fill="#000000" text-anchor="middle" font-size="28px" font-family="Helvetica">iptable_filter_net_init</text></switch></g><path d="M 631.14 554.43 L 655.43 554.43 L 655.43 547.29 L 671.92 547.29" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 677.17 547.29 L 670.17 550.79 L 671.92 547.29 L 670.17 543.79 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="331" y="517" width="300" height="50" rx="7.5" ry="7.5" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(332.5,522.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="277" height="32" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 28px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 278px; white-space: nowrap; overflow-wrap: normal;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">iptable_filter_table_init</div></div></foreignObject><text x="139" y="30" fill="#000000" text-anchor="middle" font-size="28px" font-family="Helvetica">iptable_filter_table_init</text></switch></g><path d="M 1 592 L 271 592 L 291 612 L 291 762 L 1 762 L 1 592 Z" fill="#ffffff" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="none"/><path d="M 271 592 L 271 612 L 291 612" fill="none" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(3.5,608.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="277" height="132" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 278px; white-space: nowrap; overflow-wrap: normal;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">static const struct xt_table packet_filter = {<br />    .name       = "filter",<br /><font color="#67AB9F">    .valid_hooks    = FILTER_VALID_HOOKS,</font><br />    .me     = THIS_MODULE,<br /><font color="#67AB9F">    .af     = NFPROTO_IPV4,<br />    .priority   = NF_IP_PRI_FILTER,</font><br />    .table_init = iptable_filter_table_init,<br />};</div></div></foreignObject><text x="139" y="73" fill="#000000" text-anchor="middle" font-size="14px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 311 592 L 611 592 L 631 612 L 631 672 L 311 672 L 311 592 Z" fill="#ffffff" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="none"/><path d="M 611 592 L 611 612 L 631 612" fill="none" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(313.5,597.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="315" height="65" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 315px; white-space: normal; overflow-wrap: normal;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">#define FILTER_VALID_HOOKS ((1 &lt;&lt; NF_INET_LOCAL_IN) | \<br />                (1 &lt;&lt; NF_INET_FORWARD) | \<br />                (1 &lt;&lt; NF_INET_LOCAL_OUT))<br /></div></div></foreignObject><text x="158" y="40" fill="#000000" text-anchor="middle" font-size="14px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><g transform="translate(312.5,692.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="426" height="65" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 28px; font-family: Helvetica; color: rgb(255, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap; font-weight: bold;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">common hook function for filter<br />iptable_filter_hook</div></div></foreignObject><text x="213" y="47" fill="#FF0000" text-anchor="middle" font-size="28px" font-family="Helvetica" font-weight="bold">common hook function for filter&lt;br&gt;iptable_filter_hook</text></switch></g><rect x="946" y="452" width="220" height="50" rx="7.5" ry="7.5" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(947.5,457.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="205" height="32" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 28px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 206px; white-space: nowrap; overflow-wrap: normal;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">xt_register_table</div></div></foreignObject><text x="103" y="30" fill="#000000" text-anchor="middle" font-size="28px" font-family="Helvetica">xt_register_table</text></switch></g><path d="M 844 501.57 L 844 477.29 L 939.63 477.29" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 944.88 477.29 L 937.88 480.79 L 939.63 477.29 L 937.88 473.79 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 844 561.57 L 844 627.29 L 924.77 627.29" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 930.02 627.29 L 923.02 630.79 L 924.77 627.29 L 923.02 623.79 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="678.5" y="502" width="220" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(680.5,512.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="214" height="32" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 28px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 215px; white-space: nowrap; overflow-wrap: normal;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">ipt_register_table</div></div></foreignObject><text x="107" y="30" fill="#000000" text-anchor="middle" font-size="28px" font-family="Helvetica">ipt_register_table</text></switch></g><rect x="931" y="582" width="290" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(932.5,592.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="276" height="32" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 28px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 277px; white-space: nowrap; overflow-wrap: normal;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">nf_register_net_hooks</div></div></foreignObject><text x="138" y="30" fill="#000000" text-anchor="middle" font-size="28px" font-family="Helvetica">nf_register_net_hooks</text></switch></g><g transform="translate(842.5,652.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="368" height="200" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 28px; font-family: Helvetica; color: rgb(234, 107, 102); line-height: 1.2; vertical-align: top; width: 368px; white-space: normal; overflow-wrap: normal;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">for each valid hooks<br />(IN,FOR, OUT)<br />register an entry in that list head(net-&gt;nf-&gt;hooks[IPV4][IN/OUT/FORWAR])with the common hook function</div></div></foreignObject><text x="184" y="114" fill="#EA6B66" text-anchor="middle" font-size="28px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 21 882 L 361 882 L 381 902 L 381 1192 L 21 1192 L 21 882 Z" fill="#ffffff" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="none"/><path d="M 361 882 L 361 902 L 381 902" fill="none" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(23.5,901.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="355" height="267" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 355px; white-space: normal; overflow-wrap: normal;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">struct xt_table {<br />    struct list_head list;<br />    /* What hooks you will enter on */<br />    unsigned int valid_hooks;<br />    /* Man behind the curtain... */<br /> <font color="#EA6B66"><b>   struct xt_table_info *private;</b></font><br />    /* Set this to THIS_MODULE if you are a module, otherwise NULL */<br />    struct module *me;<br />    u_int8_t af;        /* address/protocol family */<br />    int priority;       /* hook order */<br />    /* called when table is needed in the given netns */<br />    int (*table_init)(struct net *net);<br />    /* A unique name... */<br />    const char name[XT_TABLE_MAXNAMELEN];<br />};</div></div></foreignObject><text x="178" y="141" fill="#000000" text-anchor="middle" font-size="14px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 448.5 862 L 888.5 862 L 908.5 882 L 908.5 1242 L 448.5 1242 L 448.5 862 Z" fill="#ffffff" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="none"/><path d="M 888.5 862 L 888.5 882 L 908.5 882" fill="none" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(451.5,891.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="441" height="317" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 442px; white-space: nowrap; overflow-wrap: normal;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">/* The table itself */<br />struct xt_table_info {<br />    /* Size per table */<br />    unsigned int size;<br />    /* Number of entries: FIXME. --RR */<br />    unsigned int number;<br />    /* Initial number of entries. Needed for module usage count */<br />    unsigned int initial_entries;<br />    /* Entry points and underflows */<br /><font color="#EA6B66">    unsigned int hook_entry[NF_INET_NUMHOOKS];</font><br />    unsigned int underflow[NF_INET_NUMHOOKS];<br />    /*<br />     * Number of user chains. Since tables cannot have loops, at most<br />     * @stacksize jumps (number of user chains) can possibly be made.<br />     */<br />    unsigned int stacksize;<br />    void ***jumpstack;<br />    unsigned char entries[0] __aligned(8);<br />};</div></div></foreignObject><text x="221" y="166" fill="#000000" text-anchor="middle" font-size="14px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><g transform="translate(946.5,933.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="328" height="233" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 28px; font-family: Helvetica; color: rgb(234, 107, 102); line-height: 1.2; vertical-align: top; width: 328px; white-space: normal; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><div align="left">each table has xt_table in kernel, private stores all rules(configured) in that table, note <b>each table can have different HOOK rules</b><br /></div><div align="left"><b>so hook_entry[] here</b><br /></div></div></div></foreignObject><text x="164" y="131" fill="#EA6B66" text-anchor="middle" font-size="28px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><g transform="translate(2.5,1278.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="1228" height="132" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 28px; font-family: Helvetica; color: rgb(154, 199, 191); line-height: 1.2; vertical-align: top; width: 1228px; white-space: normal; overflow-wrap: normal; font-weight: bold;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">as filter only support IN, OUT, FORWARD, so even you configure rules in filter table with PREROUTING(if allowed), there rules will never run as filter kernel module only register<br />entry at IN,OUT, FORWARD, that means PREROUTING point hook chains doesn't have filter<br />table entry, its callback will never be called.</div></div></foreignObject><text x="614" y="80" fill="#9AC7BF" text-anchor="middle" font-size="28px" font-family="Helvetica" font-weight="bold">[Not supported by viewer]</text></switch></g><path d="M 201.14 1481.57 L 245.43 1481.57 L 245.43 1497.29 L 284.77 1497.29" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 290.02 1497.29 L 283.02 1500.79 L 284.77 1497.29 L 283.02 1493.79 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="1" y="1452" width="200" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(2.5,1462.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="190" height="32" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 28px; font-family: Helvetica; color: rgb(255, 0, 0); line-height: 1.2; vertical-align: top; width: 191px; white-space: nowrap; overflow-wrap: normal;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">ip_local_deliver</div></div></foreignObject><text x="95" y="30" fill="#FF0000" text-anchor="middle" font-size="28px" font-family="Helvetica">ip_local_deliver</text></switch></g><path d="M 521.14 1481.57 L 579.06 1481.57" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 584.31 1481.57 L 577.31 1485.07 L 579.06 1481.57 L 577.31 1478.07 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="291" y="1452" width="230" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(292.5,1446.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="227" height="65" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 28px; font-family: Helvetica; color: rgb(255, 0, 0); line-height: 1.2; vertical-align: top; width: 227px; white-space: normal; overflow-wrap: normal;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">NF_HOOK(IPV4, LOCAL_IN)</div></div></foreignObject><text x="114" y="47" fill="#FF0000" text-anchor="middle" font-size="28px" font-family="Helvetica">NF_HOOK(IPV4, LOCAL_IN)</text></switch></g><path d="M 975.43 1481.57 L 1049.06 1481.57" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 1054.31 1481.57 L 1047.31 1485.07 L 1049.06 1481.57 L 1047.31 1478.07 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="586" y="1457" width="390" height="50" rx="7.5" ry="7.5" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(587.5,1462.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="374" height="32" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 28px; font-family: Helvetica; color: rgb(255, 0, 0); line-height: 1.2; vertical-align: top; width: 375px; white-space: nowrap; overflow-wrap: normal;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">check all entries in LOCAL_IN</div></div></foreignObject><text x="187" y="30" fill="#FF0000" text-anchor="middle" font-size="28px" font-family="Helvetica">check all entries in LOCAL_IN</text></switch></g><path d="M 1305.43 1481.57 L 1344 1481.57 L 1344 1477.29 L 1374.77 1477.29" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 1380.02 1477.29 L 1373.02 1480.79 L 1374.77 1477.29 L 1373.02 1473.79 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><rect x="1056" y="1457" width="250" height="50" rx="7.5" ry="7.5" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(1057.5,1462.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="225" height="32" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 28px; font-family: Helvetica; color: rgb(255, 0, 0); line-height: 1.2; vertical-align: top; width: 226px; white-space: nowrap; overflow-wrap: normal;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">iptable_filter_hook</div></div></foreignObject><text x="113" y="30" fill="#FF0000" text-anchor="middle" font-size="28px" font-family="Helvetica">iptable_filter_hook</text></switch></g><rect x="1381" y="1447" width="240" height="60" rx="9" ry="9" fill="#ffffff" stroke="#000000" pointer-events="none"/><g transform="translate(1382.5,1441.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="237" height="65" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 28px; font-family: Helvetica; color: rgb(255, 0, 0); line-height: 1.2; vertical-align: top; width: 237px; white-space: normal; overflow-wrap: normal;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">check runs in this table[LOCAL_IN]</div></div></foreignObject><text x="119" y="47" fill="#FF0000" text-anchor="middle" font-size="28px" font-family="Helvetica">check runs in this table[LOCAL_IN]</text></switch></g></svg>