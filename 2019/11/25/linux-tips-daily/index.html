<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon/favicon-16x16.png">
  <meta name="google-site-verification" content="xitt2fbphh1nTeWLiTWc0lCggHuxJ5heMcAzkHW2vno">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Microsoft+YaHei+UI:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"cyun.tech","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.11.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"utterances","storage":true,"lazyload":false,"nav":null,"activeClass":"utterances"},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":10,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="TipsHere are some tips that are useful in our daily life.">
<meta property="og:type" content="article">
<meta property="og:title" content="linux-tips-daily">
<meta property="og:url" content="http://cyun.tech/2019/11/25/linux-tips-daily/index.html">
<meta property="og:site_name" content="CYun">
<meta property="og:description" content="TipsHere are some tips that are useful in our daily life.">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://ipcisco.com/wp-content/uploads/2021/01/ftp-active-mode-ipcisco.jpg">
<meta property="og:image" content="https://ipcisco.com/wp-content/uploads/2021/01/ftp-passive-mode-ipcisco.jpg">
<meta property="og:image" content="https://images.prismic.io/exavault-website/be48decc-2108-4c33-b6f6-ab8bdffb2b6b_essential-ftp-commands.png?auto=compress,format">
<meta property="article:published_time" content="2019-11-25T03:35:49.000Z">
<meta property="article:modified_time" content="2024-12-31T07:23:13.242Z">
<meta property="article:author" content="Jason">
<meta property="article:tag" content="linux">
<meta property="article:tag" content="command">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://ipcisco.com/wp-content/uploads/2021/01/ftp-active-mode-ipcisco.jpg">


<link rel="canonical" href="http://cyun.tech/2019/11/25/linux-tips-daily/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://cyun.tech/2019/11/25/linux-tips-daily/","path":"2019/11/25/linux-tips-daily/","title":"linux-tips-daily"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>linux-tips-daily | CYun</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-148730544-1"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-148730544-1","only_pageview":false}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>

  <script src="/js/third-party/analytics/baidu-analytics.js"></script>
  <script async src="https://hm.baidu.com/hm.js?a510d1f580c8231f8f867d14f42bb8ea"></script>




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">CYun</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Tips"><span class="nav-number">1.</span> <span class="nav-text">Tips</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#remove-%E2%80%98du-du%E2%80%99-sound-when-tap-keyboard"><span class="nav-number">1.1.</span> <span class="nav-text">remove ‘du du’ sound when tap keyboard</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#linux-mount-file"><span class="nav-number">1.2.</span> <span class="nav-text">linux mount file</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#lsattr-and-chattr"><span class="nav-number">1.3.</span> <span class="nav-text">lsattr and chattr</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#config-nameserver"><span class="nav-number">1.4.</span> <span class="nav-text">config nameserver</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#config-static-address"><span class="nav-number">1.5.</span> <span class="nav-text">config static address</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#grep-x2F-egrep-x2F-rgrep-x2F-zgrep-options"><span class="nav-number">1.6.</span> <span class="nav-text">grep&#x2F;egrep&#x2F;rgrep&#x2F;zgrep options</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#show-current-runlevel"><span class="nav-number">1.7.</span> <span class="nav-text">show current runlevel</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#manage-service"><span class="nav-number">1.8.</span> <span class="nav-text">manage service</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#write-a-system-V-service"><span class="nav-number">1.8.1.</span> <span class="nav-text">write a system V service</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#write-a-upstart-service-ubuntu18"><span class="nav-number">1.8.2.</span> <span class="nav-text">write a upstart service(ubuntu18)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#write-systemd-service"><span class="nav-number">1.8.3.</span> <span class="nav-text">write systemd service</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#debug-systemd-service"><span class="nav-number">1.8.3.1.</span> <span class="nav-text">debug systemd service</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#auto-mount"><span class="nav-number">1.9.</span> <span class="nav-text">auto mount</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#configure-samba-server"><span class="nav-number">1.10.</span> <span class="nav-text">configure samba server</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#share-file-between-linux-and-linux-by-nfs"><span class="nav-number">1.11.</span> <span class="nav-text">share file between linux and linux by nfs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#run-your-task-daily-weekly-etc"><span class="nav-number">1.12.</span> <span class="nav-text">run your task daily, weekly etc</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#See-anacron-8-and-anacrontab-5-for-details"><span class="nav-number">2.</span> <span class="nav-text">See anacron(8) and anacrontab(5) for details.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#the-maximal-random-delay-added-to-the-base-delay-of-the-jobs"><span class="nav-number">3.</span> <span class="nav-text">the maximal random delay added to the base delay of the jobs</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#RANDOM-DELAY-x3D-45"><span class="nav-number">4.</span> <span class="nav-text">RANDOM_DELAY&#x3D;45</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#the-jobs-will-be-started-during-the-following-hours-only"><span class="nav-number">5.</span> <span class="nav-text">the jobs will be started during the following hours only</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#configure-your-own-dns-server-by-bind-application"><span class="nav-number">5.1.</span> <span class="nav-text">configure your own dns server by bind application</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#put-file-in-memory"><span class="nav-number">5.2.</span> <span class="nav-text">put file in memory</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#run-script-at-current-shell-not-subshell"><span class="nav-number">5.3.</span> <span class="nav-text">run script at current shell not subshell</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#dos-and-unix-format"><span class="nav-number">5.4.</span> <span class="nav-text">dos and unix format</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%AD%E6%96%87%E4%B9%B1%E7%A0%81%E7%9A%84%E5%8E%9F%E5%9B%A0%E5%88%86%E6%9E%90"><span class="nav-number">5.5.</span> <span class="nav-text">中文乱码的原因分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#vncserver"><span class="nav-number">5.6.</span> <span class="nav-text">vncserver</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ssh-related"><span class="nav-number">5.7.</span> <span class="nav-text">ssh related</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#user-management"><span class="nav-number">5.8.</span> <span class="nav-text">user management</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#x2F-etc-x2F-sudoers-Ubuntu18"><span class="nav-number">5.9.</span> <span class="nav-text">&#x2F;etc&#x2F;sudoers(Ubuntu18)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#broadcast-message-to-all-users-from-terminal"><span class="nav-number">5.10.</span> <span class="nav-text">broadcast message to all users from terminal</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#copy-file-from-local-to-remote-ssh-server"><span class="nav-number">5.11.</span> <span class="nav-text">copy file from local to remote ssh server</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#create-soft-link-for-all-files-under-a-dir"><span class="nav-number">5.12.</span> <span class="nav-text">create soft link for all files under a dir</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#cfg-file-for-shell"><span class="nav-number">5.13.</span> <span class="nav-text">cfg file for shell</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sys-related"><span class="nav-number">5.14.</span> <span class="nav-text">sys related</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#reset-root-password"><span class="nav-number">5.15.</span> <span class="nav-text">reset root password</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#disable-boot-from-save-grub-entry-for-grub2"><span class="nav-number">5.16.</span> <span class="nav-text">disable boot from save grub entry for grub2</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#force-enter-command-line-mode-when-boots"><span class="nav-number">5.17.</span> <span class="nav-text">force enter command-line mode when boots</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#enter-single-user-mode-when-boots"><span class="nav-number">5.18.</span> <span class="nav-text">enter single-user mode when boots</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#x2F-etc-x2F-fstab-file-format"><span class="nav-number">5.19.</span> <span class="nav-text">&#x2F;etc&#x2F;fstab file format</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#deep-in-remove-file"><span class="nav-number">5.20.</span> <span class="nav-text">deep in remove file</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#update-file-time"><span class="nav-number">5.21.</span> <span class="nav-text">update file time</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#cut-command"><span class="nav-number">5.22.</span> <span class="nav-text">cut command</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#remove-file-named-with-special-character"><span class="nav-number">5.23.</span> <span class="nav-text">remove file named with special character</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#display-output-to-screen-and-also-write-it-to-file"><span class="nav-number">5.24.</span> <span class="nav-text">display output to screen and also write it to file</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#command-xargs"><span class="nav-number">5.25.</span> <span class="nav-text">command xargs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#find-command-better-use-find-file-not-content-of-file"><span class="nav-number">5.26.</span> <span class="nav-text">find command(better use find file, not content of file)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#rename-a-batch-of-files-with-pattern"><span class="nav-number">5.27.</span> <span class="nav-text">rename a batch of files with pattern</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#show-stats-of-a-file"><span class="nav-number">5.28.</span> <span class="nav-text">show stats of a file</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#copy-file"><span class="nav-number">5.29.</span> <span class="nav-text">copy file</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#tar"><span class="nav-number">5.30.</span> <span class="nav-text">tar</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sleep-and-usleep"><span class="nav-number">5.31.</span> <span class="nav-text">sleep and usleep</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#history-command"><span class="nav-number">5.32.</span> <span class="nav-text">history command</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#run-command-with-a-specific-user-or-group"><span class="nav-number">5.33.</span> <span class="nav-text">run command with a specific user or group</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#list-all-alias"><span class="nav-number">5.34.</span> <span class="nav-text">list all alias</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#redirect-shell-output"><span class="nav-number">5.35.</span> <span class="nav-text">redirect shell output</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#read-one-file-at-a-time-from-a-file"><span class="nav-number">5.36.</span> <span class="nav-text">read one file at a time from a file</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#read-input-from-standard-input-instead-of-a-file"><span class="nav-number">5.37.</span> <span class="nav-text">read input from standard input instead of a file</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#git-status-can%E2%80%99t-display-chinese-character"><span class="nav-number">5.38.</span> <span class="nav-text">git status can’t display chinese character</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#check-md5-value-for-a-file"><span class="nav-number">5.39.</span> <span class="nav-text">check md5 value for a file</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#format-man-output-and-save-it-to-a-file"><span class="nav-number">5.40.</span> <span class="nav-text">format man output and save it to a file</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#watch-a-command-output-by-%E2%80%98n-seconds%E2%80%99"><span class="nav-number">5.41.</span> <span class="nav-text">watch a command output by ‘n seconds’</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#file-encoding-convertor-iconv"><span class="nav-number">5.42.</span> <span class="nav-text">file encoding convertor iconv</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#error-%E2%80%98sorry-you-must-have-a-tty-to-run-sudo%E2%80%99"><span class="nav-number">5.43.</span> <span class="nav-text">error ‘sorry, you must have a tty to run sudo’</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#generate-uuid"><span class="nav-number">5.44.</span> <span class="nav-text">generate uuid</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#formated-json-output-from-shell"><span class="nav-number">5.45.</span> <span class="nav-text">formated json output from shell</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Add-an-environment-variable-to-a-command"><span class="nav-number">5.46.</span> <span class="nav-text">Add an environment variable to a command</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#eval-to-run-command-from-string"><span class="nav-number">5.47.</span> <span class="nav-text">eval to run command from string</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#killall-command-not-found"><span class="nav-number">5.48.</span> <span class="nav-text">killall command not found</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#capture-signal-in-shell"><span class="nav-number">5.49.</span> <span class="nav-text">capture signal in shell</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#write-message-to-x2F-var-x2F-log-x2F-syslog-by-shell"><span class="nav-number">5.50.</span> <span class="nav-text">write message to &#x2F;var&#x2F;log&#x2F;syslog by shell</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#rsyslog-conf"><span class="nav-number">5.51.</span> <span class="nav-text">rsyslog conf</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#wget"><span class="nav-number">5.52.</span> <span class="nav-text">wget</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#wget-breakpoint-and-retry"><span class="nav-number">5.53.</span> <span class="nav-text">wget breakpoint and retry</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#run-a-basic-http-server"><span class="nav-number">5.54.</span> <span class="nav-text">run a basic http server</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#scan-host-on-local-network"><span class="nav-number">5.55.</span> <span class="nav-text">scan host on local network</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#resize-disk-vm-after-change-its-size"><span class="nav-number">5.56.</span> <span class="nav-text">resize disk(vm) after change its size</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#count-line-of-code"><span class="nav-number">5.57.</span> <span class="nav-text">count line of code</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#setup-tcp-x2F-udp-server-with-nc"><span class="nav-number">5.58.</span> <span class="nav-text">setup tcp&#x2F;udp server with nc</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#check-virtual-disk-real-size"><span class="nav-number">5.59.</span> <span class="nav-text">check virtual disk real size</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#timezone-and-ntpdate"><span class="nav-number">5.60.</span> <span class="nav-text">timezone and ntpdate</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ps-aux"><span class="nav-number">5.61.</span> <span class="nav-text">ps aux</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#copy-excludes-some-dir"><span class="nav-number">5.62.</span> <span class="nav-text">copy excludes some dir</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#show-start-time-of-process"><span class="nav-number">5.63.</span> <span class="nav-text">show start time of process</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ls-output-blinking-ls-x2F-proc-x2F-pid-x2F-fd"><span class="nav-number">5.64.</span> <span class="nav-text">ls output blinking ls &#x2F;proc&#x2F;pid&#x2F;fd</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#top-output"><span class="nav-number">5.65.</span> <span class="nav-text">top output</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#create-iso-file-from-command-line"><span class="nav-number">5.66.</span> <span class="nav-text">create iso file from command line</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#setup-proxy-server"><span class="nav-number">5.67.</span> <span class="nav-text">setup proxy server</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#swap"><span class="nav-number">5.68.</span> <span class="nav-text">swap</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#set-process-prority"><span class="nav-number">5.69.</span> <span class="nav-text">set process prority</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#split-large-file-into-smaller-ones"><span class="nav-number">5.70.</span> <span class="nav-text">split large file into smaller ones</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#setup-ftp-server-centos"><span class="nav-number">5.71.</span> <span class="nav-text">setup ftp server (centos)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ps-command-advanced"><span class="nav-number">5.72.</span> <span class="nav-text">ps command advanced</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sort-command-advaned"><span class="nav-number">5.73.</span> <span class="nav-text">sort command advaned</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#run-python-service-from-virtual-env"><span class="nav-number">5.74.</span> <span class="nav-text">run python service from virtual env</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#encrypt-a-file"><span class="nav-number">5.75.</span> <span class="nav-text">encrypt a file</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#disable-cpu-without-reboot-system"><span class="nav-number">5.76.</span> <span class="nav-text">disable cpu without reboot system</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#show-hardware-meta"><span class="nav-number">5.77.</span> <span class="nav-text">show hardware meta</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#use-x2F-dev-x2F-urandom"><span class="nav-number">5.78.</span> <span class="nav-text">use &#x2F;dev&#x2F;urandom</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#no-space-left-on-system"><span class="nav-number">5.79.</span> <span class="nav-text">no space left on system</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#systemd-socket-activation"><span class="nav-number">5.80.</span> <span class="nav-text">systemd socket activation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#lsmem-and-free-show-different-total-memory"><span class="nav-number">5.81.</span> <span class="nav-text">lsmem and free show different total memory</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#change-PS1-env"><span class="nav-number">5.82.</span> <span class="nav-text">change PS1 env</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#proxy-setting"><span class="nav-number">5.83.</span> <span class="nav-text">proxy setting</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#process-limits"><span class="nav-number">5.84.</span> <span class="nav-text">process limits</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#random-lines"><span class="nav-number">5.85.</span> <span class="nav-text">random lines</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pgrep-vs-pidof"><span class="nav-number">5.86.</span> <span class="nav-text">pgrep vs pidof</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#remove-cgroup-from-x2F-sys-x2F-fs"><span class="nav-number">5.87.</span> <span class="nav-text">remove cgroup from &#x2F;sys&#x2F;fs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#find-all-shell-scripts"><span class="nav-number">5.88.</span> <span class="nav-text">find all shell scripts</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#add-time-out-for-any-shell-command"><span class="nav-number">5.89.</span> <span class="nav-text">add time out for any shell command</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#which-numa-memory-by-a-process"><span class="nav-number">5.90.</span> <span class="nav-text">which numa memory by a process</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#check-initrd-img"><span class="nav-number">5.91.</span> <span class="nav-text">check initrd.img</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Check-if-Hard-Drive-is-SSD-or-HDD-on-Linux"><span class="nav-number">5.92.</span> <span class="nav-text">Check if Hard Drive is SSD or HDD on Linux</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#disk-related"><span class="nav-number">5.93.</span> <span class="nav-text">disk related</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#regular-pattern-greedy-vs-lazy-match"><span class="nav-number">5.94.</span> <span class="nav-text">regular pattern greedy vs lazy match</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#tar-with-progress-bar"><span class="nav-number">5.95.</span> <span class="nav-text">tar with progress bar</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#control-file-for-sudo"><span class="nav-number">5.96.</span> <span class="nav-text">control file for sudo</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#what-does-dmesg-do"><span class="nav-number">5.97.</span> <span class="nav-text">what does dmesg do</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#temporary-select-next-reboot-kernel"><span class="nav-number">5.98.</span> <span class="nav-text">temporary select next reboot kernel</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Jason"
      src="/uploads/avatar.gif">
  <p class="site-author-name" itemprop="name">Jason</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">150</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">143</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">149</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/jason-cyun" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;jason-cyun" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:jason_lkm@163.com" title="E-Mail → mailto:jason_lkm@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://cyun.tech/2019/11/25/linux-tips-daily/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.gif">
      <meta itemprop="name" content="Jason">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CYun">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="linux-tips-daily | CYun">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          linux-tips-daily
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2019-11-25 11:35:49" itemprop="dateCreated datePublished" datetime="2019-11-25T11:35:49+08:00">2019-11-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-31 15:23:13" itemprop="dateModified" datetime="2024-12-31T15:23:13+08:00">2024-12-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/linux/tips/" itemprop="url" rel="index"><span itemprop="name">tips</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a>Tips</h1><p>Here are some tips that are useful in our daily life.</p>
<span id="more"></span>

<h2 id="remove-‘du-du’-sound-when-tap-keyboard"><a href="#remove-‘du-du’-sound-when-tap-keyboard" class="headerlink" title="remove ‘du du’ sound when tap keyboard"></a>remove ‘du du’ sound when tap keyboard</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo rmmod pcspkr</span><br></pre></td></tr></table></figure>

<h2 id="linux-mount-file"><a href="#linux-mount-file" class="headerlink" title="linux mount file"></a>linux mount file</h2><p><strong>mount files from windows by samba</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Centos7</span></span><br><span class="line">$ yum install -y cifs-utils</span><br><span class="line">$ sudo mount -t cifs //serverip/share /media/share -o user,<span class="built_in">sync</span>,user=xxx,password=pxx,uid=1000,gid=1000,file_mode=0600,dir_mode=0700,noperm</span><br><span class="line"></span><br><span class="line"><span class="comment"># error cases</span></span><br><span class="line">    <span class="comment"># case: wrong password (special characters that can not pass through command line)</span></span><br><span class="line">    <span class="comment"># case: wrong source directory(caused by wrong spell or format is not correct)</span></span><br><span class="line">    <span class="comment"># case: access control issue.</span></span><br><span class="line">    <span class="comment"># case: ubuntu iptables</span></span><br><span class="line">    <span class="comment"># case:  proxy(router)firewall</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># case: china character show incorrectly. export LC_ALL=zh_CN.utf8</span></span><br><span class="line">    <span class="comment">#       before you set, make sure to run $ locale -a to see all language supported.</span></span><br></pre></td></tr></table></figure>
<p><strong>mount iso file</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ mount -o loop disk.iso  /mnt/disk</span><br><span class="line">$ umount /mnt/disk</span><br></pre></td></tr></table></figure>

<p><strong>mount a raw file</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># check disk type raw or qcow2</span></span><br><span class="line">$ qemu-img info disk.img</span><br><span class="line">...</span><br><span class="line">file format: raw</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment"># get file system type</span></span><br><span class="line">$ blkid disk.img</span><br><span class="line"></span><br><span class="line"><span class="comment"># mount it</span></span><br><span class="line">$ mount -t xfs disk.img /mnt/disk</span><br><span class="line">$ umount /mnt/disk</span><br></pre></td></tr></table></figure>


<p><strong>mount a qcow2 file</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># use a free nbd device</span></span><br><span class="line">$ qemu-nbd -c /dev/nbd100 disk.qcow2</span><br><span class="line"></span><br><span class="line"><span class="comment"># mount the first partition or second ..</span></span><br><span class="line">$ fdisk /dev/nbd100 -l</span><br><span class="line">Disk label <span class="built_in">type</span>: dos</span><br><span class="line">Disk identifier: 0x000eb26e</span><br><span class="line"></span><br><span class="line">     Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/nbd100p1   *        2048      616447      307200   83  Linux</span><br><span class="line">/dev/nbd100p2          616448  1011460095   505421824   8e  Linux LVM</span><br><span class="line"></span><br><span class="line">$ mount /dev/nbd100p1 /mnt/disk</span><br><span class="line"></span><br><span class="line"><span class="comment"># =====fix the partition table=========================</span></span><br><span class="line"><span class="comment"># if you see below error</span></span><br><span class="line">mount: special device /dev/nbd100p1 does not exist</span><br><span class="line"><span class="comment"># if kpartx is not working, try partx -a /dev/nbd100</span></span><br><span class="line">$ kpartx -a /dev/nbd100</span><br><span class="line"><span class="comment"># =====fix the partition table=========================</span></span><br><span class="line"></span><br><span class="line">$ lsblk </span><br><span class="line">NAME                MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT</span><br><span class="line">...</span><br><span class="line">nbd100               43:100  0   500G  0 disk </span><br><span class="line">├─nbd100p1          253:0    0   300M  0 part </span><br><span class="line">└─nbd100p2          253:1    0   482G  0 part </span><br><span class="line">  ├─centos_dev-root 253:2    0   100G  0 lvm  </span><br><span class="line">  ├─centos_dev-home 253:3    0   300G  0 lvm  </span><br><span class="line">  ├─centos_dev-swap 253:4    0    32G  0 lvm  </span><br><span class="line">  └─centos_dev-var  253:5    0    50G  0 lvm</span><br><span class="line"></span><br><span class="line"><span class="comment"># mount this</span></span><br><span class="line">$ mount /dev/centos_dev/root /mnt/disk</span><br><span class="line">$ umount /mnt/disk</span><br><span class="line">$ qemu-nbd -d /dev/nbd100</span><br><span class="line"></span><br><span class="line"><span class="comment"># =========================another way: guestmount===================</span></span><br><span class="line"><span class="comment"># <span class="doctag">NOTE:</span> this will start a micro vm(qemu-kvm)</span></span><br><span class="line">$ guestmount -a disk.qcow2 -i --ro /mnt/disk</span><br><span class="line">$ guestumount /mnt/disk</span><br><span class="line"><span class="comment"># =========================another way: guestmount===================</span></span><br></pre></td></tr></table></figure>

<h2 id="lsattr-and-chattr"><a href="#lsattr-and-chattr" class="headerlink" title="lsattr and chattr"></a>lsattr and chattr</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">a: append only; 系统只允许在这个文件之后追加数据，不允许任何进程覆盖或截断这个文件。如果目录具有这个属性，系统将只允许在这个目录下建立和修改文件，而不允许删除任何文件。</span><br><span class="line">c: compressed; 系统以透明的方式压缩这个文件。从这个文件读取时，返回的是解压之后的数据；而向这个文件中写入数据时，数据首先被压缩之后才写入磁盘。</span><br><span class="line">d: no dump; 在进行文件系统备份时，dump程序将忽略这个文件。</span><br><span class="line">i: immutable; 系统不允许对这个文件进行任何的修改。如果目录具有这个属性，那么任何的进程只能修改目录之下的文件，不允许建立和删除文件。</span><br><span class="line">j: data journalizing; 如果一个文件设置了该属性，那么它所有的数据在写入文件本身之前，写入到ext3文件系统日志中，如果该文件系统挂载的时候使用了”data=ordered” 或”data=writeback”选项。当文件系统采用”data=journal”选项挂载时，所有文件数据已经记录日志，因此这个属性不起作用。仅仅超级用户或者拥有CAP_SYS_RESOURCE能力的进程可以设置和删除该属性。</span><br><span class="line">s: secure deletion; 让系统在删除这个文件时，使用0填充文件所在的区域。</span><br><span class="line">t: no tail-merging; 和其他文件合并时，该文件的末尾不会有部分块碎片(为支持尾部合并的文件系统使用)。</span><br><span class="line">u: undeletable; 当一个应用程序请求删除这个文件，系统会保留其数据块以便以后能够恢复删除这个文件。</span><br><span class="line">A: no atime updates; 告诉系统不要修改对这个文件的最后访问时间</span><br><span class="line">D: synchronous directory updates; 任何改变将同步到磁盘；这等价于mount命令中的dirsync选项：</span><br><span class="line">S: synchronous updates; 一旦应用程序对这个文件执行了写操作，使系统立刻把修改的结果写到磁盘。</span><br><span class="line">T: top of directory hierarchy; 如果一个目录设置了该属性，它将被视为目录结构的顶极目录</span><br></pre></td></tr></table></figure>

<h2 id="config-nameserver"><a href="#config-nameserver" class="headerlink" title="config nameserver"></a>config nameserver</h2><p>There are two ways to configure it, one shot or permanently</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># one shot</span></span><br><span class="line">edit  /etc/resolv.conf directly</span><br><span class="line"><span class="comment"># Note: this file is dynamically created, if networking service restart or host reboots, its content will be overwritten</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># you can also change the file &#x27;attr&#x27; make it readonly to prevent rewriting</span></span><br><span class="line">$ chattr +i /etc/resolve.conf</span><br><span class="line">$ lsattr /etc/resolve.conf</span><br></pre></td></tr></table></figure>

<h2 id="config-static-address"><a href="#config-static-address" class="headerlink" title="config static address"></a>config static address</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Centos7</span></span><br><span class="line"><span class="comment"># edit /etc/sysconfig/network-scripts/ifcfg-eth0</span></span><br><span class="line">HWADDR=52:54:00:12:34:56</span><br><span class="line">TYPE=Ethernet</span><br><span class="line">BOOTPROTO=none</span><br><span class="line">IPADDR=172.17.0.2</span><br><span class="line">NETMASK=255.255.255.0</span><br><span class="line">GATEWAY=172.17.0.1</span><br><span class="line">DNS1=172.17.0.1</span><br><span class="line">DNS2=8.8.8.8</span><br><span class="line">DEFROUTE=<span class="built_in">yes</span></span><br><span class="line">IPV6INIT=no</span><br><span class="line">NAME=eth0</span><br><span class="line">DEVICE=eth0</span><br><span class="line">ONBOOT=<span class="built_in">yes</span></span><br><span class="line">UUID=fd2fe799-fd63-4de9-b8db-773eecf9f8e0</span><br></pre></td></tr></table></figure>

<h2 id="grep-x2F-egrep-x2F-rgrep-x2F-zgrep-options"><a href="#grep-x2F-egrep-x2F-rgrep-x2F-zgrep-options" class="headerlink" title="grep&#x2F;egrep&#x2F;rgrep&#x2F;zgrep options"></a>grep&#x2F;egrep&#x2F;rgrep&#x2F;zgrep options</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># egrep: support basic regular pattern and extended pattern like + etc</span></span><br><span class="line"><span class="comment"># grep : grep -E to use extended pattern and grep -v to search recursively</span></span><br><span class="line"><span class="comment"># rgrep: recursively search</span></span><br><span class="line"><span class="comment"># zgrep: like grep but support search .gz without extract content</span></span><br><span class="line"></span><br><span class="line">-a             treat binary as text</span><br><span class="line">-C | A | B num show NUM lines before/after/center the matching line</span><br><span class="line">-n             show line number</span><br><span class="line">-l             list file name that contains the content</span><br><span class="line">-H             list file name and line number <span class="keyword">for</span> matching</span><br><span class="line">-v             list lines tht NOT matches</span><br><span class="line">-r             recursively search subdir as well without follow symbolic links</span><br><span class="line">-R             recursively search subdir as well with following symbolic links</span><br><span class="line">-o             Print only the matched (non-empty) parts of a matching line, with each such part on a separate output line, <span class="built_in">print</span> matched part not the whole line!</span><br><span class="line"></span><br><span class="line">-E             extended pattern</span><br><span class="line"></span><br><span class="line"><span class="comment"># better to add alias to your bashrc</span></span><br><span class="line"><span class="comment"># alias grep=&#x27;grep -anH&#x27;</span></span><br><span class="line"></span><br><span class="line">$ grep -anH -C <span class="string">&quot;home&quot;</span> text.txt</span><br><span class="line">$ grep -anH -C <span class="string">&quot;home&quot;</span> *.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># use pattern, must quote &#x27;ho+&#x27; to prevent the shell from erroneously replacing that</span></span><br><span class="line"><span class="comment"># pattern with a list of filenames that match the pattern</span></span><br><span class="line">$ grep -anHE -C <span class="string">&quot;ho*&quot;</span> *.txt</span><br><span class="line"></span><br><span class="line">$ grep <span class="string">&quot;home&quot;</span> *.txt <span class="comment"># only *.txt file at current level</span></span><br><span class="line">$ grep -r <span class="string">&quot;home&quot;</span> *.txt <span class="comment"># all .txt files and subdir</span></span><br><span class="line">$ grep -v <span class="string">&quot;Home&quot;</span> text.txt <span class="comment"># list unmatched lines!!!</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># grep chinese character</span></span><br><span class="line">$ grep -P <span class="string">&#x27;[\p&#123;Han&#125;]&#x27;</span> *.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># show lines with ipv4 address</span></span><br><span class="line">$ grep -E <span class="string">&#x27;[0-9]&#123;1,3&#125;\.[0-9]&#123;1,3&#125;\.[0-9]&#123;1,3&#125;\.[0-9]&#123;1,3&#125;&#x27;</span> ip.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># show matched ipv4 address only</span></span><br><span class="line">$ grep -o -E <span class="string">&#x27;[0-9]&#123;1,3&#125;\.[0-9]&#123;1,3&#125;\.[0-9]&#123;1,3&#125;\.[0-9]&#123;1,3&#125;&#x27;</span> ip.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># grep for multiple patterns</span></span><br><span class="line">$ grep -E <span class="string">&#x27;pattern1|pattern2&#x27;</span> *.py</span><br><span class="line">$ egrep <span class="string">&#x27;pattern1|pattern2&#x27;</span> *.py</span><br></pre></td></tr></table></figure>

<h2 id="show-current-runlevel"><a href="#show-current-runlevel" class="headerlink" title="show current runlevel"></a>show current runlevel</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># show current runlevel</span></span><br><span class="line">$ runlevel</span><br><span class="line">2</span><br></pre></td></tr></table></figure>

<h2 id="manage-service"><a href="#manage-service" class="headerlink" title="manage service"></a>manage service</h2><p><strong>service management</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lists the state of services controlled by System V and upstart</span></span><br><span class="line">$ service --status-all</span><br><span class="line">output format:</span><br><span class="line">+   running</span><br><span class="line">-   stopped</span><br><span class="line">?   unknown(managed by upstart)</span><br></pre></td></tr></table></figure>

<h3 id="write-a-system-V-service"><a href="#write-a-system-V-service" class="headerlink" title="write a system V service"></a>write a system V service</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/dhcp</span><br><span class="line">----service name ==dhcp</span><br><span class="line"></span><br><span class="line"><span class="comment"># run it at init by create symbol link to it on each runlevel</span></span><br><span class="line"><span class="comment"># like /etc/rc3.d/S20dhcp (will boot dhcp when starts on runlevel 3)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># dhcp file</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/sh</span></span><br><span class="line"><span class="comment"># dhcp</span></span><br><span class="line"><span class="comment">#   Start/Stop dhcp</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">### BEGIN INIT INFO</span></span><br><span class="line"><span class="comment"># Provides:          dhcp</span></span><br><span class="line"><span class="comment"># Required-Start:    $network $local_fs</span></span><br><span class="line"><span class="comment"># Required-Stop:     $network $local_fs</span></span><br><span class="line"><span class="comment"># Default-Start:     2 3 4 5</span></span><br><span class="line"><span class="comment"># Default-Stop:      0 1 6</span></span><br><span class="line"><span class="comment"># Short-Description: dhcp Server</span></span><br><span class="line"><span class="comment">### END INIT INFO</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">start</span></span>() &#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">stop</span></span>() &#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># main</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;<span class="variable">$1</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">  start)</span><br><span class="line">        start</span><br><span class="line">        ;;</span><br><span class="line">  stop)</span><br><span class="line">        stop</span><br><span class="line">        ;;</span><br><span class="line">  status)</span><br><span class="line">        <span class="keyword">if</span> [ -n <span class="string">&quot;<span class="subst">$(pidof -xs <span class="string">&quot;<span class="variable">$&#123;PROG&#125;</span>&quot;</span>)</span>&quot;</span> ] ; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;PROG_TAG&#125;</span> is running&quot;</span></span><br><span class="line">            <span class="built_in">exit</span> 0</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;PROG_TAG&#125;</span> is not running&quot;</span></span><br><span class="line">            <span class="comment"># Returning 3 like everyone else.</span></span><br><span class="line">            <span class="built_in">exit</span> 3</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">        ;;</span><br><span class="line">  restart)</span><br><span class="line">        stop</span><br><span class="line">        start</span><br><span class="line">        ;;</span><br><span class="line">  clear)</span><br><span class="line">        stop</span><br><span class="line">        clear</span><br><span class="line">        ;;</span><br><span class="line">  *)</span><br><span class="line">        <span class="built_in">echo</span> $<span class="string">&quot;Usage: <span class="variable">$0</span> &#123;start|stop|restart|status&#125;&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> 3</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure>

<h3 id="write-a-upstart-service-ubuntu18"><a href="#write-a-upstart-service-ubuntu18" class="headerlink" title="write a upstart service(ubuntu18)"></a>write a upstart service(ubuntu18)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">/etc/init/dhcp.conf</span><br><span class="line">---service name==dhcp</span><br><span class="line"><span class="comment"># !!!plain txt, but with upstart format!!!</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># dhcp.conf file</span></span><br><span class="line"><span class="comment"># UpStart service config</span></span><br><span class="line"><span class="comment"># details in http://upstart.ubuntu.com/cookbook/</span></span><br><span class="line">description <span class="string">&quot;dhcp server&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Runlevel</span></span><br><span class="line">start on runlevel [345]</span><br><span class="line">stop on runlevel [!345]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Umask</span></span><br><span class="line"><span class="built_in">umask</span> 0007</span><br><span class="line"></span><br><span class="line"><span class="comment"># Core limit</span></span><br><span class="line"><span class="built_in">limit</span> core unlimited unlimited</span><br><span class="line"></span><br><span class="line"><span class="comment"># Expect the process executed to call fork</span></span><br><span class="line"><span class="comment"># fork: exactly once.</span></span><br><span class="line"><span class="comment"># daemon: exactly twice.</span></span><br><span class="line">expect fork</span><br><span class="line"></span><br><span class="line"><span class="comment"># Respawn the job up to 3 times within a 5 second period.</span></span><br><span class="line"><span class="comment"># If the job exceeds these values, it will be stopped and</span></span><br><span class="line"><span class="comment"># marked as failed.</span></span><br><span class="line">respawn</span><br><span class="line">respawn <span class="built_in">limit</span> 3 5</span><br><span class="line"></span><br><span class="line"><span class="comment"># Redirect console to /var/log/upstart/*.log</span></span><br><span class="line">console <span class="built_in">log</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Hooks</span></span><br><span class="line">pre-start script</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;# Starting at <span class="subst">$(date -u +&#x27;%Y-%m-%dT%H:%M:%S.%NZ&#x27;)</span>&quot;</span></span><br><span class="line">    <span class="comment"># Create run time file directory</span></span><br><span class="line">    <span class="built_in">mkdir</span> -m 0755 -p /var/run/dhcp</span><br><span class="line">end script</span><br><span class="line"></span><br><span class="line">post-start script</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;# Started at <span class="subst">$(date -u +&#x27;%Y-%m-%dT%H:%M:%S.%NZ&#x27;)</span>&quot;</span></span><br><span class="line">end script</span><br><span class="line"></span><br><span class="line">pre-stop script</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;# Pre-Stopping at <span class="subst">$(date -u +&#x27;%Y-%m-%dT%H:%M:%S.%NZ&#x27;)</span>&quot;</span></span><br><span class="line">end script</span><br><span class="line"></span><br><span class="line">post-stop script</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;# Stopped at <span class="subst">$(date -u +&#x27;%Y-%m-%dT%H:%M:%S.%NZ&#x27;)</span>&quot;</span></span><br><span class="line">end script</span><br><span class="line"></span><br><span class="line"><span class="comment"># Start the process</span></span><br><span class="line"><span class="built_in">exec</span> start-stop-daemon --start --oknodo --chuid dhcp --group dhcp --<span class="built_in">umask</span> 0007 --<span class="built_in">exec</span> /opt/bin/dhcp-s -f /config/dhcp.cfg</span><br><span class="line"></span><br><span class="line"><span class="comment"># comment the above line, then run it from shell, run it in foreground!!!</span></span><br><span class="line">$/opt/bin/dhcp-s -f /config/dhcp.cfg</span><br></pre></td></tr></table></figure>

<h3 id="write-systemd-service"><a href="#write-systemd-service" class="headerlink" title="write systemd service"></a>write systemd service</h3><p>&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system is the path for service from rpm, pkg etc, so it’s common, if you want to add proxy due to your company, you should put specific conf for that service at &#x2F;etc&#x2F;systemd&#x2F;system.</p>
<ul>
<li>systemd service from pkg: &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system</li>
<li>systemd service conf and local service not from pkg: &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;</li>
</ul>
<p><strong>keywords</strong></p>
<ul>
<li>After&#x3D;: only checks if the unit is activated already, and does not explicitly activate the specified units.</li>
<li>Requires&#x3D;: The units listed in Requires are activated together with the unit. If any of the required units fail to start, the unit is not activated.</li>
<li>Wants&#x3D;: This directive is similar to Requires&#x3D; , but less strict. Systemd will attempt to start any units listed here when this unit is activated. If these units are not found or fail to start, the current unit will continue to function. This is the recommended way to configure most dependency relationships.</li>
</ul>
<p><strong>service daemon mode or not</strong><br>As systemd must get the exit code to determine if the service starts or not, hence if service can NOT run in daemon mode, it must runs in background!!!, otherwise systemd can NOT know if it starts or not and always restart it again and again.</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Test</span><br><span class="line">After=network-online.target</span><br><span class="line">Wants=network-online.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line"># runs in background</span><br><span class="line">ExecStart=web.py &amp;</span><br><span class="line">Restart=on-failure</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=default.target</span><br></pre></td></tr></table></figure>

<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Test</span><br><span class="line">After=network-online.target</span><br><span class="line">Wants=network-online.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line"># run in daemon mode</span><br><span class="line">ExecStart=app.py -S</span><br><span class="line">Restart=on-failure</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=default.target</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://www.freedesktop.org/software/systemd/man/systemd.service.html">systemd parameters detail</a></p>
<p><em>simple systemd service named: onedrive.service</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=OneDrive Free Client</span><br><span class="line">Documentation=https://github.com/abraunegg/onedrive</span><br><span class="line"># After multiple service</span><br><span class="line"># </span><br><span class="line">After=network-online.target abc.service</span><br><span class="line">Requires=xyz.service</span><br><span class="line">Wants=network-online.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Environment=BAR=default_bar_value</span><br><span class="line">EnvironmentFile=/etc/conf.d/fooservice</span><br><span class="line">Environment=&quot;HTTPS_PROXY=http://ip.address:port&quot;</span><br><span class="line">ExecStart=/usr/local/bin/onedrive --monitor</span><br><span class="line"># restart on failure</span><br><span class="line">Restart=on-failure</span><br><span class="line"># sleep time before restart</span><br><span class="line"># RestartSec=3</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=default.target</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># show all active systemd service</span></span><br><span class="line">$ systemctl --<span class="built_in">type</span>=service</span><br><span class="line"></span><br><span class="line"><span class="comment"># show all active/inactive systemd service</span></span><br><span class="line">$ systemctl --<span class="built_in">type</span>=service --all</span><br><span class="line"></span><br><span class="line"><span class="comment"># Reload the service files to include the new service.</span></span><br><span class="line">$ systemctl daemon-reload</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Start your service</span></span><br><span class="line">$ systemctl start your-service.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># To check the status of your service</span></span><br><span class="line">$ systemctl status example.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># To enable your service on every reboot</span></span><br><span class="line">$ systemctl <span class="built_in">enable</span> example.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># To disable your service on every reboot</span></span><br><span class="line">$ systemctl <span class="built_in">disable</span> example.service</span><br></pre></td></tr></table></figure>

<p><strong>Set ENV for systemd service by two ways, inline or from file</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[Service]</span><br><span class="line">Environment=FOO=default_foo_value</span><br><span class="line">Environment=BAR=default_bar_value</span><br><span class="line">EnvironmentFile=/etc/conf.d/fooservice</span><br><span class="line">ExecStart=/usr/bin/fooservice</span><br></pre></td></tr></table></figure>
<p>later on to check the env of a given process by <code>/proc/19571/environ</code></p>
<p><strong>systemd restart</strong><br>systemd services have <code>start rate limiting enabled by default</code>. If service is started more than <code>StartLimitBurst</code> times in <code>StartLimitIntervalSec</code> seconds is it <code>not permitted to start any more</code>. This parameters are inherited from <code>DefaultStartLimitIntervalSec(default 10s)</code> and <code>DefaultStartLimitBurst(default 5)</code> in <code>/etc/systemd/system.conf</code>, but you can disable <code>start rate</code> like this.</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[Service]</span><br><span class="line">Restart=always</span><br><span class="line"># time to sleep before restarting a service</span><br><span class="line">RestartSec=1</span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line"># StartLimitIntervalSec in recent systemd versions</span><br><span class="line">StartLimitInterval=0</span><br><span class="line"># StartLimitIntervalSec=0</span><br></pre></td></tr></table></figure>
<p><strong>systemd service parameter</strong><br>In some case, service file can use variable that’s defined outside, like this<br><code>/usr/lib/systemd/system/crond.service</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Command Scheduler</span><br><span class="line">After=auditd.service systemd-user-sessions.service time-sync.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">EnvironmentFile=/etc/sysconfig/crond</span><br><span class="line">ExecStart=/usr/sbin/crond -n $CRONDARGS</span><br><span class="line">ExecReload=/bin/kill -HUP $MAINPID</span><br><span class="line">KillMode=process</span><br><span class="line">Restart=on-failure</span><br><span class="line">RestartSec=30s</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>

<p>like <code>$CRONDARGS</code> and <code>$MAINPID</code> where are they defined, actually, they defined at<br><code>/etc/sysconfig/crond</code> must has the same name(crond) without service as suffix, systemd daemon will read this file and pass variable to service.</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Settings for the CRON daemon.</span><br><span class="line"># CRONDARGS= :  any extra command-line startup arguments for crond</span><br><span class="line">CRONDARGS=</span><br></pre></td></tr></table></figure>

<h4 id="debug-systemd-service"><a href="#debug-systemd-service" class="headerlink" title="debug systemd service"></a>debug systemd service</h4><p><strong>check stdout stderr log for systemd service</strong>  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -b mean since recent boots</span></span><br><span class="line">$ sudo journalctl --no-pager -b -u docker.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># -p: Filter output by message priorities</span></span><br><span class="line"><span class="comment">#   &quot;emerg&quot; (0), &quot;alert&quot; (1), &quot;crit&quot; (2),</span></span><br><span class="line"><span class="comment">#   &quot;err&quot; (3), &quot;warning&quot; (4), &quot;notice&quot; (5), </span></span><br><span class="line"><span class="comment">#   &quot;info&quot; (6), &quot;debug&quot; (7). </span></span><br><span class="line"><span class="comment"># If a single log level is specified, all messages with this log level or a lower (hence more important) log level are shown.</span></span><br><span class="line">$ sudo journalctl --no-pager -b -u docker.service -p 4</span><br><span class="line"></span><br><span class="line"><span class="comment"># with time range(relative and absolute)</span></span><br><span class="line"><span class="comment"># last two hours ago</span></span><br><span class="line">$ sudo journalctl --no-pager -u docker.service -p 4 -S -2h</span><br><span class="line"><span class="comment"># last 15 minutes ago</span></span><br><span class="line">$ sudo journalctl --no-pager -u docker.service -p 4 -S -15m</span><br><span class="line"></span><br><span class="line">$ TM=$(<span class="built_in">date</span> <span class="string">&quot;+%H:%M:%S&quot;</span>) <span class="comment"># wait a while</span></span><br><span class="line">$ sudo journalctl -k -p err --no-pager --since=<span class="variable">$TM</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># since 9am</span></span><br><span class="line">$ journalctl --since 09:00</span><br><span class="line"></span><br><span class="line"><span class="comment"># time range</span></span><br><span class="line">$ journalctl --since <span class="string">&quot;2015-01-10&quot;</span> --until <span class="string">&quot;2015-01-11 03:00&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># show journal disk usage</span></span><br><span class="line">$ sudo journalctl --disk-usage</span><br></pre></td></tr></table></figure>

<p><strong>change systemd log level to debug</strong><br>&#x2F;etc&#x2F;systemd&#x2F;system.conf</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[Manager]</span><br><span class="line">LogLevel=debug</span><br></pre></td></tr></table></figure>

<p><strong>check boot order of all systemd services</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ systemd-analyze plot &gt; something.svg</span><br></pre></td></tr></table></figure>

<h2 id="auto-mount"><a href="#auto-mount" class="headerlink" title="auto mount"></a>auto mount</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Centos7</span></span><br><span class="line">$ sudo yum install -y autofs</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># edit  /etc/auto.master, make sure, create /nfs</span></span><br><span class="line">/nfs  /etc/auto.nfs</span><br><span class="line"></span><br><span class="line"><span class="comment"># create /etc/auto.nfs with below content for linux server</span></span><br><span class="line">shared -fstype=nfs4,rw   serverIP:/home/shared</span><br><span class="line"><span class="comment">#no password, default root user</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># for windows server</span></span><br><span class="line">shared -fstype=cifs,rw,uid=jason,gid=jason,username=xxx,password=xxx ://<span class="variable">$server</span>/shared</span><br><span class="line"></span><br><span class="line"><span class="comment"># mounted by jason:jason with user/password</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># restart the service</span></span><br><span class="line">$ sudo service autofs restart</span><br><span class="line"></span><br><span class="line"><span class="comment"># debug autofs</span></span><br><span class="line">$ service autofs stop</span><br><span class="line">$ automount -d -f -v</span><br></pre></td></tr></table></figure>

<h2 id="configure-samba-server"><a href="#configure-samba-server" class="headerlink" title="configure samba server"></a>configure samba server</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">Linux export dir(run samba server), then Windows connects it with samba client.</span><br><span class="line"></span><br><span class="line">Centos7</span><br><span class="line">$ yum install samba samba-client</span><br><span class="line">$ systemctl start smb.service</span><br><span class="line">$ systemctl start nmb.service</span><br><span class="line">$ systemctl enable smb.service</span><br><span class="line">$ systemctl enable nmb.service</span><br><span class="line"></span><br><span class="line">add samba user</span><br><span class="line">$ sudo smbpasswd -a user1 (user1 must be a system user as well!!!)</span><br><span class="line">edit /etc/samba/smb.conf with below content</span><br><span class="line"></span><br><span class="line"># A publicly accessible directory, but read only, except for people in</span><br><span class="line"># the &quot;staff&quot; group</span><br><span class="line">[global]</span><br><span class="line">log level = 5</span><br><span class="line"></span><br><span class="line">[share]</span><br><span class="line">comment = public share</span><br><span class="line">path = /home/share</span><br><span class="line">public = yes</span><br><span class="line">writable = no</span><br><span class="line">printable = no</span><br><span class="line">valid users = user1 user2</span><br><span class="line"></span><br><span class="line">sudo service smb restart</span><br><span class="line"></span><br><span class="line"># check exported dir by samba server</span><br><span class="line">smbclient -L 192.168.56.101</span><br><span class="line"></span><br><span class="line">Enter SAMBA\root&#x27;s password: </span><br><span class="line"></span><br><span class="line">        Sharename       Type      Comment</span><br><span class="line">        ---------       ----      -------</span><br><span class="line">        onedrive        Disk      one drive</span><br><span class="line">        IPC$            IPC       IPC Service (Samba 4.10.16)</span><br><span class="line">Reconnecting with SMB1 for workgroup listing.</span><br><span class="line"></span><br><span class="line">        Server               Comment</span><br><span class="line">        ---------            -------</span><br><span class="line"></span><br><span class="line">        Workgroup            Master</span><br><span class="line">        ---------            -------</span><br><span class="line">        SAMBA                DEV</span><br><span class="line"></span><br><span class="line"># dump the samba config</span><br><span class="line">testparm  -v</span><br><span class="line"></span><br><span class="line"># run in forground with level 3</span><br><span class="line">smbd -i -d3</span><br><span class="line"></span><br><span class="line"># check samba log:   /var/log/samba</span><br><span class="line"># check db cache at: /var/lib/samba/</span><br></pre></td></tr></table></figure>
<h2 id="share-file-between-linux-and-linux-by-nfs"><a href="#share-file-between-linux-and-linux-by-nfs" class="headerlink" title="share file between linux and linux by nfs"></a>share file between linux and linux by nfs</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">through mount command,you can mount remote directory(linux) to the local machine over network. make sure the kernel supports nfs(server) before you use &#x27;mount&#x27; command. by default Ubuntu disables nfs.</span><br><span class="line"></span><br><span class="line">On server side</span><br><span class="line"></span><br><span class="line">steps 1: install nfs if it is not installed</span><br><span class="line">         Ubuntu18</span><br><span class="line">         $sudo apt-get install nfs-kernel-server</span><br><span class="line">         Centos7</span><br><span class="line">         $yum install -y nfs-utils</span><br><span class="line"></span><br><span class="line">steps 2: server exports a directory, edit /etc/exports file with something like this:</span><br><span class="line">        /home/share/  192.168.1.20(rw,insecure,sync,all_squash)</span><br><span class="line">        /home/share/  192.168.1.20(rw,insecure,sync,all_squash,anonuid=100,anongid=101)</span><br><span class="line">        /home/share/  192.168.1.20(rw,insecure,sync,no_root_squash)</span><br><span class="line">        /home/share/  192.168.1.20(rw,insecure,sync,no_root_squash,anonuid=100,anongid=101)</span><br><span class="line">        (override the attributes for clinet&lt;--&gt;192.168.1.20 )</span><br><span class="line"></span><br><span class="line">[</span><br><span class="line">   nfsd bases its access control to files on the server machine on the uid and gid provided in each NFS RPC request. The normal behavior a user would expect is that she can access her files on the server just as she would on a</span><br><span class="line">   normal file system. This requires that the same uids and gids are used on the client and the server machine. This is not always true, nor is it always desirable.</span><br><span class="line"></span><br><span class="line">   Very often, it is not desirable that the root user on a client machine is also treated as root when accessing files on the NFS server. To this end, uid 0 is normally mapped to a different  id:  the  so-called  anonymous  or</span><br><span class="line">   nobody uid. This mode of operation (called `root squashing&#x27;) is the default, and can be turned off with no_root_squash.</span><br><span class="line"></span><br><span class="line">   By default, exportfs chooses a uid and gid of 65534 for squashed access. These values can also be overridden by the anonuid and anongid options.  Finally, you can map all user requests to the anonymous uid by specifying the</span><br><span class="line">   all_squash option.</span><br><span class="line"></span><br><span class="line">   Here&#x27;s the complete list of mapping options:</span><br><span class="line"></span><br><span class="line">   root_squash</span><br><span class="line">          Map requests from uid/gid 0 to the anonymous uid/gid. Note that this does not apply to any other uids or gids that might be equally sensitive, such as user bin or group staff.</span><br><span class="line"></span><br><span class="line">   no_root_squash</span><br><span class="line">          Turn off root squashing. This option is mainly useful for diskless clients.</span><br><span class="line"></span><br><span class="line">   all_squash</span><br><span class="line">          Map all uids and gids to the anonymous user. Useful for NFS-exported public FTP directories, news spool directories, etc. The opposite option is no_all_squash, which is the default setting.</span><br><span class="line"></span><br><span class="line">   anonuid and anongid</span><br><span class="line">          These options explicitly set the uid and gid of the anonymous account.  This option is primarily useful for PC/NFS clients, where you might want all requests appear to be from one user. As an  example,  consider  the</span><br><span class="line">          export entry for /home/joe in the example section below, which maps all requests to uid 150 (which is supposedly that of user joe).</span><br><span class="line"></span><br><span class="line">steps 3: export  the list</span><br><span class="line">         #sudo exportfs -a</span><br><span class="line"></span><br><span class="line">steps 4: restart service</span><br><span class="line">         Ubuntu18</span><br><span class="line">         #sudo /etc/init.d/portmap restart</span><br><span class="line">         #sudo /etc/init.d/nfs-kernel-server restart</span><br><span class="line"></span><br><span class="line">         Centos7</span><br><span class="line">         $ systemctl start nfs-server</span><br><span class="line">         $ systemctl enable nfs-server</span><br><span class="line"></span><br><span class="line">On client side</span><br><span class="line">check the export list</span><br><span class="line">         #showmount -e $server_ip</span><br><span class="line"></span><br><span class="line">steps 5: client mounts the dieretory</span><br><span class="line">         #sudo mount -t nfs serverip:/home/share /media/share</span><br><span class="line"></span><br><span class="line">(don&#x27;t support user and password, create a user belongs to other group,so the permission of this user is determined</span><br><span class="line">by the configuration of /etc/exports )</span><br><span class="line"></span><br><span class="line"> 首先mount后查看mount后的用户和组,然后登陆到export机器上查看该文件对该用户的权限,并作相应的更改</span><br><span class="line"> 保证mount后的文件具有写权限</span><br><span class="line"> </span><br><span class="line"> 1.export中允许挂载后可以写【必须】</span><br><span class="line"> 2.该文件对other 用户本身具有写权限【必须】</span><br><span class="line"> 3.设置挂载点的权限，保证执行挂载的用户可以对该目录具有执行权限.</span><br><span class="line"> 4.在mount 命令中加入 -o rw 参数【如果需要】</span><br><span class="line"></span><br><span class="line"> Permission denied when write on nfs dir, even export with RW</span><br><span class="line"> 1. check the mount user at client, if it&#x27;s root, make sure export with no_root_squash set.</span><br><span class="line"> 2. check /etc/exports to see RW is set.</span><br><span class="line"> </span><br><span class="line"> if you have anything wrong, please restart the service</span><br><span class="line"></span><br><span class="line">B: show what nfs server exports to client!!!</span><br><span class="line">    #showmount -e remote_nfs_server</span><br><span class="line">    #showmount -e</span><br><span class="line">    show what my self exported by nfs</span><br><span class="line"></span><br><span class="line">C: FAQ</span><br><span class="line">   &quot;mount.nfs: access denied by server while mounting&quot;</span><br><span class="line">   1 illegal port (client uses port larger than 1024)</span><br><span class="line">   cat /var/log/messages | grep mount</span><br><span class="line">   Jan 2 12:49:04 localhost mountd[1644]: refused mount request from 192.168.0.100 for /home/nfsshare/ (/home/nfsshare): illegal port 1689</span><br><span class="line"></span><br><span class="line">   FIX: add &#x27;insecure&#x27; at server and restart nfs server</span><br><span class="line"></span><br><span class="line">   2 client and server use different nfs version</span><br><span class="line">   Try use other version to connect with server  -o &quot;vers=3&quot;</span><br><span class="line"></span><br><span class="line">   mount -v -o &quot;vers=3&quot; -t nfs 10.117.7.201:/root/jason /media</span><br><span class="line"></span><br><span class="line">   3 client must have the right to local mount point like /media</span><br></pre></td></tr></table></figure>

<h2 id="run-your-task-daily-weekly-etc"><a href="#run-your-task-daily-weekly-etc" class="headerlink" title="run your task daily, weekly etc"></a>run your task daily, weekly etc</h2><p>use cron daemon to execute schedule job, there are two ways you can choose to run your task<br>one is user predefined period like daily, weakly, minutes etc, the other is defined own schedule whenever you want.</p>
<p><a target="_blank" rel="noopener" href="https://crontab.guru/">cron online tester</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">$ crontab filename [-u user]    用指定的文件替代(用户)目前的crontab。</span><br><span class="line">$ crontab -1[-u user]        列出(用户)目前的crontab.</span><br><span class="line">$ crontab -e[-u user]        编辑(用户)目前的crontab.</span><br><span class="line">$ crontab -ri[-u user]        删除(用户)目前的crontab.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">文件格式基本格式 :</span><br><span class="line">*　　*　　*　　*　　*　[username] <span class="built_in">command</span></span><br><span class="line">分　 时　 日　 月　 周　 命令</span><br><span class="line"></span><br><span class="line"><span class="comment"># ┌───────────── minute (0 - 59)</span></span><br><span class="line"><span class="comment"># │ ┌───────────── hour (0 - 23)</span></span><br><span class="line"><span class="comment"># │ │ ┌───────────── day of the month (1 - 31)</span></span><br><span class="line"><span class="comment"># │ │ │ ┌───────────── month (1 - 12)</span></span><br><span class="line"><span class="comment"># │ │ │ │ ┌───────────── day of the week (0 - 6) (Sunday to Saturday;</span></span><br><span class="line"><span class="comment"># │ │ │ │ │                                   7 is also Sunday on some systems)</span></span><br><span class="line"><span class="comment"># │ │ │ │ │</span></span><br><span class="line"><span class="comment"># │ │ │ │ │</span></span><br><span class="line"><span class="comment"># * * * * *</span></span><br><span class="line"></span><br><span class="line">*	any value</span><br><span class="line">,	value list separator</span><br><span class="line">-	range of values</span><br><span class="line">/	step values</span><br><span class="line"></span><br><span class="line">第1列表示分钟1～59 每分钟用*或者 */1表示</span><br><span class="line">第2列表示小时1～23（0表示0点）</span><br><span class="line">第3列表示日期1～31</span><br><span class="line">第4列表示月份1～12</span><br><span class="line">第5列标识号星期0～6（0表示星期天）</span><br><span class="line">第6列要运行的命令</span><br><span class="line"></span><br><span class="line">crontab文件的一些例子：</span><br><span class="line">/*脚本的地址必须是绝对地址*/</span><br><span class="line">30 21 * * * /usr/local/etc/rc.d/lighttpd restart   &gt;&gt; /var/log/root_crontab.log 2&gt;&amp;1</span><br><span class="line">上面的例子表示每晚的21:30重启apache。</span><br><span class="line"></span><br><span class="line">45 4 3,8,13,18,23,28 * * /usr/local/etc/rc.d/lighttpd restart</span><br><span class="line">45 4 1,10,22 * * /usr/local/etc/rc.d/lighttpd restart</span><br><span class="line">上面的例子表示每月1、10、22日的4 : 45重启apache。</span><br><span class="line"></span><br><span class="line">10 1 * * 6,0 /usr/local/etc/rc.d/lighttpd restart</span><br><span class="line">上面的例子表示每周六、周日的1 : 10重启apache。</span><br><span class="line"></span><br><span class="line">0,30 18-23 * * * /usr/local/etc/rc.d/lighttpd restart</span><br><span class="line">上面的例子表示在每天18 : 00至23 : 00之间每隔30分钟重启apache。</span><br><span class="line"></span><br><span class="line">0 23 * * 6 /usr/local/etc/rc.d/lighttpd restart</span><br><span class="line">上面的例子表示每星期六的11 : 00 pm重启apache。</span><br><span class="line"></span><br><span class="line">* */1 * * * /usr/local/etc/rc.d/lighttpd restart</span><br><span class="line">每一小时重启apache</span><br><span class="line"></span><br><span class="line">* 23-7/1 * * * /usr/local/etc/rc.d/lighttpd restart</span><br><span class="line">晚上11点到早上7点之间，每隔一小时重启apache</span><br><span class="line"></span><br><span class="line">0 11 4 * mon-wed /usr/local/etc/rc.d/lighttpd restart</span><br><span class="line">每月的4号与每周一到周三的11点重启apache</span><br><span class="line"></span><br><span class="line">0 4 1 jan * /usr/local/etc/rc.d/lighttpd restart</span><br><span class="line">一月一号的4点重启apache</span><br><span class="line">Note:路径必须是绝对路径！！</span><br><span class="line"></span><br><span class="line">Another way is use cron daemon cron is a daemon, <span class="built_in">which</span> execute <span class="built_in">jobs</span> under /etc hourly/weekly/monthly etc</span><br><span class="line"></span><br><span class="line">$ ps -ef | grep cron (run as root)</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">ls</span> /etc/cron*</span><br><span class="line">cron.d/       cron.daily/   cron.hourly/  cron.monthly/ crontab       cron.weekly/</span><br><span class="line"></span><br><span class="line">$ service cron restart</span><br></pre></td></tr></table></figure>

<p><strong>write cron file under one of them, restart cron service to reload it</strong></p>
<p>Note:</p>
<ol>
<li>file under cron.d&#x2F; and crontab must use the above format and <code>[username] is a must for these two</code></li>
<li>file under cron.xx just write with command, no time as xx means the time, no username is needed as it runs as root</li>
<li>for daily&#x2F;weekly&#x2F;monthly, the exact time is determined by <code>/etc/anacrontab</code> refer to <a target="_blank" rel="noopener" href="https://www.cyberciti.biz/faq/linux-when-does-cron-daily-weekly-monthly-run/">anacrontab format</a>.</li>
</ol>
<h1 id="See-anacron-8-and-anacrontab-5-for-details"><a href="#See-anacron-8-and-anacrontab-5-for-details" class="headerlink" title="See anacron(8) and anacrontab(5) for details."></a>See anacron(8) and anacrontab(5) for details.</h1><p>SHELL&#x3D;&#x2F;bin&#x2F;sh<br>PATH&#x3D;&#x2F;sbin:&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;bin<br>MAILTO&#x3D;root</p>
<h1 id="the-maximal-random-delay-added-to-the-base-delay-of-the-jobs"><a href="#the-maximal-random-delay-added-to-the-base-delay-of-the-jobs" class="headerlink" title="the maximal random delay added to the base delay of the jobs"></a>the maximal random delay added to the base delay of the jobs</h1><h1 id="RANDOM-DELAY-x3D-45"><a href="#RANDOM-DELAY-x3D-45" class="headerlink" title="RANDOM_DELAY&#x3D;45"></a>RANDOM_DELAY&#x3D;45</h1><h1 id="the-jobs-will-be-started-during-the-following-hours-only"><a href="#the-jobs-will-be-started-during-the-following-hours-only" class="headerlink" title="the jobs will be started during the following hours only"></a>the jobs will be started during the following hours only</h1><p>START_HOURS_RANGE&#x3D;3-22</p>
<p>#period in days   delay in minutes   job-identifier   command<br>1	5	cron.daily		nice run-parts &#x2F;etc&#x2F;cron.daily<br>7	25	cron.weekly		nice run-parts &#x2F;etc&#x2F;cron.weekly<br>@monthly 45	cron.monthly		nice run-parts &#x2F;etc&#x2F;cron.monthly&#96;</p>
<hr>
<p><strong>debug cron</strong>  </p>
<ol>
<li><p>some checks</p>
<ul>
<li>username is needed for jobs in cron.d and &#x2F;etc&#x2F;crontab are system jobs.</li>
<li>when username is used, should load user env from profile and set PATH for python, otherwise, cron has nothing with env(like $PATH set by profile not seen by cron)</li>
<li><code>30 21 * * *  user1 $HOME/.profile; /usr/local/etc/rc.d/lighttpd restart</code></li>
</ul>
</li>
<li><p>Redirect console log, it’s usually for error.<br> <code>30 21 * * * /usr/local/etc/rc.d/lighttpd restart   &gt;&gt; /var/log/root_crontab.log 2&gt;&amp;1</code></p>
</li>
<li><p>Check log <code>$grep CRON /var/log/syslog</code> OR <code>$journalctl --no-pager -b -u crond.service</code></p>
</li>
<li><p>Make sure cron is running $ps -ef | grep cron</p>
</li>
<li><p>Check that the filename should NOT have an extension!!!</p>
</li>
<li><p>Ensure the file has execute permissions</p>
</li>
<li><p>Tell the system what to use when executing your script (eg. put #!&#x2F;bin&#x2F;sh at top)</p>
</li>
<li><p>PATH is restricted to &#x2F;bin:&#x2F;usr&#x2F;bin, if cmd not there, use absolute path</p>
</li>
</ol>
<h2 id="configure-your-own-dns-server-by-bind-application"><a href="#configure-your-own-dns-server-by-bind-application" class="headerlink" title="configure your own dns server by bind application"></a>configure your own dns server by bind application</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">1 steps of configuring bind9</span><br><span class="line">    1.1 edit /etc/bind/name.conf.local with the content below</span><br><span class="line">                zone <span class="string">&quot;example.com&quot;</span> &#123;</span><br><span class="line">                        <span class="built_in">type</span> master;</span><br><span class="line">                        file <span class="string">&quot;/var/cache/bind/db.example.com&quot;</span>;</span><br><span class="line">                        allow-update &#123;any;&#125;;</span><br><span class="line">                        allow-transfer &#123;any;&#125;;</span><br><span class="line">                        allow-query &#123;any;&#125;;</span><br><span class="line"></span><br><span class="line">                &#125;;</span><br><span class="line">                zone <span class="string">&quot;0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.2.ip6.arpa&quot;</span> &#123;</span><br><span class="line">                        <span class="built_in">type</span> master;</span><br><span class="line">                        file <span class="string">&quot;/var/cache/bind/db.rev.2000&quot;</span>;</span><br><span class="line">                        allow-update &#123;any;&#125;;</span><br><span class="line">                        allow-transfer &#123;any;&#125;;</span><br><span class="line">                        allow-query &#123;any;&#125;;</span><br><span class="line">                &#125;;</span><br><span class="line"></span><br><span class="line">    1.2 <span class="comment">#sudo mkdir /var/cache/bind</span></span><br><span class="line">        <span class="comment">#sudo chown bind:bind /var/cache/bind</span></span><br><span class="line">        <span class="comment">#edit /var/cache/bind/db.example.com with content below</span></span><br><span class="line">            <span class="variable">$ORIGIN</span> .</span><br><span class="line">            <span class="variable">$TTL</span> 604800     ; 1 week</span><br><span class="line">            example.com             IN SOA  ns1.example.com. root.example.com. (</span><br><span class="line">                                            2006020222 ; serial</span><br><span class="line">                                            604800     ; refresh (1 week)</span><br><span class="line">                                            86400      ; retry (1 day)</span><br><span class="line">                                            2419200    ; expire (4 weeks)</span><br><span class="line">                                            604800     ; minimum (1 week)</span><br><span class="line">                                            )</span><br><span class="line">                                    NS      ns1.example.com.</span><br><span class="line">            <span class="variable">$ORIGIN</span> example.com.</span><br><span class="line">            ns1                     AAAA    2000::1</span><br><span class="line"></span><br><span class="line">        <span class="comment">#edit /var/cache/bind/db.rev.2000 with content below</span></span><br><span class="line">            <span class="variable">$ORIGIN</span> .</span><br><span class="line">            <span class="variable">$TTL</span> 10800      ; 3 hours</span><br><span class="line">            0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.2.ip6.arpa IN SOA ns1.example.com.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.2.ip6.arpa. root.example.com. (</span><br><span class="line">                                            2002111312 ; serial</span><br><span class="line">                                            28800      ; refresh (8 hours)</span><br><span class="line">                                            14400      ; retry (4 hours)</span><br><span class="line">                                            3600000    ; expire (5 weeks 6 days 16 hours)</span><br><span class="line">                                            86400      ; minimum (1 day)</span><br><span class="line">                                            )</span><br><span class="line">                                    NS      ns1.example.com.</span><br><span class="line">            <span class="variable">$ORIGIN</span> 0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.2.ip6.arpa.</span><br><span class="line"></span><br><span class="line">2 update AAAA using nsupdate</span><br><span class="line">    <span class="comment">#nsupdate</span></span><br><span class="line">    &gt;server 2000::1(specify the dns server)</span><br><span class="line">    &gt;update add worf.example.com 7200 IN AAAA 2000::58(zone example.com must be configured at dns server)</span><br><span class="line">    &gt;send (send the update)</span><br><span class="line">3 query AAAA record</span><br><span class="line">    <span class="comment">#dig @2000::1(dns server) worf.example.com AAAA</span></span><br></pre></td></tr></table></figure>

<h2 id="put-file-in-memory"><a href="#put-file-in-memory" class="headerlink" title="put file in memory"></a>put file in memory</h2><p>For faster run, you can put files in memory, create a mount point with tmpfs, then put files there, but files are lost when it’s umounted or system boots, actually, you do not need to create this ram disk by yourself, system already creates somes for you, it’s &#x2F;run, &#x2F;dev&#x2F;shm</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(base) [root@dev]<span class="comment"># df -h</span></span><br><span class="line">Filesystem               Size  Used Avail Use% Mounted on</span><br><span class="line">devtmpfs                 3.9G     0  3.9G   0% /dev</span><br><span class="line">tmpfs                    3.9G     0  3.9G   0% /dev/shm</span><br><span class="line">tmpfs                    3.9G  9.0M  3.9G   1% /run</span><br></pre></td></tr></table></figure>

<h2 id="run-script-at-current-shell-not-subshell"><a href="#run-script-at-current-shell-not-subshell" class="headerlink" title="run script at current shell not subshell"></a>run script at current shell not subshell</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@dev:/tmp<span class="comment"># cat test.sh</span></span><br><span class="line"><span class="comment">#! /usr/bin/env bash</span></span><br><span class="line"><span class="built_in">export</span>  http=1.0</span><br><span class="line"></span><br><span class="line">root@dev:/tmp<span class="comment"># source test.sh</span></span><br><span class="line">root@dev:/tmp<span class="comment"># echo $http</span></span><br><span class="line">1.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># likes you type export http=1.0 from the terminal!</span></span><br></pre></td></tr></table></figure>

<h2 id="dos-and-unix-format"><a href="#dos-and-unix-format" class="headerlink" title="dos and unix format"></a>dos and unix format</h2><p>when you work both on windows and unix(linux), move files between them, be careful! as the file content may be changed due to os</p>
<p>linux和windows，Mac的行结束符是不同的，因此有些编辑器会无法正确的显示换行，这是编辑器 没有正确的处理行结束符导致的，但是有些强大的编辑器就能正确的显示不同文件类型， 无论是windows文件 还是unix，mac文件，当遇到编辑器无法正确显示的时候.</p>
<ul>
<li>首先确定文件的类型，在linux下运行file命令</li>
<li>看编辑器是否支持该类型</li>
<li>根据需要通过editplus–&gt;document—&gt;file format选项转化为能正确显示的文件类型。</li>
</ul>
<p>• Window (CR&#x2F;LF)<br>• Unix (LF)<br>• Mac (CR)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ dos2unix dos_format_file</span><br></pre></td></tr></table></figure>

<h2 id="中文乱码的原因分析"><a href="#中文乱码的原因分析" class="headerlink" title="中文乱码的原因分析"></a>中文乱码的原因分析</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">因此解决乱码的关键分三步</span><br><span class="line">1.明确文件的编码格式</span><br><span class="line">2.系统支持(安装）了这种编码格式</span><br><span class="line">3.为应用程序设置此编码格式</span><br><span class="line"></span><br><span class="line">乱码的原因就是编码格式的选择不对或者不兼容，使得解析错误！因此解决办法就是选择正确的编码格式，</span><br><span class="line">任何应用程序都是调用系统默认或者本程序设定的编码格式，最终的都是调用系统安装的编码格式,去解析文件,</span><br><span class="line"></span><br><span class="line">中文乱码的解决</span><br><span class="line">1 显示系统支持的所有编码格式</span><br><span class="line">    $ locale -a</span><br><span class="line">    $ sudo apt-get install language-pack-zh-hant language-pack-zh-hans</span><br><span class="line">    (如果没有zh_CN 下载安装)</span><br><span class="line">2 如果不支持中文编码格式，修改</span><br><span class="line">    sudo vi /var/lib/locales/supported.d/local</span><br><span class="line">    加入</span><br><span class="line">    zh_CN.GB18030 GB18030</span><br><span class="line">    zh_CN.GBK GBK</span><br><span class="line">    zh_CN.GB2312 GB2312</span><br><span class="line">    zh_HK.BIG5 BIG5</span><br><span class="line">    zh_TW.BIG5 BIG5</span><br><span class="line">    然后执行</span><br><span class="line">    #sudo locale-gen</span><br><span class="line"></span><br><span class="line">    check all encodings system support:</span><br><span class="line">    $ locale -a</span><br><span class="line">    zh_CN.gb18030</span><br><span class="line">    zh_CN.gb2312</span><br><span class="line">    zh_CN.gbk</span><br><span class="line">    zh_CN.utf8</span><br><span class="line">    zh_HK.big5</span><br><span class="line">    zh_HK.utf8</span><br><span class="line">    zh_SG.utf8</span><br><span class="line">    zh_TW.big5</span><br><span class="line">    zh_TW.utf8</span><br><span class="line"></span><br><span class="line">3 为各种应用设置其编码格式gbk，或者gb2312</span><br><span class="line">    ****step 1 and step 2 are a must for 中文乱码***</span><br><span class="line"></span><br><span class="line">    3.1 但是通过远程终端登录后，打开文件还是显示乱码</span><br><span class="line">    这是由于终端也有其编码格式，因此需要设置终端的编码格式为gbk或者gb2312，或者其他的编码格式，使其与文件内容的编码格式对应起来，具体设置方法参考终端的设置选项。</span><br><span class="line">    以上是常见的中文乱码的情况。</span><br><span class="line"></span><br><span class="line">    3.2 当远程登录后，英文乱码，出现？？等情况，这是由于终端的编码格式和系统的编码格式不兼容导致的</span><br><span class="line">    因此通过locale查看系统的当前编码格式，然后设置终端的编码格式与其兼容就可以解决问题了。</span><br><span class="line"></span><br><span class="line">    3.3 mount(from windows)的中文文件名字显示 ?? 设置mount的iocharset 为utf-8</span><br><span class="line">    set iocharset to utf8 for mount option</span><br><span class="line"></span><br><span class="line">    -fstype=cifs,rw,iocharset=utf8,uid=ubuntu,gid=ubuntu,</span><br></pre></td></tr></table></figure>

<h2 id="vncserver"><a href="#vncserver" class="headerlink" title="vncserver"></a>vncserver</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">设置vncserver的分辨率，一种是修改配置文件，一种是启动vncserver的时候 通过参数传递，现在第二种方式更灵活，因此这里只介绍第二种方法：</span><br><span class="line"></span><br><span class="line">#vncserver -geometry 1680x1050 -alwaysshared :1</span><br><span class="line"></span><br><span class="line">这个命令包含了3个参数，第一个参数geometry表示分辨率，你可以指定适合自己桌面的分辨率；</span><br><span class="line">第二个参数alwaysshared表示运行多个人同时连接到同一个桌面；</span><br><span class="line">第三个参数:1表示开启一个1号远程桌面(如果该编号已经被占用，请选择其他的标号）</span><br><span class="line">此时你可以使用ip:1来连接这个远程桌面。(注意：上面1280与800之间的连接符为英文字母x(xyz的x)，而不是中英文的乘号!)</span><br><span class="line"></span><br><span class="line">关闭一个远程桌面，可以使用如下命令：</span><br><span class="line">$ vncserver -kill :1 其中，&quot;:1&quot;表示的创建远程桌面时的桌面号</span><br></pre></td></tr></table></figure>
<h2 id="ssh-related"><a href="#ssh-related" class="headerlink" title="ssh related"></a>ssh related</h2><p><strong>install sshd</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Centos7</span><br><span class="line">$ yum install -y openssh-server</span><br><span class="line"></span><br><span class="line"><span class="comment"># ssh client timeout after sometime</span></span><br><span class="line"><span class="comment"># edit sshd config and restart sshd service</span></span><br><span class="line"><span class="comment"># edit /etc/ssh/sshd_config</span></span><br><span class="line">ClientAliveInterval 60</span><br><span class="line"></span><br><span class="line">$ service sshd restart</span><br><span class="line"></span><br><span class="line"><span class="comment"># ssh terminal timeout due to “timed out waiting for input: auto-logout”</span></span><br><span class="line"><span class="comment"># edit ~/.bashrc</span></span><br><span class="line"><span class="built_in">unset</span> TMOUT</span><br></pre></td></tr></table></figure>


<p><strong>Reset by peer even iptable and firewall is disabled</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ grep sshd /var/log/syslog</span><br><span class="line">Oct 16 08:59:45 openstack sshd[1214]: error: Could not load host key: /etc/ssh/ssh_host_rsa_key</span><br><span class="line">Oct 16 08:59:45 openstack sshd[1214]: error: Could not load host key: /etc/ssh/ssh_host_dsa_key</span><br><span class="line">Oct 16 08:59:45 openstack sshd[1214]: error: Could not load host key: /etc/ssh/ssh_host_ecdsa_key</span><br><span class="line"></span><br><span class="line"><span class="comment"># fix it(Ubuntu18)</span></span><br><span class="line">$ sudo <span class="built_in">rm</span> -r /etc/ssh/ssh*key</span><br><span class="line">$ sudo dpkg-reconfigure openssh-server</span><br></pre></td></tr></table></figure>

<p><strong>only allow specific user to login</strong></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Edit /etc/ssh/sshd_config</span><br><span class="line">add the statement</span><br><span class="line"></span><br><span class="line">AllowUsers lzq</span><br></pre></td></tr></table></figure>

<p><strong>long delay when login with ssh</strong></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">try:</span><br><span class="line">ssh -o GSSAPIAuthentication=no user@yourserver</span><br><span class="line">update /etc/ssh/sshd_config</span><br><span class="line">UseDNS no</span><br></pre></td></tr></table></figure>

<p><strong>allow root user login with password by ssh</strong></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">open /etc/ssh/ssd_config</span><br><span class="line">Change</span><br><span class="line">    PermitRootLogin prohibit-password</span><br><span class="line">    PasswordAuthentication no</span><br><span class="line">To</span><br><span class="line">    PermitRootLogin yes</span><br><span class="line">    PasswordAuthentication yes</span><br></pre></td></tr></table></figure>

<p><strong>specify user when connect with ssh server</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ssh root@server</span><br><span class="line"><span class="comment"># OR</span></span><br><span class="line">$ ssh server -l root</span><br></pre></td></tr></table></figure>

<p><strong>disable openssl popup window when use git</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">unset</span> SSH_ASKPASS</span><br></pre></td></tr></table></figure>

<p><strong>ssh with password on command line</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Centos7</span></span><br><span class="line">$ yum install -y sshpass</span><br><span class="line"></span><br><span class="line">$ sshpass -p your_password ssh user@hostname</span><br><span class="line"></span><br><span class="line"><span class="comment"># change user password without prompt</span></span><br><span class="line">$ <span class="built_in">echo</span> -e -n <span class="string">&quot;oldpasswd\nnewpasswd\nnewpasswd&quot;</span> | sudo passwd user</span><br><span class="line"><span class="comment"># OR</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&#x27;userid:newpasswd&#x27;</span> | sudo chpasswd</span><br></pre></td></tr></table></figure>

<p><strong>launch GUI at ssh server by terminal</strong></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ssh server side</span><br><span class="line">enable X11 on sshd by edit /etc/ssh/sshd_config</span><br><span class="line"></span><br><span class="line">X11Forwarding yes</span><br><span class="line"></span><br><span class="line">ssh client</span><br><span class="line">While doing ssh use the option -X to enable X11 forwarding.</span><br><span class="line">$ ssh username@hostname -X</span><br><span class="line"></span><br><span class="line">OR</span><br><span class="line"></span><br><span class="line">Enable trusted X11 forwarding, by using the -Y option,</span><br><span class="line">$ ssh username@hostname -Y</span><br></pre></td></tr></table></figure>

<p><strong>run scp&#x2F;ssh&#x2F;sftp used in scripts without password input</strong></p>
<p><code>key point is add the client public key to server&#39;s authorized_keys</code></p>
<p><strong>use ssh-copy-id</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># On client</span></span><br><span class="line">$ ssh-keygen -t rsa  (just enter is a must)</span><br><span class="line">$ ssh-copy-id -f -i /home/lzq/.ssh/xx.pub root@serverip</span><br><span class="line"></span><br><span class="line"><span class="comment"># run command on remote server by ssh</span></span><br><span class="line">$ ssh root@serverip <span class="string">&quot;ls;pwd&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># enter particular dir after ssh login</span></span><br><span class="line">$ ssh root@serverip <span class="string">&quot;bash --login&quot;</span></span><br><span class="line">$ ssh root@serverip <span class="string">&quot;cd xxx; bash --login&quot;</span></span><br></pre></td></tr></table></figure>
<p>OR</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># scp is used on client to copy data to server</span></span><br><span class="line"><span class="comment"># on client</span></span><br><span class="line">$ <span class="built_in">mkdir</span> -p /home/lzq/.ssh <span class="comment"># create parent dir as well if not exist</span></span><br><span class="line"><span class="comment"># create private and public key pairs</span></span><br><span class="line">$ ssh-keygen -t rsa  (just enter, no other input)</span><br><span class="line"></span><br><span class="line"><span class="comment"># copy public key to ssh server</span></span><br><span class="line">$ scp /home/lzq/.ssh/id_rsa.pub  root@serverip:/root/.ssh/new.pub</span><br><span class="line"></span><br><span class="line"><span class="comment"># on server</span></span><br><span class="line">$ <span class="built_in">cd</span> /root/.ssh</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>  authorized_keys exists</span><br><span class="line">  $ <span class="built_in">cat</span> new.pub &gt;&gt;authorized_keys</span><br><span class="line">  $ <span class="built_in">rm</span> new.pub</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   $ <span class="built_in">mv</span> new.pub authorized_keys</span><br><span class="line"></span><br><span class="line"> $ <span class="built_in">chmod</span> 644 authorized_keys</span><br><span class="line"></span><br><span class="line"><span class="comment"># Client</span></span><br><span class="line">$ ssh  root@serverip</span><br></pre></td></tr></table></figure>

<h2 id="user-management"><a href="#user-management" class="headerlink" title="user management"></a>user management</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># show all processes of a given user</span></span><br><span class="line">$ ps -u <span class="variable">$user</span></span><br><span class="line">$ pstree <span class="variable">$user</span> -ap</span><br><span class="line"><span class="comment"># show a process and its owner</span></span><br><span class="line">$ ps u <span class="variable">$pid</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># show all processes of given group</span></span><br><span class="line">$ ps -g <span class="variable">$user</span></span><br><span class="line"><span class="comment"># show all groups from local and remote LDAP</span></span><br><span class="line">$ getent group</span><br><span class="line"><span class="comment"># show all users from local and remote LDAP</span></span><br><span class="line">$ getent passwd</span><br><span class="line"><span class="comment"># add a group with given id and name at local</span></span><br><span class="line">$ groupadd [-g 6002] school</span><br><span class="line"><span class="comment"># create a system group</span></span><br><span class="line">$ groupadd -r <span class="variable">$group_name</span></span><br><span class="line"><span class="comment"># delete a group from local</span></span><br><span class="line">$ groupdel <span class="variable">$group_name</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># show groups for current user</span></span><br><span class="line">$ <span class="built_in">groups</span></span><br><span class="line"><span class="comment"># show groups for a given user</span></span><br><span class="line">$ <span class="built_in">groups</span> jason</span><br><span class="line"></span><br><span class="line"><span class="comment"># --- add a user to group does not effect for the given login</span></span><br><span class="line"><span class="comment"># --- you need to login again or use $ newgrp $group</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># add/delete an existing user to a given group</span></span><br><span class="line">$ gpasswd -a <span class="variable">$user</span> <span class="variable">$group</span></span><br><span class="line">$ gpasswd -d <span class="variable">$user</span> <span class="variable">$group</span></span><br><span class="line">$ gpasswd --members <span class="variable">$user1</span>, <span class="variable">$user2</span> <span class="variable">$group</span></span><br><span class="line"><span class="comment"># add user to given group</span></span><br><span class="line">$ sudo usermod -a -G root jason <span class="comment"># add jason to root group</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># show id of current user</span></span><br><span class="line">$ <span class="built_in">id</span> -ru</span><br><span class="line"><span class="comment"># show current user</span></span><br><span class="line">$ <span class="built_in">id</span> -un</span><br><span class="line"><span class="comment"># show id of given user(local or remote)</span></span><br><span class="line">$ <span class="built_in">id</span> <span class="variable">$user1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># add a new user or remove a user from local</span></span><br><span class="line"><span class="comment"># adduser [--home DIR] [--shell SHELL] [--no-create-home] [--uid ID]  [--ingroup GROUP | --gid ID] [--disabled-password] [--disabled-login]   user</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -r means deleting its home directory</span></span><br><span class="line">$ userdel -r <span class="variable">$user</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># change passwd for current user</span></span><br><span class="line">$ passwd</span><br><span class="line">$ passwd <span class="variable">$user</span></span><br></pre></td></tr></table></figure>
<h2 id="x2F-etc-x2F-sudoers-Ubuntu18"><a href="#x2F-etc-x2F-sudoers-Ubuntu18" class="headerlink" title="&#x2F;etc&#x2F;sudoers(Ubuntu18)"></a>&#x2F;etc&#x2F;sudoers(Ubuntu18)</h2><p>it’s a file used to control what commands a user can run</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo visudo</span><br></pre></td></tr></table></figure>

<p><strong>&#x2F;etc&#x2F;sudoers</strong></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># User privilege specification, root user can run all with any user on all hosts with any command!!!</span><br><span class="line">root       ALL  =    (ALL)                     ALL</span><br><span class="line">[user]     [host] =  [runas user]              commands</span><br><span class="line"></span><br><span class="line">jorge ALL=(root) NOPASSWD: /usr/bin/find, /bin/rm</span><br><span class="line"># user  jorge can run as root user!!!</span><br><span class="line"># the command must have absolute path!!!, user jorge can run /bin/rm as root without password required.</span><br><span class="line"></span><br><span class="line"># Allow members of group sudo to execute any command after they have provided their password</span><br><span class="line">%sudo ALL=(ALL) ALL</span><br><span class="line"></span><br><span class="line"># Members of the admin group may gain root privileges</span><br><span class="line"># allow members of group admin/users to execute any command with any user on all host without password.</span><br><span class="line">%admin      ALL=    (ALL) NOPASSWD:          ALL</span><br><span class="line">%users      ALL=    (ALL) NOPASSWD:          ALL</span><br><span class="line">[group] [host] =    (runas user)             commands</span><br></pre></td></tr></table></figure>

<p><strong>&#x2F;etc&#x2F;sudoers example</strong></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">lb 10.10.10.3 = (root) NOPASSWD: /usr/bin/find, /bin/rm</span><br><span class="line"># OR</span><br><span class="line">lb 10.10.10.1/24 = (root) NOPASSWD: /usr/bin/find, /bin/rm</span><br><span class="line"></span><br><span class="line"># lb user can run /bin/rm as root without password on jason_dev host</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">lb@jason_dev<span class="variable">$sudo</span> <span class="built_in">rm</span> xx</span><br><span class="line">sudo unable to resolve host jason_dev(hostname of my machine)</span><br><span class="line"><span class="comment"># take long time to show such warning</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># let&#x27;s see how this happens and fix it</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># step 1: check the user: lb, ok allowed to run /bin/rm</span></span><br><span class="line"><span class="comment"># step 2: check host(as lb is only allowed to run on 10.10.10.3</span></span><br><span class="line"><span class="comment">#         we must know what&#x27;s ip for current machine(jason_dev)</span></span><br><span class="line"><span class="comment">#         check /etc/hosts, if not found</span></span><br><span class="line"><span class="comment">#         DNSLookUp</span></span><br><span class="line"><span class="comment">#         still not found, can&#x27;t find get the above error)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># step 3: run rm with root and no password</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># to avoid dnslook, add entry at /etc/hosts with</span></span><br><span class="line"></span><br><span class="line">127.0.0.1 jason_dev</span><br></pre></td></tr></table></figure>

<h2 id="broadcast-message-to-all-users-from-terminal"><a href="#broadcast-message-to-all-users-from-terminal" class="headerlink" title="broadcast message to all users from terminal"></a>broadcast message to all users from terminal</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ wall <span class="string">&#x27;hello everyone&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># send msg to one pts</span></span><br><span class="line">$ <span class="built_in">who</span></span><br><span class="line">root     pts/8        2019-11-24 22:30 (10.20.6.117)</span><br><span class="line">root     pts/9        2019-11-25 23:59 (10.20.6.117)</span><br><span class="line">$ write root pts/8</span><br></pre></td></tr></table></figure>

<h2 id="copy-file-from-local-to-remote-ssh-server"><a href="#copy-file-from-local-to-remote-ssh-server" class="headerlink" title="copy file from local to remote ssh server"></a>copy file from local to remote ssh server</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -r will follow symbol link</span></span><br><span class="line">$ scp -r username@hostB:/home/lzq/vim .</span><br><span class="line">$ scp -r vim username@hostB:/home/lzq/</span><br></pre></td></tr></table></figure>
<p>backup file with progress bar locally</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ rsync -avP  /home/lzq/Document   /share/</span><br><span class="line"></span><br><span class="line"><span class="comment"># skip following symbol link</span></span><br><span class="line">rsync -a --no-links vim root@hostB:/root/</span><br><span class="line"></span><br><span class="line"><span class="comment"># -a, --archive               archive mode; equals -rlptgoD (no -H,-A,-X)</span></span><br><span class="line"><span class="comment"># -v, --verbose               increase verbosity</span></span><br><span class="line"><span class="comment"># -P  --progress</span></span><br><span class="line"></span><br><span class="line">rsync -avP --no-links vim root@hostB:/root/</span><br></pre></td></tr></table></figure>
<h2 id="create-soft-link-for-all-files-under-a-dir"><a href="#create-soft-link-for-all-files-under-a-dir" class="headerlink" title="create soft link for all files under a dir"></a>create soft link for all files under a dir</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">ln</span> -s /home/lzq/* .</span><br></pre></td></tr></table></figure>

<h2 id="cfg-file-for-shell"><a href="#cfg-file-for-shell" class="headerlink" title="cfg file for shell"></a>cfg file for shell</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">non-interactive terminal</span><br><span class="line">bash/csh/sh  /etc/bashrc and $HOME/.bashrc</span><br><span class="line"></span><br><span class="line">interactive terminal</span><br><span class="line">/etc/profile and $HOME/.profile</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/etc/profile vs /etc/environment</span><br><span class="line">System-wide environment variables</span><br><span class="line">[</span><br><span class="line">/etc/environment is not part of POSIX, it belongs to PAM (Pluggable Authentication Module), and only programs compiled with PAM support are able to use it (primarily login systems, which subsequently start the shell or user environment). This means it isn&#x27;t even read by your shell.</span><br><span class="line">--------------------------------------------------------------------------------------------------------</span><br><span class="line">You can see the programs using /etc/environment with grep -l pam_env /etc/pam.d/*.</span><br><span class="line">So /etc/environment is used for setting variables for programs which are usually not started from a shell</span><br><span class="line">--------------------------------------------------------------------------------------------------------</span><br><span class="line">]</span><br><span class="line">A suitable file for environment variable settings that affect the system as a whole (rather than just a particular user) is /etc/environment. An alternative is to create a file for the purpose in the /etc/profile.d directory.</span><br><span class="line"></span><br><span class="line">/etc/environment</span><br><span class="line"></span><br><span class="line">This file is specifically meant for system-wide environment variable settings. It is not a script file, but rather consists of assignment expressions, one per line.</span><br><span class="line"></span><br><span class="line">FOO=bar</span><br><span class="line"></span><br><span class="line">Note: Variable expansion does not work in /etc/environment.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/etc/profile.d/*.sh</span><br><span class="line"></span><br><span class="line">Files with the .sh extension in the /etc/profile.d directory get executed whenever a bash login shell is entered (e.g. when logging in from the console or over ssh), as well as by the DisplayManager when the desktop session loads.</span><br><span class="line"></span><br><span class="line">You can for instance create the file /etc/profile.d/myenvvars.sh and set variables like this:</span><br><span class="line"></span><br><span class="line">export JAVA_HOME=/usr/lib/jvm/jdk1.7.0</span><br><span class="line">export PATH=$PATH:$JAVA_HOME/bin</span><br><span class="line"></span><br><span class="line">Other files</span><br><span class="line"></span><br><span class="line">While /etc/profile is often suggested for setting environment variables system-wide, it is a configuration file of the base-files package, so it&#x27;s not appropriate to edit that file directly. Use a file in /etc/profile.d instead as shown above. (Files in /etc/profile.d are sourced by /etc/profile.)</span><br><span class="line"></span><br><span class="line">/etc/default/locale is specifically meant for system-wide locale environment variable settings. It&#x27;s written to by the installer and when you use Language Support to set the language or regional formats system-wide. On a desktop system there is normally no reason to edit this file manually.</span><br><span class="line"></span><br><span class="line">The shell config file /etc/bash.bashrc is sometimes suggested for setting environment variables system-wide. While this may work on Bash shells for programs started from the shell, variables set in that file are not available by default to programs started from the graphical environment in a desktop session.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="sys-related"><a href="#sys-related" class="headerlink" title="sys related"></a>sys related</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Centos</span></span><br><span class="line">$ /etc/centos-release</span><br><span class="line">CentOS Linux release 7.9.2009 (Core)</span><br><span class="line"></span><br><span class="line"><span class="comment"># show cmdline of running kernel</span></span><br><span class="line">$ <span class="built_in">cat</span> /proc/cmdline</span><br><span class="line"></span><br><span class="line"><span class="comment"># change system time</span></span><br><span class="line">$ <span class="built_in">date</span> --<span class="built_in">set</span>=<span class="string">&quot;2017-04-11 13:21:00&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># change timezone from command line</span></span><br><span class="line">$ <span class="built_in">ln</span> -s /usr/share/zoneinfo/US/Pacific /etc/localtime</span><br><span class="line"></span><br><span class="line"><span class="comment"># change hostname permanently</span></span><br><span class="line">/etc/hostname (or /etc/HOSTNAME)</span><br><span class="line"></span><br><span class="line"><span class="comment"># show system reboot and shutodwn event</span></span><br><span class="line"><span class="comment"># <span class="doctag">NOTE:</span> last read files from /var/log/wtmp or /var/log/btmp</span></span><br><span class="line">$ last -xF reboot | <span class="built_in">head</span> -3</span><br><span class="line">reboot   system boot  4.14.15-1.el7.el Fri May 17 04:45:16 2024 - Thu May 23 06:24:04 2024 (6+01:38)   </span><br><span class="line">reboot   system boot  4.14.15-1.el7.el Fri May 10 06:37:05 2024 - Thu May 23 06:24:04 2024 (12+23:46)  </span><br><span class="line">reboot   system boot  4.14.15-1.el7.el Fri May 10 06:29:01 2024 - Fri May 10 06:35:46 2024  (00:06) </span><br><span class="line"></span><br><span class="line">$ last -xF shutdown</span><br><span class="line"></span><br><span class="line"><span class="comment"># show the latest reboot time</span></span><br><span class="line">$ <span class="built_in">who</span> -b</span><br><span class="line">         system boot  2024-05-17 04:45</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">uptime</span> -s</span><br><span class="line">2024-05-17 04:43:51</span><br><span class="line"></span><br><span class="line"><span class="comment"># show the lastest reboot</span></span><br><span class="line">$ last -x reboot | <span class="built_in">head</span> -1</span><br><span class="line"></span><br><span class="line"><span class="comment"># show how lang system boots</span></span><br><span class="line">$ <span class="built_in">uptime</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># disable selinux</span></span><br><span class="line">$ setenforce 0 <span class="comment"># temporary close selinux</span></span><br><span class="line">OR</span><br><span class="line">edit /etc/selinux/config</span><br></pre></td></tr></table></figure>

<h2 id="reset-root-password"><a href="#reset-root-password" class="headerlink" title="reset root password"></a>reset root password</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">In the event your Linux box experiences disk or file system issues you may receive a “Give root password for maintenance” prompt upon reboot. If you have your root password you can login but in the event your using ‘slide’ or ‘sudo’ for wheel access or you’ve just mis-placed your root password – you’ll need to reset it.</span><br><span class="line"></span><br><span class="line">To reset your root password:</span><br><span class="line">    1. When the GRUB loader shows during boot press the spare bar to pause boot.</span><br><span class="line"></span><br><span class="line">    2. Select your boot kernel.</span><br><span class="line"></span><br><span class="line">    3. Type ‘e’ to edit the default kernel line.</span><br><span class="line"></span><br><span class="line">    4. Type ‘e’ again on the line that starts with ‘kernel’.</span><br><span class="line"></span><br><span class="line">    5. Add ‘init=/bin/bash’ to the end of the ‘kernel’ line then press enter.</span><br><span class="line"></span><br><span class="line">    6. Type ‘b’ to boot the modified kernel parameters.</span><br><span class="line"></span><br><span class="line">    7. Once you’re at the /bin/bash prompt you will need to remount the root file system as read/write in order to edit the passwd file:</span><br><span class="line"></span><br><span class="line">    # mount -o remount,rw /</span><br><span class="line"></span><br><span class="line">    8. Change your root password:</span><br><span class="line"></span><br><span class="line">    # passwd root</span><br><span class="line"></span><br><span class="line">    9. Remount the filesystem back to read only:</span><br><span class="line"></span><br><span class="line">    # mount -o remount,ro /</span><br><span class="line"></span><br><span class="line">    10. Reboot your server using CTR-ALT-DELETE.</span><br><span class="line"></span><br><span class="line">    11. You will now be able to login with your new root password and carry out the maintenance.</span><br></pre></td></tr></table></figure>

<h2 id="disable-boot-from-save-grub-entry-for-grub2"><a href="#disable-boot-from-save-grub-entry-for-grub2" class="headerlink" title="disable boot from save grub entry for grub2"></a>disable boot from save grub entry for grub2</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Ubuntu18</span><br><span class="line"></span><br><span class="line">GRUB_DEFAULT=saved</span><br><span class="line">GRUB_SAVEDEFAULT=true</span><br><span class="line"></span><br><span class="line">to</span><br><span class="line"></span><br><span class="line">GRUB_DEFAULT=0</span><br><span class="line">(always first entry)</span><br><span class="line">GRUB_SAVEDEFAULT=false</span><br><span class="line"></span><br><span class="line">then generate /boot/grub2/grub.cfg newly</span><br><span class="line">#grub2-mkconfig -o /boot/grub2/grub.cfg</span><br></pre></td></tr></table></figure>

<h2 id="force-enter-command-line-mode-when-boots"><a href="#force-enter-command-line-mode-when-boots" class="headerlink" title="force enter command-line mode when boots"></a>force enter command-line mode when boots</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$sudo vi /etc/default/grub</span><br><span class="line"></span><br><span class="line">Do below changes:</span><br><span class="line">Comment the line     GRUB_CMDLINE_LINUX_DEFAULT=”quiet splash”, by adding # at the beginning, which will disable the Ubuntu purple screen.</span><br><span class="line">Change               GRUB_CMDLINE_LINUX=”” to GRUB_CMDLINE_LINUX=”text”, this makes Ubuntu boot directly into Text Mode.</span><br><span class="line">Uncomment this line #GRUB_TERMINAL=console, by removing the # at the beginning, this makes Grub Menu into real black &amp; white Text Mode (without background image)</span><br><span class="line"></span><br><span class="line">Ubuntu18</span><br><span class="line">$ sudo update-grub</span><br><span class="line">Centos7</span><br><span class="line">$ grub2-mkconfig</span><br></pre></td></tr></table></figure>

<h2 id="enter-single-user-mode-when-boots"><a href="#enter-single-user-mode-when-boots" class="headerlink" title="enter single-user mode when boots"></a>enter single-user mode when boots</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">开机进入grub时，用上下键移到第二行的恢复模式，按e（注意不是回车）</span><br><span class="line">把ro single 改成rw single init=/bin/bash ， 然后按ctrl+x，就可以进入 单用户模式，完成后，按”ctrl+alt+delete“组合神键重启</span><br><span class="line"></span><br><span class="line">passwd: Authentication token manipulation error</span><br><span class="line">进入单用户模式后， filessystem may be mounted with readonly， so remount it again</span><br><span class="line"></span><br><span class="line">mount -rw -o remount /</span><br><span class="line">OR</span><br><span class="line">mount -o remount, rw /</span><br></pre></td></tr></table></figure>

<h2 id="x2F-etc-x2F-fstab-file-format"><a href="#x2F-etc-x2F-fstab-file-format" class="headerlink" title="&#x2F;etc&#x2F;fstab file format"></a>&#x2F;etc&#x2F;fstab file format</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line">What is fstab file?</span><br><span class="line"></span><br><span class="line">fstab is a configuration file that contains information of all the partitions and storage devices in your computer. The file is located under /etc, so the full path to this file is /etc/fstab.</span><br><span class="line"></span><br><span class="line">/etc/fstab contains information of where your partitions and storage devices should be mounted and how. If you can&#x27;t access your Windows partition from Linux, aren&#x27;t able to mount your CD or write to your floppy as a normal user, or have problems with your CD-RW, you probably have a misconfigured /etc/fstab file. So, you can usually fix your mounting problems by editing your fstab file.</span><br><span class="line"></span><br><span class="line">/etc/fstab is just a plain text file, so you can open and edit it with any text editor you&#x27;re familiar with. However, note that you must have the root privileges before editing fstab. So, in order to edit the file, you must either log in as root or use the su command to become root.</span><br><span class="line"></span><br><span class="line">Sample fstab file looks like this</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># /etc/fstab</span><br><span class="line">#</span><br><span class="line"># &lt;device&gt; &lt;mountpoint&gt; &lt;filesystemtype&gt;&lt;options&gt; &lt;dump&gt; &lt;fsckorder&gt;</span><br><span class="line"></span><br><span class="line">/dev/hdb5         /                       ext2               defaults       1              1</span><br><span class="line">/dev/hdb2        /home                  ext2               defaults       1             2</span><br><span class="line">/dev/hdc         /mnt/cdrom            iso9660         noauto,ro,user     0        0</span><br><span class="line">/dev/hda1     /mnt/dos/c              msdos              defaults        0             0</span><br><span class="line">/dev/hdb1    /mnt/dos/d              msdos            defaults           0             0</span><br><span class="line">/dev/fd0     /mnt/floppy               ext2               noauto,user     0             0</span><br><span class="line">/dev/hdb4     none                     ignore             defaults          0              0</span><br><span class="line"></span><br><span class="line">none            /proc                       proc                defaults</span><br><span class="line">/dev/hdb3    none                        swap                sw</span><br><span class="line"></span><br><span class="line">Note that this system has two IDE partitions, one which is used as /, and the other used as /home. It also has two DOS partitions which are mounted under /mnt. Note the user option provided for the cdrom, and the floppy drive. This is one of the many default parameters you can specify. In this case it means that any user can mount a cdrom, or floppy disk. Other options will be dealt with later.</span><br><span class="line"></span><br><span class="line">fstab file format explination</span><br><span class="line"></span><br><span class="line">fstab consists of a number of lines (one for each filesystem) seperated into six fields. Each field is seperated from the next by whitespace (spaces/tabs).</span><br><span class="line"></span><br><span class="line">So from the example given previously:</span><br><span class="line"></span><br><span class="line">/dev/hdc /mnt/cdrom iso9660 noauto,ro,user 0 0</span><br><span class="line"></span><br><span class="line"> first field (/dev/hdc) is the physical device/remote filesystem which is to be described.</span><br><span class="line"></span><br><span class="line"> second field (/mnt/cdrom) specifies the mount point where the filesystem will be mounted.</span><br><span class="line"></span><br><span class="line"> third field (iso9660) is the type of filesystem on the device from the first field.</span><br><span class="line"></span><br><span class="line"> fourth field (noauto,ro,user) is a (default) list of options which mount should use when mounting the filesystem.</span><br><span class="line"></span><br><span class="line"> fifth field (0) is used by dump (a backup utility) to decide if a filesystem should be backed up. If zero then dump will ignore that filesystem. The sixth field (0) is used by fsck (the filesystem check utility) to determine the order in which filesystems should be checked.</span><br><span class="line"></span><br><span class="line">If zero then fsck won&#x27;t check the filesystem.</span><br><span class="line"></span><br><span class="line">(as the example line above is a cdrom there is very little point in doing a fsck on it, so the value is zero).</span><br><span class="line"></span><br><span class="line">File system mount options</span><br><span class="line"></span><br><span class="line">As the filesystems in /etc/fstab will eventually be mounted using mount(8) it isn&#x27;t surprising that the options field simply contains a comma-seperated list of options which will be passed directly to mount when it tries to mount the filesystem.</span><br><span class="line"></span><br><span class="line">The options common to all filesystems are:</span><br><span class="line"></span><br><span class="line">sync / async</span><br><span class="line"></span><br><span class="line">All I/O to the file system should be done (a)synchronously.</span><br><span class="line"></span><br><span class="line">auto</span><br><span class="line"></span><br><span class="line">The filesystem can be mounted automatically (at bootup, or when mount is passed the -a option). This is really unnecessary as this is the default action of mount -a anyway.</span><br><span class="line"></span><br><span class="line">noauto</span><br><span class="line"></span><br><span class="line">The filesystem will NOT be automatically mounted at startup, or when mount passed -a. You must explicitly mount the filesystem.</span><br><span class="line"></span><br><span class="line">dev / nodev</span><br><span class="line"></span><br><span class="line">Permit any user to mount the filesyste. This automatically implies noexec,</span><br><span class="line"></span><br><span class="line">exec / noexec</span><br><span class="line"></span><br><span class="line">Permit/Prevent the execution of binaries from the filesystem.</span><br><span class="line"></span><br><span class="line">suid / nosuid</span><br><span class="line"></span><br><span class="line">Permit/Block the operation of suid, and sgid bits.</span><br><span class="line"></span><br><span class="line">ro</span><br><span class="line"></span><br><span class="line">Mount read-only.</span><br><span class="line"></span><br><span class="line">rw</span><br><span class="line"></span><br><span class="line">Mount read-write.</span><br><span class="line"></span><br><span class="line">user</span><br><span class="line"></span><br><span class="line">Permit any user to mount the filesystem. This automatically implies noexec, nosuid,nodev unless overridden.</span><br><span class="line"></span><br><span class="line">nouser</span><br><span class="line"></span><br><span class="line">Only permit root to mount the filesystem. This is also a default setting.</span><br><span class="line"></span><br><span class="line">defaults</span><br><span class="line"></span><br><span class="line">Use default settings. Equivalent to rw,suid,dev,exec,auto,nouser,async.</span><br><span class="line"></span><br><span class="line">There are numerous options for the specific filesystes supported by mount.</span><br><span class="line">However these are some of the more useful, for the full list check out the man page for `mount`.</span><br><span class="line"></span><br><span class="line">ext2</span><br><span class="line"></span><br><span class="line">check=&#123;none, normal, strict&#125;</span><br><span class="line">Sets the fsck checking level.</span><br><span class="line"></span><br><span class="line">debug</span><br><span class="line"></span><br><span class="line">print debugging info on each remount.</span><br><span class="line"></span><br><span class="line">sb=n</span><br><span class="line"></span><br><span class="line">n is the block which should be used as the superblock for the fs.</span><br><span class="line"></span><br><span class="line">fat</span><br><span class="line"></span><br><span class="line">check=&#123;r[elaxed], n[ormal], s[trict]&#125;</span><br><span class="line"></span><br><span class="line">Not the same as ext2. Rather deals with allowed filenames. See mount man page.</span><br><span class="line"></span><br><span class="line">conv=&#123;b[inary], t[ext], a[uto]&#125;</span><br><span class="line"></span><br><span class="line">Performs DOS&lt;-&gt;UNIX text file conversions automatically. See mount man page.</span><br><span class="line"></span><br><span class="line">uid=n, gid=n</span><br><span class="line"></span><br><span class="line">iso9660</span><br><span class="line"></span><br><span class="line">norock</span><br><span class="line"></span><br><span class="line">Disables Rock Ridge extensions.</span><br><span class="line"></span><br><span class="line">fstab file Supported file systems list</span><br><span class="line"></span><br><span class="line">affs - I have know idea what this is, if anyone else does please enlighten me.</span><br><span class="line"></span><br><span class="line">coherent</span><br><span class="line"></span><br><span class="line">ext - Don&#x27;t use this. ext has been superseded by ext2.</span><br><span class="line"></span><br><span class="line">ext2 - The standard Linux filesystem. (NB, this has nothing to do with extended partitions.)</span><br><span class="line"></span><br><span class="line">fat - DOS.</span><br><span class="line"></span><br><span class="line">hpfs - OS/2 High Performance File System.</span><br><span class="line"></span><br><span class="line">iso9660 - CD-ROM&#x27;s. Supports Rock Ridge extensions by default.</span><br><span class="line"></span><br><span class="line">minix - can be useful for floppy disks.</span><br><span class="line"></span><br><span class="line">msdos - Just fat with some addtional error checking.</span><br><span class="line"></span><br><span class="line">nfs - Network FileSystem. Dealt with later.</span><br><span class="line"></span><br><span class="line">proc - The process psudeo-filesystem now standard in Linux.</span><br><span class="line"></span><br><span class="line">smb - Another network filesystem. Compatable with WFW, and NT. See Samba.</span><br><span class="line"></span><br><span class="line">ufs - Unix FileSystem.</span><br><span class="line"></span><br><span class="line">unsdos - Unix filesystem on a FAT partition.</span><br><span class="line"></span><br><span class="line">vfat - MS&#x27;s kludge of FAT to provide long filenames.</span><br><span class="line"></span><br><span class="line">xenix</span><br><span class="line"></span><br><span class="line">xiafs</span><br></pre></td></tr></table></figure>

<h2 id="deep-in-remove-file"><a href="#deep-in-remove-file" class="headerlink" title="deep in remove file"></a>deep in remove file</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">rm</span> test.c</span><br><span class="line"><span class="comment"># actually, kernel takes two steps to delete the file</span></span><br><span class="line">1. remove fentry(<span class="keyword">then</span> you can NOT see test.c)</span><br><span class="line">2. free inode of this file <span class="keyword">if</span> its reference count is 0</span><br><span class="line">Only these two steps executed, the disk space is freed</span><br><span class="line"></span><br><span class="line"><span class="comment"># show all deleted files(not see from disk), but still opened by process</span></span><br><span class="line">$  lsof 2&gt;/dev/null | grep deleted</span><br><span class="line">ovsdb-ser  1089          openvswitch    7u      REG              253,0        159   69471332 /tmp/tmpfVYsNnz (deleted)</span><br></pre></td></tr></table></figure>

<p><strong>what about app opens a large file, during it’s reading, someone rm that file?</strong></p>
<p>Only fentry is deleted, inode is not freed, as when app opens that file,<br>it increments the reference of that inode<br>when app closes that file, at that time, it will be deleted from disk.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># check file inode</span></span><br><span class="line"><span class="variable">$ls</span> -i a.c b.c</span><br><span class="line">OR</span><br><span class="line"><span class="variable">$stat</span> a.c b.c</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">mv</span> a.c b.c</span><br><span class="line"><span class="comment"># actually, fentry(b.c) points to inode of (a.c)</span></span><br><span class="line"><span class="comment"># a.c(fentry is deleted), inode of (b.c) is freed if no use open it!!!</span></span><br></pre></td></tr></table></figure>

<h2 id="update-file-time"><a href="#update-file-time" class="headerlink" title="update file time"></a>update file time</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Update the access and modification times of each FILE to the current time</span></span><br><span class="line">$ <span class="built_in">touch</span>  test.doc</span><br><span class="line">$ <span class="built_in">touch</span> -d <span class="string">&quot;2010-05-31 08:10:30&quot;</span> test.doc</span><br><span class="line"></span><br><span class="line"><span class="comment"># or change only one</span></span><br><span class="line">$ <span class="built_in">touch</span> -m -d <span class="string">&quot;2010-05-31 08:10:30&quot;</span> test.doc</span><br><span class="line">$ <span class="built_in">touch</span> -a -d <span class="string">&quot;2010-05-31 08:10:30&quot;</span> test.doc</span><br></pre></td></tr></table></figure>
<h2 id="cut-command"><a href="#cut-command" class="headerlink" title="cut command"></a>cut command</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cut split string by tab by default, the first indiex if 1</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;hello boy&quot;</span> | <span class="built_in">cut</span> -d <span class="string">&#x27; &#x27;</span> -f 1</span><br><span class="line">hello</span><br></pre></td></tr></table></figure>

<h2 id="remove-file-named-with-special-character"><a href="#remove-file-named-with-special-character" class="headerlink" title="remove file named with special character"></a>remove file named with special character</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">ls</span></span><br><span class="line"><span class="comment">#a.c  -a.c</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">rm</span> <span class="string">&#x27;#a.c&#x27;</span></span><br><span class="line">$ <span class="built_in">rm</span> \<span class="comment">#a.c</span></span><br><span class="line">$ <span class="built_in">rm</span> ./-a.c</span><br><span class="line"></span><br><span class="line"><span class="comment"># use eval</span></span><br><span class="line">$ <span class="built_in">eval</span> <span class="string">&quot;rm =1.3.0,&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="display-output-to-screen-and-also-write-it-to-file"><a href="#display-output-to-screen-and-also-write-it-to-file" class="headerlink" title="display output to screen and also write it to file"></a>display output to screen and also write it to file</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;just a test&quot;</span> | <span class="built_in">tee</span> log.txt</span><br></pre></td></tr></table></figure>

<h2 id="command-xargs"><a href="#command-xargs" class="headerlink" title="command xargs"></a>command xargs</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># xargs will split parameters passed by tab or space, then call after command with splited parameter one by one</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;hello boy&quot;</span> | xargs <span class="built_in">rm</span></span><br><span class="line"><span class="built_in">rm</span>: cannot remove <span class="string">&#x27;hello&#x27;</span>: No such file or directory</span><br><span class="line"><span class="built_in">rm</span>: cannot remove <span class="string">&#x27;boy&#x27;</span>: No such file or directory</span><br><span class="line"></span><br><span class="line"><span class="comment"># if you see xargs: argument line too long</span></span><br><span class="line">$ xx | xargs -l1 <span class="built_in">rm</span> <span class="comment"># -l1 each time each parameter</span></span><br></pre></td></tr></table></figure>

<h2 id="find-command-better-use-find-file-not-content-of-file"><a href="#find-command-better-use-find-file-not-content-of-file" class="headerlink" title="find command(better use find file, not content of file)"></a>find command(better use find file, not content of file)</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -name  exactly match!!!</span></span><br><span class="line"><span class="comment"># -iname case insensitive</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -type  f | d | c | l(link) | b(block) | p(pipe)</span></span><br><span class="line"><span class="comment"># -size  n[cwbkMG] # 1M, -1k</span></span><br><span class="line"><span class="comment"># -maxdepth 1 (max depth)</span></span><br><span class="line"><span class="comment"># -perm 755  (permission with 755)</span></span><br><span class="line"><span class="comment"># -user jason</span></span><br><span class="line"></span><br><span class="line">$ find - <span class="built_in">type</span> f -size +1k -name <span class="string">&quot;/*test.c&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># when use | for find better to use -print0</span></span><br><span class="line">$ find . -<span class="built_in">type</span> f -print0 | xargs -0 <span class="built_in">rm</span> -f</span><br><span class="line"></span><br><span class="line"><span class="comment"># more exec on some file</span></span><br><span class="line">$ find . -<span class="built_in">type</span> f -print0 -<span class="built_in">exec</span> <span class="built_in">ls</span> &#123;&#125; \; -<span class="built_in">exec</span> <span class="built_in">rm</span> -f &#123;&#125; \;</span><br><span class="line"></span><br><span class="line">$ find . -<span class="built_in">type</span> f -print0 -<span class="built_in">exec</span> <span class="built_in">rm</span> -f &#123;&#125; \;</span><br><span class="line"><span class="comment"># in some case it may meet error &#x27;too long parameter/argument&#x27; something like use, use find | xargs to sovle it</span></span><br><span class="line"></span><br><span class="line">print0: <span class="built_in">print</span> the full file name on the standard output, followed by a null character (instead of the new-line character that ‘-<span class="built_in">print</span>’ uses).  This allows file names that contain  newlines  or  other  types  of white  space  to  be correctly interpreted by programs that process the find output.  This option corresponds to the ‘-0’ option of xargs.</span><br><span class="line"></span><br><span class="line"><span class="comment"># find file with executable attribute</span></span><br><span class="line">$ find . -executable</span><br><span class="line"></span><br><span class="line"><span class="comment"># negative</span></span><br><span class="line">$ find . ! -name <span class="string">&quot;*.txt&quot;</span></span><br><span class="line"><span class="comment"># find with two or more conditions</span></span><br><span class="line"></span><br><span class="line">$ find . -iname class.* -o -name basic*</span><br></pre></td></tr></table></figure>

<h2 id="rename-a-batch-of-files-with-pattern"><a href="#rename-a-batch-of-files-with-pattern" class="headerlink" title="rename a batch of files with pattern"></a>rename a batch of files with pattern</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ rename <span class="string">&#x27;s/ //g&#x27;</span> *.txt <span class="comment"># remove space from filename</span></span><br><span class="line">$ find . -<span class="built_in">type</span> f -<span class="built_in">exec</span> rename <span class="string">&#x27;s/ //g&#x27;</span> &#123;&#125; \; <span class="comment"># remove space from file name only</span></span><br><span class="line">$ find . name <span class="string">&quot;* *&quot;</span> -<span class="built_in">exec</span> rename <span class="string">&#x27;s/ //g&#x27;</span> &#123;&#125; \; <span class="comment"># remove space from file name or dir name</span></span><br></pre></td></tr></table></figure>

<h2 id="show-stats-of-a-file"><a href="#show-stats-of-a-file" class="headerlink" title="show stats of a file"></a>show stats of a file</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">stat</span> a.c</span><br></pre></td></tr></table></figure>

<h2 id="copy-file"><a href="#copy-file" class="headerlink" title="copy file"></a>copy file</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cp</span> -r dir1 dir2 dir3/ <span class="comment"># copy dir1, dir2(include hiden files) to dir3(under)</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cp</span> -r dir1/* dir2/</span><br><span class="line">$ <span class="built_in">cp</span> -r dir1/ dir2/ <span class="comment"># copy all files(except hiden files) under dir1 to dir2</span></span><br></pre></td></tr></table></figure>
<h2 id="tar"><a href="#tar" class="headerlink" title="tar"></a>tar</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ERROR: Exiting with failure status due to previous errors</span></span><br><span class="line"><span class="comment"># 原来是待压缩的文件夹是root权限创建的，而执行tar的时候未加sudo</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># create tar and exclude some dirs for files</span></span><br><span class="line">$ tar czvf test.tar.gz <span class="built_in">test</span>/ --exclude=<span class="string">&#x27;test/exclude/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># extract .xz with tar</span></span><br><span class="line">$ tar -xJf xx.tar.xz</span><br><span class="line"><span class="comment"># extract .gz file</span></span><br><span class="line">$ gunzip *.gz</span><br></pre></td></tr></table></figure>
<h2 id="sleep-and-usleep"><a href="#sleep-and-usleep" class="headerlink" title="sleep and usleep"></a>sleep and usleep</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sleep (sec);</span><br><span class="line">usleep (microsec)</span><br><span class="line"></span><br><span class="line">sec = 1000 milisecond 毫秒</span><br><span class="line">milisecond = 1000 microsecond 微秒</span><br></pre></td></tr></table></figure>
<h2 id="history-command"><a href="#history-command" class="headerlink" title="history command"></a>history command</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># show history command with time</span></span><br><span class="line">$ <span class="built_in">export</span> HISTTIMEFORMAT=<span class="string">&quot;`whoami` : |  %F  | %T: | &quot;</span></span><br><span class="line"><span class="comment"># run history command</span></span><br><span class="line">$ <span class="built_in">history</span></span><br><span class="line">1 <span class="built_in">cd</span></span><br><span class="line">2 <span class="built_in">ls</span></span><br><span class="line"></span><br><span class="line">$ !2 <span class="comment"># equal ls</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># show latest N history commands</span></span><br><span class="line">$ <span class="built_in">history</span> 10</span><br></pre></td></tr></table></figure>

<h2 id="run-command-with-a-specific-user-or-group"><a href="#run-command-with-a-specific-user-or-group" class="headerlink" title="run command with a specific user or group"></a>run command with a specific user or group</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ su -m jason -c <span class="string">&#x27;ls&#x27;</span> <span class="comment"># jason is a user</span></span><br><span class="line">$ sg - jason_group -c <span class="string">&#x27;ls&#x27;</span> <span class="comment"># sg group</span></span><br></pre></td></tr></table></figure>

<h2 id="list-all-alias"><a href="#list-all-alias" class="headerlink" title="list all alias"></a>list all alias</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">alias</span> -p</span><br></pre></td></tr></table></figure>

<h2 id="redirect-shell-output"><a href="#redirect-shell-output" class="headerlink" title="redirect shell output"></a>redirect shell output</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># redirect stdout(1) to /dev/null</span></span><br><span class="line"><span class="comment"># and redirect stder(2) to stdout(1)</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;hello&quot;</span> &gt;/dev/null 2&gt;&amp;1</span><br></pre></td></tr></table></figure>

<h2 id="read-one-file-at-a-time-from-a-file"><a href="#read-one-file-at-a-time-from-a-file" class="headerlink" title="read one file at a time from a file"></a>read one file at a time from a file</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># read is a keyword</span></span><br><span class="line"><span class="comment"># line is var</span></span><br><span class="line"><span class="built_in">where</span> <span class="built_in">read</span> -r line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$line</span></span><br><span class="line"><span class="keyword">done</span> &lt; file</span><br></pre></td></tr></table></figure>

<h2 id="read-input-from-standard-input-instead-of-a-file"><a href="#read-input-from-standard-input-instead-of-a-file" class="headerlink" title="read input from standard input instead of a file"></a>read input from standard input instead of a file</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> &lt;&lt; <span class="string">END</span></span><br><span class="line"><span class="string">hello boy</span></span><br><span class="line"><span class="string">END</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># read from std and write to a file</span></span><br><span class="line">$ <span class="built_in">cat</span> &gt;new.txt &lt;&lt; <span class="string">END</span></span><br><span class="line"><span class="string">hello boy</span></span><br><span class="line"><span class="string">END</span></span><br><span class="line"><span class="comment"># END is a marker can be any</span></span><br></pre></td></tr></table></figure>

<h2 id="git-status-can’t-display-chinese-character"><a href="#git-status-can’t-display-chinese-character" class="headerlink" title="git status can’t display chinese character"></a>git status can’t display chinese character</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">edit ～/.gitconfig</span><br><span class="line">[core]</span><br><span class="line">quotepath = false</span><br></pre></td></tr></table></figure>

<h2 id="check-md5-value-for-a-file"><a href="#check-md5-value-for-a-file" class="headerlink" title="check md5 value for a file"></a>check md5 value for a file</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">md5sum</span> xx.iso</span><br></pre></td></tr></table></figure>

<h2 id="format-man-output-and-save-it-to-a-file"><a href="#format-man-output-and-save-it-to-a-file" class="headerlink" title="format man output and save it to a file"></a>format man output and save it to a file</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ man strace | col -b &gt; trace.txt</span><br></pre></td></tr></table></figure>



<h2 id="watch-a-command-output-by-‘n-seconds’"><a href="#watch-a-command-output-by-‘n-seconds’" class="headerlink" title="watch a command output by ‘n seconds’"></a>watch a command output by ‘n seconds’</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># by default, free unix is KB -m means MB</span></span><br><span class="line">$ watch -n 1 free -m</span><br></pre></td></tr></table></figure>

<h2 id="file-encoding-convertor-iconv"><a href="#file-encoding-convertor-iconv" class="headerlink" title="file encoding convertor iconv"></a>file encoding convertor iconv</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ iconv -l  <span class="comment"># show supported encoding</span></span><br><span class="line"></span><br><span class="line">$ file a.c <span class="comment"># get file encoding</span></span><br><span class="line"></span><br><span class="line">$ iconv -f one_encoding -t another_encoding a.c &gt;b.c</span><br></pre></td></tr></table></figure>

<h2 id="error-‘sorry-you-must-have-a-tty-to-run-sudo’"><a href="#error-‘sorry-you-must-have-a-tty-to-run-sudo’" class="headerlink" title="error ‘sorry, you must have a tty to run sudo’"></a>error ‘sorry, you must have a tty to run sudo’</h2><p>There must be <code>Defaults requiretty</code> in the file you try to edit.</p>
<h2 id="generate-uuid"><a href="#generate-uuid" class="headerlink" title="generate uuid"></a>generate uuid</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ uuidgen</span><br></pre></td></tr></table></figure>

<h2 id="formated-json-output-from-shell"><a href="#formated-json-output-from-shell" class="headerlink" title="formated json output from shell"></a>formated json output from shell</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&#x27;&#123;&quot;hostname&quot;:&quot;test&quot;,&quot;domainname&quot;:&quot;example.com&quot;&#125;&#x27;</span> | python -m json.tool</span><br></pre></td></tr></table></figure>
<h2 id="Add-an-environment-variable-to-a-command"><a href="#Add-an-environment-variable-to-a-command" class="headerlink" title="Add an environment variable to a command"></a>Add an environment variable to a command</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">test</span>=hello; <span class="built_in">echo</span> <span class="variable">$test</span></span><br></pre></td></tr></table></figure>
<h2 id="eval-to-run-command-from-string"><a href="#eval-to-run-command-from-string" class="headerlink" title="eval to run command from string"></a>eval to run command from string</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">eval</span> <span class="string">&#x27;ls&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="killall-command-not-found"><a href="#killall-command-not-found" class="headerlink" title="killall command not found"></a>killall command not found</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Centos7</span></span><br><span class="line">$ yum install -y psmisc</span><br></pre></td></tr></table></figure>

<h2 id="capture-signal-in-shell"><a href="#capture-signal-in-shell" class="headerlink" title="capture signal in shell"></a>capture signal in shell</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># trap ctrl-c and call ctrl_c()</span></span><br><span class="line"><span class="built_in">trap</span> ctrl_c INT</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">ctrl_c</span></span>() &#123;</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;** Trapped CTRL-C&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `<span class="built_in">seq</span> 1 5`; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">sleep</span> 1</span><br><span class="line">    <span class="built_in">echo</span> -n <span class="string">&quot;.&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h2 id="write-message-to-x2F-var-x2F-log-x2F-syslog-by-shell"><a href="#write-message-to-x2F-var-x2F-log-x2F-syslog-by-shell" class="headerlink" title="write message to &#x2F;var&#x2F;log&#x2F;syslog by shell"></a>write message to &#x2F;var&#x2F;log&#x2F;syslog by shell</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">logger -t <span class="string">&quot;title&quot;</span> <span class="string">&quot;message&quot;</span>         /* use tcp socket server port 601 */</span><br><span class="line">logger -d <span class="string">&quot;title&quot;</span> <span class="string">&quot;message&quot;</span>         /* use udp socket server port 514 */</span><br><span class="line">logger -u /dev/log <span class="string">&quot;title&quot;</span> <span class="string">&quot;message&quot;</span></span><br><span class="line"><span class="comment"># [looger is a command that can write syslog]</span></span><br></pre></td></tr></table></figure>

<h2 id="rsyslog-conf"><a href="#rsyslog-conf" class="headerlink" title="rsyslog conf"></a>rsyslog conf</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">In /var/log/syslog you may see these kind of message</span><br><span class="line">&quot;Previous message repeated X times&quot;, where X is a number</span><br><span class="line"></span><br><span class="line">it&#x27;s useful for supressing message, but for debugging, you can&#x27;t see it directly, turn it off by(ubuntu)</span><br><span class="line"></span><br><span class="line">edit /etc/rsyslog.conf</span><br><span class="line"></span><br><span class="line">$RepeatedMsgReduction off</span><br></pre></td></tr></table></figure>

<h2 id="wget"><a href="#wget" class="headerlink" title="wget"></a>wget</h2><p><strong>download particular files from particular website</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ wget -r -A .html http://cunit.sourceforge.net/doc/</span><br><span class="line">$ wget -r --no-parent -A <span class="string">&#x27;*.deb&#x27;</span> http://www.xyun.com/amd64/</span><br><span class="line"></span><br><span class="line"><span class="comment"># download all files except auto-generated index.html</span></span><br><span class="line">$ wget -r -np -R <span class="string">&quot;index.html*&quot;</span> http://example.com/configs/.vim/</span><br></pre></td></tr></table></figure>

<h2 id="wget-breakpoint-and-retry"><a href="#wget-breakpoint-and-retry" class="headerlink" title="wget breakpoint and retry"></a>wget breakpoint and retry</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ wget -c -t 10 <span class="variable">$url</span></span><br><span class="line"><span class="comment"># -c breakpoin</span></span><br><span class="line"><span class="comment"># -t 0, number for retransmission, 0 always retry!</span></span><br></pre></td></tr></table></figure>

<h2 id="run-a-basic-http-server"><a href="#run-a-basic-http-server" class="headerlink" title="run a basic http server"></a>run a basic http server</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python -m http.server 80 <span class="comment">#python3</span></span><br></pre></td></tr></table></figure>

<h2 id="scan-host-on-local-network"><a href="#scan-host-on-local-network" class="headerlink" title="scan host on local network"></a>scan host on local network</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># if you know the mac and you are on the local network</span></span><br><span class="line"><span class="comment"># you can easy to know the ip of that host(mac)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># will print IP, MAC</span></span><br><span class="line">$ sudo arp-scan --interface=eth0 --localnet</span><br><span class="line"></span><br><span class="line"><span class="comment"># check if host(ip) opens a specific port</span></span><br><span class="line"><span class="comment"># check RDP port(windows remote desktop port)</span></span><br><span class="line">$ sudo nmap -p 3389 <span class="variable">$IP</span></span><br></pre></td></tr></table></figure>

<h2 id="resize-disk-vm-after-change-its-size"><a href="#resize-disk-vm-after-change-its-size" class="headerlink" title="resize disk(vm) after change its size"></a>resize disk(vm) after change its size</h2><p>Afer you change vm disk by client, the free space of disk can be added to part of disk to expand its size</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">$ sudo fdisk -l</span><br><span class="line">...</span><br><span class="line">GPT PMBR size mismatch (20971519 != 209715199) will be corrected by w(rite).</span><br><span class="line"></span><br><span class="line">-----new size 100G, old size 10G-----</span><br><span class="line">Disk /dev/sda: 100 GiB, 107374182400 bytes, 209715200 sectors</span><br><span class="line">Units: sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disklabel <span class="built_in">type</span>: gpt</span><br><span class="line">Disk identifier: 1C6DFAAE-5BA8-4141-A6CF-953F8D9E871F</span><br><span class="line"></span><br><span class="line">----sda1 still use 10G-----</span><br><span class="line">Device      Start      End  Sectors  Size Type</span><br><span class="line">/dev/sda1  227328 20971486 20744159  9.9G Linux filesystem</span><br><span class="line">/dev/sda14   2048    10239     8192    4M BIOS boot</span><br><span class="line">/dev/sda15  10240   227327   217088  106M EFI System</span><br><span class="line"></span><br><span class="line">$ sudo LANG=en_US.UTF-8 growpart /dev/sda 1</span><br><span class="line">CHANGED: partition=1 start=227328 old: size=20744159 end=20971487 new: size=209487839,end=209715167</span><br><span class="line"></span><br><span class="line">$ sudo fdisk -l</span><br><span class="line">Disk /dev/sda: 100 GiB, 107374182400 bytes, 209715200 sectors</span><br><span class="line">Units: sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disklabel <span class="built_in">type</span>: gpt</span><br><span class="line">Disk identifier: 1C6DFAAE-5BA8-4141-A6CF-953F8D9E871F</span><br><span class="line"></span><br><span class="line">----sda1 has 100G, but the new add part should format with fs---</span><br><span class="line">Device      Start       End   Sectors  Size Type</span><br><span class="line">/dev/sda1  227328 209715166 209487839 99.9G Linux filesystem</span><br><span class="line">/dev/sda14   2048     10239      8192    4M BIOS boot</span><br><span class="line">/dev/sda15  10240    227327    217088  106M EFI System</span><br><span class="line"></span><br><span class="line">$ sudo resize2fs /dev/sda1</span><br><span class="line">resize2fs 1.44.1 (24-Mar-2018)</span><br><span class="line">Filesystem at /dev/sda1 is mounted on /; on-line resizing required</span><br><span class="line">old_desc_blocks = 2, new_desc_blocks = 13</span><br><span class="line">The filesystem on /dev/sda1 is now 26185979 (4k) blocks long.</span><br></pre></td></tr></table></figure>
<h2 id="count-line-of-code"><a href="#count-line-of-code" class="headerlink" title="count line of code"></a>count line of code</h2><p>There are lots of tools for counting code, two fast and popular ones, <a target="_blank" rel="noopener" href="https://github.com/boyter/scc">scc</a> and <a target="_blank" rel="noopener" href="https://github.com/XAMPPRocky/tokei">tokei</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ go get -u github.com/boyter/scc/</span><br><span class="line">$ scc [flags] [files or directories]</span><br><span class="line">$ scc .</span><br><span class="line">───────────────────────────────────────────────────────────────────────────────</span><br><span class="line">Language                 Files     Lines   Blanks  Comments     Code Complexity</span><br><span class="line">───────────────────────────────────────────────────────────────────────────────</span><br><span class="line">Go                         113     19031     2746      2181    14104       3360</span><br><span class="line">Markdown                    29      2701      655         0     2046          0</span><br><span class="line">TOML                         2        87       12        32       43          0</span><br><span class="line">Makefile                     1        41        6        17       18          0</span><br><span class="line">Python                       1       112       27         2       83         25</span><br><span class="line">Shell                        1        35        9         2       24          6</span><br><span class="line">Smarty Template              1        25        3         0       22          5</span><br><span class="line">Systemd                      1        19        2         0       17          0</span><br><span class="line">XML                          1         1        0         0        1          0</span><br><span class="line">gitignore                    1         5        0         2        3          0</span><br><span class="line">───────────────────────────────────────────────────────────────────────────────</span><br><span class="line">Total                      151     22057     3460      2236    16361       3396</span><br><span class="line">───────────────────────────────────────────────────────────────────────────────</span><br><span class="line"></span><br><span class="line">$ scc --by-file .</span><br><span class="line">$ scc --exclude-dir vendor .</span><br></pre></td></tr></table></figure>

<h2 id="setup-tcp-x2F-udp-server-with-nc"><a href="#setup-tcp-x2F-udp-server-with-nc" class="headerlink" title="setup tcp&#x2F;udp server with nc"></a>setup tcp&#x2F;udp server with nc</h2><p>nc is command to <strong>setup tcp(tls)&#x2F;udp server or used as tcp&#x2F;udp client</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># start tcp server</span></span><br><span class="line">$ nc -lv</span><br><span class="line">nc -lv</span><br><span class="line">Ncat: Version 7.50 ( https://nmap.org/ncat )</span><br><span class="line">Ncat: Listening on :::31337</span><br><span class="line">Ncat: Listening on 0.0.0.0:31337</span><br><span class="line"></span><br><span class="line"><span class="comment"># send tcp data with nc</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;hello&quot;</span> | nc localhost 31337</span><br></pre></td></tr></table></figure>

<h2 id="check-virtual-disk-real-size"><a href="#check-virtual-disk-real-size" class="headerlink" title="check virtual disk real size"></a>check virtual disk real size</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  use -s option </span></span><br><span class="line"><span class="comment">#  disk size set 10G, but real size is 133M</span></span><br><span class="line">$ <span class="built_in">ls</span> -slh pod-23vmqfdjge-2021-09-08-21-00-07.raw</span><br><span class="line">133M -rw-r--r-- 1 root root 10G Sep  8 20:51 pod-23vmqfdjge-2021-09-08-21-00-07.raw</span><br></pre></td></tr></table></figure>
<h2 id="timezone-and-ntpdate"><a href="#timezone-and-ntpdate" class="headerlink" title="timezone and ntpdate"></a>timezone and ntpdate</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># show current timezone</span></span><br><span class="line">$ <span class="built_in">ls</span> -al /etc/localtime</span><br><span class="line">lrwxrwxrwx. 1 root root 35 Sep 14 09:33 /etc/localtime -&gt; ../usr/share/zoneinfo/Asia/Shanghai</span><br><span class="line"></span><br><span class="line"><span class="comment"># OR use command line</span></span><br><span class="line">$ timedatectl status</span><br><span class="line">      Local time: Tue 2021-09-14 09:36:45 CST</span><br><span class="line">  Universal time: Tue 2021-09-14 01:36:45 UTC</span><br><span class="line">        RTC time: Tue 2021-09-14 01:36:51</span><br><span class="line">       Time zone: Asia/Shanghai (CST, +0800)</span><br><span class="line">     NTP enabled: <span class="built_in">yes</span></span><br><span class="line">NTP synchronized: no</span><br><span class="line"> RTC <span class="keyword">in</span> <span class="built_in">local</span> TZ: no</span><br><span class="line">      DST active: n/a</span><br><span class="line"></span><br><span class="line"><span class="comment"># show all available zones</span></span><br><span class="line">$ timedatectl list-timezones</span><br><span class="line"></span><br><span class="line"><span class="comment"># set correct zone</span></span><br><span class="line">$ timedatectl set-timezone Asia/Shanghai</span><br><span class="line"></span><br><span class="line"><span class="comment"># ntpdate will update time with ntpserver to the zone you&#x27;re using</span></span><br><span class="line"><span class="comment"># if you set zone incorrect, the time you get may be not expected.</span></span><br><span class="line">$ ntpdate cn.pool.ntp.org</span><br><span class="line">14 Sep 09:34:01 ntpdate[1524]: adjust time server 124.108.20.1 offset 0.028670 sec</span><br><span class="line"></span><br><span class="line"><span class="comment"># without ntp, set time by date directly, note for web GMT(UTC) is returned!!!</span></span><br><span class="line"><span class="comment"># so must with &#x27;Z&#x27; suffix to convert to local time zone</span></span><br><span class="line">$ <span class="built_in">date</span> -s <span class="string">&quot;<span class="subst">$(curl -H&#x27;Cache-Control:no-cache&#x27; -sI baidu.com | grep &#x27;^Date:&#x27; | cut -d&#x27; &#x27; -f3-6)</span>Z&quot;</span></span><br><span class="line"><span class="comment"># use proxychains for net proxy</span></span><br><span class="line">$ <span class="built_in">date</span> -s <span class="string">&quot;<span class="subst">$(proxychains -q curl -H&#x27;Cache-Control:no-cache&#x27; -sI baidu.com | grep &#x27;^Date:&#x27; | cut -d&#x27; &#x27; -f3-6)</span>Z&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># use proxychains for net proxy</span></span><br><span class="line">$ <span class="built_in">date</span> -s <span class="string">&quot;<span class="subst">$(proxychains -q curl -H&#x27;Cache-Control:no-cache&#x27; -sI google.com | grep &#x27;^Date:&#x27; | cut -d&#x27; &#x27; -f3-6)</span>Z&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="ps-aux"><a href="#ps-aux" class="headerlink" title="ps aux"></a>ps aux</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">$ ps -aux</span><br><span class="line">USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line">root         1  0.0  0.0 193888  7052 ?        Ss   08:12   0:01 /usr/lib/systemd/systemd --switched-root --system --deserialize 22</span><br><span class="line">root         2  0.0  0.0      0     0 ?        S    08:12   0:00 [kthreadd]</span><br><span class="line">root         4  0.0  0.0      0     0 ?        S&lt;   08:12   0:00 [kworker/0:0H]</span><br><span class="line">root         6  0.0  0.0      0     0 ?        S    08:12   0:00 [ksoftirqd/0]</span><br><span class="line">root         7  0.0  0.0      0     0 ?        S    08:12   0:00 [migration/0]</span><br><span class="line">root         8  0.0  0.0      0     0 ?        S    08:12   0:00 [rcu_bh]</span><br><span class="line">root         9  0.0  0.0      0     0 ?        S    08:12   0:00 [rcu_sched]</span><br><span class="line"></span><br><span class="line"><span class="comment"># state of process can be in below code</span></span><br><span class="line">D 	Uninterruptible <span class="built_in">sleep</span> (usually IO), <span class="keyword">in</span> kerenl space, can not wake up by signal!!</span><br><span class="line">R 	Running or runnable (on run queue)</span><br><span class="line">S 	Interruptible <span class="built_in">sleep</span> (waiting <span class="keyword">for</span> an event to complete)</span><br><span class="line">T 	Stopped, either by a job control signal(<span class="built_in">kill</span> -STOP <span class="variable">$pid</span>) or because it is being traced.</span><br><span class="line">Z 	Defunct (<span class="string">&quot;zombie&quot;</span>) process, terminated but not reaped by its parent. When a process finishes its task, it `releases the system resources it was using and cleans up its memory`. However,` its entry from the process table is not removed`, and its status is <span class="built_in">set</span> as EXIT_ZOMBIE.</span><br><span class="line"></span><br><span class="line">For BSD formats and when the <span class="built_in">stat</span> keyword is used, additional</span><br><span class="line">characters may be displayed:</span><br><span class="line">&lt;    high-priority (not <span class="built_in">nice</span> to other <span class="built_in">users</span>)</span><br><span class="line">N    low-priority (<span class="built_in">nice</span> to other <span class="built_in">users</span>)</span><br><span class="line">L    has pages locked into memory (<span class="keyword">for</span> real-time and custom IO), never swaped the memory out to disk!!!</span><br><span class="line">s    is a session leader</span><br><span class="line">l    is multi-threaded (using CLONE_THREAD, like NPTL pthreads <span class="keyword">do</span>)</span><br><span class="line">+    is <span class="keyword">in</span> the foreground process group</span><br><span class="line"></span><br><span class="line"><span class="comment"># show more info(backtrace) about D process</span></span><br><span class="line">$ <span class="built_in">echo</span> w &gt; /proc/sysrq-trigger</span><br><span class="line">This <span class="built_in">command</span> produces a report and a list of all processes <span class="keyword">in</span> D state and a full kernel stack trace to /var/log/messages</span><br><span class="line">$ grep <span class="string">&#x27;state:D stack&#x27;</span> /var/log/messages</span><br><span class="line"></span><br><span class="line"><span class="comment"># show all processes id in D state</span></span><br><span class="line">$ ps axl | awk <span class="string">&#x27;$10 ~ /D/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># show all processes in Zombine state</span></span><br><span class="line">$ ps axl | awk <span class="string">&#x27;$10 ~ /Z/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># show pstree of given process, show tree from 1 to its child with args</span></span><br><span class="line"></span><br><span class="line">$ pstree -ansp 63044</span><br><span class="line">systemd,1 --switched-root --system --deserialize 21</span><br><span class="line">  └─docker-containe,62978 c946e9c0e6845d4496d808c317d20a54086203932d940b103f9705322f4e9308 /var/run/docker/libcontainerd/c946e9c0e6845d4496d808c317d20a54086203932d940b103f9705322f4e9308 /usr/libexec/docker/docker-runc-current</span><br><span class="line">      └─(entry.sh,63044)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># pstree -ansp 115764, as you can seee under docker-containe,115764, there are many &#123;docker-containe&#125;,$id which is thread of &#123;docker.containe&#125; process!!!</span></span><br><span class="line">systemd,1 --switched-root --system --deserialize 21</span><br><span class="line">  └─docker-containe,115764 c946e9c0e6845d4496d808c317d20a54086203932d940b103f9705322f4e9308 /var/run/docker/libcontainerd/c946e9c0e6845d4496d808c317d20a54086203932d940b103f9705322f4e9308 /usr/libexec/docker/docker-runc-current</span><br><span class="line">      ├─&#123;docker-containe&#125;,115765</span><br><span class="line">      ├─&#123;docker-containe&#125;,115766</span><br><span class="line">      ├─&#123;docker-containe&#125;,115767</span><br><span class="line">      ├─&#123;docker-containe&#125;,115768</span><br><span class="line">      ├─&#123;docker-containe&#125;,115770</span><br><span class="line">      ├─&#123;docker-containe&#125;,115771</span><br><span class="line">      ├─&#123;docker-containe&#125;,115772</span><br><span class="line">      ├─&#123;docker-containe&#125;,115774</span><br><span class="line">      ├─&#123;docker-containe&#125;,115775</span><br><span class="line">      └─(<span class="built_in">tail</span>,116336)</span><br><span class="line"></span><br><span class="line"><span class="comment"># clear process in D state</span></span><br><span class="line">Reboot, Reboot!</span><br><span class="line"></span><br><span class="line"><span class="comment"># clear process in Z(zombine) state</span></span><br><span class="line">We can’t really <span class="built_in">kill</span> a zombie process since it’s already dead. However, there are a few workarounds we can use to clean up a zombie process</span><br><span class="line">1. Manually send the SIGCHLD signal to the parent of a zombie process, it works only when parent process handles such signal!!! <span class="built_in">kill</span> -s SIGCHLD <span class="variable">$parent_pid</span></span><br><span class="line">2. Kill parent process.</span><br><span class="line"></span><br><span class="line">but <span class="keyword">if</span> the parent process is init(pid 1), so that you can NOT <span class="built_in">kill</span> init</span><br><span class="line">This pretty much leaves you with two options.</span><br><span class="line"></span><br><span class="line">- Manually modify the process table, eg. create a dummy process, <span class="built_in">link</span> the [defunct process] as a child of the dummy, <span class="keyword">then</span> <span class="built_in">kill</span> them off. Quite dangerous, and you may have to manually clean up other process resources such as semaphores and file handles.</span><br><span class="line"></span><br><span class="line">- Reboot the system</span><br></pre></td></tr></table></figure>

<h2 id="copy-excludes-some-dir"><a href="#copy-excludes-some-dir" class="headerlink" title="copy excludes some dir"></a>copy excludes some dir</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># copy html dir to dev without sites/video</span></span><br><span class="line"><span class="comment"># The the --exclude path is relative to the source directly. Even if you put full absolute path, it will not work</span></span><br><span class="line"><span class="comment"># -v is for verbose, -a is for archive mode which means you want recursion and want to preserve almost everything</span></span><br><span class="line">$ rsync -av --exclude <span class="string">&#x27;sites/video&#x27;</span> /var/www/html /var/www/dev</span><br></pre></td></tr></table></figure>

<h2 id="show-start-time-of-process"><a href="#show-start-time-of-process" class="headerlink" title="show start time of process"></a>show start time of process</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ ps -eo pid,lstart,cmd</span><br><span class="line"> PID                  STARTED CMD</span><br><span class="line">    1 Mon Jan 24 11:21:04 2022 /usr/lib/systemd/systemd --system --deserialize 15</span><br><span class="line">    2 Mon Jan 24 11:21:04 2022 [kthreadd]</span><br><span class="line">    4 Mon Jan 24 11:21:04 2022 [kworker/0:0H]</span><br><span class="line">    6 Mon Jan 24 11:21:04 2022 [ksoftirqd/0]</span><br><span class="line">    7 Mon Jan 24 11:21:04 2022 [migration/0]</span><br><span class="line">    8 Mon Jan 24 11:21:04 2022 [rcu_bh]</span><br><span class="line">    9 Mon Jan 24 11:21:04 2022 [rcu_sched]</span><br><span class="line">   10 Mon Jan 24 11:21:04 2022 [lru-add-drain]</span><br><span class="line">   11 Mon Jan 24 11:21:04 2022 [watchdog/0]</span><br></pre></td></tr></table></figure>

<h2 id="ls-output-blinking-ls-x2F-proc-x2F-pid-x2F-fd"><a href="#ls-output-blinking-ls-x2F-proc-x2F-pid-x2F-fd" class="headerlink" title="ls output blinking ls &#x2F;proc&#x2F;pid&#x2F;fd"></a>ls output blinking ls &#x2F;proc&#x2F;pid&#x2F;fd</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">ls</span> -al /proc/9358/fd</span><br><span class="line">total 0</span><br><span class="line">dr-x------ 2 root root  0 Jan 28 14:11 .</span><br><span class="line">dr-xr-xr-x 9 root root  0 Jan 28 14:11 ..</span><br><span class="line">lrwx------ 1 root root 64 Jan 28 14:12 0 -&gt; /dev/pts/4</span><br><span class="line">lrwx------ 1 root root 64 Jan 28 14:12 1 -&gt; /dev/pts/4</span><br><span class="line">lrwx------ 1 root root 64 Jan 28 14:11 2 -&gt; /dev/pts/4</span><br><span class="line">lrwx------ 1 root root 64 Jan 28 14:12 3 -&gt; socket:[985807] // inode number</span><br><span class="line"></span><br><span class="line"><span class="comment"># the last line is blinking as, it points to socket not a file on the disk</span></span><br><span class="line"></span><br><span class="line">$ lsof -p 9358</span><br><span class="line">COMMAND  PID USER   FD   TYPE             DEVICE SIZE/OFF     NODE NAME</span><br><span class="line">s       9358 root  cwd    DIR              253,2     4096  2079103 /home/data/tmp</span><br><span class="line">s       9358 root  rtd    DIR              253,0     4096       64 /</span><br><span class="line">s       9358 root  txt    REG              253,2    17240  4216816 /home/data/tmp/s</span><br><span class="line">s       9358 root  mem    REG              253,0  2156592 33841830 /usr/lib64/libc-2.17.so</span><br><span class="line">s       9358 root  mem    REG              253,0   163312 33841791 /usr/lib64/ld-2.17.so</span><br><span class="line">s       9358 root    0u   CHR              136,4      0t0        7 /dev/pts/4</span><br><span class="line">s       9358 root    1u   CHR              136,4      0t0        7 /dev/pts/4</span><br><span class="line">s       9358 root    2u   CHR              136,4      0t0        7 /dev/pts/4</span><br><span class="line">s       9358 root    3u  unix 0xffff8fa41596b740      0t0   985807 /tmp/fd-pass.socket</span><br></pre></td></tr></table></figure>

<h2 id="top-output"><a href="#top-output" class="headerlink" title="top output"></a>top output</h2><p><a target="_blank" rel="noopener" href="https://www.booleanworld.com/guide-linux-top-command/#Filtering_through_processes">Top Example</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">$ top</span><br><span class="line">top - 17:20:52 up  8:15,  6 <span class="built_in">users</span>,  load average: 0.02, 0.03, 0.05</span><br><span class="line">Tasks: 216 total,   1 running, 215 sleeping,   0 stopped,   0 zombie</span><br><span class="line">%Cpu(s):  0.0 us,  0.7 sy,  0.0 ni, 99.3 <span class="built_in">id</span>,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st</span><br><span class="line">KiB Mem :  8172968 total,  3056856 free,  1933172 used,  3182940 buff/cache</span><br><span class="line">KiB Swap:  8257532 total,  8257532 free,        0 used.  5903604 avail Mem </span><br><span class="line"></span><br><span class="line">  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND                                                                                                                                     </span><br><span class="line">    1 root      20   0  191832   4776   2620 S   0.0  0.1   0:07.57 systemd                                                                                                                                     </span><br><span class="line">    2 root      20   0       0      0      0 S   0.0  0.0   0:00.02 kthreadd                                                                                                                                    </span><br><span class="line">    4 root       0 -20       0      0      0 S   0.0  0.0   0:00.00 kworker/0:0H                                                                                                                                </span><br><span class="line">    6 root      20   0       0      0      0 S   0.0  0.0   0:01.06 ksoftirqd/0       </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">us - user cpu time (or) % CPU time spent <span class="keyword">in</span> user space</span><br><span class="line">sy - system cpu time (or) % CPU time spent <span class="keyword">in</span> kernel space</span><br><span class="line">ni - user <span class="built_in">nice</span> cpu time (or) % CPU time spent on low priority processes</span><br><span class="line"><span class="built_in">id</span> - idle cpu time (or) % CPU time spent idle</span><br><span class="line">wa - io <span class="built_in">wait</span> cpu time (or) % CPU time spent <span class="keyword">in</span> <span class="built_in">wait</span> (on disk)</span><br><span class="line">hi - hardware irq (or) % CPU time spent servicing/handling hardware interrupts</span><br><span class="line">si - software irq (or) % CPU time spent servicing/handling software interrupts</span><br><span class="line">st - steal time % CPU time <span class="keyword">in</span> involuntary <span class="built_in">wait</span> by virtual cpu <span class="keyword">while</span> hypervisor is servicing another processor (or) % CPU time stolen from a virtual machine</span><br><span class="line"></span><br><span class="line">NOTE: it is aggregate value, <span class="keyword">if</span> you want to check usage <span class="keyword">for</span> each CPU</span><br><span class="line">press  `top` <span class="keyword">then</span> press 1.</span><br><span class="line"></span><br><span class="line">top - 17:22:32 up  8:17,  6 <span class="built_in">users</span>,  load average: 0.00, 0.02, 0.05</span><br><span class="line">Tasks: 216 total,   1 running, 215 sleeping,   0 stopped,   0 zombie</span><br><span class="line">%Cpu0  :  0.0 us,  0.0 sy,  0.0 ni,100.0 <span class="built_in">id</span>,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st</span><br><span class="line">%Cpu1  :  0.0 us,  0.0 sy,  0.0 ni,100.0 <span class="built_in">id</span>,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st</span><br><span class="line">%Cpu2  :  0.0 us,  0.0 sy,  0.0 ni,100.0 <span class="built_in">id</span>,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st</span><br><span class="line">%Cpu3  :  0.0 us,  0.0 sy,  0.0 ni,100.0 <span class="built_in">id</span>,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st</span><br><span class="line">%Cpu4  :  0.0 us,  0.0 sy,  0.0 ni,100.0 <span class="built_in">id</span>,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st</span><br><span class="line">%Cpu5  :  0.3 us,  0.3 sy,  0.0 ni, 99.0 <span class="built_in">id</span>,  0.0 wa,  0.0 hi,  0.3 si,  0.0 st</span><br><span class="line">%Cpu6  :  0.0 us,  0.0 sy,  0.0 ni,100.0 <span class="built_in">id</span>,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st</span><br><span class="line">%Cpu7  :  0.0 us,  0.0 sy,  0.0 ni,100.0 <span class="built_in">id</span>,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st</span><br><span class="line">KiB Mem :  8172968 total,  3056468 free,  1933540 used,  3182960 buff/cache</span><br><span class="line">KiB Swap:  8257532 total,  8257532 free,        0 used.  5903236 avail Mem </span><br><span class="line"></span><br><span class="line">  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND                                                                                                                                     </span><br><span class="line"> 1856 mongod    20   0 1604016 116512  11132 S   0.3  1.4   2:23.77 mongod                                                                                                                                      </span><br><span class="line"> 2148 root      20   0  164024   6480   4952 S   0.3  0.1   0:15.29 sshd              </span><br><span class="line"></span><br><span class="line">NOTE: By default, the top will refresh the output every 3 seconds.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">TIPS:</span><br><span class="line">press `c` to show full path</span><br><span class="line">press `o` to filter based on Field.  example(support partial match): COMMAND=libvirt</span><br><span class="line">press `=` to clear filter</span><br><span class="line">press `e` to switch memory unit(kb, mb,gb,tb) <span class="keyword">for</span> mem colums by default is kb</span><br><span class="line"></span><br><span class="line"><span class="comment"># sort by CPU or memory</span></span><br><span class="line">$ top -o %CPU</span><br><span class="line">$ top -o %MEM</span><br><span class="line"><span class="comment"># OR</span></span><br><span class="line">$ top</span><br><span class="line"><span class="keyword">then</span> press</span><br><span class="line">P</span><br><span class="line">M (RES not VIRT)</span><br><span class="line"></span><br><span class="line"><span class="comment"># add more fields to see</span></span><br><span class="line">TIP:</span><br><span class="line">1 `press f` to show all fields</span><br><span class="line">2 move cursor to the line</span><br><span class="line">3 `press space` to define this line</span><br><span class="line">4 `press right arrow` to select it <span class="keyword">then</span> move the field to righ position</span><br></pre></td></tr></table></figure>

<h2 id="create-iso-file-from-command-line"><a href="#create-iso-file-from-command-line" class="headerlink" title="create iso file from command line"></a>create iso file from command line</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mkisofs -o test.iso <span class="variable">$dir</span></span><br></pre></td></tr></table></figure>

<h2 id="setup-proxy-server"><a href="#setup-proxy-server" class="headerlink" title="setup proxy server"></a>setup proxy server</h2><p><a target="_blank" rel="noopener" href="https://phoenixnap.com/kb/install-squid-proxy-server-centos">squid proxy</a></p>
<h2 id="swap"><a href="#swap" class="headerlink" title="swap"></a>swap</h2><p>change swap size by map it to a swap file <a target="_blank" rel="noopener" href="https://linuxize.com/post/create-a-linux-swap-file/">setup swap file</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># check current swap size</span></span><br><span class="line"><span class="variable">$free</span> -h</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:            31G        5.5G         25G        8.7M        870M         25G</span><br><span class="line">Swap:           31G          0B         31G</span><br><span class="line"></span><br><span class="line"><span class="variable">$swapon</span> -v</span><br><span class="line">NAME      TYPE      SIZE USED PRIO</span><br><span class="line">/dev/dm-1 partition  32G   0B   -2</span><br><span class="line"></span><br><span class="line"><span class="comment"># check trend that swap is used from global, each cgroup can change it within that group</span></span><br><span class="line"><span class="variable">$cat</span> /proc/sys/vm/swappiness</span><br><span class="line"></span><br><span class="line"><span class="comment"># temporary disable/enable swap</span></span><br><span class="line"><span class="variable">$swapon</span> -a</span><br><span class="line"><span class="comment"># when swap is off, all data in swap(disk) will be swap in to memory!!! if not enough memory is avaiable, swapoff will fail with &#x27;can </span></span><br><span class="line"><span class="variable">$swapoff</span> -a</span><br></pre></td></tr></table></figure>

<h2 id="set-process-prority"><a href="#set-process-prority" class="headerlink" title="set process prority"></a>set process prority</h2><p>Priority value(PRI) — The priority value is the<code> process’s actual priority which is used by the Linux kernel</code> to schedule a task.<br>In Linux system priorities are<code> 0 to 139 in which 0 to 99 for real-time and 100 to 139 for users</code>.</p>
<p>Nice value(NI) — Nice values are <code>user-space values that we can use to control the priority of a process</code>. The nice value range is <code>-20 to +19</code> where -20 is highest, 0 default and +19 is lowest.</p>
<p><strong>The relation between nice value and priority is as such</strong><br><code>Priority_value = Nice_value + 20</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nice value(NI) can be range -20(highest) to 19(lowest)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># start process with nice value, threads will inherited parent&#x27;s nice value</span></span><br><span class="line">$ <span class="built_in">nice</span> -5 ./app arg1</span><br><span class="line"></span><br><span class="line"><span class="comment"># change nice value after process starts(only change 1055, not it&#x27;s children)</span></span><br><span class="line">$ renice -n -10  -p 1055</span><br><span class="line"><span class="comment"># renice process which has multi-threads</span></span><br><span class="line">$ renice -n -10 -p `ps --no-heading -Lo tid 1055`</span><br></pre></td></tr></table></figure>

<h2 id="split-large-file-into-smaller-ones"><a href="#split-large-file-into-smaller-ones" class="headerlink" title="split large file into smaller ones"></a>split large file into smaller ones</h2><p>Some website does not allow to upload larger file, split it into smaller ones.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># -d use digital sufffix</span></span><br><span class="line"><span class="comment"># -a one digital</span></span><br><span class="line"><span class="comment"># centos. as prefix</span></span><br><span class="line">$ <span class="built_in">split</span> -b 1G CentOS-7-x86_64-GenericCloud.qcow2 -d -a 1 centos.</span><br><span class="line">centos.0  centos.1</span><br><span class="line"></span><br><span class="line"><span class="comment"># combine them to orignal one</span></span><br><span class="line"><span class="comment"># <span class="doctag">NOTE:</span> not &gt;&gt;</span></span><br><span class="line">$ <span class="built_in">cat</span> centos.* &gt; CentOS-7-x86_64-GenericCloud.qcow2</span><br></pre></td></tr></table></figure>

<h2 id="setup-ftp-server-centos"><a href="#setup-ftp-server-centos" class="headerlink" title="setup ftp server (centos)"></a>setup ftp server (centos)</h2><p>The difference for modes is who is the initialator for data connection, <code>for active mode, server always use 20 as the source port.</code></p>
<p><img src="https://ipcisco.com/wp-content/uploads/2021/01/ftp-active-mode-ipcisco.jpg" alt="ftp active mode"></p>
<hr>
<p>In passive mode, the client uses the control connection to send a PASV command to the server and then receives a server IP address and server port number from the server, which the client then uses to open a data connection from an arbitrary client port to the server IP address and server port number received. </p>
<p><img src="https://ipcisco.com/wp-content/uploads/2021/01/ftp-passive-mode-ipcisco.jpg" alt="ftp passive mode"></p>
<p><strong>vsftpd</strong></p>
<p>By default, vsftpd allows local users to login in and switch to its $HOME</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ yum install vsftpd</span><br><span class="line">$ service vsftpd start</span><br><span class="line"></span><br><span class="line"><span class="comment"># edit /etc/vsftpd/vsftpd.conf</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Use virtual HOME for local user not $HOME/$USER</span></span><br><span class="line"><span class="comment"># https://www.ryadel.com/en/vsftpd-configure-different-home-folder-each-user-specific-directory/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># test it</span></span><br><span class="line"></span><br><span class="line">$ yum install -y ftp</span><br><span class="line"><span class="comment"># standard port 21 for ftp</span></span><br><span class="line">$ ftp localhost</span><br><span class="line"></span><br><span class="line"><span class="comment"># open on different port</span></span><br><span class="line">$ ftp</span><br><span class="line">ftp&gt;open localhost 6621</span><br></pre></td></tr></table></figure>

<p><img src="https://images.prismic.io/exavault-website/be48decc-2108-4c33-b6f6-ab8bdffb2b6b_essential-ftp-commands.png?auto=compress,format"></p>
<h2 id="ps-command-advanced"><a href="#ps-command-advanced" class="headerlink" title="ps command advanced"></a>ps command advanced</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># fields of aux</span></span><br><span class="line">USER        PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line"></span><br><span class="line"><span class="comment"># show top 5 cpu usage processes</span></span><br><span class="line">$ ps aux --<span class="built_in">sort</span> -%cpu| <span class="built_in">head</span> -n 6</span><br><span class="line">USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line">openvsw+  1353  0.6  0.1 1220748 51412 ?       S&lt;Lsl 17:44   0:28 ovs-vswitchd unix:/var/run/openvswitch/db.sock -vconsole:emer -vsyslog:err -vfile:info --mlockall --user openvswitch:openvswitch --no-chdir --log-file=/var/log/openvswitch/ovs-vswitchd.log --pidfile=/var/run/openvswitch/ovs-vswitchd.pid --detach</span><br><span class="line">mysql     2086  0.2  1.1 1980300 389644 ?      Ssl  17:44   0:11 /usr/sbin/mysqld</span><br><span class="line">root         1  0.0  0.0 191528  4520 ?        Ss   17:44   0:01 /usr/lib/systemd/systemd --switched-root --system --deserialize 22</span><br><span class="line">root         2  0.0  0.0      0     0 ?        S    17:44   0:00 [kthreadd]</span><br><span class="line">root         4  0.0  0.0      0     0 ?        S&lt;   17:44   0:00 [kworker/0:0H]</span><br><span class="line"></span><br><span class="line"><span class="comment"># show the first 5 memory usage processes, by default memory unit is KB!!!</span></span><br><span class="line">$ ps aux --<span class="built_in">sort</span> -%mem | <span class="built_in">head</span> -n 6</span><br><span class="line">USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line">mysql     2086  0.2  1.1 1980300 389644 ?      Ssl  17:44   0:11 /usr/sbin/mysqld</span><br><span class="line">root      1796  0.0  0.2 274540 76708 ?        S    17:44   0:02 /home/data/Anaconda3/envs/py3.9/bin/python3.9 /home/data/Anaconda3/envs/py3.9/bin/jupyter-notebook -y --no-browser --allow-root --ip=172.17.0.2 --port=8080 --notebook-dir=/home/data/jupyter</span><br><span class="line">openvsw+  1353  0.6  0.1 1220748 51412 ?       S&lt;Lsl 17:44   0:28 ovs-vswitchd unix:/var/run/openvswitch/db.sock -vconsole:emer -vsyslog:err -vfile:info --mlockall --user openvswitch:openvswitch --no-chdir --log-file=/var/log/openvswitch/ovs-vswitchd.log --pidfile=/var/run/openvswitch/ovs-vswitchd.pid --detach</span><br><span class="line">root      1794  0.0  0.0 574288 17504 ?        Ssl  17:44   0:00 /usr/bin/python2 -Es /usr/sbin/tuned -l -P</span><br><span class="line">polkitd   1060  0.0  0.0 614316 11136 ?        Ssl  17:44   0:00 /usr/lib/polkit-1/polkitd --no-debug</span><br><span class="line"></span><br><span class="line"><span class="comment"># show thread info of given process</span></span><br><span class="line"><span class="comment"># -L Show threads, possibly with LWP and NLWP columns.</span></span><br><span class="line">$ ps -Lf 13430</span><br><span class="line">UID        PID  PPID   LWP  C NLWP STIME TTY      STAT   TIME CMD</span><br><span class="line">root     13430 13429 13430  0   11 Jun20 ?        Ssl    0:32 node --no-warnings /root/.vim/bundle/coc.nvim/build/index.js</span><br><span class="line">root     13430 13429 13431  0   11 Jun20 ?        Ssl    0:00 node --no-warnings /root/.vim/bundle/coc.nvim/build/index.js</span><br><span class="line">root     13430 13429 13432  0   11 Jun20 ?        Ssl    0:00 node --no-warnings /root/.vim/bundle/coc.nvim/build/index.js</span><br><span class="line">root     13430 13429 13433  0   11 Jun20 ?        Ssl    0:00 node --no-warnings /root/.vim/bundle/coc.nvim/build/index.js</span><br><span class="line">root     13430 13429 13434  0   11 Jun20 ?        Ssl    0:00 node --no-warnings /root/.vim/bundle/coc.nvim/build/index.js</span><br><span class="line">root     13430 13429 13435  0   11 Jun20 ?        Ssl    0:00 node --no-warnings /root/.vim/bundle/coc.nvim/build/index.js</span><br><span class="line">root     13430 13429 13436  0   11 Jun20 ?        Ssl    0:00 node --no-warnings /root/.vim/bundle/coc.nvim/build/index.js</span><br><span class="line">root     13430 13429 13479  0   11 Jun20 ?        Ssl    0:00 node --no-warnings /root/.vim/bundle/coc.nvim/build/index.js</span><br><span class="line">root     13430 13429 13480  0   11 Jun20 ?        Ssl    0:00 node --no-warnings /root/.vim/bundle/coc.nvim/build/index.js</span><br><span class="line">root     13430 13429 13481  0   11 Jun20 ?        Ssl    0:00 node --no-warnings /root/.vim/bundle/coc.nvim/build/index.js</span><br><span class="line">root     13430 13429 13482  0   11 Jun20 ?        Ssl    0:00 node --no-warnings /root/.vim/bundle/coc.nvim/build/index.js</span><br><span class="line"></span><br><span class="line"><span class="comment"># show thread name of a process</span></span><br><span class="line">$ ps -L -o tid,pid,<span class="built_in">comm</span> 19562</span><br><span class="line">  PID   TID COMMAND</span><br><span class="line">19562 19562 qemu-kvm</span><br><span class="line">19562 19565 qemu-kvm</span><br><span class="line">19562 19566 qemu-kvm</span><br><span class="line">19562 19567 IO iothread1</span><br><span class="line">19562 19571 CPU 0/KVM</span><br><span class="line">19562 19572 CPU 1/KVM</span><br><span class="line">19562 19574 vnc_worker</span><br><span class="line"></span><br><span class="line"><span class="comment"># show custom output for given process</span></span><br><span class="line">$ ps -eo user,pid,ppid,%cpu,%mem,vsz,rss,pri,ni,start,time,cmd -fp <span class="variable">$pid</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># show custom output and more </span></span><br><span class="line">$ ps -eo user,pid,ppid,%cpu,%mem,vsz,rss,pri,ni,start,time,cmd</span><br><span class="line">USER       PID  PPID %CPU %MEM    VSZ   RSS PRI  NI  STARTED     TIME CMD</span><br><span class="line">root         1     0  0.0  0.0 191528  3216  19   0   Jan 11 00:00:09 /usr/lib/systemd/systemd --switched-root --system --deserialize 22</span><br><span class="line">root         2     0  0.0  0.0      0     0  19   0   Jan 11 00:00:00 [kthreadd]</span><br><span class="line">root         4     2  0.0  0.0      0     0  39 -20   Jan 11 00:00:00 [kworker/0:0H]</span><br><span class="line">root         6     2  0.0  0.0      0     0  19   0   Jan 11 00:00:03 [ksoftirqd/0]</span><br><span class="line">root         7     2  0.0  0.0      0     0 139   -   Jan 11 00:00:00 [migration/0]</span><br><span class="line">root         8     2  0.0  0.0      0     0  19   0   Jan 11 00:00:00 [rcu_bh]</span><br><span class="line"></span><br><span class="line"><span class="comment"># custom fields with sorting</span></span><br><span class="line">$ ps -eo user,pid,ppid,%cpu,%mem,vsz,rss,pri,ni,start,time,cmd --<span class="built_in">sort</span>=%cpu</span><br><span class="line">$ ps -eo user,pid,ppid,%cpu,%mem,vsz,rss,pri,ni,start,time,cmd --<span class="built_in">sort</span>=%mem</span><br><span class="line"></span><br><span class="line"><span class="comment"># The &quot;+&quot; is optional since default direction is increasing numerical or lexicographic order</span></span><br><span class="line">$ ps -eo user,pid,ppid,%cpu,%mem,vsz,rss,pri,ni,start,time,cmd --<span class="built_in">sort</span>=+rss</span><br><span class="line">$ ps -eo user,pid,ppid,%cpu,%mem,vsz,rss,pri,ni,start,time,cmd --<span class="built_in">sort</span>=rss</span><br><span class="line"></span><br><span class="line"><span class="comment"># top five memory usage process</span></span><br><span class="line">$ ps -eo user,pid,ppid,%cpu,%mem,vsz,rss,pri,ni,start,time,cmd --<span class="built_in">sort</span>=-rss | <span class="built_in">head</span> -6</span><br><span class="line"></span><br><span class="line"><span class="comment"># show memory in MB unit(format field 7) only support format one field by numfmt!!</span></span><br><span class="line">$ ps -eo user,pid,ppid,%cpu,%mem,vsz,rss,pri,ni,start,time,cmd --<span class="built_in">sort</span>=-rss  | <span class="built_in">numfmt</span> --header --field 7 --to=iec --from-unit=1024</span><br><span class="line"></span><br><span class="line"><span class="comment"># show rss field value(default unit KB) only</span></span><br><span class="line"><span class="variable">$ps</span> -q 1354 -o rss=</span><br><span class="line">51464</span><br><span class="line"><span class="comment"># show given process only</span></span><br><span class="line">$ ps -fp <span class="variable">$pid</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># there  are two process PID 1 and PID 2 which have no parent!</span></span><br><span class="line"><span class="comment"># all user processes are child of PID 1</span></span><br><span class="line"><span class="comment"># all kernel processes are child of PID 2</span></span><br><span class="line"><span class="comment"># UID         PID   PPID  C STIME TTY          TIME CMD</span></span><br><span class="line"><span class="comment"># root          1      0  0 Mar08 ?        00:00:59 /usr/lib/systemd/systemd --switched-root --system --deserialize 21</span></span><br><span class="line"><span class="comment"># root          2      0  0 Mar08 ?        00:00:02 [kthreadd]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># only show user application process not kernel thread</span></span><br><span class="line">$ ps -ef | awk <span class="string">&#x27;$3!=&quot;2&quot; &#123;print $0&#125;&#x27;</span></span><br><span class="line"><span class="comment"># only show kernel thread</span></span><br><span class="line">$ ps -ef | awk <span class="string">&#x27;$3==&quot;2&quot; &#123;print $0&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="sort-command-advaned"><a href="#sort-command-advaned" class="headerlink" title="sort command advaned"></a>sort command advaned</h2><p>refer to <a target="_blank" rel="noopener" href="https://www.cnblogs.com/51linux/archive/2012/05/23/2515299.html">sort example</a></p>
<h2 id="run-python-service-from-virtual-env"><a href="#run-python-service-from-virtual-env" class="headerlink" title="run python service from virtual env"></a>run python service from virtual env</h2><p>Edit your serivce file like this</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /root/py3.8 is virtual env</span></span><br><span class="line">$ <span class="built_in">cat</span> /etc/systemd/system/test.service</span><br><span class="line">...</span><br><span class="line">ExecStart=/root/py3.8/bin/python /root/me/auto-tools/tool/web.py &amp;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment"># reload service file</span></span><br><span class="line">$ systemctl daemon-reload</span><br><span class="line">$ service <span class="built_in">test</span> restart</span><br></pre></td></tr></table></figure>

<h2 id="encrypt-a-file"><a href="#encrypt-a-file" class="headerlink" title="encrypt a file"></a>encrypt a file</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ yum install -y gnupg</span><br><span class="line"><span class="comment"># prompt to input password for encryption</span></span><br><span class="line">$ gpg  --cipher-algo AES256 -c file</span><br><span class="line">$ gpg -d file.gpg</span><br><span class="line"></span><br><span class="line"><span class="comment"># with output file</span></span><br><span class="line">$ gpg -o encrypt --cipher-algo AES256 -c file</span><br><span class="line">$ gpg -o file -d encrypt</span><br></pre></td></tr></table></figure>

<h2 id="disable-cpu-without-reboot-system"><a href="#disable-cpu-without-reboot-system" class="headerlink" title="disable cpu without reboot system"></a>disable cpu without reboot system</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###########One way############################</span></span><br><span class="line">$ chcpu -d 1-10</span><br><span class="line">$ chcpu -d 1</span><br><span class="line">$ chcpu -e 1</span><br><span class="line"></span><br><span class="line"><span class="comment">###########One way############################</span></span><br><span class="line">$ <span class="built_in">echo</span> 0 &gt; /sys/devices/system/cpu/cpu1/online</span><br><span class="line">$ <span class="built_in">echo</span> 1 &gt; /sys/devices/system/cpu/cpu1/online</span><br><span class="line"></span><br><span class="line"><span class="comment"># show online processor</span></span><br><span class="line">$ grep processor /proc/cpuinfo</span><br></pre></td></tr></table></figure>

<h2 id="show-hardware-meta"><a href="#show-hardware-meta" class="headerlink" title="show hardware meta"></a>show hardware meta</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">$ lshw</span><br><span class="line">    description: Rack Mount Chassis</span><br><span class="line">    product: PowerEdge R630 (SKU=NotProvided;ModelName=PowerEdge R630)</span><br><span class="line">    vendor: Dell</span><br><span class="line">    serial: 91TYB72</span><br><span class="line">    width: 64 bits</span><br><span class="line">    capabilities: smbios-2.8 dmi-2.8 vsyscall32</span><br><span class="line">    configuration: boot=normal chassis=rackmount sku=SKU=NotProvided;ModelName=PowerEdge R630 uuid=44454C4C-3100-1054-8059-B9C04F423732</span><br><span class="line">  *-core</span><br><span class="line">       description: Motherboard</span><br><span class="line">       product: 0CNCJW</span><br><span class="line">       vendor: Dell</span><br><span class="line">       physical <span class="built_in">id</span>: 0</span><br><span class="line">       version: A08</span><br><span class="line">       serial: .91TYB72.CN747515840576.</span><br><span class="line">     *-firmware</span><br><span class="line">          description: BIOS</span><br><span class="line">          vendor: Dell</span><br><span class="line">          physical <span class="built_in">id</span>: 0</span><br><span class="line">          version: 1.3.6</span><br><span class="line">          <span class="built_in">date</span>: 06/03/2015</span><br><span class="line">          size: 64KiB</span><br><span class="line">          capacity: 15MiB</span><br><span class="line">          capabilities: isa pci pnp upgrade shadowing cdboot bootselect edd int13floppytoshiba int13floppy360 int13floppy1200 int13floppy720 int9keyboard int14serial int10video acpi usb biosbootspecification netboot uefi</span><br><span class="line">     *-cpu:0</span><br><span class="line">          description: CPU</span><br><span class="line">          product: Xeon</span><br><span class="line">          vendor: Intel Corp.</span><br><span class="line">          physical <span class="built_in">id</span>: 400</span><br><span class="line">          bus info: cpu@0</span><br><span class="line">          version: Intel(R) Xeon(R) CPU E5-2640 v3 @ 2.60GHz</span><br><span class="line">          slot: CPU1</span><br><span class="line">          size: 2600MHz</span><br><span class="line">          capacity: 4GHz</span><br><span class="line">          width: 64 bits</span><br><span class="line">          clock: 3705MHz</span><br><span class="line">... more</span><br><span class="line"></span><br><span class="line">$ lshw -class disk</span><br><span class="line">  *-disk:0                </span><br><span class="line">       description: SCSI Disk</span><br><span class="line">       product: PERC H730 Mini</span><br><span class="line">       vendor: DELL</span><br><span class="line">       physical <span class="built_in">id</span>: 2.0.0</span><br><span class="line">       bus info: scsi@0:2.0.0</span><br><span class="line">       logical name: /dev/sda</span><br><span class="line">       version: 4.25</span><br><span class="line">       serial: 009bf0a4080e81572100a1d44820844a</span><br><span class="line">       size: 558GiB (599GB)</span><br><span class="line">       capabilities: partitioned partitioned:dos</span><br><span class="line">       configuration: ansiversion=5 logicalsectorsize=512 sectorsize=512 signature=000ddb8f</span><br></pre></td></tr></table></figure>

<h2 id="use-x2F-dev-x2F-urandom"><a href="#use-x2F-dev-x2F-urandom" class="headerlink" title="use &#x2F;dev&#x2F;urandom"></a>use &#x2F;dev&#x2F;urandom</h2><p>It’s a file like device, so you can cat it or copy from it</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 4K of random bytes</span></span><br><span class="line">$ <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/urandom of=~/urandom_test count=4 bs=1024</span><br><span class="line"></span><br><span class="line"><span class="comment"># quit until ctrl + c</span></span><br><span class="line">$ <span class="built_in">cat</span> /dev/urandom &gt; ~/urandom_test2 </span><br><span class="line"></span><br><span class="line"><span class="comment"># 30 lines of random</span></span><br><span class="line">$ <span class="built_in">head</span> -30 /dev/urandom &gt; ~/urandom_test3</span><br><span class="line"></span><br><span class="line"><span class="comment"># 30 bytes of random</span></span><br><span class="line"><span class="built_in">head</span> -c 30 /dev/urandom &gt; random.bytes</span><br></pre></td></tr></table></figure>

<h2 id="no-space-left-on-system"><a href="#no-space-left-on-system" class="headerlink" title="no space left on system"></a>no space left on system</h2><p>There are two possible reasons that may cause this.</p>
<ul>
<li>no enough space</li>
<li>no enough inode</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># disk which disk is full</span></span><br><span class="line">$ <span class="built_in">df</span> -h</span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">devtmpfs        440M     0  440M   0% /dev</span><br><span class="line">tmpfs           464M     0  464M   0% /dev/shm</span><br><span class="line">tmpfs           464M   13M  451M   3% /run</span><br><span class="line">tmpfs           464M     0  464M   0% /sys/fs/cgroup</span><br><span class="line">/dev/vda1       8.0G  1.1G  7.0G  14% /</span><br><span class="line">tmpfs           119M     0  119M   0% /run/user/0</span><br><span class="line"><span class="comment"># inside that disk, check whih dir uses the much space</span></span><br><span class="line">$ <span class="built_in">cd</span> /home/data</span><br><span class="line">$ <span class="built_in">du</span> -h -d 1</span><br><span class="line">7.0G    ./Anaconda3</span><br><span class="line">0       ./jupyter</span><br><span class="line">23G     ./github</span><br><span class="line">3.3G    ./tmp</span><br><span class="line">1.6G    ./onedrive</span><br><span class="line">34G     .</span><br><span class="line"></span><br><span class="line"><span class="comment"># inode</span></span><br><span class="line">$ <span class="built_in">df</span> -i</span><br><span class="line">Filesystem                  Inodes IUsed IFree IUse% Mounted on</span><br><span class="line">devtmpfs                      2.0M   451  2.0M    1% /dev</span><br><span class="line">tmpfs                         2.0M     2  2.0M    1% /dev/shm</span><br><span class="line">tmpfs                         2.0M   721  2.0M    1% /run</span><br><span class="line">tmpfs                         2.0M    16  2.0M    1% /sys/fs/cgroup</span><br><span class="line">/dev/mapper/centos_dev-root    50M  363K   50M    1% /</span><br><span class="line">/dev/mapper/centos_dev-home   150M  580K  150M    1% /home</span><br><span class="line">/dev/mapper/centos_dev-var     25M   90K   25M    1% /var</span><br><span class="line">/dev/sda1                     150K   370  150K    1% /boot</span><br><span class="line">tmpfs                         2.0M   366  2.0M    1% /run/user/0</span><br><span class="line">overlay                        25M   90K   25M    1% /var/lib/docker/overlay2/bec9168000402c04316e112d231a51fa1ba120b7e09c5ab65014b80f3161b6b6/merged</span><br><span class="line"></span><br><span class="line"><span class="comment"># to see inodes used for each subdir</span></span><br><span class="line">$ find . -xdev | <span class="built_in">cut</span> -d <span class="string">&quot;/&quot;</span> -f 2 | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -c | <span class="built_in">sort</span> -n -r | <span class="built_in">head</span> -10</span><br><span class="line">285913 Anaconda3</span><br><span class="line">226484 github</span><br><span class="line">   760 onedrive</span><br><span class="line">    11 tmp</span><br><span class="line">    11 jupyter</span><br></pre></td></tr></table></figure>

<h2 id="systemd-socket-activation"><a href="#systemd-socket-activation" class="headerlink" title="systemd socket activation"></a>systemd socket activation</h2><p><a target="_blank" rel="noopener" href="https://rocketeer.be/articles/deploying-node-js-with-systemd/">how socket activation works</a> and <a target="_blank" rel="noopener" href="http://0pointer.de/blog/projects/socket-activation.html">systemd for developer</a></p>
<h2 id="lsmem-and-free-show-different-total-memory"><a href="#lsmem-and-free-show-different-total-memory" class="headerlink" title="lsmem and free show different total memory"></a>lsmem and free show different <code>total</code> memory</h2><p><code>lsmem</code> lists memory blocks and their state; <code>these reflect physical memory and are counted in units of memory blocks</code>, i.e. 128MiB on your system. To do this, lsmem reads information made available by the kernel in <code>/sys/devices/system/memory</code>. On your system, the kernel tracks 64 memory blocks for a total of 8GiB.</p>
<p><code>free</code> lists memory that’s usable by the system; <strong>“total” is the amount of physical memory, minus memory reserved by the system (for the firmware’s purposes mostly) and the kernel’s executable code</strong>. free reads this information from &#x2F;proc&#x2F;meminfo.</p>
<h2 id="change-PS1-env"><a href="#change-PS1-env" class="headerlink" title="change PS1 env"></a>change PS1 env</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># \u    ---&gt;user</span></span><br><span class="line"><span class="comment"># \h    ---&gt;hostanme</span></span><br><span class="line">[root@A04-R08-I138-44-3G1ZBS2 ~] $ <span class="built_in">echo</span> <span class="variable">$PS1</span></span><br><span class="line">[\u@\h \W]\$</span><br><span class="line"></span><br><span class="line">[root@A04-R08-I138-44-3G1ZBS2 ~] $ <span class="built_in">export</span> PS1=<span class="string">&quot;[\u@node-debug \W]$ &quot;</span></span><br><span class="line">[root@node-debug ~]$</span><br></pre></td></tr></table></figure>


<h2 id="proxy-setting"><a href="#proxy-setting" class="headerlink" title="proxy setting"></a>proxy setting</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># global setting, this works only when application use such environment variable</span></span><br><span class="line">$ <span class="built_in">cat</span> ~/.bashrc</span><br><span class="line"><span class="built_in">export</span> http_proxy=<span class="string">&#x27;http://10.226.198.162:3128&#x27;</span></span><br><span class="line"><span class="built_in">export</span> https_proxy=<span class="string">&#x27;http://10.226.198.162:3128&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># application provides its own way for proxy</span></span><br><span class="line"><span class="comment"># git proxy</span></span><br><span class="line">$ git config --global https.proxy http://127.0.0.1:1080</span><br><span class="line">$ git config --global https.proxy https://127.0.0.1:1080</span><br><span class="line">$ git config --global http.proxy <span class="string">&#x27;socks5://127.0.0.1:1080&#x27;</span></span><br><span class="line">$ git config --global https.proxy <span class="string">&#x27;socks5://127.0.0.1:1080&#x27;</span></span><br><span class="line">$ git config --global --<span class="built_in">unset</span> http.proxy/su</span><br><span class="line">$ git config --global --<span class="built_in">unset</span> https.proxy</span><br><span class="line"></span><br><span class="line"><span class="comment"># npm proxy</span></span><br><span class="line">$ npm config <span class="built_in">set</span> proxy  http://127.0.0.1:1080</span><br><span class="line"></span><br><span class="line"><span class="comment"># docker proxy</span></span><br><span class="line">$ <span class="built_in">mkdir</span> -p /etc/systemd/system/docker.service.d</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">touch</span>  /etc/systemd/system/docker.service.d/http-proxy.conf</span><br><span class="line">[Service]</span><br><span class="line">Environment=<span class="string">&quot;HTTP_PROXY=http://user01:password@10.10.10.10:8080/&quot;</span></span><br><span class="line">Environment=<span class="string">&quot;HTTPS_PROXY=https://user01:password@10.10.10.10:8080/&quot;</span></span><br><span class="line">Environment=<span class="string">&quot;NO_PROXY= hostname.example.com,172.10.10.10&quot;</span></span><br><span class="line"></span><br><span class="line">$ systemctl show docker --property Environment</span><br><span class="line"></span><br><span class="line"><span class="comment"># go proxy</span></span><br><span class="line">$ go <span class="built_in">env</span></span><br><span class="line">GOPROXY=<span class="string">&quot;https://goproxy.io,direct&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># yum proxy</span></span><br><span class="line">$ <span class="built_in">cat</span> /etc/yum.conf</span><br><span class="line">[main]</span><br><span class="line">proxy=http://192.226.198.162:3128</span><br><span class="line"></span><br><span class="line"><span class="comment"># pip proxy or set global HTTP_PROXY</span></span><br><span class="line">$ pip install --proxy http://user:password@proxyserver:port TwitterApi</span><br><span class="line"></span><br><span class="line"><span class="comment"># proxychains to force any application to use proxy</span></span><br><span class="line"><span class="comment"># <span class="doctag">NOTE:</span> it supports TCP only (no UDP/ICMP etc).</span></span><br><span class="line">$ yum install proxychains-ng</span><br><span class="line">$ <span class="built_in">cat</span> /etc/proxychains.conf</span><br><span class="line">strict_chain</span><br><span class="line">proxy_dns</span><br><span class="line">remote_dns_subnet 224</span><br><span class="line">tcp_read_time_out 15000</span><br><span class="line">tcp_connect_time_out 8000</span><br><span class="line">[ProxyList]</span><br><span class="line">http 192.226.136.231 3128</span><br><span class="line"><span class="comment"># then run app this way</span></span><br><span class="line">$ proxychains pip install ipvsd</span><br></pre></td></tr></table></figure>

<h2 id="process-limits"><a href="#process-limits" class="headerlink" title="process limits"></a>process limits</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># global setting(default for process, but can be reset by process)</span></span><br><span class="line">$ <span class="built_in">ulimit</span> -a</span><br><span class="line">core file size          (blocks, -c) 0</span><br><span class="line">data seg size           (kbytes, -d) unlimited</span><br><span class="line">scheduling priority             (-e) 0</span><br><span class="line">file size               (blocks, -f) unlimited</span><br><span class="line">pending signals                 (-i) 1030598</span><br><span class="line">max locked memory       (kbytes, -l) 64</span><br><span class="line">max memory size         (kbytes, -m) unlimited</span><br><span class="line">open files                      (-n) 102400</span><br><span class="line">pipe size            (512 bytes, -p) 8</span><br><span class="line">POSIX message queues     (bytes, -q) 819200</span><br><span class="line">real-time priority              (-r) 0</span><br><span class="line">stack size              (kbytes, -s) 10240</span><br><span class="line">cpu time               (seconds, -t) unlimited</span><br><span class="line">max user processes              (-u) 307200</span><br><span class="line">virtual memory          (kbytes, -v) unlimited</span><br><span class="line">file locks                      (-x) unlimited</span><br><span class="line"></span><br><span class="line"><span class="comment"># real limits of each process</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> /proc/116446/limits</span><br><span class="line">Limit                     Soft Limit           Hard Limit           Units     </span><br><span class="line">Max cpu time              unlimited            unlimited            seconds   </span><br><span class="line">Max file size             unlimited            unlimited            bytes     </span><br><span class="line">Max data size             unlimited            unlimited            bytes     </span><br><span class="line">Max stack size            10485760             20971520             bytes     </span><br><span class="line">Max core file size        0                    unlimited            bytes     </span><br><span class="line">Max resident <span class="built_in">set</span>          unlimited            unlimited            bytes     </span><br><span class="line">Max processes             307200               307200               processes </span><br><span class="line">Max open files            204800               204800               files     </span><br><span class="line">Max locked memory         65536                65536                bytes     </span><br><span class="line">Max address space         unlimited            unlimited            bytes     </span><br><span class="line">Max file locks            unlimited            unlimited            locks     </span><br><span class="line">Max pending signals       1030598              1030598              signals   </span><br><span class="line">Max msgqueue size         819200               819200               bytes     </span><br><span class="line">Max <span class="built_in">nice</span> priority         0                    0                    </span><br><span class="line">Max realtime priority     0                    0                    </span><br><span class="line">Max realtime <span class="built_in">timeout</span>      unlimited            unlimited            us      </span><br></pre></td></tr></table></figure>

<h2 id="random-lines"><a href="#random-lines" class="headerlink" title="random lines"></a>random lines</h2><p>use <code>shuf</code> to write a random permutation of the input lines to standard output.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># standoutput</span></span><br><span class="line">$ <span class="built_in">shuf</span> new.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># file as output</span></span><br><span class="line">$ <span class="built_in">shuf</span> new.txt -o random.txt</span><br></pre></td></tr></table></figure>

<h2 id="pgrep-vs-pidof"><a href="#pgrep-vs-pidof" class="headerlink" title="pgrep vs pidof"></a>pgrep vs pidof</h2><p>The programs pgrep and pidof are not quite the same thing, but they are very similar. For example:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ pidof <span class="string">&#x27;firefox&#x27;</span></span><br><span class="line">5696</span><br><span class="line">$ pgrep <span class="string">&#x27;[i]ref&#x27;</span></span><br><span class="line">5696</span><br><span class="line">$ pidof <span class="string">&#x27;[i]ref&#x27;</span></span><br><span class="line">$ <span class="built_in">printf</span> <span class="string">&#x27;%s\n&#x27;</span> <span class="string">&quot;$?&quot;</span></span><br><span class="line">1</span><br><span class="line"></span><br><span class="line"><span class="comment"># get children process(not thread) of given pid</span></span><br><span class="line">$ pgrep -P 1824</span><br><span class="line">1825</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># it shows process and threads as well</span></span><br><span class="line"><span class="comment"># 1694, 1695 are threads not process</span></span><br><span class="line">$ pstree -p 1824</span><br><span class="line">dnsmasq(1824)───dnsmasq(1825)</span><br></pre></td></tr></table></figure>
<p>As you can see, pidof failed to find a match for [i]ref. This is because <code>pidof program returns a list of all process IDs associated with a program called program</code>. On the other hand, <code>pgrep re returns a list of all process IDs associated with a program whose name matches the regular expression re.</code></p>
<p>In their most basic forms, the equivalence is actually: <code>$ pidof &#39;program&#39;</code> &#x3D;&#x3D; <code>$ pgrep &#39;^program$&#39;</code></p>
<h2 id="remove-cgroup-from-x2F-sys-x2F-fs"><a href="#remove-cgroup-from-x2F-sys-x2F-fs" class="headerlink" title="remove cgroup from &#x2F;sys&#x2F;fs"></a>remove cgroup from &#x2F;sys&#x2F;fs</h2><p>First you have to move all processes from this cgroup, then delete it, otherwise it, error shows <code>cgroups can&#39;t be cleaned up: Device or resource busy</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># use cpu cgroup as an example</span></span><br><span class="line">$ <span class="built_in">cat</span> /sys/fs/cgroup/cpu/test/cgroup.procs</span><br><span class="line">8666</span><br><span class="line"><span class="comment"># move 8666 to root group, also moved it from test group</span></span><br><span class="line">$ <span class="built_in">echo</span> 8666 &gt;/sys/fs/cgroup/cpu/cgroup.procs</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> /sys/fs/cgroup/cpu/test/cgroup.procs</span><br><span class="line">$ <span class="built_in">rmdir</span> /sys/fs/cgroup/cpu/test</span><br></pre></td></tr></table></figure>

<h2 id="find-all-shell-scripts"><a href="#find-all-shell-scripts" class="headerlink" title="find all shell scripts"></a>find all shell scripts</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ find /xyz | xargs file | grep shell</span><br><span class="line">./david/query-docker.sh:                                                                                                Bourne-Again shell script, ASCII text executable</span><br><span class="line">./david/db/import-db.sh:                                                                                                POSIX shell script, ASCII text executable, with very long lines</span><br><span class="line"></span><br><span class="line">$ find /xyz | xargs file | grep shell | <span class="built_in">cut</span> -d <span class="string">&quot;:&quot;</span> -f1</span><br><span class="line">./david/query-docker.sh</span><br><span class="line">./david/db/import-db.sh</span><br></pre></td></tr></table></figure>

<h2 id="add-time-out-for-any-shell-command"><a href="#add-time-out-for-any-shell-command" class="headerlink" title="add time out for any shell command"></a>add time out for any shell command</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">timeout</span> 5s ping www.sd</span><br><span class="line"></span><br><span class="line"><span class="comment"># capture output of command</span></span><br><span class="line">$ RET=$(<span class="built_in">timeout</span> 5s <span class="built_in">ls</span> asd 2&gt;&amp;1)</span><br><span class="line">$ <span class="built_in">echo</span> <span class="variable">$RET</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># sometimes it will hang when capture command output, to solve this add &#x27;--foreground&#x27; option</span></span><br><span class="line">$ RET=$(<span class="built_in">timeout</span> --foreground 5s <span class="variable">$CMD</span> 2&gt;&amp;1)</span><br><span class="line">$ <span class="built_in">echo</span> <span class="variable">$RET</span></span><br></pre></td></tr></table></figure>
<h2 id="which-numa-memory-by-a-process"><a href="#which-numa-memory-by-a-process" class="headerlink" title="which numa memory by a process"></a>which numa memory by a process</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># list all memory used by a process</span></span><br><span class="line"><span class="comment"># numa bind policy for huage page, default policy for others</span></span><br><span class="line">$ <span class="built_in">cat</span> /proc/82389/numa_maps</span><br><span class="line">7f069ab9a000 default file=/usr/lib64/ld-2.17.so anon=1 dirty=1 N0=1 kernelpagesize_kB=4</span><br><span class="line">7f0588000000 <span class="built_in">bind</span>:0-1 file=/mnt/huge_2MB/libvirt/qemu/141-i-f2w3m8owht/qemu_back_mem._objects_ram-node0.2IyOfZ\040(deleted) huge dirty=2048 mapmax=4 N0=2048 kernelpagesize_kB=2048</span><br><span class="line"><span class="comment"># the first column is memory address</span></span><br><span class="line"><span class="comment"># the second column is numa node used by this memory</span></span><br><span class="line"><span class="comment">#   default means all numa nodes</span></span><br><span class="line"><span class="comment">#   bind:0-1 means only numa node 0 and node 1 are allowed for this memory, but we may only used one node.</span></span><br><span class="line"><span class="comment"># the third column is file related</span></span><br><span class="line"><span class="comment"># the last column is kernel page for this memory</span></span><br><span class="line"><span class="comment"># the one before last colum is the page count of this memory on each node</span></span><br><span class="line"><span class="comment"># N0=2048 means allocate 2048*kernelpagesize_kB on node 0 </span></span><br><span class="line"></span><br><span class="line">$ numastat -p 82389</span><br><span class="line">Per-node process memory usage (<span class="keyword">in</span> MBs) <span class="keyword">for</span> PID 82389 (qemu-kvm)</span><br><span class="line">                           Node 0          Node 1           Total</span><br><span class="line">                  --------------- --------------- ---------------</span><br><span class="line">Huge                      4096.00            0.00         4096.00</span><br><span class="line">Heap                        65.16            0.00           65.16</span><br><span class="line">Stack                        0.03            0.00            0.04</span><br><span class="line">Private                     32.34            1.21           33.55</span><br><span class="line">----------------  --------------- --------------- ---------------</span><br><span class="line">Total                     4193.53            1.21         4194.74</span><br><span class="line"></span><br><span class="line"><span class="comment"># total numa stat</span></span><br><span class="line">$ numastat </span><br><span class="line">                           node0           node1</span><br><span class="line">numa_hit            271446988685    306962573062</span><br><span class="line">numa_miss                 144931     15014353674</span><br><span class="line">numa_foreign         15014353674          144931</span><br><span class="line">interleave_hit             35352           35604</span><br><span class="line">local_node          271445218315    306961782987</span><br><span class="line">other_node               1915301     15015143749</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># huage page on two numa nodes</span></span><br><span class="line"><span class="variable">$numastat</span> -p 1144</span><br><span class="line">Per-node process memory usage (<span class="keyword">in</span> MBs) <span class="keyword">for</span> PID 1144 (qemu-kvm)</span><br><span class="line">                           Node 0          Node 1           Total</span><br><span class="line">                  --------------- --------------- ---------------</span><br><span class="line">Huge                      1752.00         6440.00         8192.00</span><br><span class="line">Heap                         1.04           44.79           45.82</span><br><span class="line">Stack                        0.00            0.04            0.04</span><br><span class="line">Private                     16.66           11.42           28.08</span><br><span class="line">----------------  --------------- --------------- ---------------</span><br><span class="line">Total                     1769.70         6496.25         8265.95</span><br><span class="line"></span><br><span class="line"><span class="comment"># as you can see N0(node 0) 876*2M and N1(node 1) 3220*2M</span></span><br><span class="line"><span class="comment"># numa bind policy</span></span><br><span class="line">$ <span class="built_in">cat</span> /proc/1144/numa_maps | grep 2048</span><br><span class="line">7fbd58000000 <span class="built_in">bind</span>:0-1 file=/mnt/huge_2MB/libvirt/qemu/38-i-y4s8f9zg2o/qemu_back_mem._objects_ram-node0.dlp9WP\040(deleted) huge dirty=4096 mapmax=4 N0=876 N1=3220 kernelpagesize_kB=2048</span><br><span class="line"></span><br><span class="line"><span class="comment"># numa prefer policy for huge page</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># prefre node 1 but huage page is allocated at node0(N0) 12G and node1(N1) 20G</span></span><br><span class="line">$ <span class="built_in">cat</span> /proc/140662/numa_maps | grep 1G</span><br><span class="line">7f5480000000 prefer:1 file=/mnt/huge_1GB/qemu_back_mem._objects_ram-node0.8Jxnog\040(deleted) huge anon=32 dirty=32 N0=12 N1=20 kernelpagesize_kB=1048576</span><br></pre></td></tr></table></figure>

<h2 id="check-initrd-img"><a href="#check-initrd-img" class="headerlink" title="check initrd.img"></a>check initrd.img</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># list content of initrd</span></span><br><span class="line">$ lsinitrd build/initrd.img</span><br><span class="line">mage: build/nc-initrd.img: 31M</span><br><span class="line">========================================================================</span><br><span class="line">Version: </span><br><span class="line"></span><br><span class="line">Arguments: </span><br><span class="line">dracut modules:</span><br><span class="line">========================================================================</span><br><span class="line">drwxr-xr-x  11 root     root            0 Mar  8 11:30 .</span><br><span class="line">drwxr-xr-x   2 root     root            0 Mar  8 11:30 bin</span><br><span class="line">lrwxrwxrwx   1 root     root           13 Mar  8 11:30 bin/hwclock -&gt; /sbin/busybox</span><br><span class="line">lrwxrwxrwx   1 root     root           13 Mar  8 11:30 bin/sh -&gt; /sbin/busybox</span><br><span class="line">lrwxrwxrwx   1 root     root           13 Mar  8 11:30 bin/tar -&gt; /sbin/busybox</span><br><span class="line">drwxr-xr-x   2 root     root            0 Mar  8 11:30 dev</span><br><span class="line">-rwxr-xr-x   1 root     root       568240 Mar  8 11:30 init</span><br><span class="line">drwxr-xr-x   2 root     root            0 Mar  8 11:30 kdump_tools</span><br><span class="line">-rw-r--r--   1 root     root     10162077 Mar  8 11:30 kdump_tools/initramfs-4.14.121-jdcloudkdump.img</span><br><span class="line">-rw-r--r--   1 root     root      4964304 Mar  8 11:30 kdump_tools/vmlinuz-4.14.121-jdcloud</span><br><span class="line">drwxr-xr-x   3 root     root            0 Mar  8 11:30 lib</span><br><span class="line">drwxr-xr-x   2 root     root            0 Mar  8 11:30 lib64</span><br><span class="line">-rwxr-xr-x   1 root     root       163312 Mar  8 11:30 lib64/ld-linux-x86-64.so.2</span><br><span class="line">-rwxr-xr-x   1 root     root        13536 Mar  8 11:30 lib64/libfreebl3.so</span><br><span class="line">-rwxr-xr-x   1 root     root       553072 Mar  8 11:30 lib64/libfreeblpriv3.so</span><br><span class="line">-rwxr-xr-x   1 root     root       287312 Mar  8 11:30 lib64/libnspr4.so</span><br><span class="line">-rwxr-xr-x   1 root     root       737664 Mar  8 11:30 lib64/libnss3.so</span><br><span class="line">-rwxr-xr-x   1 root     root       585848 Mar  8 11:30 lib64/libnssckbi.so</span><br><span class="line">-rwxr-xr-x   1 root     root       152576 Mar  8 11:30 lib64/libnssdbm3.so</span><br><span class="line">-rwxr-xr-x   1 root     root       175464 Mar  8 11:30 lib64/libnsspem.so</span><br><span class="line">-rwxr-xr-x   1 root     root        13312 Mar  8 11:30 lib64/libnsssysinit.so</span><br><span class="line">-rwxr-xr-x   1 root     root       229152 Mar  8 11:30 lib64/libnssutil3.so</span><br><span class="line">-rwxr-xr-x   1 root     root        23664 Mar  8 11:30 lib64/libplc4.so</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment"># unpack </span></span><br><span class="line">$ file gunzip initrd.img.gz</span><br><span class="line">initrd.img: gzip compressed data, from Unix, last modified: Wed Mar  8 11:30:10 2023, max compression</span><br><span class="line">$ gunzip initrd.img.gz</span><br><span class="line"></span><br><span class="line">$ cpio -idv &lt; initrd.img</span><br><span class="line">bin/  dev/  init  kdump_tools/  lib/  lib64/ proc/  sbin/  sys/  usr/</span><br></pre></td></tr></table></figure>

<h2 id="Check-if-Hard-Drive-is-SSD-or-HDD-on-Linux"><a href="#Check-if-Hard-Drive-is-SSD-or-HDD-on-Linux" class="headerlink" title="Check if Hard Drive is SSD or HDD on Linux"></a>Check if Hard Drive is SSD or HDD on Linux</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1 for HDD, 0 for SSD</span></span><br><span class="line"><span class="comment">################ way1=======================</span></span><br><span class="line">$ <span class="built_in">cat</span> /sys/block/sda/queue/rotational</span><br><span class="line">1</span><br><span class="line"><span class="comment">################ way2=======================</span></span><br><span class="line">$ lsblk -d -o name,rota</span><br><span class="line">NAME    ROTA</span><br><span class="line">sda        1</span><br><span class="line">...</span><br><span class="line">sdm        0</span><br><span class="line">nvme0n1    0</span><br><span class="line"><span class="comment">################ way3=======================</span></span><br><span class="line">$ smartctl -a /dev/sda | grep <span class="string">&#x27;Rotation Rate&#x27;</span></span><br><span class="line">Rotation Rate:    7200 rpm</span><br><span class="line">$ smartctl -a /dev/sdm | grep <span class="string">&#x27;Rotation Rate&#x27;</span></span><br><span class="line">Rotation Rate:    Solid State Device</span><br></pre></td></tr></table></figure>

<h2 id="disk-related"><a href="#disk-related" class="headerlink" title="disk related"></a>disk related</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># show filesystem, uuid etc for block device</span></span><br><span class="line"><span class="variable">$blkid</span></span><br><span class="line">/dev/sda1: UUID=<span class="string">&quot;5cf26576-d3d1-48d1-aab4-1326cdda3c77&quot;</span> TYPE=<span class="string">&quot;xfs&quot;</span> </span><br><span class="line">/dev/sda2: UUID=<span class="string">&quot;mFfzPH-yRAk-6ASm-6ASF-Nizr-9u3m-25wQgr&quot;</span> TYPE=<span class="string">&quot;LVM2_member&quot;</span> </span><br><span class="line">/dev/mapper/centos_dev-root: UUID=<span class="string">&quot;6b5ed230-86e5-4ab6-9e96-08caf90afca6&quot;</span> TYPE=<span class="string">&quot;xfs&quot;</span> </span><br><span class="line">/dev/mapper/centos_dev-swap: UUID=<span class="string">&quot;638cc56c-e2c9-425a-b13a-0c890082db1b&quot;</span> TYPE=<span class="string">&quot;swap&quot;</span> </span><br><span class="line">/dev/mapper/centos_dev-home: UUID=<span class="string">&quot;cab6c113-6e6d-4d9a-8654-eb304b9100c3&quot;</span> TYPE=<span class="string">&quot;xfs&quot;</span> </span><br><span class="line">/dev/mapper/centos_dev-var: UUID=<span class="string">&quot;7aafa462-85af-4587-a334-beeb477e25f6&quot;</span> TYPE=<span class="string">&quot;xfs&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$lsblk</span> -f</span><br><span class="line">NAME                FSTYPE      LABEL UUID                                   MOUNTPOINT</span><br><span class="line">sda                                                                          </span><br><span class="line">├─sda1              xfs               5cf26576-d3d1-48d1-aab4-1326cdda3c77   /boot</span><br><span class="line">└─sda2              LVM2_member       mFfzPH-yRAk-6ASm-6ASF-Nizr-9u3m-25wQgr </span><br><span class="line">  ├─centos_dev-root xfs               6b5ed230-86e5-4ab6-9e96-08caf90afca6   /</span><br><span class="line">  ├─centos_dev-swap swap              638cc56c-e2c9-425a-b13a-0c890082db1b   [SWAP]</span><br><span class="line">  ├─centos_dev-home xfs               cab6c113-6e6d-4d9a-8654-eb304b9100c3   /home</span><br><span class="line">  └─centos_dev-var  xfs               7aafa462-85af-4587-a334-beeb477e25f6   /var</span><br><span class="line"><span class="variable">$df</span> -Th</span><br><span class="line">Filesystem                  Type      Size  Used Avail Use% Mounted on</span><br><span class="line">devtmpfs                    devtmpfs   16G     0   16G   0% /dev</span><br><span class="line">tmpfs                       tmpfs      16G     0   16G   0% /dev/shm</span><br><span class="line">tmpfs                       tmpfs      16G  888K   16G   1% /run</span><br><span class="line">tmpfs                       tmpfs      16G     0   16G   0% /sys/fs/cgroup</span><br><span class="line">/dev/mapper/centos_dev-root xfs       100G   45G   56G  45% /</span><br><span class="line">/dev/sda1                   xfs       297M  191M  107M  65% /boot</span><br><span class="line">/dev/mapper/centos_dev-var  xfs        50G  9.4G   41G  19% /var</span><br><span class="line">/dev/mapper/centos_dev-home xfs       300G   58G  243G  20% /home</span><br><span class="line">overlay                     overlay    50G  9.4G   41G  19% /var/lib/docker/overlay2/5c1f012f94cc69c18a9fbcc84c5403232f103c6a68b9544ba2284f59ee99e379/merged</span><br><span class="line">tmpfs                       tmpfs     3.2G  876K  3.2G   1% /run/user/0</span><br><span class="line"></span><br><span class="line"><span class="comment"># disk error hence disk mounted as read-only fix it by</span></span><br><span class="line">$ fsck -aC</span><br><span class="line">OR</span><br><span class="line">$ e2fsck -f -y -v /dev/sda1</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">$ reboot</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">df</span> -lh      <span class="comment"># show disk partition</span></span><br><span class="line">$ <span class="built_in">df</span> -ih      <span class="comment"># show inode free/used</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">du</span> -h -d 1 <span class="comment"># show file size</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># format disk with ext2 or ext3 etc</span></span><br><span class="line"><span class="comment"># mkfs.bfs      mkfs.cramfs   mkfs.ext2     mkfs.ext3     mkfs.ext4     mkfs.ext4dev  mkfs.minix    mkfs.msdos    mkfs.ntfs     mkfs.vfat</span></span><br><span class="line"></span><br><span class="line">$ fdisk -l</span><br><span class="line">$ mkfs.minix /dev/sdb1</span><br><span class="line"></span><br><span class="line"><span class="comment"># increase /tmp size by remounting it with a large file</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/usr/temp-disk bs=2M count=1024</span><br><span class="line">$ mkfs.ext3  /usr/temp-disk</span><br><span class="line"></span><br><span class="line"><span class="comment"># add /etc/fstab file with below content</span></span><br><span class="line">/usr/temp-disk /tmp ext3 rw,noexec,nosuid,loop 0 0</span><br></pre></td></tr></table></figure>

<p><strong>UUID vs PARTUUID</strong></p>
<ul>
<li><code>UUID is a filesystem-level UUID</code>, which is retrieved from the filesystem metadata inside the partition. It can only be read if the filesystem type is known and readable.</li>
<li><code>PARTUUID is a partition-table-level UUID for the partition</code>, a standard feature for all partitions on <strong>GPT-partitioned</strong> disks. Since it is retrieved from the partition table, it is accessible without making any assumptions at all about the actual contents of the partition.</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ls</span> /dev/disk/by-uuid/</span><br><span class="line">38db244b-e0b7-45fb-aftg-a168b6fd00fd  433acdf3-70b7-4e93-abcd-04817a6aeae1</span><br><span class="line"><span class="variable">$ls</span> /dev/disk/by-partuuid/</span><br><span class="line">0260d409-b765-4de2-adfd-493e92087395  7d05dd0b-ab8a-48eb-12ad-2ef4e4e8b3af ...</span><br><span class="line"></span><br><span class="line"><span class="comment"># uuid is return if this partition has a filesystem</span></span><br><span class="line"><span class="variable">$blkid</span> /dev/sdm1</span><br><span class="line">/dev/sdm1: UUID=<span class="string">&quot;38db244b-e0b7-34fb-adbd-a168b6fd00fd&quot;</span> TYPE=<span class="string">&quot;xfs&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># partuuid is return if no filesytem on it</span></span><br><span class="line"><span class="variable">$blkid</span> /dev/sdl1</span><br><span class="line">/dev/sdl1: PARTLABEL=<span class="string">&quot;meta&quot;</span> PARTUUID=<span class="string">&quot;87a0bfbf-2374-4be8-93c7-b5d49810ee9b&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="regular-pattern-greedy-vs-lazy-match"><a href="#regular-pattern-greedy-vs-lazy-match" class="headerlink" title="regular pattern greedy vs lazy match"></a>regular pattern greedy vs lazy match</h2><p><code>&#39;Greedy&#39;</code> means match longest possible string. while <code>&#39;Lazy&#39; or non-greedy</code> means match shortest possible string. </p>
<table>
<thead>
<tr>
<th>Greedy quantifier</th>
<th>Lazy quantifier</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>*</td>
<td>*?</td>
<td>Star Quantifier: 0 or more</td>
</tr>
<tr>
<td>+</td>
<td>+?</td>
<td>Plus Quantifier: 1 or more</td>
</tr>
<tr>
<td>?</td>
<td>??</td>
<td>Optional Quantifier: 0 or 1</td>
</tr>
<tr>
<td>{n}</td>
<td>{n}?</td>
<td>Quantifier: exactly n</td>
</tr>
<tr>
<td>{n,}</td>
<td>{n,}?</td>
<td>Quantifier: n or more</td>
</tr>
<tr>
<td>{n,m}</td>
<td>{n,m}?</td>
<td>Quantifier: between n and m</td>
</tr>
</tbody></table>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep with lazy match</span></span><br><span class="line"><span class="comment"># egrep does not support non-greedy matching. Using perl mode -P will help you:</span></span><br><span class="line"><span class="comment"># -o only print the matched part!!!</span></span><br><span class="line"><span class="variable">$grep</span> -o -P  <span class="string">&#x27;https.*?mp3&#x27;</span> example.txt | <span class="built_in">sort</span> | <span class="built_in">uniq</span> </span><br></pre></td></tr></table></figure>
<h2 id="tar-with-progress-bar"><a href="#tar-with-progress-bar" class="headerlink" title="tar with progress bar"></a>tar with progress bar</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$D</span>=<span class="string">&quot;.//dir1 ./file1&quot;</span></span><br><span class="line"><span class="variable">$tar</span> pcf - <span class="variable">$D</span> | pv -s <span class="string">&quot;<span class="subst">$(du -sk --total $D | tail -n1 | cut -f1)</span>k&quot;</span>| gzip &gt; target.tar.gz</span><br></pre></td></tr></table></figure>

<h2 id="control-file-for-sudo"><a href="#control-file-for-sudo" class="headerlink" title="control file for sudo"></a>control file for sudo</h2><p>The <code>/etc/sudoers</code> file is a critical configuration file on Unix-like operating systems, including Linux, that controls the permissions for users to execute commands with superuser (root) privileges using the sudo command. Here are the key aspects of the &#x2F;etc&#x2F;sudoers file:</p>
<ul>
<li>Access Control: The primary function of the &#x2F;etc&#x2F;sudoers file is to <code>define which users or groups can execute specific commands as the root user or another user</code>. This allows for fine-grained control over administrative privileges without giving users full root access.</li>
<li>Defaults and Aliases: The file can also contain <code>default settings and aliases to simplify configuration</code>. Aliases can be defined for users, hosts, commands, and run-as specifications to group multiple entries togethe</li>
</ul>
<p>By default sudo inherits ENV and PATH from users, but it should be reset by &#x2F;etc&#x2F;sudoers to prevent the use of potentially harmful variables and allow only trusted directories are used for command execution, so that user should set <code>Defaults env_reset</code> and <code>Defaults env_reset</code> at <code>/etc/sudoers</code> file</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ sudo <span class="built_in">cat</span> /etc/sudoers</span><br><span class="line">...</span><br><span class="line">Defaults    env_reset                                                           </span><br><span class="line">Defaults    env_keep =  <span class="string">&quot;COLORS DISPLAY HOSTNAME HISTSIZE KDEDIR LS_COLORS&quot;</span>     </span><br><span class="line">Defaults    env_keep += <span class="string">&quot;MAIL PS1 PS2 QTDIR USERNAME LANG LC_ADDRESS LC_CTYPE&quot;</span>  </span><br><span class="line">Defaults    env_keep += <span class="string">&quot;LC_COLLATE LC_IDENTIFICATION LC_MEASUREMENT LC_MESSAGES&quot;</span></span><br><span class="line">Defaults    env_keep += <span class="string">&quot;LC_MONETARY LC_NAME LC_NUMERIC LC_PAPER LC_TELEPHONE&quot;</span>  </span><br><span class="line">Defaults    env_keep += <span class="string">&quot;LC_TIME LC_ALL LANGUAGE LINGUAS _XKB_CHARSET XAUTHORITY&quot;</span></span><br><span class="line"></span><br><span class="line">Defaults	secure_path=<span class="string">&quot;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin&quot;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h2 id="what-does-dmesg-do"><a href="#what-does-dmesg-do" class="headerlink" title="what does dmesg do"></a>what does dmesg do</h2><p><code>dmesg</code> is used to examine or control the kernel ring buffer, <strong>so that after each reboot, it’s fresh!</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ dmesg</span><br><span class="line">[    0.000000] Linux version 4.14.15-1.el7.elrepo.x86_64 (mockbuild@Build64R7) (gcc version 4.8.5 20150623 (Red Hat 4.8.5-16) (GCC)) <span class="comment">#1 SMP Tue Jan 23 20:28:26 EST 2018</span></span><br><span class="line">[    0.000000] Command line: BOOT_IMAGE=/vmlinuz-4.14.15-1.el7.elrepo.x86_64 root=UUID=d94e304b-6b86-4a2b-8016-4029b94f92cc ro crashkernel=auto modprobe.blacklist=mlx5_core,virtio_pci hugepages=800 intel_iommu=on processor.max_cstate=1 idle=poll intel_pstate=<span class="built_in">disable</span> pci=realloc</span><br><span class="line">[    0.000000] x86/fpu: Supporting XSAVE feature 0x001: <span class="string">&#x27;x87 floating point registers&#x27;</span></span><br><span class="line">[    0.000000] x86/fpu: Supporting XSAVE feature 0x002: <span class="string">&#x27;SSE registers&#x27;</span></span><br><span class="line">[    0.000000] x86/fpu: Supporting XSAVE feature 0x004: <span class="string">&#x27;AVX registers&#x27;</span></span><br><span class="line">[    0.000000] x86/fpu: xstate_offset[2]:  576, xstate_sizes[2]:  256</span><br><span class="line">[    0.000000] x86/fpu: Enabled xstate features 0x7, context size is 832 bytes, using <span class="string">&#x27;standard&#x27;</span> format.</span><br><span class="line">[    0.000000] e820: BIOS-provided physical RAM map:</span><br><span class="line">[    0.000000] BIOS-e820: [mem 0x0000000000000000-0x0000000000099bff] usable</span><br><span class="line"></span><br><span class="line"><span class="comment"># show timestamp and color import thing</span></span><br><span class="line">$ dmesg -TL</span><br><span class="line">[Wed Aug 21 19:49:14 2024] Linux version 4.14.15-1.el7.elrepo.x86_64 (mockbuild@Build64R7) (gcc version 4.8.5 20150623 (Red Hat 4.8.5-16) (GCC)) <span class="comment">#1 SMP Tue Jan 23 20:28:26 EST 2018</span></span><br><span class="line">[Wed Aug 21 19:49:14 2024] Command line: BOOT_IMAGE=/vmlinuz-4.14.15-1.el7.elrepo.x86_64 root=UUID=d94e304b-6b86-4a2b-8016-4029b94f92cc ro crashkernel=auto modprobe.blacklist=mlx5_core,virtio_pci hugepages=800 intel_iommu=on processor.max_cstate=1 idle=poll intel_pstate=<span class="built_in">disable</span> pci=realloc</span><br><span class="line">[Wed Aug 21 19:49:14 2024] x86/fpu: Supporting XSAVE feature 0x001: <span class="string">&#x27;x87 floating point registers&#x27;</span></span><br><span class="line">[Wed Aug 21 19:49:14 2024] x86/fpu: Supporting XSAVE feature 0x002: <span class="string">&#x27;SSE registers&#x27;</span></span><br><span class="line">[Wed Aug 21 19:49:14 2024] x86/fpu: Supporting XSAVE feature 0x004: <span class="string">&#x27;AVX registers&#x27;</span></span><br><span class="line">[Wed Aug 21 19:49:14 2024] x86/fpu: xstate_offset[2]:  576, xstate_sizes[2]:  256</span><br><span class="line">[Wed Aug 21 19:49:14 2024] x86/fpu: Enabled xstate features 0x7, context size is 832 bytes, using <span class="string">&#x27;standard&#x27;</span> format.</span><br><span class="line">[Wed Aug 21 19:49:14 2024] e820: BIOS-provided physical RAM map:</span><br><span class="line">[Wed Aug 21 19:49:14 2024] BIOS-e820: [mem 0x0000000000000000-0x0000000000099bff] usable</span><br></pre></td></tr></table></figure>

<h2 id="temporary-select-next-reboot-kernel"><a href="#temporary-select-next-reboot-kernel" class="headerlink" title="temporary select next reboot kernel"></a>temporary select next reboot kernel</h2><p>If you want to temporarily boot a different entry just once, you can use the grub-reboot command before rebooting.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------------- temporary only once ----------------------</span></span><br><span class="line"><span class="comment"># menu index starts from 0</span></span><br><span class="line">$ sudo grub-reboot 2</span><br><span class="line">$ sudo reboot</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1&gt;2: main menu index: 1, submenu index: 2</span></span><br><span class="line">$ sudo grub-reboot <span class="string">&quot;1&gt;2&quot;</span></span><br><span class="line">$ sudo reboot</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ----------------- permanently---------------------</span></span><br><span class="line"><span class="comment"># First, check default boot kernel</span></span><br><span class="line">sudo grubby --default-kernel</span><br><span class="line"></span><br><span class="line"><span class="comment"># Second, list all available boot entries:</span></span><br><span class="line">$ sudo grubby --info=ALL</span><br><span class="line">index=0</span><br><span class="line">kernel=<span class="string">&quot;/boot/vmlinuz-5.4.104.el8.MLX_FWV.x86_64&quot;</span></span><br><span class="line">args=<span class="string">&quot;ro crashkernel=auto resume=UUID=e255e64b-50f8-4c50-8439-d7993bdc022b rhgb quiet <span class="variable">$tuned_params</span>&quot;</span></span><br><span class="line">root=<span class="string">&quot;UUID=ba4a340c-1876-452f-a4c6-3a91f13952c7&quot;</span></span><br><span class="line">initrd=<span class="string">&quot;/boot/initramfs-5.4.104.el8.MLX_FWV.x86_64.img <span class="variable">$tuned_initrd</span>&quot;</span></span><br><span class="line">title=<span class="string">&quot;Red Hat Enterprise Linux (5.4.104.el8.MLX_FWV.x86_64) 8.4 (Ootpa)&quot;</span></span><br><span class="line"><span class="built_in">id</span>=<span class="string">&quot;7e051a8637824e4dbeac5f6c50424baa-5.4.104.el8.MLX_FWV.x86_64&quot;</span></span><br><span class="line">index=1</span><br><span class="line">kernel=<span class="string">&quot;/boot/vmlinuz-4.18.0-305.el8.x86_64&quot;</span></span><br><span class="line">args=<span class="string">&quot;ro crashkernel=auto resume=UUID=e255e64b-50f8-4c50-8439-d7993bdc022b rhgb quiet <span class="variable">$tuned_params</span>&quot;</span></span><br><span class="line">root=<span class="string">&quot;UUID=ba4a340c-1876-452f-a4c6-3a91f13952c7&quot;</span></span><br><span class="line">initrd=<span class="string">&quot;/boot/initramfs-4.18.0-305.el8.x86_64.img <span class="variable">$tuned_initrd</span>&quot;</span></span><br><span class="line">title=<span class="string">&quot;Red Hat Enterprise Linux (4.18.0-305.el8.x86_64) 8.4 (Ootpa)&quot;</span></span><br><span class="line"><span class="built_in">id</span>=<span class="string">&quot;7e051a8637824e4dbeac5f6c50424baa-4.18.0-305.el8.x86_64&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Third, to change the default boot entry</span></span><br><span class="line">$ sudo grubby --set-default-index=1</span><br></pre></td></tr></table></figure>
    </div>

    
    
    
      


    <footer class="post-footer">
          <div class="reward-container">
  <div></div>
  <button>
    Donate
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechatpay.jpeg" alt="Jason WeChat Pay">
        <span>WeChat Pay</span>
      </div>

  </div>
</div>

          <div class="post-tags">
              <a href="/tags/linux/" rel="tag"># linux</a>
              <a href="/tags/command/" rel="tag"># command</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2019/11/25/gdb-commands/" rel="prev" title="gdb-commands">
                  <i class="fa fa-chevron-left"></i> gdb-commands
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2019/11/29/benchmark-tools/" rel="next" title="benchmark-tools">
                  benchmark-tools <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments utterances-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2018 – 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Cyun All rights reserved</span>
</div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.0/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>



  <script src="/js/third-party/fancybox.js"></script>

  <script src="/js/third-party/pace.js"></script>

  




<script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"jason-bj/blog","issue_term":"pathname","theme":"github-light"}</script>
<script src="/js/third-party/comments/utterances.js"></script>

</body>
</html>
