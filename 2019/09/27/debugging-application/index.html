<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon/favicon-16x16.png">
  <meta name="google-site-verification" content="xitt2fbphh1nTeWLiTWc0lCggHuxJ5heMcAzkHW2vno">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Microsoft+YaHei+UI:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"cyun.tech","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.11.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"utterances","storage":true,"lazyload":false,"nav":null,"activeClass":"utterances"},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":10,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="debug applicationHere are list of frequent commands that are used in daily life and some tips that may be useful to debug application">
<meta property="og:type" content="article">
<meta property="og:title" content="debugging application">
<meta property="og:url" content="http://cyun.tech/2019/09/27/debugging-application/index.html">
<meta property="og:site_name" content="CYun">
<meta property="og:description" content="debug applicationHere are list of frequent commands that are used in daily life and some tips that may be useful to debug application">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2019-09-27T05:29:20.000Z">
<meta property="article:modified_time" content="2025-05-12T02:18:31.900Z">
<meta property="article:author" content="Jason">
<meta property="article:tag" content="linux">
<meta property="article:tag" content="linux command">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://cyun.tech/2019/09/27/debugging-application/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://cyun.tech/2019/09/27/debugging-application/","path":"2019/09/27/debugging-application/","title":"debugging application"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>debugging application | CYun</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-148730544-1"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-148730544-1","only_pageview":false}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>

  <script src="/js/third-party/analytics/baidu-analytics.js"></script>
  <script async src="https://hm.baidu.com/hm.js?a510d1f580c8231f8f867d14f42bb8ea"></script>




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">CYun</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#debug-application"><span class="nav-number">1.</span> <span class="nav-text">debug application</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#show-dynamic-library-used-by-an-application"><span class="nav-number">1.1.</span> <span class="nav-text">show dynamic library used by an application</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#create-and-use-a-static-library"><span class="nav-number">1.2.</span> <span class="nav-text">create and use a static library</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#create-and-use-a-dynamic-library"><span class="nav-number">1.3.</span> <span class="nav-text">create and use a dynamic library</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#show-symbols-in-dynamics-and-static-library"><span class="nav-number">1.4.</span> <span class="nav-text">show symbols in dynamics and static library</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#check-process-thread"><span class="nav-number">1.5.</span> <span class="nav-text">check process thread</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#do-everything-in-memory"><span class="nav-number">1.6.</span> <span class="nav-text">do everything in memory</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#debug-dynamic-library-info-when-runs-a-program"><span class="nav-number">1.7.</span> <span class="nav-text">debug dynamic library info when runs a program</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#useful-commands-in-binutils"><span class="nav-number">1.8.</span> <span class="nav-text">useful commands in binutils</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#process-affinity"><span class="nav-number">1.9.</span> <span class="nav-text">process affinity</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#IRQ-affinity-setting"><span class="nav-number">1.10.</span> <span class="nav-text">IRQ affinity setting</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#trace-process-by-strace"><span class="nav-number">1.11.</span> <span class="nav-text">trace process by strace</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#show-shared-memory-on-the-system"><span class="nav-number">1.12.</span> <span class="nav-text">show shared memory on the system</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#only-show-mem-x2F-cpu-usage-of-a-particular-pid"><span class="nav-number">1.13.</span> <span class="nav-text">only show mem&#x2F;cpu usage of a particular pid</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#show-processes-who-opened-a-file-or-dir"><span class="nav-number">1.14.</span> <span class="nav-text">show processes who opened a file or dir</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#force-a-running-process-to-generate-a-core-dump"><span class="nav-number">1.15.</span> <span class="nav-text">force a running process to generate a core dump</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#signal"><span class="nav-number">1.16.</span> <span class="nav-text">signal</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#show-environment-variables-of-a-running-process"><span class="nav-number">1.17.</span> <span class="nav-text">show environment variables of a running process.</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#check-process-name-when-knows-pid"><span class="nav-number">1.18.</span> <span class="nav-text">check process name when knows pid</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#memory-leak-x2F-overflow-tool"><span class="nav-number">1.19.</span> <span class="nav-text">memory leak&#x2F; overflow tool</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#shutdown-vs-close"><span class="nav-number">1.20.</span> <span class="nav-text">shutdown() vs close()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RESET-TCP-from-application"><span class="nav-number">1.21.</span> <span class="nav-text">RESET TCP from application</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#install-debuginfo-of-kernel-or-application-on-centos"><span class="nav-number">1.22.</span> <span class="nav-text">install debuginfo of kernel or application on centos</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#show-stack-for-give-process-thread"><span class="nav-number">1.23.</span> <span class="nav-text">show stack for give process(thread)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pkg-config"><span class="nav-number">1.24.</span> <span class="nav-text">pkg-config</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ld-finding-library"><span class="nav-number">1.25.</span> <span class="nav-text">ld finding library</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#get-hardware-meta"><span class="nav-number">1.26.</span> <span class="nav-text">get hardware meta</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#lspci-output"><span class="nav-number">1.27.</span> <span class="nav-text">lspci output</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#coredump-without-symbol-table"><span class="nav-number">1.28.</span> <span class="nav-text">coredump without symbol table</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#network-related"><span class="nav-number">1.29.</span> <span class="nav-text">network related</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#enable-forwarding-in-kernel"><span class="nav-number">1.29.1.</span> <span class="nav-text">enable forwarding in kernel</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#IP-address-and-Route"><span class="nav-number">1.29.2.</span> <span class="nav-text">IP address and Route</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Deep-into-route-table"><span class="nav-number">1.29.3.</span> <span class="nav-text">Deep into route table</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#prevent-route-missing-after-reboot"><span class="nav-number">1.29.4.</span> <span class="nav-text">prevent route missing after reboot</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#show-arp-entry"><span class="nav-number">1.29.5.</span> <span class="nav-text">show arp entry</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#save-tcpdump-captured-packet-to-file"><span class="nav-number">1.29.6.</span> <span class="nav-text">save tcpdump captured packet to file</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#packet-shows-as-tcp-segment-of-a-reassembled-pdu-in-wireshark"><span class="nav-number">1.29.7.</span> <span class="nav-text">packet shows as tcp segment of a reassembled pdu in wireshark</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#get-two-sides-of-established-STREAM-socket"><span class="nav-number">1.29.8.</span> <span class="nav-text">get two sides of established STREAM socket</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#show-all-sockets"><span class="nav-number">1.29.9.</span> <span class="nav-text">show all sockets</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#check-x2F-set-mtu-or-MAC"><span class="nav-number">1.29.10.</span> <span class="nav-text">check&#x2F;set mtu or MAC</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#socket-bind-to-no-local-address"><span class="nav-number">1.29.11.</span> <span class="nav-text">socket bind to no-local address</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#source-port-selection"><span class="nav-number">1.29.12.</span> <span class="nav-text">source port selection</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#create-vlan-interface-and-check-its-real-dev"><span class="nav-number">1.29.13.</span> <span class="nav-text">create vlan interface and check its real dev</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#check-tcp-fastopen-cookie"><span class="nav-number">1.29.14.</span> <span class="nav-text">check tcp fastopen cookie</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#How-to-know-if-a-network-interface-is-tap-tun-bridge-or-physical"><span class="nav-number">1.29.15.</span> <span class="nav-text">How to know if a network interface is tap, tun, bridge or physical</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#bind-irq-s-of-ethx-to-specific-cpu"><span class="nav-number">1.29.16.</span> <span class="nav-text">bind irq(s) of ethx to specific cpu</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#check-rss-of-ethx"><span class="nav-number">1.29.17.</span> <span class="nav-text">check rss of ethx</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#get-bus-info-for-a-network-device-like-eth0"><span class="nav-number">1.29.18.</span> <span class="nav-text">get bus info for a network device like eth0</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#create-binding-interface-through-sysfs"><span class="nav-number">1.29.19.</span> <span class="nav-text">create binding interface through sysfs</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#icmp-ping-is-ok-but-tcp-connect-fails"><span class="nav-number">1.29.20.</span> <span class="nav-text">icmp ping is ok but tcp connect fails</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Jason"
      src="/uploads/avatar.gif">
  <p class="site-author-name" itemprop="name">Jason</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">150</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">143</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">149</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/jason-cyun" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;jason-cyun" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:jason_lkm@163.com" title="E-Mail → mailto:jason_lkm@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://cyun.tech/2019/09/27/debugging-application/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.gif">
      <meta itemprop="name" content="Jason">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CYun">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="debugging application | CYun">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          debugging application
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2019-09-27 13:29:20" itemprop="dateCreated datePublished" datetime="2019-09-27T13:29:20+08:00">2019-09-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-05-12 10:18:31" itemprop="dateModified" datetime="2025-05-12T10:18:31+08:00">2025-05-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/linux/command/" itemprop="url" rel="index"><span itemprop="name">command</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="debug-application"><a href="#debug-application" class="headerlink" title="debug application"></a>debug application</h1><p>Here are list of frequent commands that are used in daily life and some tips that may be useful to debug application</p>
<span id="more"></span>
<p><strong><mark>tested only on centos7 platform</mark></strong></p>
<h2 id="show-dynamic-library-used-by-an-application"><a href="#show-dynamic-library-used-by-an-application" class="headerlink" title="show dynamic library used by an application"></a>show dynamic library used by an application</h2><div class="tabs" id="way"><ul class="nav-tabs"><li class="tab active"><a href="#way-1">Way 1</a></li><li class="tab"><a href="#way-2">Way 2</a></li></ul><div class="tab-content"><div class="tab-pane active" id="way-1"><div class="note success"><p><strong>$ ldd app_binary</strong><br>output:<br>linux-vdso.so.1 &#x3D;&gt;  (0x00007fff76bcd000)<br>libopenvswitch.so.1 &#x3D;&gt; &#x2F;usr&#x2F;lib&#x2F;libopenvswitch.so.1 (0x00007f19c83c2000)<br>libboost_system.so.1.54.0 &#x3D;&gt; &#x2F;usr&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libboost_system.so.1.54.0 (0x00007f19c81be000)<br>…</p>
</div></div><div class="tab-pane" id="way-2"><div class="note success"><p><strong>$ readelf -d app_binary | grep NEEDED</strong><br>output:<br>0x0000000000000001 (NEEDED)             Shared library: [libopenvswitch.so.1]<br>0x0000000000000001 (NEEDED)             Shared library: [libboost_system.so.1.54.0]<br>…</p>
<p>then find the library path<br><strong>$ locate libopenvswitch.so.1</strong><br>&#x2F;usr&#x2F;lib&#x2F;debug&#x2F;usr&#x2F;lib&#x2F;libopenvswitch.so.1.0.0<br>&#x2F;usr&#x2F;lib&#x2F;libopenvswitch.so.1<br>&#x2F;usr&#x2F;lib&#x2F;libopenvswitch.so.1.0.0</p>
<p>how application searches library</p>
<ul>
<li>directories listed in the LD_LIBRARY_PATH environment variable (DYLD_LIBRARY_PATH on OSX)</li>
<li>directories listed in the executable’s rpath($chrpath -l app)</li>
<li>directories on the system search path, which (on Linux at least) consists of the entries in &#x2F;etc&#x2F;ld.so.conf plus &#x2F;lib and &#x2F;usr&#x2F;lib.</li>
</ul>
</div></div></div></div>

<h2 id="create-and-use-a-static-library"><a href="#create-and-use-a-static-library" class="headerlink" title="create and use a static library"></a>create and use a static library</h2><div class="note success"><p>create static lib from object files<br><strong>$ ar cru libopenvswitch.a stream-ssl.o stream.o</strong><br>later on you may want to add a new object in the lib<br><strong>$ ar crs libopenvswitch.a foo.o</strong></p>
<p>use it in your application<br><strong>$ gcc -o app main.c &#x2F;xx&#x2F;libopenvswitch.a</strong><br>OR<br><strong>$ gcc -o app main.c -lopenvswitch -L&#x2F;path&#x2F;to&#x2F;openvswitch</strong></p>
<p><mark class="label danger">when adding library in gcc command line the order is important, let&#39;s say if A.a depends on B.a, the command should be $ gcc -o app main.c A.a B.a</mark></p>
<p>show all objects in static library<br><strong>$ ar -t libopenvswitch.a</strong><br>extract object file from static library<br><strong>$ ar -xv libopenvswitch.a stream-ssl.o</strong></p>
</div>

<h2 id="create-and-use-a-dynamic-library"><a href="#create-and-use-a-dynamic-library" class="headerlink" title="create and use a dynamic library"></a>create and use a dynamic library</h2><div class="note success"><p><strong>$ gcc -fPIC -g foo.c</strong><br><strong>$ gcc -shared -o libfoo.so foo.o</strong></p>
<p>Use it later on by this way<br><strong>$ gcc -o app main.c libfoo.so</strong><br>Or<br><strong>$ gcc -app main.c -lfoo -L&#x2F;path&#x2F;to&#x2F;foo</strong></p>
</div>

<h2 id="show-symbols-in-dynamics-and-static-library"><a href="#show-symbols-in-dynamics-and-static-library" class="headerlink" title="show symbols in dynamics and static library"></a>show symbols in dynamics and static library</h2><div class="note success"><p><strong>$ readelf -s &#x2F;usr&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libssl.so</strong><br><strong>$ readelf -Ws &#x2F;usr&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libssl.a</strong><br><strong>$ readelf -Ws stream-ssl.o</strong><br><mark class="label danger">-W&#x3D;&#x3D;–wide means show full name of the long symbol</mark></p>
</div>

<h2 id="check-process-thread"><a href="#check-process-thread" class="headerlink" title="check process thread"></a>check process thread</h2><div class="note success"><p>show all processes(not thread) of a given program<br><strong>$ pidof program_name</strong></p>
<p>-s     Single shot - this instructs the program to return only one pid<br><strong>$ pidof -s program_name</strong></p>
<p>-x     Scripts too - this causes the program to also return process id’s of shells running the named scripts<br><strong>$ pidof -x shell_scripts</strong></p>
<p>-o omit pid Tells pidof to omit processes with that process id.<br>The special pid %PPID can be used to name the parent process of the pidof program, in other words the calling shell or shell script.<br>example:</p>
<p>if pidof -o %PPID -x “abc.sh”&gt;&#x2F;dev&#x2F;null; then<br>  echo “Process already running”<br>fi</p>
<p>show threads in a process<br><strong>$ ps -Lf $pid</strong><br>Or see from &#x2F;proc<br><strong>$ ls &#x2F;proc&#x2F;$pid&#x2F;task</strong></p>
</div>

<h2 id="do-everything-in-memory"><a href="#do-everything-in-memory" class="headerlink" title="do everything in memory"></a>do everything in memory</h2><div class="note success"><p>As in some case, you have large memory, you can run all commands in memory, it&#39;s fast, but also note these files<br>will be <mark>lost</mark> after reboot.</p>
<p>For example compile kernel in memory<br><strong>$ tar xjvf linux.tar.gz -C &#x2F;dev&#x2F;shm</strong><br><strong>$ cd &#x2F;dev&#x2F;shm&#x2F;linux</strong><br><strong>$ cp &#x2F;boot&#x2F;config-4.3.3-4.3.y.20151215.ol7.x86_64 .config</strong><br><strong>$ make oldconfig &amp;&amp; make -j32</strong><br><strong>$ make -j32 modules_install</strong><br><strong>$ make install</strong></p>
</div>

<h2 id="debug-dynamic-library-info-when-runs-a-program"><a href="#debug-dynamic-library-info-when-runs-a-program" class="headerlink" title="debug dynamic library info when runs a program"></a>debug dynamic library info when runs a program</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ LD_DEBUG=help ls</span><br><span class="line">Valid options for the LD_DEBUG environment variable are:</span><br><span class="line">libs        display library search paths</span><br><span class="line">reloc       display relocation processing</span><br><span class="line">files       display progress for input file</span><br><span class="line">symbols     display symbol table processing</span><br><span class="line">bindings    display information about symbol binding</span><br><span class="line">versions    display version dependencies</span><br><span class="line">scopes      display scope information</span><br><span class="line">all         all previous options combined</span><br><span class="line">statistics  display relocation statistics</span><br><span class="line">unused      determined unused DSOs</span><br><span class="line">help        display this help message and exit</span><br><span class="line">$ LD_DEBUG=libs ls</span><br><span class="line">$ LD_DEBUG=all ls</span><br></pre></td></tr></table></figure>

<h2 id="useful-commands-in-binutils"><a href="#useful-commands-in-binutils" class="headerlink" title="useful commands in binutils"></a>useful commands in binutils</h2><div class="note success"><p>addr2line, ar, gprof, nm, objdump, readelf, gcov, strip, ranlib, size, strings</p>
<p>ranlib: generates an index to the contents of an archive<br>(below will generate symbol index for the archive but actually, it&#39;s not need as &#39;ar&#39; already takes care of it, you can use &#39;nm -s xxx.a&#39; to check the symbol before running ranlib)<br><strong>$ ranlib xxx.a</strong></p>
<p>size: list the section size of an object or archive file</p>
<p>strings: list printable strings from files<br>(note strings only return printable characters, strings displays all strings that are at least four characters in length in the files but can change with -n)<br>strings is always used to get string from Binary file!!!</p>
<p><strong>$ strings &#x2F;bin&#x2F;ls | grep Copyright</strong></p>
<p>show c++ symbol with namespace<br><strong>$ nm –demangle xxx.a</strong><br>(–demangle shows symbol like namespace::Builder::hello(int); that is readable for human not ABXxxhello33x which is really stored by compiler)<br>output format for nm</p>
<p>A: Archive symbol (from an archive file)<br>B: BSS segment (uninitialized data)<br>C: Common symbol (a type of BSS)<br>D: Data segment (initialized data)<br>G: Global symbol (for dynamic symbols, typically in shared objects)<br>I: Indirect symbol (used in dynamic linking)<br>N: Debugging section (symbol with no defined value)<br>R: Read-only data segment<br>S: Stack segment<br>T: Text segment (code)<br>U: Undefined symbol (a symbol that is referenced but not defined in this object file)<br>W: Weak symbol (a symbol that can be overridden by a definition with the same name)<br>t: Local (static) text (code) symbol<br>d: Local (static) data symbol</p>
</div>

<h2 id="process-affinity"><a href="#process-affinity" class="headerlink" title="process affinity"></a>process affinity</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">task state: ZOMBIE(if child exits, it enters this STATE, waiting parent to read it state, after parent read it by wait() etc, child resource(task_struct) is freed)</span><br><span class="line"></span><br><span class="line">Make sure parent call wait() for its child process when they exit, otherwise resource is leak in kernel as said above!</span><br><span class="line"></span><br><span class="line">priority:</span><br><span class="line">        nice is given when create a process to calculate the static priority</span><br><span class="line">        while scheduling is based on dynamic priority (effective_prio) which considers</span><br><span class="line">        sleep time and static priority</span><br><span class="line"></span><br><span class="line">command</span><br><span class="line">    show nice value</span><br><span class="line">    #ps -axl</span><br><span class="line"></span><br><span class="line">    default priority(20)&lt;-------&gt;nice(0)</span><br><span class="line">    run a program with adjustment nice value</span><br><span class="line">    (nice value for ls ==default_nice_value(0)+(-10)</span><br><span class="line">    #nice -n -10 ls</span><br><span class="line"></span><br><span class="line">    change nice value of processes</span><br><span class="line">    #renice -n 10 -p 1203</span><br><span class="line"></span><br><span class="line">    retrieve task cpu affinity</span><br><span class="line">    #taskset -p 1203</span><br><span class="line"></span><br><span class="line">     cpu7    cpu6  cpu5   cpu4 cpu3  cpu2  cpu1  cpu0</span><br><span class="line">       +      +     +      +    +     +     +     +</span><br><span class="line">       |      |     |      |    |     |     |     |</span><br><span class="line">       +------+-----+-----------+-----+-----+-----+</span><br><span class="line">       |                   |                      |</span><br><span class="line">       |   1111(f)         |       0000(0)        |</span><br><span class="line">       +   cpu mask        +       cpu mask       +</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Let&#x27;s say we have 8 cpus, core id</span><br><span class="line">    begins from 0-7, cpu mask is bits</span><br><span class="line">    each bit represent a cpu, 1/0</span><br><span class="line"></span><br><span class="line">    #taskset -p 1223</span><br><span class="line">    0x03</span><br><span class="line">    affinity mask 0x03 means it runs only on cpu0, cpu1</span><br><span class="line"></span><br><span class="line">    c means use 1, 2, 3 format for cpu not 0x format!!</span><br><span class="line">    #taskset -cp 1223</span><br><span class="line">    pid 1223&#x27;s current affinity list: 0,</span><br><span class="line"></span><br><span class="line">    retrieve task cpu affinity, Only runs on process #0, set it cpu bit with 1</span><br><span class="line">    #taskset -p 0x01 1223</span><br><span class="line">    OR</span><br><span class="line">    #taskset -cp 0 1223</span><br><span class="line"></span><br><span class="line">CPU bandwidth</span><br><span class="line">    /proc/sys/kernel/sched_rt_period_us:</span><br><span class="line">    The scheduling period that is equivalent to 100% CPU</span><br><span class="line">    bandwidth</span><br><span class="line">    /proc/sys/kernel/sched_rt_runtime_us:</span><br><span class="line">    A global limit on how much time realtime scheduling may</span><br><span class="line">    use.</span><br></pre></td></tr></table></figure>

<h2 id="IRQ-affinity-setting"><a href="#IRQ-affinity-setting" class="headerlink" title="IRQ affinity setting"></a>IRQ affinity setting</h2><div class="note success"><p>see cpu affinity for IRQ<br><strong>$ cat &#x2F;proc&#x2F;irq&#x2F;145&#x2F;smp_affinity</strong><br>f<br>(0x1111)<br><strong>$ cat &#x2F;proc&#x2F;irq&#x2F;145&#x2F;smp_affinity_list</strong><br>0-3<br>(cpu0, cpu1, cpu2, cpu3)</p>
</div>

<h2 id="trace-process-by-strace"><a href="#trace-process-by-strace" class="headerlink" title="trace process by strace"></a>trace process by strace</h2><div class="note success"><p>strace&#x2F;ltrace&#x2F;ptrace&#x2F;truss<br>show how much time process spent on system call or library, (the library is C library like, memset, fgets etc)</p>
<p>ptrace is a system call<br>long ptrace(enum __ptrace_request request, pid_t pid, void *addr, void *data);</p>
<p>strace and ltrace are based on ptrace to implement their feature<br>strace&#x2F;truss is used to trace system call and signal when it occurs<br>ltrace is used to trace a process&#39;s library call initially</p>
<p>truss is similar to strace, but it&#39;s for UNIX, not linux</p>
<p><strong><mark>strace is tool we selected for linux</mark></strong><br>#mount -t procfs proc &#x2F;proc<br>#strace -f  -tt -o vim.strace vim</p>
<p>&#x2F;*attach a process to see what system (lib) is calling *&#x2F;<br>#strace -p pid</p>
<p>#strace -f -p pid<br>(monitor parent and all its children, this is what -f option does)</p>
<p>#strace -o filename<br>(save result to a file)<br>#strace -T<br>(show time spent on system call)<br>#strace -t<br>(show time of day)<br>#strace -s 1024<br>(max sie of string to print)<br>#strace -e trace&#x3D;nanosleep<br>     -e trace&#x3D;network<br>     -e trace&#x3D;file<br>     -e trace&#x3D;desc<br>     -e trace&#x3D;signal</p>
<p>(trace a particular event)<br>7) strace -f<br>(trace child as well)<br>8) strace -c<br>(Count time, calls, and errors for each system call and report a summary on program exit)</p>
<p>ltrace also has options above!!!!!</p>
<p>so the usually use case is<br><strong>$ strace -f -c -o result vim</strong></p>
<p>show time, spending time for system call<br><strong>$ strace -f -t -T -o result vim</strong><br>root@manager:~# strace -f -c vim</p>
</div>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">% time     seconds  usecs/call     calls    errors syscall</span><br><span class="line">------ ----------- ----------- --------- --------- ----------------</span><br><span class="line"> 21.81    0.000935           3       309           <span class="built_in">read</span></span><br><span class="line"> 15.35    0.000658           2       383       127 <span class="built_in">stat</span></span><br><span class="line">  9.96    0.000427           3       142         5 open</span><br><span class="line">  9.68    0.000415           6        65           munmap</span><br><span class="line">  6.02    0.000258           2       113           mmap</span><br><span class="line">  5.25    0.000225           2       145           close</span><br><span class="line">  4.15    0.000178           2        86        80 openat</span><br><span class="line">  3.48    0.000149           6        25           write</span><br><span class="line">  3.15    0.000135           4        36           mprotect</span><br><span class="line">  2.61    0.000112           2        59           select</span><br><span class="line">  2.59    0.000111           1       160           fcntl</span><br><span class="line">  2.15    0.000092           1       106           fchdir</span><br><span class="line">  2.05    0.000088           2        37           brk</span><br><span class="line">  1.94    0.000083           1        56           <span class="built_in">chdir</span></span><br><span class="line">  1.70    0.000073           1        83           fstat</span><br><span class="line">  1.24    0.000053           1        56           getcwd</span><br><span class="line">  1.19    0.000051           1        56           lseek</span><br><span class="line">  1.10    0.000047           4        12           getdents</span><br><span class="line">  1.03    0.000044           2        21        20 access</span><br><span class="line">  0.84    0.000036          36         1           <span class="built_in">unlink</span></span><br><span class="line">  0.63    0.000027           1        25           ioctl</span><br><span class="line">  0.42    0.000018           1        24           rt_sigaction</span><br><span class="line">  0.30    0.000013           7         2         2 connect</span><br><span class="line">  0.23    0.000010          10         1           rename</span><br><span class="line">  0.19    0.000008           4         2         2 statfs</span><br><span class="line">  0.16    0.000007           1         7           rt_sigprocmask</span><br><span class="line">  0.16    0.000007           4         2           socket</span><br><span class="line">  0.16    0.000007           7         1           fchown</span><br><span class="line">  0.12    0.000005           1         6           getuid</span><br><span class="line">  0.09    0.000004           4         1           sysinfo</span><br><span class="line">  0.05    0.000002           1         2           getrlimit</span><br><span class="line">  0.05    0.000002           2         1         1 futex</span><br><span class="line">  0.02    0.000001           1         1           execve</span><br><span class="line">  0.02    0.000001           1         1           <span class="built_in">uname</span></span><br><span class="line">  0.02    0.000001           1         2           <span class="built_in">umask</span></span><br><span class="line">  0.02    0.000001           1         1           sigaltstack</span><br><span class="line">  0.02    0.000001           1         1           arch_prctl</span><br><span class="line">  0.02    0.000001           1         1           set_tid_address</span><br><span class="line">  0.02    0.000001           1         1           set_robust_list</span><br><span class="line">------ ----------- ----------- --------- --------- ----------------</span><br><span class="line">100.00    0.004287                  2033       237 total</span><br></pre></td></tr></table></figure>

<h2 id="show-shared-memory-on-the-system"><a href="#show-shared-memory-on-the-system" class="headerlink" title="show shared memory on the system"></a>show shared memory on the system</h2><div class="note success"><p>show ipc shared memory<br><strong>$ ipcs</strong><br>show posix shared memory<br><strong>$ ls &#x2F;dev&#x2F;shm</strong></p>
</div>

<h2 id="only-show-mem-x2F-cpu-usage-of-a-particular-pid"><a href="#only-show-mem-x2F-cpu-usage-of-a-particular-pid" class="headerlink" title="only show mem&#x2F;cpu usage of a particular pid"></a>only show mem&#x2F;cpu usage of a particular pid</h2><div class="note success"><p><strong>$ ps -p 13687  -o %mem&#x3D;</strong><br><strong>$ ps -p 13687  -o %cpu&#x3D;</strong></p>
</div>

<h2 id="show-processes-who-opened-a-file-or-dir"><a href="#show-processes-who-opened-a-file-or-dir" class="headerlink" title="show processes who opened a file or dir"></a>show processes who opened a file or dir</h2><div class="note success"><p>who open the dir only(top level)<br><strong>$ lsof $dir</strong><br>search for all open instances of <code>directory s and the files and directories it contains at its top level</code><br><strong>$ lsof +d $s</strong><br>search for all open instances of directory D and all the files and directories it contains to its complete depth<br><strong>$ lsof +D $s</strong></p>
<p>only this file, who opens the file<br><strong>$ lsof $file</strong></p>
</div>

<h2 id="force-a-running-process-to-generate-a-core-dump"><a href="#force-a-running-process-to-generate-a-core-dump" class="headerlink" title="force a running process to generate a core dump"></a>force a running process to generate a core dump</h2><div class="note success"><p>gcore(from gdb) does NOT kill the process<br><strong>$ gcore  $pid</strong><br>(usually to see the snapshot of the process memory)</p>
<p>kill the process as send abort to the process<br><strong>$ kill -SIGABRT $pid</strong></p>
</div>

<h2 id="signal"><a href="#signal" class="headerlink" title="signal"></a>signal</h2><div class="note success"><p>A few days ago, i landed upon unix signals that lead to process termination. I guess i was trying to remember the signals generated in linux when one presses Ctrl+Z and Ctrl+C. Memory did not serve me at that moment and i decided to look these up, one more time. I realized that having a consolidated book which explains these terms clearly is better than searching loads of webpages. I did the later since i had kept my unix os book away from my reach.To my disappointment, there was no single link that listed out all differences in an orderly fashion.</p>
<p>Hence, in this post, i wish to delineate these terms by consolidating my findings from stackoverflow, wikipedia and other unix internals websites. Here it goes:</p>
<p>SIGKILL: Terminates a process immediately. This signal cannot be handled (caught), ignored or blocked. (The “kill -9” command in linux generates the same signal).</p>
<p>SIGTERM: Terminates a process immediately. However, this signal can be handled, ignored or caught in code. If the signal is not caught by a process, the process is killed. Also, this is used for graceful termination of a process. (The “kill” command in linux if specified without any signal number like -9, will send SIGTERM)</p>
<p>SIGINT: Interrupts a process. (The default action is to terminate gracefully). This too, like, SIGTERM can be handled, ignored or caught. The difference between SIGINT and SIGTERM is that the former can be sent from a terminal as input characters. This is the signal generated when a user presses Ctrl+C. (Sidenote: Ctrl+C denotes EOT(End of Transmission) for (say) a network stream)</p>
<p>SIGQUIT: Terminates a process. This is different from both SIGKILL and SIGTERM in the sense that it generates a core dump of the process and also cleans up resources held up by a process. Like SIGINT, this can also be sent from the terminal as input characters. It can be handled, ignored or caught in code. This is the signal generated when a user presses Ctrl+.</p>
<p>SIGSTP: Suspends a process. This too, can be handled, ignored or blocked. Since it does not terminate the process, the process can be resumed by sending a SIGCONT signal. This signal can be generated by pressing Ctrl+Z. (Sidenote: Ctrl+Z stands for substitute character which indicates End-of-File in DOS)</p>
<p>SIGHUP: (From Wikipedia): Hangs up a process when the controlling terminal is disconnected. This especially relates to modem&#x2F;dial in connections. A process has to explicitly handle this signal for it to work. A good use is to “poke” a process and letting the process (as defined by the programmer) decide what to do with the signal is described here. Hence, SIGHUP can be handled, ignored or caught. This is the signal generated when a user presses Ctrl+D.</p>
<p>Some time, you may want to hang a process for low response</p>
<p>$ kill -STOP $pid<br>$ kill -SIGCONT $pid</p>
</div>

<h2 id="show-environment-variables-of-a-running-process"><a href="#show-environment-variables-of-a-running-process" class="headerlink" title="show environment variables of a running process."></a>show environment variables of a running process.</h2><div class="note success"><p><strong>use gdb, environ is a global variable</strong></p>
<p>environment variables of this process, it’s the final place, absolute right!<br>attach to that process<br>gdb&gt; p environ<br>gdb&gt;environ[0]<br>gdb&gt;environ[1]<br>gdb&gt;environ[2]<br>…<br>gdb&gt;environ[x]</p>
<p><strong>check &#x2F;proc&#x2F;PIDxx&#x2F;environ</strong></p>
<p>it only shows the environment variables when process launches, if you added<br>new environment variable by setenv()[C function], it doesn’t have one that<br>added after process launched!!!</p>
</div>

<h2 id="check-process-name-when-knows-pid"><a href="#check-process-name-when-knows-pid" class="headerlink" title="check process name when knows pid"></a>check process name when knows pid</h2><div class="note success"><p><strong>$ cat &#x2F;proc&#x2F;$pid&#x2F;status</strong></p>
</div>

<h2 id="memory-leak-x2F-overflow-tool"><a href="#memory-leak-x2F-overflow-tool" class="headerlink" title="memory leak&#x2F; overflow tool"></a>memory leak&#x2F; overflow tool</h2><div class="note success"><p>Use tools:<br>valgrind and AddressSanitizer</p>
</div>

<h2 id="shutdown-vs-close"><a href="#shutdown-vs-close" class="headerlink" title="shutdown() vs close()"></a>shutdown() vs close()</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"> shutdown() is useful for deliniating when you are done providing a request to a server using TCP.  A typical use is to send a request to a server followed by a shutdown().  The server will read your request followed by an EOF (read of 0 on most unix implementations).  This tells the server that it has your full request.  You then go read blocked on the socket.  The server will process your request and send the necessary data back to you followed by a close.  When you have finished reading all of the response to your request you will read an EOF thus signifying that you have the whole response.</span><br><span class="line"></span><br><span class="line">The shutdown(s, how) call causes all or part of a full-duplex connection on the socket associated with sockfd to be shut down.</span><br><span class="line">- If how is SHUT_RD, further receptions will be disallowed.</span><br><span class="line">    - No FIN sent, only kernel set the state of socket NOT reading(the peer does not know), should not read any more</span><br><span class="line">    - if read on SHUT_RD, -1(ECONNRESET) reset by peer, or end of file if peer close(fd).</span><br><span class="line"></span><br><span class="line">- If how is SHUT_WR, further transmissions will be disallowed.</span><br><span class="line">    - cause FIN sent to peer and the peer recv EOF()(peer should not send any more, as its peer close reading)`the peer can send data even after receiving EOF`</span><br><span class="line">    - if write again on SHUT_WR socket, exception `SIGPIPE, Broken pipe`.</span><br><span class="line"></span><br><span class="line">- If how is SHUT_RDWR,further receptions and transmissions will be disallowed.</span><br><span class="line">    - Both action above</span><br><span class="line"></span><br><span class="line">- close() can do SHUT_RDWR and tell kernel to free socket resource</span><br><span class="line"></span><br><span class="line">Usage:</span><br><span class="line">- shutdown + close()(only for resource free)</span><br><span class="line">- close() only</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="RESET-TCP-from-application"><a href="#RESET-TCP-from-application" class="headerlink" title="RESET TCP from application"></a>RESET TCP from application</h2><p>if application sent RST(RST flag set) on a tcp socket, the socket will go into <code>Closed state imediately(no FIN sent)</code>, the peer that receives RST packet will go into <code>peer Closed state as well</code>, <code>no need ACK for RST packet</code>, this is the quick way to close tcp conenction and free port.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">linger</span> <span class="title">linger</span>;</span></span><br><span class="line"></span><br><span class="line">linger.l_onoff = <span class="number">1</span>;</span><br><span class="line">linger.l_linger = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span> (setsockopt(fd, SOL_SOCKET, SO_LINGER,</span><br><span class="line">               (<span class="type">const</span> <span class="type">void</span> *) &amp;linger, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> linger)) == <span class="number">-1</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/* log error */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//RST packet is sent when call close()</span></span><br><span class="line">close(fd);</span><br></pre></td></tr></table></figure>

<h2 id="install-debuginfo-of-kernel-or-application-on-centos"><a href="#install-debuginfo-of-kernel-or-application-on-centos" class="headerlink" title="install debuginfo of kernel or application on centos"></a>install debuginfo of kernel or application on centos</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># debuginfo of kernel(kernel is not built by yourself)</span></span><br><span class="line"><span class="variable">$debuginfo</span>-install -y kernel-$(<span class="built_in">uname</span> -r)</span><br><span class="line"></span><br><span class="line"><span class="comment"># debuginfo of application or library installed by yum</span></span><br><span class="line"><span class="variable">$cp</span> CentOS-Debuginfo.repo /etc/yum.repos.d/</span><br><span class="line"><span class="variable">$yum</span> update</span><br><span class="line"><span class="variable">$debuginfo</span>-install libgcc-4.8.5-44.el7.x86_64</span><br></pre></td></tr></table></figure>

<h2 id="show-stack-for-give-process-thread"><a href="#show-stack-for-give-process-thread" class="headerlink" title="show stack for give process(thread)"></a>show stack for give process(thread)</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># show task of the group</span></span><br><span class="line"><span class="variable">$pstack</span> 11289</span><br><span class="line"></span><br><span class="line"><span class="comment"># only print this process itself</span></span><br><span class="line">$/proc/11289/stack</span><br><span class="line"></span><br><span class="line"><span class="comment"># or generate a core without kill this process</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$gcore</span> <span class="variable">$pid</span></span><br></pre></td></tr></table></figure>

<h2 id="pkg-config"><a href="#pkg-config" class="headerlink" title="pkg-config"></a>pkg-config</h2><p><code>pkg-config</code> is a tool to check dependencies for a library, it outputs <code>version, header path, libs</code> of that library, so that someone who <code>uses this library passes these to compiler for building.</code></p>
<p><code>pkg-config</code> gets all these information by checking <code>xxx.pc</code> from several paths, so that if a library wants to be managed by <code>pkg-config</code>, it must proivde a xxx.pc file at some path.</p>
<hr>
<p><strong>&#x2F;usr&#x2F;lib64&#x2F;pkgconfig&#x2F;glib.pc</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">prefix=/usr</span><br><span class="line">exec_prefix=/usr</span><br><span class="line">libdir=/usr/lib64</span><br><span class="line">includedir=/usr/include</span><br><span class="line"></span><br><span class="line">Name: GLib</span><br><span class="line">Description: C Utility Library</span><br><span class="line">Version: 1.2.10</span><br><span class="line">Libs: -L$&#123;libdir&#125; -lglib</span><br><span class="line">Cflags: -I$&#123;includedir&#125;/glib-1.2 -I$&#123;libdir&#125;/glib/include </span><br></pre></td></tr></table></figure>

<hr>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># get default search paths for pkg-config</span></span><br><span class="line"><span class="variable">$pkg</span>-config --variable pc_path pkg-config</span><br><span class="line"></span><br><span class="line"><span class="comment"># change search paths for pkg-config</span></span><br><span class="line">$ <span class="built_in">export</span> PKG_CONFIG_PATH=/usr/lib64/pkgconfig:/usr/share/pkgconfig:/new/path</span><br><span class="line"></span><br><span class="line"><span class="comment"># list all known packages</span></span><br><span class="line"><span class="variable">$pkg</span>-config --list-all</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##################### example ###########################</span></span><br><span class="line"><span class="variable">$pkg</span>-config --modversion gnutls</span><br><span class="line">3.3.29</span><br><span class="line"><span class="variable">$pkg</span>-config --libs  gnutls</span><br><span class="line">-L/usr/lib64 -lgnutls</span><br><span class="line"><span class="variable">$pkg</span>-config --cflags gnutls</span><br><span class="line">-I/usr/include/p11-kit-1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$cat</span> /usr/lib64/pkgconfig/gnutls.pc </span><br><span class="line"><span class="comment"># Process this file with autoconf to produce a pkg-config metadata file.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Copyright (C) 2004-2012 Free Software Foundation, Inc.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Copying and distribution of this file, with or without modification,</span></span><br><span class="line"><span class="comment"># are permitted in any medium without royalty provided the copyright</span></span><br><span class="line"><span class="comment"># notice and this notice are preserved.  This file is offered as-is,</span></span><br><span class="line"><span class="comment"># without any warranty.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Author: Simon Josefsson</span></span><br><span class="line"></span><br><span class="line">prefix=/usr</span><br><span class="line">exec_prefix=/usr</span><br><span class="line">libdir=/usr/lib64</span><br><span class="line">includedir=/usr/include</span><br><span class="line"></span><br><span class="line">Name: GnuTLS</span><br><span class="line">Description: Transport Security Layer implementation <span class="keyword">for</span> the GNU system</span><br><span class="line">URL: http://www.gnutls.org/</span><br><span class="line">Version: 3.3.29</span><br><span class="line">Libs: -L<span class="variable">$&#123;libdir&#125;</span> -lgnutls</span><br><span class="line">Libs.private: /usr/lib64/libz.so     -lp11-kit    -ltspi -lgmp</span><br><span class="line">Requires.private: nettle, hogweed, libtasn1, p11-kit-1, zlib</span><br><span class="line">Cflags: -I<span class="variable">$&#123;includedir&#125;</span></span><br><span class="line"><span class="comment">##################### example ###########################</span></span><br></pre></td></tr></table></figure>
<h2 id="ld-finding-library"><a href="#ld-finding-library" class="headerlink" title="ld finding library"></a>ld finding library</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># when for linking, ld is used, show paths checked for a library</span></span><br><span class="line">$ ld -lopenvswitch --verbose</span><br></pre></td></tr></table></figure>

<h2 id="get-hardware-meta"><a href="#get-hardware-meta" class="headerlink" title="get hardware meta"></a>get hardware meta</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$dmidecode</span></span><br><span class="line"><span class="comment"># dmidecode 3.2</span></span><br><span class="line">Getting SMBIOS data from sysfs.</span><br><span class="line">SMBIOS 2.8 present.</span><br><span class="line">11 structures occupying 539 bytes.</span><br><span class="line">Table at 0x000F70E0.</span><br><span class="line"></span><br><span class="line">Handle 0x0000, DMI <span class="built_in">type</span> 0, 24 bytes</span><br><span class="line">BIOS Information</span><br><span class="line">	Vendor: SeaBIOS</span><br><span class="line">	Version: 1.10.2-1.el7</span><br><span class="line">	Release Date: 04/01/2014</span><br><span class="line">	Address: 0xE8000</span><br><span class="line">	Runtime Size: 96 kB</span><br><span class="line">	ROM Size: 64 kB</span><br><span class="line">	Characteristics:</span><br><span class="line">		BIOS characteristics not supported</span><br><span class="line">		Targeted content distribution is supported</span><br><span class="line">	BIOS Revision: 0.0</span><br><span class="line"></span><br><span class="line">Handle 0x0100, DMI <span class="built_in">type</span> 1, 27 bytes</span><br><span class="line">System Information</span><br><span class="line">	Manufacturer: Red Hat</span><br><span class="line">	Product Name: KVM</span><br><span class="line">	Version: RHEL 7.4.0 PC (i440FX + PIIX, 1996)</span><br><span class="line">	Serial Number: Not Specified</span><br><span class="line">	UUID: Not Settable</span><br><span class="line">	Wake-up Type: Power Switch</span><br><span class="line">	SKU Number: Not Specified</span><br><span class="line">	Family: Red Hat Enterprise Linux</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">####################### PCIE Slot information ============================</span></span><br><span class="line"><span class="comment"># get free pci-e slot, lanes of each slot</span></span><br><span class="line"><span class="comment"># then you can install devices into these slots</span></span><br><span class="line"><span class="variable">$dmidecode</span> --<span class="built_in">type</span> slot</span><br><span class="line">...</span><br><span class="line">Handle 0x0902, DMI <span class="built_in">type</span> 9, 17 bytes</span><br><span class="line">System Slot Information</span><br><span class="line">	Designation: PCIe Slot 4 ----&gt; like a description</span><br><span class="line">	Type: x16 PCI Express 3  ----&gt; 16 lanes PCIE 3.0</span><br><span class="line">	Current Usage: Available ----&gt; this slot is free, can be inserted with pcie device</span><br><span class="line">	Length: Long</span><br><span class="line">	ID: 4</span><br><span class="line">	Characteristics:</span><br><span class="line">		3.3 V is provided</span><br><span class="line">		PME signal is supported</span><br><span class="line"></span><br><span class="line">Handle 0x0903, DMI <span class="built_in">type</span> 9, 17 bytes</span><br><span class="line">System Slot Information</span><br><span class="line">	Designation: PCIe Slot 5 ----&gt; like a description</span><br><span class="line">	Type: x8 PCI Express 3 x16---&gt; electrical 8 lanes but x16 (physical slot), [think it as fake x16]</span><br><span class="line">	Current Usage: In Use     ---&gt; this slot is <span class="keyword">in</span> use</span><br><span class="line">	Length: Long</span><br><span class="line">	ID: 5</span><br><span class="line">	Characteristics:</span><br><span class="line">		3.3 V is provided</span><br><span class="line">		PME signal is supported</span><br><span class="line">	Bus Address: 0000:86:00.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># In some linux kernel, the type may not contain pcie generation info</span></span><br><span class="line"><span class="comment"># then check the pcie generation from link rate</span></span><br><span class="line"><span class="variable">$lspci</span> -s 0000:86:00.0 -vv | egrep  <span class="string">&quot;LnkCap|LnkSta&quot;</span></span><br><span class="line">		LnkCap:	Port <span class="comment">#0, Speed 8GT/s, Width x8, ASPM L0s, Exit Latency L0s &lt;2us, L1 &lt;4us</span></span><br><span class="line">		LnkSta:	Speed 8GT/s, Width x8, TrErr- Train- SlotClk+ DLActive- BWMgmt- ABWMgmt-</span><br><span class="line"></span><br><span class="line"><span class="comment"># LinkCap(Link Capabilities Register): Speed 8GT/s(Data transfer rate)， Width x8(lanes), is the capability supported by slot on motherboard</span></span><br><span class="line"><span class="comment"># LinkSta(Link Status Register): Speed 8GT/s, Width x8, is the result(current speed) after negotiation with pcie device inserted on this slot</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">####################### PCIE Slot information ============================</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="lspci-output"><a href="#lspci-output" class="headerlink" title="lspci output"></a>lspci output</h2><p><code>lspci</code> only shows pci(e) devices which means in-use pci(e) slot, more detail about pci device by <a target="_blank" rel="noopener" href="https://support.xilinx.com/s/article/1148199?language=en_US">lspci and setpci</a> to query and set pci registers</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># list all pci devices</span></span><br><span class="line"><span class="variable">$ls</span> -al /sys/bus/pci/devices</span><br><span class="line">lrwxrwxrwx 1 root root 0 Aug 29 17:59 0000:3b:12.0 -&gt; ../../../devices/pci0000:3a/0000:3a:00.0/0000:3b:12.0</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment"># We can break the device string &quot;0000:3b:12.0&quot; down as follows:</span></span><br><span class="line"><span class="comment"># 0000 : PCI domain (each domain can contain up to 256 PCI buses)</span></span><br><span class="line"><span class="comment"># 3b   : the bus number the device is attached to </span></span><br><span class="line"><span class="comment"># 12   : the device number </span></span><br><span class="line"><span class="comment"># .0   : PCI device function</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># To get additional information about the device, we can change into the 0000:04:00.0 directory and execute our favorite pager to display one or more pseudo-device entries:</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># show number instead of name</span></span><br><span class="line"><span class="variable">$lspci</span> -s 3b:12.0 -n</span><br><span class="line">3b:12.0 0100: 1af4:1042</span><br><span class="line"></span><br><span class="line"><span class="comment"># Field 1 : 3b:12.0 : bus number (3b), device number (12) and function (0) </span></span><br><span class="line"><span class="comment"># Field 2 : 0100    : device class </span></span><br><span class="line"><span class="comment"># Field 3 : 1af4    : vendor ID </span></span><br><span class="line"><span class="comment"># Field 4 : 1042    : device ID</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Or more easy way and more details</span></span><br><span class="line"><span class="variable">$lspci</span> -s 3b:12.0 -nmv</span><br><span class="line">Device:	3b:12.0</span><br><span class="line">Class:	0100</span><br><span class="line">Vendor:	1af4</span><br><span class="line">Device:	1042</span><br><span class="line">SVendor:	1172</span><br><span class="line">SDevice:	0001</span><br><span class="line">NUMANode:	0</span><br><span class="line"></span><br><span class="line"><span class="comment"># To convert the identifiers to human-readable strings, we can look up the identifiers in the PCI ID repository: http://pci-ids.ucw.cz/</span></span><br><span class="line"><span class="comment"># Field 2 : 0100   : class 0200 is listed as a &quot;SCSI storage controller&quot;</span></span><br><span class="line"><span class="comment"># Field 3 : 1af4   : vendor ID 1af4 is listed as the &quot;Red Hat, Inc.&quot; </span></span><br><span class="line"><span class="comment"># Field 4 : 1000   : device ID 1042 is listed as a &quot;Virtio 1.0 block device&quot;</span></span><br><span class="line"></span><br><span class="line">$ lspci</span><br><span class="line">3b:12.0 SCSI storage controller: Red Hat, Inc Virtio block device</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h2 id="coredump-without-symbol-table"><a href="#coredump-without-symbol-table" class="headerlink" title="coredump without symbol table"></a>coredump without symbol table</h2><p>As in production env, symbol table is stripped to reduce the binary size, but external symbol table is generated and stored somewhere usually, so that when core happens, it’s esay for us to know why.</p>
<p><strong>but what about no external symbol what we can do?</strong><br>Stack analysis: Analyze the stack trace in the core dump to understand the sequence of function calls leading up to the crash(use virtual address and objdump -d binary to find the assembly code, with the assembly code, try to map the source). This can provide insights into the program’s execution flow and potentially identify the source of the problem.</p>
<p>Register analysis: Examine the register values in the core dump to understand the state of the program at the time of the crash. This can help you identify any abnormal values or conditions that may have caused the crash.</p>
<p>Keep in mind that without symbols, the information obtained from the core dump analysis will be limited. It will be <code>difficult to pinpoint the exact cause of the crash or understand the specific code paths leading to it.</code></p>
<h2 id="network-related"><a href="#network-related" class="headerlink" title="network related"></a>network related</h2><h3 id="enable-forwarding-in-kernel"><a href="#enable-forwarding-in-kernel" class="headerlink" title="enable forwarding in kernel"></a>enable forwarding in kernel</h3><div class="note success"><p>open &#x2F;etc&#x2F;sysctl.conf<br>enable net.ipv4.ip_forward&#x3D;1<br>enable ipv6 forwarding set net.ipv6.conf.all.forwarding&#x3D;1<br>then restart sysctl service</p>
<p>Actually, all variables in &#x2F;etc&#x2F;sysctl.conf will be applied to corresponding kernel variables through &#x2F;proc or sysctl API<br><strong>Note:  proc for sysctl is at  &#x2F;proc&#x2F;sys</strong><br><strong>$ cat &#x2F;proc&#x2F;sys&#x2F;net&#x2F;ipv4&#x2F;ip_forward</strong></p>
</div>

<h3 id="IP-address-and-Route"><a href="#IP-address-and-Route" class="headerlink" title="IP address and Route"></a>IP address and Route</h3><div class="note success"><p><strong><mark>IP Address</mark></strong><br>Displaying existing addresses<br><strong>ip [-6] addr show [dev <interface>]</strong></p>
<p>Add an IP address<br><strong>ip [-6] addr add <ipaddress>&#x2F;<prefixlength> dev <interface></strong><br><strong>ip -6 addr add 2001:0db8:0:f101::1&#x2F;64 dev eth0</strong></p>
<p>Removing an IP address<br><strong>ip [-6] addr del <ipv6address>&#x2F;<prefixlength> dev <interface></strong><br><strong>ip -6 addr del 2001:0db8:0:f101::1&#x2F;64 dev eth0</strong></p>
<p><strong><mark>IP Route</mark></strong><br>show ip routes on all interface<br><strong>ip [-6] route show</strong><br>show ip routes on particular interface<br><strong>ip [-6] route show dev eth0</strong></p>
<p>Add an IP route through a gateway<br><strong>ip [-6] route add <ipnetwork>&#x2F;<prefixlength> via <ipaddress> [dev <device>]</strong><br><strong>ip -6 route add 2000::&#x2F;64 via 2001:0db8:0:f101::1</strong></p>
<p>Removing an IP route through a gateway<br><strong>ip [-6] route del <ipnetwork>&#x2F;<prefixlength> via <ipaddress> [dev <device>]</strong><br><strong>ip -6 route del 2000::&#x2F;3 via 2001:0db8:0:f101::1</strong></p>
<p>Add an IP route through an interface<br><strong>ip [-6] route add <ipnetwork>&#x2F;<prefixlength> dev <device> metric 1</strong><br><strong>ip -6 route add 2000::&#x2F;3 dev eth0 metric 1</strong></p>
<p>Removing an IP route through an interface<br><strong>ip [-6] route del <ipnetwork>&#x2F;<prefixlength> dev <device></strong><br><strong>ip -6 route del 2000::&#x2F;3 dev eth0</strong></p>
</div>

<h3 id="Deep-into-route-table"><a href="#Deep-into-route-table" class="headerlink" title="Deep into route table"></a>Deep into route table</h3><div class="note success"><p><mark>Actually, kernel supports 255 route tables with priority, the two main<br>used ones are local table and main table, local table can’t be modified, controlled by kernel<br>while main table is the default table when you use tools to add&#x2F;delete&#x2F;create route, they are in main table</mark></p>
<p><strong>which table should we use when packet comes in?</strong><br>First check local table, if not match, check main table, DO NOT check other table if no<br>policy(ip rule) is configure, otherwise, check other table based on rule, skip local and main</p>
<p><mark>For example, tag skb with mark 1, if skb with mark 1, lookup table 100</mark></p>
<p><strong>iptables -t mangle -A PREROUTING -j MARK –set-mark 1</strong><br><strong>ip rule add fwmark 1 lookup 100</strong><br><strong>ip route add local 0.0.0.0&#x2F;0 dev lo table 100</strong></p>
<p>Show routes in different tables(default is main)<br><strong>ip -6 route show</strong><br><strong>ip -6 route show table main</strong><br><strong>ip -6 route show table all</strong><br><strong>ip -6 route show table local</strong><br><strong>ip -6 route show table 100</strong></p>
</div>

<p>lets explain the output fields for each route with ipv4 as example</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">$ ifconfig</span><br><span class="line">docker0   Link encap:Ethernet  HWaddr 02:42:32:26:c0:ce</span><br><span class="line">          inet addr:172.17.0.2  Bcast:172.17.255.255  Mask:255.255.0.0</span><br><span class="line">          inet6 addr: fe80::42:32ff:fe26:c0ce/64 Scope:Link</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">          RX packets:27408 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:30149 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:0</span><br><span class="line">          RX bytes:1717078 (1.7 MB)  TX bytes:67951999 (67.9 MB)</span><br><span class="line"></span><br><span class="line">eth0      Link encap:Ethernet  HWaddr 00:50:56:91:d7:c1</span><br><span class="line">          inet addr:10.107.60.8  Bcast:10.117.7.255  Mask:255.255.252.0</span><br><span class="line">          inet6 addr: fe80::250:56ff:fe91:d7c1/64 Scope:Link</span><br><span class="line">          inet6 addr: fc00:10:117:7:250:56ff:fe91:d7c1/64 Scope:Global</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">          RX packets:20424652 errors:1753 dropped:2707017 overruns:0 frame:0</span><br><span class="line">          TX packets:2390188 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:1000</span><br><span class="line">          RX bytes:9346260108 (9.3 GB)  TX bytes:32523341970 (32.5 GB)</span><br><span class="line"></span><br><span class="line">lo        Link encap:Local Loopback</span><br><span class="line">          inet addr:127.0.0.1  Mask:255.0.0.0</span><br><span class="line">          inet6 addr: ::1/128 Scope:Host</span><br><span class="line">          UP LOOPBACK RUNNING  MTU:65536  Metric:1</span><br><span class="line">          RX packets:754204 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:754204 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:1</span><br><span class="line">          RX bytes:74578327 (74.5 MB)  TX bytes:74578327 (74.5 MB)</span><br><span class="line"></span><br><span class="line">(base) root@dev:~/$ ip route show</span><br><span class="line">default via 10.117.7.253 dev eth0 onlink</span><br><span class="line"><span class="comment"># default gateway 10.117.7.253 output eth0</span></span><br><span class="line">10.117.4.0/22 dev eth0  proto kernel  scope <span class="built_in">link</span>  src 10.117.6.8</span><br><span class="line"><span class="comment"># scope link(local network 10.117.4.0/22), src 10.117.6.8 eth0&#x27;s ip</span></span><br><span class="line">172.17.0.0/16 dev docker0  proto kernel  scope <span class="built_in">link</span>  src 172.17.0.2</span><br><span class="line"><span class="comment"># scope link(local network 172.17.0.0/16), src 172.17.0.2 docker0&#x27;s ip</span></span><br><span class="line"><span class="comment">#local network, match subnet.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(base) root@dev:~/<span class="comment"># ip route show table local</span></span><br><span class="line">broadcast 10.117.4.0 dev eth0  proto kernel  scope <span class="built_in">link</span>  src 10.117.6.8</span><br><span class="line"><span class="built_in">local</span> 10.117.6.8 dev eth0  proto kernel  scope host  src 10.117.6.8</span><br><span class="line"><span class="comment"># local mapped to RT_LOCAL(kernel) eth0, scope host-&gt;0 hop, myself</span></span><br><span class="line">broadcast 10.117.7.255 dev eth0  proto kernel  scope <span class="built_in">link</span>  src 10.117.6.8</span><br><span class="line">broadcast 127.0.0.0 dev lo  proto kernel  scope <span class="built_in">link</span>  src 127.0.0.1</span><br><span class="line"><span class="built_in">local</span> 127.0.0.0/8 dev lo  proto kernel  scope host  src 127.0.0.1</span><br><span class="line"><span class="built_in">local</span> 127.0.0.1 dev lo  proto kernel  scope host  src 127.0.0.1</span><br><span class="line"><span class="comment"># local mapped to RT_LOCAL(kernel) lo, scope host-&gt;0 hop, myself</span></span><br><span class="line">broadcast 127.255.255.255 dev lo  proto kernel  scope <span class="built_in">link</span>  src 127.0.0.1</span><br><span class="line">broadcast 172.17.0.0 dev docker0  proto kernel  scope <span class="built_in">link</span>  src 172.17.0.2</span><br><span class="line"><span class="built_in">local</span> 172.17.0.2 dev docker0  proto kernel  scope host  src 172.17.0.2</span><br><span class="line"><span class="comment"># local mapped to RT_LOCAL(kernel) docker0, scope host-&gt;0 hop, myself</span></span><br><span class="line">broadcast 172.17.255.255 dev docker0  proto kernel  scope <span class="built_in">link</span>  src 172.17.0.2</span><br><span class="line"><span class="comment"># local address, match 255.255.255.255, exact match</span></span><br></pre></td></tr></table></figure>
<h3 id="prevent-route-missing-after-reboot"><a href="#prevent-route-missing-after-reboot" class="headerlink" title="prevent route missing after reboot"></a>prevent route missing after reboot</h3><div class="note success"><p>There are two ways to do this</p>
<ol>
<li><p>add static route</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Centos</span></span><br><span class="line"><span class="comment"># /etc/sysconfig/network-scripts/route-eth0 created if not there</span></span><br><span class="line"></span><br><span class="line">default via 10.10.10.1 dev eth0</span><br><span class="line">10.117.0.0/16 via 10.117.1.1 dev eth0</span><br><span class="line"><span class="comment"># from terminal restart network service</span></span><br><span class="line"><span class="variable">$sudo</span> service network restart</span><br></pre></td></tr></table></figure>
</li>
<li><p>save route table and restore it after reboot</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sudo</span> ip route save &gt;dump</span><br><span class="line"></span><br><span class="line"><span class="comment"># after reboot</span></span><br><span class="line"><span class="variable">$sudo</span> ip route restore &lt;dump</span><br></pre></td></tr></table></figure></li>
</ol>
</div>

<h3 id="show-arp-entry"><a href="#show-arp-entry" class="headerlink" title="show arp entry"></a>show arp entry</h3><div class="note success"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># incomplete means request is sent and no reply</span></span><br><span class="line">$ arp -n</span><br><span class="line">Address                  HWtype  HWaddress           Flags Mask            Iface</span><br><span class="line">172.17.0.6                       (incomplete)                              docker0</span><br><span class="line">172.17.0.2                       12:64:0b:38:ea:49                         docker0</span><br><span class="line">10.226.134.65            ether   1c:ab:34:33:81:84   C                     eth0</span><br><span class="line">127.0.0.3                ether   02:00:00:12:34:05   CM                    loopback-279</span><br><span class="line"></span><br><span class="line"><span class="comment"># if you delete an entry, it will be marked incomplete, you still see such entry</span></span><br><span class="line">$ arp -d 172.17.0.2</span><br><span class="line">$ arp -n</span><br><span class="line">Address                  HWtype  HWaddress           Flags Mask            Iface</span><br><span class="line">172.17.0.6                       (incomplete)                              docker0</span><br><span class="line">172.17.0.2                       (incomplete)                              docker0</span><br><span class="line">10.226.134.65            ether   1c:ab:34:33:81:84   C                     eth0</span><br><span class="line">127.0.0.3                ether   02:00:00:12:34:05   CM                    loopback-279</span><br><span class="line"></span><br><span class="line">Flags:</span><br><span class="line">C-----&gt;entry is completed</span><br><span class="line">M------&gt;Permanent entries, user added.</span><br></pre></td></tr></table></figure></div>

<h3 id="save-tcpdump-captured-packet-to-file"><a href="#save-tcpdump-captured-packet-to-file" class="headerlink" title="save tcpdump captured packet to file"></a>save tcpdump captured packet to file</h3><div class="note success"><p><strong>$ tcpdump -i eth0 -s 0 -w &#x2F;home&#x2F;lzq&#x2F;pt.pcap</strong><br>-s limits the size of packet<br>-o indicates no limition!</p>
</div>

<h3 id="packet-shows-as-tcp-segment-of-a-reassembled-pdu-in-wireshark"><a href="#packet-shows-as-tcp-segment-of-a-reassembled-pdu-in-wireshark" class="headerlink" title="packet shows as tcp segment of a reassembled pdu in wireshark"></a>packet shows as tcp segment of a reassembled pdu in wireshark</h3><div class="note success"><p>This is due to application message(PDU) is larger than MSS, tcp splits it into several tcp segments, but tcp segment has no Fragment flag, how does wireshark know several tcp segments belong to same PDU?</p>
<p>wireshark thinks if several tcp segments have the same ACK number but different sequence numbers, they belong to same PDU, refer to </p>
</div>

<h3 id="get-two-sides-of-established-STREAM-socket"><a href="#get-two-sides-of-established-STREAM-socket" class="headerlink" title="get two sides of established STREAM socket"></a>get two sides of established STREAM socket</h3><div class="note success"><p>STREAM socket can be over TCP or unix, for TCP, it’s easy to get it, here we foucus on UNIX STREAM socket with <code>ss</code> command.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">State      Recv-Q Send-Q Local Address:Port              Peer Address:Port                <span class="built_in">local</span> process <span class="built_in">who</span> uses <span class="built_in">local</span> address          </span><br><span class="line"><span class="comment"># -t for tcp</span></span><br><span class="line"><span class="comment"># -u for udp</span></span><br><span class="line"><span class="comment"># -w for Raw</span></span><br><span class="line"><span class="comment"># -x for unix</span></span><br><span class="line"><span class="comment"># -p show process name and id</span></span><br><span class="line"><span class="variable">$ss</span> -tp | grep libvirtd</span><br><span class="line">ESTAB      0      0      172.17.0.2:55758                172.17.0.3:16508                 <span class="built_in">users</span>:((<span class="string">&quot;libvirtd&quot;</span>,pid=5056,fd=22))</span><br><span class="line"></span><br><span class="line"><span class="comment"># for unix established socket</span></span><br><span class="line"><span class="comment"># stream client side: Peer Address is *, Port is unix socket inode, same thing for local address and port as well</span></span><br><span class="line"><span class="comment"># stream server side: Peer Address is *, Port is unix socket inode, while local address is unix path, port is unix socket inode</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># as you can see virsh use unix socket(254243) to connect peer who uses 254245 unix socket</span></span><br><span class="line"><span class="variable">$ss</span> -xp | grep virsh</span><br><span class="line">u_str  ESTAB      0      0       * 254243                * 254245                <span class="built_in">users</span>:((<span class="string">&quot;virsh&quot;</span>,pid=11049,fd=6))</span><br><span class="line"></span><br><span class="line"><span class="comment"># it&#x27;s clear</span></span><br><span class="line"><span class="comment"># virsh connects with libivrt on path /var/run/libvirt/libvirt-sock </span></span><br><span class="line"><span class="variable">$ss</span> -xp | grep 254245</span><br><span class="line">u_str  ESTAB      0      0      /var/run/libvirt/libvirt-sock 254245                * 254243                <span class="built_in">users</span>:((<span class="string">&quot;libvirtd&quot;</span>,pid=5056,fd=21))</span><br><span class="line">u_str  ESTAB      0      0       * 254243                * 254245                <span class="built_in">users</span>:((<span class="string">&quot;virsh&quot;</span>,pid=11049,fd=6))</span><br></pre></td></tr></table></figure></div>

<h3 id="show-all-sockets"><a href="#show-all-sockets" class="headerlink" title="show all sockets"></a>show all sockets</h3><div class="note success"><p><strong>$ netstat -a -t     #all tcp  sockets</strong><br><strong>$ netstat -a -u     #all udp  sockets</strong><br><strong>$ netstat -a -w     #all raw  sockets</strong><br><strong>$ netstat -a -x     #all unix sockets</strong><br><strong>$ netstat -tulpn    #l means listening p with program name</strong><br><mark class="label danger">Note: if -a is not present, it will only display socket in established state</mark></p>
<p>Show all files opened by a process and -P(show number not name for host, port)<br><strong>$ lsof -p pid -P</strong><br>show which process opens a socket on particular port<br><strong># lsof -i:80</strong></p>
</div>

<h3 id="check-x2F-set-mtu-or-MAC"><a href="#check-x2F-set-mtu-or-MAC" class="headerlink" title="check&#x2F;set mtu or MAC"></a>check&#x2F;set mtu or MAC</h3><div class="note success"><p><strong>$ ifconfig eth1</strong><br><strong>$ ifcofnig eth1 mtu 1500</strong></p>
<p><strong>temporary</strong><br><strong>$ ifconfig eth0 down</strong><br><strong>$ ifconfig eth0 hw ether 00:80:48:BA:d1:30</strong><br><strong>$ ifconfig eth0 up</strong></p>
<p><strong>permanently</strong><br>Centos7<br>edit &#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-eth0<br>    <strong>MACADDR&#x3D;02:01:02:03:04:0</strong></p>
</div>

<h3 id="socket-bind-to-no-local-address"><a href="#socket-bind-to-no-local-address" class="headerlink" title="socket bind to no-local address"></a>socket bind to no-local address</h3><div class="note success"><p>if you bind() normally, the ip address must be one of the host’s address</p>
<p>bind can be usedin two cases:</p>
<ul>
<li>server call socket&#x2F;bind&#x2F;listen&#x2F;accpet, that means only the dst is for bind address, it will accept it, otherwise no.</li>
<li>client call bind, socket&#x2F;bind&#x2F;send, that means client uses the bind address as the source address when sending packet.</li>
</ul>
<p>but for some case, you want to bind an address which is no-local(none of the host address) which is always need for loadbalancer server!</p>
<p>global setting, so that every application can bind non local address<br><strong>$ echo 1 &gt; &#x2F;proc&#x2F;sys&#x2F;net&#x2F;ipv4&#x2F;ip_nonlocal_bind</strong></p>
<p>enable it on a socket of the process<br><strong>In programe code, call setsocketopt(IP_TRANSPARENT, 1), then</strong><br><strong>$ setcap CAP_NET_ADMIN program(before program runs)</strong></p>
<p>IP_TRANSPARENT (since Linux 2.6.24)<br>Setting this boolean option enables transparent proxying on<br>this socket.  This socket option allows the calling<br>application to bind to a nonlocal IP address and operate both<br>as a client and a server with the foreign address as the local<br>endpoint.</p>
<p><strong>NOTE: for receiving non-local address that requires routing should be set up in a way that packets going to the foreign address are routed through the TProxy box (i.e., the system hosting the application that employs the IP_TRANSPARENT socket option), make sure packet is not dropped before reaching tproxy module in kernel</strong></p>
<p>Enabling this socket option requires superuser privilege(the CAP_NET_ADMIN capability).</p>
</div>

<h3 id="source-port-selection"><a href="#source-port-selection" class="headerlink" title="source port selection"></a>source port selection</h3><div class="note success"><p><strong>if not set source port explicitly by bind(), source port selected from below range</strong><br>$ cat &#x2F;proc&#x2F;sys&#x2F;net&#x2F;ipv4&#x2F;ip_local_port_range<br>32768	60999</p>
<p><strong>change the source port range</strong><br>$ sysctl -w  net.ipv4.ip_local_port_range&#x3D;1024 4095</p>
</div>

<h3 id="create-vlan-interface-and-check-its-real-dev"><a href="#create-vlan-interface-and-check-its-real-dev" class="headerlink" title="create vlan interface and check its real dev"></a>create vlan interface and check its real dev</h3><p>As vlan interface is a virtual device, so it must attach to a ‘real’ device, ‘real’ does not mean it must be a physical, it could be another virtual device as well, when send traffic on the vlan interface, it sends out to ‘real’ device after adding vlan id, call ‘real’ device’s dev_queue_xmit().</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># must provide &#x27;real&#x27; device when creating vlan interface, two vlan interfaces can point to same &#x27;real&#x27; deivce.</span></span><br><span class="line">$ ip <span class="built_in">link</span> add <span class="built_in">link</span> ens192 name ens192.100 <span class="built_in">type</span> vlan <span class="built_in">id</span> 100</span><br><span class="line">$ ip <span class="built_in">link</span> <span class="built_in">set</span> dev ens192.100 up</span><br><span class="line">$ ip -d <span class="built_in">link</span> show ens192.100</span><br><span class="line">446: ens192.100@ens192: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 00:50:56:b2:01:75 brd ff:ff:ff:ff:ff:ff promiscuity 0</span><br><span class="line">    vlan protocol 802.1Q <span class="built_in">id</span> 100 &lt;REORDER_HDR&gt; addrgenmode eui64 numtxqueues 1 numrxqueues 1 gso_max_size 65536 gso_max_segs 65535</span><br><span class="line"></span><br><span class="line"><span class="comment"># ens192.100@ens192  &#x27;real device&#x27; ens192</span></span><br><span class="line"><span class="comment"># vlan protocol 802.1Q id 100</span></span><br><span class="line"></span><br><span class="line">$ ip <span class="built_in">link</span> add <span class="built_in">link</span> ens192 name ens192.200 <span class="built_in">type</span> vlan <span class="built_in">id</span> 200</span><br><span class="line">$ ip <span class="built_in">link</span> <span class="built_in">set</span> dev ens192.200 up</span><br><span class="line">$ ip -d <span class="built_in">link</span> show ens192.200</span><br><span class="line">447: ens192.200@ens192: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 00:50:56:b2:01:75 brd ff:ff:ff:ff:ff:ff promiscuity 0</span><br><span class="line">    vlan protocol 802.1Q <span class="built_in">id</span> 200 &lt;REORDER_HDR&gt; addrgenmode eui64 numtxqueues 1 numrxqueues 1 gso_max_size 65536 gso_max_segs 65535</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ens192.200@ens192  &#x27;real device&#x27; ens192</span></span><br><span class="line"><span class="comment"># vlan protocol 802.1Q id 200</span></span><br></pre></td></tr></table></figure>

<h3 id="check-tcp-fastopen-cookie"><a href="#check-tcp-fastopen-cookie" class="headerlink" title="check tcp fastopen cookie"></a>check tcp fastopen cookie</h3><p>When tcp fastopen is enabled both on client and server side, client sends cookie request as TCP option, server sends cookie as TCP option as well, client saves it at kernel with key(dstip: port), when next TCP SYN will send the cookie if for same dst:port</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># check cookie saved by kernel</span></span><br><span class="line">$ sudo ip tcp_metrics</span><br><span class="line">10.10.10.10 age 4.764sec cwnd 10 rtt 110us rttvar 188us fo_mss 65495 fo_cookie a427a77724e9229f <span class="built_in">source</span> 10.117.6.2</span><br><span class="line"><span class="comment"># fo_cookie is sent by server and save at client in kernel</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># check cookie only for dst 10.10.10.10</span></span><br><span class="line">$ sudo ip tcp_metrics 10.10.10.10</span><br><span class="line"></span><br><span class="line"><span class="comment"># flush cookie</span></span><br><span class="line">$ sudo ip tcp_metrics flush</span><br><span class="line">$ sudo ip tcp_metrics flush 10.10.10.10</span><br></pre></td></tr></table></figure>
<p><strong>NOTE when TCP fastopen is enabled(setsockopt), use send() not connect() to setup TCP connection</strong></p>
<h3 id="How-to-know-if-a-network-interface-is-tap-tun-bridge-or-physical"><a href="#How-to-know-if-a-network-interface-is-tap-tun-bridge-or-physical" class="headerlink" title="How to know if a network interface is tap, tun, bridge or physical"></a>How to know if a network interface is tap, tun, bridge or physical</h3><p><code>ethtool -i tunOrTapDeviceName</code></p>
<ul>
<li>In case of a TAP device we will get: “bus-info: tap”.</li>
<li>In case of a TUN device we will get: “bus-info: tun”.</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ ethtool -i vnet0</span><br><span class="line">driver: tun</span><br><span class="line">version: 1.6</span><br><span class="line">firmware-version: </span><br><span class="line">expansion-rom-version: </span><br><span class="line">bus-info: tap</span><br><span class="line">supports-statistics: no</span><br><span class="line">supports-test: no</span><br><span class="line">supports-eeprom-access: no</span><br><span class="line">supports-register-dump: no</span><br><span class="line">supports-priv-flags: no</span><br></pre></td></tr></table></figure>

<h3 id="bind-irq-s-of-ethx-to-specific-cpu"><a href="#bind-irq-s-of-ethx-to-specific-cpu" class="headerlink" title="bind irq(s) of ethx to specific cpu"></a>bind irq(s) of ethx to specific cpu</h3><p><a target="_blank" rel="noopener" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/6/html/performance_tuning_guide/s-cpu-irq">irq binding</a></p>
<p><strong>do it by yourself</strong></p>
<ol>
<li>get irq of the ethx</li>
<li>set affinity of each irq</li>
</ol>
<p><strong>use vendor script</strong></p>
<ul>
<li>Mellanox: &#x2F;usr&#x2F;sbin&#x2F;set_irq_affinity_bynode.sh socket ethN</li>
<li>Chelsio: &#x2F;sbin&#x2F;t4_perftune.sh</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># get irq of eth0, for ethx that support multiple queues, for each queue there is a irq number</span></span><br><span class="line"><span class="variable">$grep</span> eth0-TxRx /proc/interrupts | awk <span class="string">&#x27;&#123;printf &quot;  %s\n&quot;, $1&#125;&#x27;</span></span><br><span class="line">103:</span><br><span class="line">104:</span><br><span class="line">105:</span><br><span class="line">106:</span><br><span class="line">107:</span><br><span class="line">108:</span><br><span class="line">109:</span><br><span class="line">110:</span><br><span class="line">111:</span><br><span class="line">112:</span><br><span class="line">113:</span><br><span class="line">114:</span><br><span class="line">115:</span><br><span class="line">116:</span><br><span class="line">117:</span><br><span class="line">118:</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment"># cpu 0 for irq 103</span></span><br><span class="line"><span class="variable">$echo</span> 1 &gt; /proc/irq/103/smp_affinity</span><br></pre></td></tr></table></figure>

<h3 id="check-rss-of-ethx"><a href="#check-rss-of-ethx" class="headerlink" title="check rss of ethx"></a>check rss of ethx</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#+++++++++++++++++++++++++++++ One Way++++++++++++++++++++++++++++++++++++++++</span></span><br><span class="line"><span class="comment"># if rss is enabled, ethx should have multiple queues</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># with hardware rss </span></span><br><span class="line"><span class="variable">$ls</span> /sys/class/net/eth0/queues/</span><br><span class="line">rx-0   rx-12  rx-16  rx-2   rx-23  rx-27  rx-30  rx-34  rx-38  rx-41  rx-45  rx-49  rx-52  rx-56  rx-6   rx-7  tx-1   tx-13  tx-17  tx-20  tx-24  tx-28  tx-31  tx-35  tx-39  tx-42  tx-46  tx-5   tx-53  tx-57  tx-60  tx-8</span><br><span class="line">rx-1   rx-13  rx-17  rx-20  rx-24  rx-28  rx-31  rx-35  rx-39  rx-42  rx-46  rx-5   rx-53  rx-57  rx-60  rx-8  tx-10  tx-14  tx-18  tx-21  tx-25  tx-29  tx-32  tx-36  tx-4   tx-43  tx-47  tx-50  tx-54  tx-58  tx-61  tx-9</span><br><span class="line">rx-10  rx-14  rx-18  rx-21  rx-25  rx-29  rx-32  rx-36  rx-4   rx-43  rx-47  rx-50  rx-54  rx-58  rx-61  rx-9  tx-11  tx-15  tx-19  tx-22  tx-26  tx-3   tx-33  tx-37  tx-40  tx-44  tx-48  tx-51  tx-55  tx-59  tx-62</span><br><span class="line">rx-11  rx-15  rx-19  rx-22  rx-26  rx-3   rx-33  rx-37  rx-40  rx-44  rx-48  rx-51  rx-55  rx-59  rx-62  tx-0  tx-12  tx-16  tx-2   tx-23  tx-27  tx-30  tx-34  tx-38  tx-41  tx-45  tx-49  tx-52  tx-56  tx-6   tx-7</span><br><span class="line"></span><br><span class="line"><span class="comment"># no rss</span></span><br><span class="line"><span class="variable">$ls</span> /sys/class/net/eth0/queues/</span><br><span class="line">rx-0 tx-0</span><br><span class="line"></span><br><span class="line"><span class="comment"># with RSS, there are multiple irqs, for each irq there are two queues rx-x and tx-x</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#+++++++++++++++++++++++++++++ Another Way++++++++++++++++++++++++++++++++++++++++</span></span><br><span class="line"><span class="variable">$ethtool</span> -l eth0</span><br><span class="line">Channel parameters <span class="keyword">for</span> eth0:</span><br><span class="line">Pre-<span class="built_in">set</span> maximums:</span><br><span class="line">RX:		0</span><br><span class="line">TX:		0</span><br><span class="line">Other:		0</span><br><span class="line">Combined:	1 --------------------------&gt; one queue, no RSS</span><br><span class="line">Current hardware settings:</span><br><span class="line">RX:		0</span><br><span class="line">TX:		0</span><br><span class="line">Other:		0</span><br><span class="line">Combined:	1</span><br><span class="line"></span><br><span class="line"><span class="variable">$ethtool</span> -l eth0</span><br><span class="line">Channel parameters <span class="keyword">for</span> eth0:</span><br><span class="line">Pre-<span class="built_in">set</span> maximums:</span><br><span class="line">RX:		0</span><br><span class="line">TX:		0</span><br><span class="line">Other:		1</span><br><span class="line">Combined:	63-------------------------&gt;63 queueus(63 rx and 63 tx), RSS supported by hardware!!!</span><br><span class="line">Current hardware settings:</span><br><span class="line">RX:		0</span><br><span class="line">TX:		0</span><br><span class="line">Other:		1</span><br><span class="line">Combined:	63</span><br></pre></td></tr></table></figure>

<h3 id="get-bus-info-for-a-network-device-like-eth0"><a href="#get-bus-info-for-a-network-device-like-eth0" class="headerlink" title="get bus info for a network device like eth0"></a>get bus info for a network device like eth0</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">################# use ethtool=====================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># you can also get bus info, driver info etc</span></span><br><span class="line"><span class="variable">$ethtool</span> -i eth0</span><br><span class="line">driver: mlx5_core      --------------------&gt; driver info</span><br><span class="line">version: 5.6-1.0.3</span><br><span class="line">firmware-version: 16.33.1048 (MT_0000000241)</span><br><span class="line">expansion-rom-version: </span><br><span class="line">bus-info: 0000:4b:00.0 --------------------&gt; bus info here</span><br><span class="line">supports-statistics: <span class="built_in">yes</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">################ check /sys filesystem ===========</span></span><br><span class="line"><span class="variable">$grep</span> PCI_SLOT_NAME /sys/class/net/*/device/uevent | grep eth0</span><br><span class="line">/sys/class/net/eth0/device/uevent:PCI_SLOT_NAME=0000:4b:00.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># check device for this (it&#x27;s physical function)</span></span><br><span class="line"><span class="variable">$lspci</span> -D | grep 0000:4b:00.0</span><br><span class="line">0000:4b:00.0 Ethernet controller: Mellanox Technologies MT27800 Family [ConnectX-5]</span><br><span class="line"></span><br><span class="line"><span class="comment"># show more details about this device</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$lspci</span> -vv -s 0000:4b:00.0</span><br><span class="line">4b:00.0 Ethernet controller: Mellanox Technologies MT27800 Family [ConnectX-5] ---------------------&gt;Mellanox Connect-5</span><br><span class="line">	Subsystem: Mellanox Technologies Device 0052</span><br><span class="line">	Physical Slot: 19                                                          ----------------------&gt;physical Slot</span><br><span class="line">    ...</span><br><span class="line">	Interrupt: pin A routed to IRQ 18                                          ----------------------&gt; IRQ</span><br><span class="line">	NUMA node: 0                                                               ----------------------&gt; Numa node it belongs to</span><br><span class="line">	Region 0: Memory at 9c000000 (64-bit, prefetchable) [size=32M]</span><br><span class="line">	Expansion ROM at 99000000 [disabled] [size=1M]</span><br><span class="line">    ....</span><br><span class="line">	Capabilities: [180 v1] Single Root I/O Virtualization (SR-IOV)             -----------------------&gt;Caps like SR-IOV</span><br><span class="line">		IOVCap:	Migration-, Interrupt Message Number: 000</span><br><span class="line">		IOVCtl:	Enable- Migration- Interrupt- MSE- ARIHierarchy+</span><br><span class="line">		IOVSta:	Migration-</span><br><span class="line">		Initial VFs: 127, Total VFs: 127, Number of VFs: 0, Function Dependency Link: 00</span><br><span class="line">		VF offset: 2, stride: 1, Device ID: 1018</span><br><span class="line">		Supported Page Size: 000007ff, System Page Size: 00000001</span><br><span class="line">		Region 0: Memory at 00000000a5f00000 (64-bit, prefetchable)</span><br><span class="line">		VF Migration: offset: 00000000, BIR: 0</span><br><span class="line">    ...</span><br><span class="line">	Kernel driver <span class="keyword">in</span> use: mlx5_core                                           -------------------------&gt; driver <span class="keyword">in</span> use</span><br><span class="line">	Kernel modules: mlx5_core</span><br><span class="line"></span><br><span class="line"><span class="comment">####################### another example##################################</span></span><br><span class="line"><span class="variable">$ethtool</span> -i enp75s17f2np0</span><br><span class="line">driver: mlx5_core</span><br><span class="line">version: 5.6-1.0.3</span><br><span class="line">firmware-version: 16.33.1048 (MT_0000000241)</span><br><span class="line">expansion-rom-version: </span><br><span class="line">bus-info: 0000:4b:11.2</span><br><span class="line">....</span><br><span class="line"></span><br><span class="line"><span class="variable">$lspci</span> -D | grep 0000:4b:11.2</span><br><span class="line">0000:4b:11.2 Ethernet controller: Mellanox Technologies MT27800 Family [ConnectX-5 Virtual Function]----&gt; VF</span><br><span class="line"></span><br><span class="line"><span class="comment"># show only given pci device</span></span><br><span class="line"><span class="variable">$lspci</span> -vv -s 0000:4b:11.2</span><br><span class="line">4b:11.2 Ethernet controller: Mellanox Technologies MT27800 Family [ConnectX-5 Virtual Function]  -----&gt; Mellanox VF</span><br><span class="line">	Subsystem: Mellanox Technologies Device 0052</span><br><span class="line">	NUMA node: 0                                                                                 ------&gt; no physical slot,no IRQ, numa node it blongs to</span><br><span class="line">	Region 0: [virtual] Memory at 9e900000 (64-bit, prefetchable) [size=1M]</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">    Capabilities: [9c] MSI-X: Enable+ Count=6 Masked-                                            -------&gt; MSI-X with six msx-irqs</span><br><span class="line">        Vector table: BAR=0 offset=00002000</span><br><span class="line">        PBA: BAR=0 offset=00003000</span><br><span class="line"></span><br><span class="line">	Kernel driver <span class="keyword">in</span> use: mlx5_core</span><br><span class="line">	Kernel modules: mlx5_core</span><br></pre></td></tr></table></figure>

<h3 id="create-binding-interface-through-sysfs"><a href="#create-binding-interface-through-sysfs" class="headerlink" title="create binding interface through sysfs"></a>create binding interface through sysfs</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#first check all existing bindings</span></span><br><span class="line"><span class="variable">$modprobe</span> --first-time bonding</span><br><span class="line"><span class="variable">$cat</span> /sys/class/net/bonding_masters</span><br><span class="line"></span><br><span class="line"><span class="comment"># create binding interface</span></span><br><span class="line"><span class="variable">$echo</span> +bond0 &gt;/sys/class/net/bonding_masters</span><br><span class="line">(after this <span class="comment">#ifconfig -a to check or /sys/class/net/bond1 created)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># add slaves to binding interface</span></span><br><span class="line"><span class="variable">$ifconfig</span> eth0 down</span><br><span class="line"><span class="variable">$ifconfig</span> eth1 down</span><br><span class="line"><span class="variable">$echo</span> +eth0 &gt;/sys/class/net/bond1/bonding/slaves</span><br><span class="line"><span class="variable">$echo</span> +eth1 &gt;/sys/class/net/bond1/bonding/slaves</span><br><span class="line"></span><br><span class="line"><span class="comment"># configure binding interface like mode and its address</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$echo</span> active-backup &gt;/sys/class/net/bond1/bonding/mode</span><br><span class="line"><span class="variable">$ifconfig</span> bond1 192.168.100.1 netmask 255.255.255.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># enable bonding interface</span></span><br><span class="line"><span class="variable">$ifconfig</span> bond1 up</span><br><span class="line"><span class="comment"># (these will bring up all slaves in it)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># <span class="doctag">NOTE:</span> remove in revert order with &quot;-&quot; prefix</span></span><br></pre></td></tr></table></figure>
<h3 id="icmp-ping-is-ok-but-tcp-connect-fails"><a href="#icmp-ping-is-ok-but-tcp-connect-fails" class="headerlink" title="icmp ping is ok but tcp connect fails"></a>icmp ping is ok but tcp connect fails</h3><p>Tcp connection fails with ‘NO route to host’ while ping is ok, it’s probably packet is dropped by firewall.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># --- Way1: use tcpdump to see where packet dropped</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line">04:10:28.906424 IP dev-162 &gt; 22.7.73.161: ICMP host dev-162 unreachable - admin prohibited filter, length 68 -----&gt; as you can seee <span class="string">&quot;admin prohibited&quot;</span> means firewall drops it.</span><br><span class="line"></span><br><span class="line"><span class="comment"># --- Way2: check iptables rules</span></span><br><span class="line">sudo iptables -L -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># --- Way3: check firewalld(firwalld can use iptables or nftable as backend)</span></span><br><span class="line"><span class="comment"># you can not see firewall ruels if it uses nftable as backend.</span></span><br><span class="line">$ sudo systemctl status firewalld</span><br><span class="line"></span><br><span class="line"><span class="comment"># To see the current configuration, including allowed services and ports, use:</span></span><br><span class="line">$ sudo firewall-cmd --list-all</span><br><span class="line"></span><br><span class="line"><span class="comment"># For a more detailed view of all active zones and their settings, use:</span></span><br><span class="line">$ sudo firewall-cmd --get-active-zones</span><br><span class="line">$ sudo firewall-cmd --get-default-zone</span><br><span class="line"></span><br><span class="line"><span class="comment"># list rich rules</span></span><br><span class="line">$ sudo firewall-cmd --list-rich-rules</span><br></pre></td></tr></table></figure>
    </div>

    
    
    
      


    <footer class="post-footer">
          <div class="reward-container">
  <div></div>
  <button>
    Donate
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechatpay.jpeg" alt="Jason WeChat Pay">
        <span>WeChat Pay</span>
      </div>

  </div>
</div>

          <div class="post-tags">
              <a href="/tags/linux/" rel="tag"># linux</a>
              <a href="/tags/linux-command/" rel="tag"># linux command</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2019/09/26/linux-performance-tools/" rel="prev" title="performance tools">
                  <i class="fa fa-chevron-left"></i> performance tools
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2019/10/11/docker-core-tech-chroot/" rel="next" title="docker-core-tech-chroot">
                  docker-core-tech-chroot <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments utterances-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2018 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Cyun All rights reserved</span>
</div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.0/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>



  <script src="/js/third-party/fancybox.js"></script>

  <script src="/js/third-party/pace.js"></script>

  




<script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"jason-bj/blog","issue_term":"pathname","theme":"github-light"}</script>
<script src="/js/third-party/comments/utterances.js"></script>

</body>
</html>
