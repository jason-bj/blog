<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon/favicon-16x16.png">
  <meta name="google-site-verification" content="xitt2fbphh1nTeWLiTWc0lCggHuxJ5heMcAzkHW2vno">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Microsoft+YaHei+UI:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"cyun.tech","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.11.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"utterances","storage":true,"lazyload":false,"nav":null,"activeClass":"utterances"},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":10,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="FAQsHere are list of faqs that are asked for web beginner, like what Vary is and difference between Content-Encoding and Transfer-Encoding, what conditional request is etc.">
<meta property="og:type" content="article">
<meta property="og:title" content="http-protocol-faq">
<meta property="og:url" content="http://cyun.tech/2019/12/13/http-protocol-faq/index.html">
<meta property="og:site_name" content="CYun">
<meta property="og:description" content="FAQsHere are list of faqs that are asked for web beginner, like what Vary is and difference between Content-Encoding and Transfer-Encoding, what conditional request is etc.">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2019-12-13T01:02:34.000Z">
<meta property="article:modified_time" content="2023-08-16T15:02:01.150Z">
<meta property="article:author" content="Jason">
<meta property="article:tag" content="http">
<meta property="article:tag" content="faq">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://cyun.tech/2019/12/13/http-protocol-faq/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://cyun.tech/2019/12/13/http-protocol-faq/","path":"2019/12/13/http-protocol-faq/","title":"http-protocol-faq"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>http-protocol-faq | CYun</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-148730544-1"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-148730544-1","only_pageview":false}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>

  <script src="/js/third-party/analytics/baidu-analytics.js"></script>
  <script async src="https://hm.baidu.com/hm.js?a510d1f580c8231f8f867d14f42bb8ea"></script>




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">CYun</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#FAQs"><span class="nav-number">1.</span> <span class="nav-text">FAQs</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#How-response-Vary-header-is-used"><span class="nav-number">1.1.</span> <span class="nav-text">How response Vary header is used</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#what-q-x3D-0-6-mean-in-header-value"><span class="nav-number">1.2.</span> <span class="nav-text">what q&#x3D;0.6 mean in header value</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#how-Etag-is-generated"><span class="nav-number">1.3.</span> <span class="nav-text">how Etag is generated</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#headers-related-to-resume-from-break-point"><span class="nav-number">1.4.</span> <span class="nav-text">headers related to resume from break point</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Expires-vs-Cache-Control-max-age-value-header"><span class="nav-number">1.5.</span> <span class="nav-text">Expires vs Cache-Control(max-age value) header</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Ways-to-do-conditional-request"><span class="nav-number">1.6.</span> <span class="nav-text">Ways to do conditional request</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#TE-and-Transfer-Encoding-header"><span class="nav-number">1.7.</span> <span class="nav-text">TE and Transfer-Encoding header</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Accept-Encoding-and-Content-Encoding"><span class="nav-number">1.8.</span> <span class="nav-text">Accept-Encoding and Content-Encoding</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Content-Encoding-vs-Transfer-Encoding"><span class="nav-number">1.9.</span> <span class="nav-text">Content-Encoding vs Transfer-Encoding</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#method-PUT-whole-update-vs-POST-new-vs-PATCH-part-update"><span class="nav-number">1.10.</span> <span class="nav-text">method PUT(whole update) vs POST(new) vs PATCH(part update)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#GET-VS-HEAD"><span class="nav-number">1.11.</span> <span class="nav-text">GET VS HEAD</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#OPTIONS-method"><span class="nav-number">1.12.</span> <span class="nav-text">OPTIONS method</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#how-to-create-a-forever-http-connection"><span class="nav-number">1.13.</span> <span class="nav-text">how to create a forever http connection</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Jason"
      src="/uploads/avatar.gif">
  <p class="site-author-name" itemprop="name">Jason</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">150</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">143</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">149</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/jason-cyun" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;jason-cyun" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:jason_lkm@163.com" title="E-Mail → mailto:jason_lkm@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://cyun.tech/2019/12/13/http-protocol-faq/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.gif">
      <meta itemprop="name" content="Jason">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CYun">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="http-protocol-faq | CYun">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          http-protocol-faq
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2019-12-13 09:02:34" itemprop="dateCreated datePublished" datetime="2019-12-13T09:02:34+08:00">2019-12-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-08-16 23:02:01" itemprop="dateModified" datetime="2023-08-16T23:02:01+08:00">2023-08-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/http-protocol/" itemprop="url" rel="index"><span itemprop="name">http-protocol</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/http-protocol/faq/" itemprop="url" rel="index"><span itemprop="name">faq</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="FAQs"><a href="#FAQs" class="headerlink" title="FAQs"></a>FAQs</h1><p>Here are list of faqs that are asked for web beginner, like <code>what Vary is</code> and difference between <code>Content-Encoding and Transfer-Encoding</code>, what <code>conditional request</code> is etc.</p>
<span id="more"></span>
<h2 id="How-response-Vary-header-is-used"><a href="#How-response-Vary-header-is-used" class="headerlink" title="How response Vary header is used"></a>How response Vary header is used</h2><p>In some case, server may return <code>different responses for the same uri</code> based on some info from request  headers, the based on headers are put in <code>Vary header</code>, one typical example is web server returns different web pages for mobile and desktop, but the uri is same, that means response depends on <code>User-Agent</code> request header, so put <code>User-Agent</code> in Vary response header, when proxy(nginx always cache response) receives the response, <code>it (nginx) stores the response with key (uri, User-Agent)</code>, next time when a new request comes in with same uri but different user-agent, proxy should request a fresh one from origin server, not use cached data, as the User-Agent(secondary key when searching cache) is different.</p>
<p><strong>response depends on User-Agent and Cookie</strong></p>
<ul>
<li><code>Vary: User-Agent, Cookie</code></li>
</ul>
<p>In one word, <code>it tells downstream proxies how to match future request headers to decide whether the cached response can be used rather than requesting a fresh one from the origin server.</code></p>
<h2 id="what-q-x3D-0-6-mean-in-header-value"><a href="#what-q-x3D-0-6-mean-in-header-value" class="headerlink" title="what q&#x3D;0.6 mean in header value"></a>what q&#x3D;0.6 mean in header value</h2><p>As for some headers, like <code>Accept-Language</code>, <code>Accept</code> it could contain multiple values, in that case which value should be used by server, q(relative quality factor) is used for this, <code>it indicates preference of each value, server should use highest one(q value is larger)</code>, when sends response to client, here is an example:</p>
<p><code>Accept-Language: en-us,en;q=0.5</code></p>
<p>en-us uses default q&#x3D;1 which is higher than en, so when server sends response to client, it should use en-us Language if it supports.</p>
<p><strong>Rules</strong></p>
<ul>
<li>without q provided use <code>default q=1</code></li>
<li><code>high</code> value means <code>much prefer</code></li>
<li>value <code>range [0, 1]</code></li>
<li><strong>format <code>value;q=0.5</code></strong></li>
</ul>
<h2 id="how-Etag-is-generated"><a href="#how-Etag-is-generated" class="headerlink" title="how Etag is generated"></a>how Etag is generated</h2><p>Etag(response header) is an <code>identifier for a specific version of a resource</code>(mostly for static resource), often a <code>hash value</code> of a resource, it’s generated by web server based on attributes(size, inode, modified-time etc) of the resource.</p>
<p><code>ETag: &quot;737060cd8c284d8af7ad3082f209582d&quot;</code></p>
<h2 id="headers-related-to-resume-from-break-point"><a href="#headers-related-to-resume-from-break-point" class="headerlink" title="headers related to resume from break point"></a>headers related to resume from break point</h2><p>In order to support this, client can request partial range of content, while server must support partial request, there are three headers, two response headers <code>Accept-Ranges</code>, <code>Content-Range</code>, one request header <code>Range</code>.</p>
<ul>
<li><code>Accept-Ranges</code> indicates if server supports partial request</li>
<li><code>Range</code> indicates which range client wants to get</li>
<li><code>Content-Range</code> indicates which range that server sends it to client.</li>
</ul>
<p><strong>server declares it supports</strong></p>
<p><code>Accept-Ranges: bytes</code></p>
<p><strong>client request a range</strong></p>
<p><code>Range: bytes=500-999</code></p>
<p><strong>server send the conent of that range</strong></p>
<p><code>Content-Range : bytes 500-999/1234</code></p>
<h2 id="Expires-vs-Cache-Control-max-age-value-header"><a href="#Expires-vs-Cache-Control-max-age-value-header" class="headerlink" title="Expires vs Cache-Control(max-age value) header"></a>Expires vs Cache-Control(max-age value) header</h2><p><code>Cache-Control</code> was introduced in <code>HTTP/1.1</code> and <code>offers more options than Expires</code>. They can be used to accomplish the same thing.</p>
<p>The data value for Expires is an <code>HTTP date</code> whereas Cache-Control max-age lets you specify a <code>relative amount of time</code> so you could specify ‘X hours after the page was requested’.</p>
<p>If a response includes a Cache-Control field with the max-age directive, a recipient MUST ignore the Expires field.</p>
<p><code>Cache-Control: max-age=3600</code></p>
<p><code>Expires: Tue, 18 Jul 2017 16:07:23 GMT</code></p>
<p><code>Always use Cache-Control as it offers more options</code></p>
<h2 id="Ways-to-do-conditional-request"><a href="#Ways-to-do-conditional-request" class="headerlink" title="Ways to do conditional request"></a>Ways to do conditional request</h2><p>Conditional request means client provides <code>condition</code> to server, server checks the <code>condition</code> if matched, sends the resource, otherwise, only sends header with special status code.</p>
<p><strong>Old way(http1.0)</strong></p>
<p><code>If-Unmodified-Since and If-Modified-Since, where the client sends a timestamp of the resource.</code></p>
<p><strong>http 1.1</strong></p>
<p><code>If-Modified and If-None-Modified, where the client sends an ETag representation of the resource</code></p>
<p><strong>Difference:</strong></p>
<p>Dates can be ordered, ETags can not.</p>
<p>This means that if some resource was modified a year ago, but never since, and we know it. Then we can correctly answer an If-Unmodified-Since request for arbitrary dates the last year and agree that sure… it has been unmodified since that date.</p>
<p>An Etag is only comparable for identity. Either it is <code>the same or it is not</code>. If you have the same resource as above, and during the year the docroot has been moved to a new disk and filesystem, giving all files new inodes but preserving modification dates. And someone had based the ETags on file’s inode number. Then we can’t say that the old ETag is still okay, without having a log of past-still-okay-ETags.</p>
<p>So I don’t see them as one obsoleting the other. They are for different situations. Either you can easily get a Last-Modified date of all the data in the page you’re about to serve, or you can easily get an ETag for what you will serve.</p>
<p>If you have a <code>dynamic webpage</code> with data from lots of db lookups it might be difficult to tell what the Last-Modified date is without making your database contain lots of modification dates. But you can always make an <code>md5 checksum of the result rendered page</code>.</p>
<p>When supporting these cache protocols I definitely go for only one of them, never both.</p>
<h2 id="TE-and-Transfer-Encoding-header"><a href="#TE-and-Transfer-Encoding-header" class="headerlink" title="TE and Transfer-Encoding header"></a>TE and Transfer-Encoding header</h2><p>The <code>TE request header</code> specifies the <code>transfer encodings the user agent is willing to accept</code>. (you could informally call it Accept-Transfer-Encoding, which would be more intuitive).</p>
<p><code>TE: chunked</code></p>
<p>The <code>Transfer-Encoding response header</code> specifies the form of encoding used to safely transfer the <code>payload body</code> to the user</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#chunked, only for Http1.1</span><br><span class="line">Transfer-Encoding: chunked</span><br><span class="line"></span><br><span class="line">#no encoding at transfor level</span><br><span class="line">Transfer-Encoding: identity</span><br></pre></td></tr></table></figure>

<p><strong>In which case chunked is used</strong></p>
<p>Regards to chunked encoding, there is one important response header <code>Trailer</code>, it allows the sender to include <code>additional fields(header) at the end of chunked messages</code> in order to supply metadata that might be dynamically generated while the message body is sent, such as a message integrity check, digital signature, or post-processing status.</p>
<p><code>Note: The TE request header needs to be set to &quot;trailers&quot; to allow trailer fields.</code></p>
<p>Chunked encoding is useful when larger amounts of data are sent to the client and <code>the total size of the response may not be known until the request has been fully processed</code>. For example, when generating a large HTML table resulting from a database query or when transmitting large images.</p>
<p>Data is sent in a series of chunks. The <code>Content-Length header is omitted</code> in this case and at the beginning of each chunk you need to add the length of the current chunk in <code>hexadecimal format</code>, followed by ‘\r\n’ and then the chunk itself, followed by another ‘\r\n’. The terminating chunk is a regular chunk, with the exception that its length is zero. It is followed by the trailer, which consists of a (possibly empty) sequence of entity header fields.</p>
<p>A chunked response looks like this:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type: text/plain</span><br><span class="line">Transfer-Encoding: chunked</span><br><span class="line">Trailer: Expires</span><br><span class="line"></span><br><span class="line">7\r\n</span><br><span class="line">Mozilla\r\n</span><br><span class="line">9\r\n</span><br><span class="line">Developer\r\n</span><br><span class="line">7\r\n</span><br><span class="line">Network\r\n</span><br><span class="line">0\r\n</span><br><span class="line">Expires: Wed, 21 Oct 2015 07:28:00 GMT\r\n</span><br><span class="line">\r\n</span><br></pre></td></tr></table></figure>

<h2 id="Accept-Encoding-and-Content-Encoding"><a href="#Accept-Encoding-and-Content-Encoding" class="headerlink" title="Accept-Encoding and Content-Encoding"></a>Accept-Encoding and Content-Encoding</h2><p>The Content-Encoding entity header is used to <strong>compress the media-type</strong>. When present, its value indicates which encodings were applied to the entity-body. It <code>lets the client know how to decode in order to obtain the media-type referenced by the Content-Type header</code>.</p>
<p>The recommendation is to compress data as much as possible and therefore to use this field, but some types of resources, such as <code>jpeg images, are already compressed</code></p>
<p>The Accept-Encoding request HTTP header advertises which content encoding, usually a compression algorithm, <code>the client is able to understand</code>.</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Accept-Encoding: gzip</span><br><span class="line">Accept-Encoding: compress</span><br><span class="line">Accept-Encoding: deflate</span><br><span class="line"></span><br><span class="line"># As long as the identity value, meaning no encoding in some case like for image format.</span><br><span class="line">Accept-Encoding: identity</span><br></pre></td></tr></table></figure>

<p><code>Note: browser will decompress payload and show uncompressed web page to user</code></p>
<h2 id="Content-Encoding-vs-Transfer-Encoding"><a href="#Content-Encoding-vs-Transfer-Encoding" class="headerlink" title="Content-Encoding vs Transfer-Encoding"></a>Content-Encoding vs Transfer-Encoding</h2><p>Content-Encoding is how content is encoding, like if the web page is 100k, it’s better to encode it with gzip to reduce the payload, when server gets the encode data(or server encodes it by itself), the server may decide to transfer the gzip data(<code>Content-Encoding: gzip</code>) with chunked format(<code>Transfer-Encoding: chunked</code>), that’s what they are,  they apply at different levels, <code>Transfer-Encoding is hop by hop, it may change during transferring proxy</code>, while <code>Content-Encoding is end-to-end proxy never touch the payload!</code></p>
<p><code>Without Content-Encoding, assume it&#39;s uncompressed, without Transfer-Encoding, assume it&#39;s not chunked, but must has Content-length if has body</code></p>
<h2 id="method-PUT-whole-update-vs-POST-new-vs-PATCH-part-update"><a href="#method-PUT-whole-update-vs-POST-new-vs-PATCH-part-update" class="headerlink" title="method PUT(whole update) vs POST(new) vs PATCH(part update)"></a>method PUT(whole update) vs POST(new) vs PATCH(part update)</h2><p>The POST method is used to <code>submit an entity to the specified resource</code>, often causing a change in state or side effects on the server. <code>plan to create new</code>, if you run many times with same uri, many new objects may be created with same value</p>
<p><code>POST /questions</code></p>
<p>The PUT method <code>replaces all current representations of the target resource with the request payload</code>, or create new one if not found, <code>plan to replace</code>, if you run many times with same uri, there is only one objects created, as <code>PUT must provide a identity</code></p>
<p><code>PUT /questions/&#123;question-id&#125;</code></p>
<p>The PATCH method is used to apply <code>partial modifications to a resource.</code></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">method                          PATCH     POST         PUT</span><br><span class="line">Request has body	            Yes       Yes          Yes</span><br><span class="line">Successful response has body	Yes       Yes          NO</span><br><span class="line">Safe	                        No        NO           NO</span><br><span class="line">Idempotent	                    No        NO           Yes</span><br><span class="line">Cacheable	                    No        NO           NO</span><br><span class="line">Allowed in HTML forms	        No        Yes          NO</span><br><span class="line"></span><br><span class="line">Safe:       no side effect</span><br><span class="line">Idempotent: same result if ran many times</span><br></pre></td></tr></table></figure>

<p>A POST request is typically sent via an HTML form and results in a change on the server, in this case, it only supports three content types</p>
<ul>
<li>application&#x2F;x-www-form-urlencoded: <code>the keys and values are encoded in key-value tuples separated by &#39;&amp;&#39;, with a &#39;=&#39; between the key and the value.</code> Non-alphanumeric characters in both keys and values are percent encoded: this is the reason why this type is not suitable to use with binary data (use multipart&#x2F;form-data instead)</li>
</ul>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST /test HTTP/1.1</span><br><span class="line">Host: foo.example</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 27</span><br><span class="line"></span><br><span class="line">field1=value1&amp;field2=value2</span><br></pre></td></tr></table></figure>

<ul>
<li><p>multipart&#x2F;form-data: each value is sent as a block of data (“body part”), with a user agent-defined delimiter (“boundary”) separating each part. The keys are given in the Content-Disposition header of each part.</p>
</li>
<li><p>text&#x2F;plain</p>
</li>
</ul>
<p><code>When the POST request is sent via a method other than an HTML form — like via an XMLHttpRequest(like in script) — the body can take any type</code></p>
<h2 id="GET-VS-HEAD"><a href="#GET-VS-HEAD" class="headerlink" title="GET VS HEAD"></a>GET VS HEAD</h2><p>The GET method requests a representation of the specified resource. Requests using <strong>GET should only retrieve data.</strong></p>
<p>The HEAD method asks for a response identical to that of a GET request, but <strong>without the response body.</strong></p>
<p><strong>HEAD same as GET but without body returned</strong></p>
<h2 id="OPTIONS-method"><a href="#OPTIONS-method" class="headerlink" title="OPTIONS method"></a>OPTIONS method</h2><p>The OPTIONS method is used to describe the communication options for the target resource.<br>The client can specify a URL for the OPTIONS method, or an asterisk (*) to refer to the entire server.</p>
<p><strong>Identifying allowed request methods</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ curl -X OPTIONS http://example.org -i</span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Date: Mon, 16 Dec 2019 02:57:20 GMT</span><br><span class="line">Content-Type: text/html</span><br><span class="line">Content-Length: 0</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Server: Apache/2.4.7 (Ubuntu)</span><br><span class="line">Allow: GET,HEAD,POST,OPTIONS</span><br></pre></td></tr></table></figure>
<h2 id="how-to-create-a-forever-http-connection"><a href="#how-to-create-a-forever-http-connection" class="headerlink" title="how to create a forever http connection"></a>how to create a forever http connection</h2><p>To open a connection that never dies until close it by explicitly</p>
<ul>
<li>Websocket</li>
<li>send http request with transfer-encoding: Chunked, but never set terminating chunk <code>0\r\n</code></li>
</ul>
<p>In the above two ways, after get respone from sever, server will not close it, the close happends only when client closes it or client sends <code>\0\r\n</code> to server</p>

    </div>

    
    
    
      


    <footer class="post-footer">
          <div class="reward-container">
  <div></div>
  <button>
    Donate
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechatpay.jpeg" alt="Jason WeChat Pay">
        <span>WeChat Pay</span>
      </div>

  </div>
</div>

          <div class="post-tags">
              <a href="/tags/http/" rel="tag"># http</a>
              <a href="/tags/faq/" rel="tag"># faq</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2019/12/13/http-protocol-cookie/" rel="prev" title="http-protocol-cookie">
                  <i class="fa fa-chevron-left"></i> http-protocol-cookie
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2019/12/16/http-protocol-connection/" rel="next" title="http-protocol-connection">
                  http-protocol-connection <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments utterances-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2018 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Cyun All rights reserved</span>
</div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.0/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>



  <script src="/js/third-party/fancybox.js"></script>

  <script src="/js/third-party/pace.js"></script>

  




<script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"jason-bj/blog","issue_term":"pathname","theme":"github-light"}</script>
<script src="/js/third-party/comments/utterances.js"></script>

</body>
</html>
